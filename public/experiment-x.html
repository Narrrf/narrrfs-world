<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🧪 Lab Preview - Narrrf's World</title>
  
  <!-- 🚫 Prevent Game Over and Rotate Device Alerts on Mobile -->
  <script>
    // Override any alert function that might show unwanted messages
    const originalAlert = window.alert;
    window.alert = function(message) {
      // Block any "game over" or "rotate device" related alerts
      if (typeof message === 'string') {
        const lowerMessage = message.toLowerCase();
        if (lowerMessage.includes('game over') || 
            lowerMessage.includes('rotate') || 
            lowerMessage.includes('device') ||
            lowerMessage.includes('orientation')) {
          console.log('Blocked unwanted alert:', message);
          return;
        }
      }
      // Allow other alerts to work normally
      return originalAlert.apply(this, arguments);
    };
  </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="discord-config.js"></script>

  <!-- Carousel & Lab Animations -->
  <style>
    @keyframes labBubble {
      0% { transform: translateY(0) scale(1); opacity: 0.7; }
      100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
    }
    .animate-lab-bubble {
      animation: labBubble 5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.05); }
    }
    .animate-pulse {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes floatMouse {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
    .floaty {
      animation: floatMouse 3s ease-in-out infinite;
    }
@keyframes scaleIn {
  0% {
    transform: scale(0.7);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}
.animate-scaleIn {
  animation: scaleIn 0.6s ease-out forwards;
}

  </style>
</head>


<body class="relative bg-gradient-to-br from-purple-50 to-pink-100 text-gray-900 font-sans min-h-screen overflow-x-hidden">

<body>
  <!-- 
  🧪 CRITICAL LAB NOTES: EXPERIMENT-X.HTML (GAME MECHANICS & TESTING)
  ------------------------------------------------------------
  Purpose: 
    - Showcase of early test visuals, mutated scenes, and game mechanic experiments.
    - Links to **NFT traits** and **Hytopia land** integration.
    - **Backend Data** for dynamic plot ownership and staking rewards.

  💾 **SQL Structure**:
    - Tables for **user plots**, **staking rewards**, **NFT traits**.
    - **Dynamic data** for **plot ownership** and **NFT traits**.

  🧠 **Game Features**:
    - Users with **NFT traits** can access **Hytopia land** in **Experiment X**.
    - Rewards and **staking stats** tied to **NFT ownership**


  <!-- 🧪 Navigation -->
  <header class="bg-black text-white py-4 px-6 shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <a href="index.html" class="text-xl font-bold tracking-tight">🧠 Narrrf's World</a>
      <nav class="space-x-4 text-sm md:text-base flex items-center">
        <a href="index.html" class="hover:text-pink-400">Home</a>
        <a href="mint.html" class="hover:text-pink-400">Mint</a>
        <a href="whitepaper.html" class="hover:text-pink-400">Whitepaper</a>
        <a href="get-roles.html" class="hover:text-pink-400">Get Roles</a>
        <a href="project-updates.html" class="hover:text-pink-400">Updates</a>
        <a href="faq.html" class="hover:text-pink-400">FAQ</a>
        <button id="connect-wallet-btn" onclick="connectWallet()" class="ml-4 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-1 px-4 rounded-xl shadow text-xs">🔌 Connect</button>
        <img id="user-avatar" src="cheese.PNG" alt="PFP" class="hidden w-8 h-8 rounded-full border-2 border-white ml-4 shadow-lg" />
      </nav>
    </div>
  </header>


  <!-- Hero -->
  <section class="text-center py-16 px-6">
    <h1 class="text-4xl font-bold mb-4">🧬 Welcome to Experiment X</h1>
    <p class="text-md text-gray-700 max-w-xl mx-auto">Lab preview of upcoming maps, scenes, and mouseverse mutations.</p>
  </section>

<!-- 🧪 Main Content Area
  ----------------------------------------------
  🎨 This is the main display of visuals & lore.
  👶 Dev Tips for Baby Brain 5yo:
    - <main> = your main story zone. It's like the comic page.
    - Everything here is centered and spaced with Tailwind classes.
-->
<main class="max-w-5xl mx-auto px-6 py-12 space-y-12 z-10 relative">

  <!-- 🧬 Headline -->
  <h1 class="text-4xl font-extrabold text-center mb-6">🧬 Experiment X: The Mutant Chronicles</h1>
  <p class="text-center max-w-xl mx-auto text-gray-700 mb-8">
    Deep from the Narrrf Labs, a genetic experiment gave rise to the legends. Dive into the visuals and meet the freaks born from cheese, time, and a sprinkle of chaos.
  </p>

<!-- 🎞️ Narrrf Visual Mutation Zone
--------------------------------------------------------------
🧠 DEV NOTES:
This is the dual-mode display section for both:
1. 🧪 Experiment Mode — animated image slider of mutant assets
2. 🎨 HDR Art Mode — high-resolution zoom grid from IPFS

🔧 Architecture:
- Uses toggleSliderMode('exp' | 'art') for switching
- All experiment carousel images injected dynamically via JS
- HDR images can also be loaded via static markup or JSON/IPFS

📁 Folders:
- Experiment images from: /img/Carusel1 (1-81)_small.PNG
- HDR Art pulled from IPFS gateways

💡 Goals:
- Modular, future-proof, mobile-optimized
- Smooth toggle and rendering separation
-------------------------------------------------------------- -->

<!-- 🧬 NFT Visual Carousel Promo | From experiment-x.html | Genesis 11.0 -->
<!-- 🧬 NFT Visual Carousel Promo | From experiment-x.html | Genesis 11.0 -->
<!-- 🧬 NFT Visual Carousel Promo | From experiment-x.html | Genesis 11.0 -->
<!-- 🧬 Narrrf Dual Mode Visual Lab Section -->
<section class="max-w-6xl mx-auto px-6 py-32 text-center z-10 relative">

  <!-- 🎛️ Slider Toggle Controls -->
  <div class="flex justify-center gap-6 mb-10">
    <button onclick="toggleSliderMode('exp')" class="bg-gradient-to-r from-yellow-300 to-yellow-400 hover:from-yellow-400 hover:to-yellow-500 text-black font-bold px-6 py-3 rounded-full shadow-lg transition-all duration-300 border-2 border-yellow-500 hover:border-yellow-600 transform hover:scale-105">
      🧪 Experiment Mode
    </button>
    <button onclick="toggleSliderMode('art')" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold px-6 py-3 rounded-full shadow-lg transition-all duration-300 border-2 border-purple-400 hover:border-purple-500 transform hover:scale-105">
      🧀 HDR Cheese Gallery
    </button>
  </div>

  <!-- 🧪 Carousel Mode -->
  <div id="carousel-zone" class="block">
    <div id="carousel-images" class="overflow-hidden rounded-xl shadow-lg bg-white cursor-grab select-none" style="touch-action: pan-y pinch-zoom;">
      <!-- JS injects 81 carusel images -->
    </div>
    <div class="flex justify-between items-center mt-4">
      <button onclick="showSlide(-1)" class="bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white px-6 py-3 rounded-full shadow-lg transition-all duration-300 font-bold border-2 border-pink-400 hover:border-pink-500 transform hover:scale-105">← Previous</button>
      <button onclick="showSlide(1)" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-3 rounded-full shadow-lg transition-all duration-300 font-bold border-2 border-purple-400 hover:border-purple-500 transform hover:scale-105">Next →</button>
    </div>
                        <p class="text-xs text-gray-600 text-center mt-3 font-semibold">🧀 Swipe left/right or drag to navigate the cheese</p>
  </div>

<!-- 🎨 HDR IPFS ART GALLERY -->
<div id="art-mode-slider" class="hidden mt-10">
  <!-- 🧀 Gallery Header with Cheese Stats -->
  <div class="text-center mb-8">
    <h3 class="text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-yellow-600 via-pink-600 to-purple-600 bg-clip-text text-transparent mb-2">
      🧀 Ultra HD Cheese Gallery
    </h3>
    <p class="text-gray-600 text-lg font-semibold">
      <span class="text-yellow-600">151</span> pieces of digital cheese art • <span class="text-pink-600">IPFS</span> powered • <span class="text-purple-600">4K</span> quality
    </p>
  </div>
  
  <!-- 🎨 Enhanced Gallery Container -->
  <div id="hdr-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 p-8 justify-center items-start bg-gradient-to-br from-yellow-50 via-pink-50 to-purple-50 rounded-3xl border-4 border-yellow-300 shadow-2xl relative overflow-hidden">
    <!-- 🧀 Animated Background Decorations -->
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-yellow-200 via-pink-200 to-transparent opacity-20 animate-pulse pointer-events-none"></div>
    <div class="absolute top-4 right-4 w-16 h-16 bg-yellow-300 rounded-full blur-xl opacity-30 animate-bounce-slow pointer-events-none"></div>
    <div class="absolute bottom-4 left-4 w-12 h-12 bg-pink-300 rounded-full blur-lg opacity-25 animate-bounce-slow pointer-events-none" style="animation-delay: 1s;"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-purple-300 rounded-full blur-2xl opacity-20 animate-bounce-slow pointer-events-none" style="animation-delay: 2s;"></div>
    
    <!-- Images loaded dynamically via JavaScript -->
  </div>
  
  <!-- 🧀 Enhanced Load More Section -->
  <div class="text-center mt-8">
    <div class="bg-gradient-to-r from-yellow-100 to-pink-100 rounded-2xl p-6 border-2 border-yellow-300 shadow-lg">
      <button id="load-more-hdr" onclick="loadMoreHDRImages()" class="bg-gradient-to-r from-yellow-400 to-pink-500 hover:from-yellow-500 hover:to-pink-600 text-white px-10 py-4 rounded-full shadow-xl transition-all duration-300 font-bold text-xl border-4 border-yellow-300 hover:border-yellow-400 transform hover:scale-105 hover:shadow-2xl">
        🧀 Load More Cheese
      </button>
      <p class="text-gray-600 text-sm mt-3 font-semibold">
        Click to discover more cheesy masterpieces! 🎨✨
      </p>
    </div>
  </div>
</div>

<!-- 🖼️ HDR Fullscreen Viewer -->
<div id="hdrFullscreen" class="hidden fixed inset-0 bg-black bg-opacity-95 z-50 flex flex-col items-center justify-center transition-all duration-300 cursor-grab" style="touch-action: pan-x pan-y; -webkit-user-select: none; -webkit-touch-callout: none;">
                              <!-- ❌ Exit Button -->
                      <button onclick="closeHDR()" class="absolute bottom-4 left-2 md:bottom-6 md:left-4 text-white bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 px-2 py-1 md:px-4 md:py-2 lg:px-6 lg:py-3 rounded-full shadow-lg text-xs md:text-sm z-50 transition-all duration-300 font-bold border-2 border-red-400 hover:border-red-500 transform hover:scale-105">
                        🧀 Exit
                      </button>
                      
                      <!-- 📱 Horizontal Mode Button -->
                      <button onclick="forceHorizontalMode()" class="absolute bottom-4 left-16 md:bottom-6 md:left-32 lg:left-48 text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 px-2 py-1 md:px-4 md:py-2 lg:px-6 lg:py-3 rounded-full shadow-lg text-xs md:text-sm z-50 transition-all duration-300 font-bold border-2 border-blue-400 hover:border-blue-500 transform hover:scale-105">
                        📱 Horizontal
                      </button>

  <!-- 🖼️ Fullscreen Image - Maximized for full screen -->
  <img id="hdrImage" src="" alt="HDR Art" class="w-full h-full object-contain animate-scaleIn" />



  <!-- ⬅️➡️ Navigation Controls -->
  <div class="absolute bottom-4 md:bottom-6 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-1 md:gap-2">
    <div class="flex gap-2 md:gap-4">
      <button onclick="console.log('Prev button clicked'); navigateHDR(-1)" class="bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white px-3 py-1 md:px-6 md:py-3 rounded-full shadow-lg transition-all duration-300 text-sm md:text-lg font-bold border-2 border-pink-400 hover:border-pink-500 transform hover:scale-105">← Prev</button>
      <button onclick="console.log('Next button clicked'); navigateHDR(1)" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-3 py-1 md:px-6 md:py-3 rounded-full shadow-lg transition-all duration-300 text-sm md:text-lg font-bold border-2 border-purple-400 hover:border-purple-500 transform hover:scale-105">Next →</button>
    </div>
            <p class="text-xs text-gray-500 text-center font-semibold">🧀 Swipe left/right or drag to navigate • ESC to close</p>
  </div>
</div>

<script>
  // 🧪 Carousel Logic with Swipe Support
  let index = 0;
  let isDragging = false;
  let startX = 0;
  let currentX = 0;
  let dragDistance = 0;
  const SWIPE_THRESHOLD = 50; // Minimum distance for swipe

  function showSlide(step) {
    const slides = document.querySelectorAll(".carousel-slide");
    if (!slides.length) return;
    index = (index + step + slides.length) % slides.length;
    slides.forEach((slide, i) => {
      slide.classList.toggle("hidden", i !== index);
      slide.classList.toggle("block", i === index);
    });
  }

  // 🖱️ Mouse/Touch Swipe Support
  function initializeSwipeSupport() {
    const carouselContainer = document.getElementById('carousel-images');
    if (!carouselContainer) return;

    // Mouse events for desktop
    carouselContainer.addEventListener('mousedown', handleDragStart);
    carouselContainer.addEventListener('mousemove', handleDragMove);
    carouselContainer.addEventListener('mouseup', handleDragEnd);
    carouselContainer.addEventListener('mouseleave', handleDragEnd);

    // Touch events for mobile
    carouselContainer.addEventListener('touchstart', handleDragStart);
    carouselContainer.addEventListener('touchmove', handleDragMove);
    carouselContainer.addEventListener('touchend', handleDragEnd);

    // Prevent default drag behavior
    carouselContainer.addEventListener('dragstart', (e) => e.preventDefault());
  }

  function handleDragStart(e) {
    isDragging = true;
    startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
    currentX = startX;
    dragDistance = 0;
    
    const carouselContainer = document.getElementById('carousel-images');
    if (carouselContainer) {
      carouselContainer.style.cursor = 'grabbing';
      carouselContainer.style.userSelect = 'none';
    }
  }

  function handleDragMove(e) {
    if (!isDragging) return;
    
    e.preventDefault();
    currentX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
    dragDistance = currentX - startX;
    
    // Add visual feedback during drag
    const carouselContainer = document.getElementById('carousel-images');
    if (carouselContainer && Math.abs(dragDistance) > 10) {
      carouselContainer.style.transform = `translateX(${dragDistance * 0.1}px)`;
      carouselContainer.style.transition = 'none';
    }
  }

  function handleDragEnd() {
    if (!isDragging) return;
    
    isDragging = false;
    
    const carouselContainer = document.getElementById('carousel-images');
    if (carouselContainer) {
      carouselContainer.style.cursor = 'grab';
      carouselContainer.style.userSelect = 'auto';
      carouselContainer.style.transform = '';
      carouselContainer.style.transition = 'transform 0.3s ease-out';
    }

    // Determine swipe direction and trigger slide change
    if (Math.abs(dragDistance) > SWIPE_THRESHOLD) {
      if (dragDistance > 0) {
        // Swipe right - go to previous slide
        showSlide(-1);
      } else {
        // Swipe left - go to next slide
        showSlide(1);
      }
    }
    
    // Reset drag distance
    dragDistance = 0;
  }

  // 🖱️ HDR Swipe Support Functions
  function initializeHDRSwipeSupport() {
    const hdrContainer = document.getElementById('hdrFullscreen');
    if (!hdrContainer) return;

    // Mouse events for desktop
    hdrContainer.addEventListener('mousedown', handleHDRDragStart);
    hdrContainer.addEventListener('mousemove', handleHDRDragMove);
    hdrContainer.addEventListener('mouseup', handleHDRDragEnd);
    hdrContainer.addEventListener('mouseleave', handleHDRDragEnd);

    // Touch events for mobile
    hdrContainer.addEventListener('touchstart', handleHDRDragStart);
    hdrContainer.addEventListener('touchmove', handleHDRDragMove);
    hdrContainer.addEventListener('touchend', handleHDRDragEnd);

    // Prevent default drag behavior
    hdrContainer.addEventListener('dragstart', (e) => e.preventDefault());
  }

  function removeHDRSwipeSupport() {
    const hdrContainer = document.getElementById('hdrFullscreen');
    if (!hdrContainer) return;

    // Remove mouse events
    hdrContainer.removeEventListener('mousedown', handleHDRDragStart);
    hdrContainer.removeEventListener('mousemove', handleHDRDragMove);
    hdrContainer.removeEventListener('mouseup', handleHDRDragEnd);
    hdrContainer.removeEventListener('mouseleave', handleHDRDragEnd);

    // Remove touch events
    hdrContainer.removeEventListener('touchstart', handleHDRDragStart);
    hdrContainer.removeEventListener('touchmove', handleHDRDragMove);
    hdrContainer.removeEventListener('touchend', handleHDRDragEnd);
  }

  function handleHDRDragStart(e) {
    e.preventDefault(); // Prevent default touch behavior
    isHDRDragging = true;
    hdrStartX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
    hdrCurrentX = hdrStartX;
    hdrDragDistance = 0;

    const hdrContainer = document.getElementById('hdrFullscreen');
    if (hdrContainer) {
      hdrContainer.style.cursor = 'grabbing';
      hdrContainer.style.userSelect = 'none';
    }
  }

  function handleHDRDragMove(e) {
    if (!isHDRDragging) return;

    e.preventDefault();
    e.stopPropagation(); // Stop event propagation
    
    const currentX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
    hdrCurrentX = currentX;
    hdrDragDistance = currentX - hdrStartX;

    // Add visual feedback during drag
    const hdrImage = document.getElementById('hdrImage');
    if (hdrImage && Math.abs(hdrDragDistance) > 10) {
      hdrImage.style.transform = `translateX(${hdrDragDistance * 0.1}px)`;
      hdrImage.style.transition = 'none';
    }
  }

  function handleHDRDragEnd() {
    if (!isHDRDragging) return;

    isHDRDragging = false;

    const hdrContainer = document.getElementById('hdrFullscreen');
    const hdrImage = document.getElementById('hdrImage');
    
    if (hdrContainer) {
      hdrContainer.style.cursor = 'grab';
      hdrContainer.style.userSelect = 'auto';
    }
    
    if (hdrImage) {
      hdrImage.style.transform = '';
      hdrImage.style.transition = 'transform 0.3s ease-out';
    }

    // Determine swipe direction and trigger HDR navigation
    if (Math.abs(hdrDragDistance) > HDR_SWIPE_THRESHOLD) {
      if (hdrDragDistance > 0) {
        // Swipe right - go to previous HDR image
        navigateHDR(-1);
      } else {
        // Swipe left - go to next HDR image
        navigateHDR(1);
      }
    }

    // Reset drag distance
    hdrDragDistance = 0;
  }

  // 🎨 HDR Fullscreen Logic
  let currentHDRIndex = 0;
  
  // 🖱️ HDR Swipe Support Variables
  let isHDRDragging = false;
  let hdrStartX = 0;
  let hdrCurrentX = 0;
  let hdrDragDistance = 0;
  const HDR_SWIPE_THRESHOLD = 50; // Minimum distance for HDR swipe

  function openHDR(figureEl) {
    const full = document.getElementById('hdrFullscreen');
    const hdrImage = document.getElementById('hdrImage');
    if (!figureEl || !hdrImage || !full) return;

    const index = parseInt(figureEl.dataset.index || "0", 10);
    currentHDRIndex = index;

    const img = figureEl.querySelector('img');
    if (!img || !img.src) return;

    hdrImage.src = img.src;
    full.classList.remove('hidden');
    full.classList.add('flex');
    document.body.classList.add('overflow-hidden');
    
    // Initialize HDR swipe support
    initializeHDRSwipeSupport();
    
    // Lock orientation to landscape when opening HDR viewer on mobile
    if (window.innerWidth <= 768 && screen.orientation && screen.orientation.lock) {
      try {
        screen.orientation.lock('landscape').then(() => {
          console.log('Screen locked to landscape mode for HDR viewing');
        }).catch((error) => {
          console.log('Could not lock orientation:', error);
        });
      } catch (error) {
        console.log('Orientation lock not supported:', error);
      }
    }
  }

  // Add this function to enable closing HDR fullscreen
  function closeHDR() {
    const full = document.getElementById('hdrFullscreen');
    if (full) {
      full.classList.add('hidden');
      full.classList.remove('flex');
    }
    document.body.classList.remove('overflow-hidden');
    
    // Remove HDR swipe event listeners
    removeHDRSwipeSupport();
    
    // Unlock orientation when closing HDR viewer
    if (screen.orientation && screen.orientation.unlock) {
      try {
        screen.orientation.unlock();
        console.log('Screen orientation unlocked');
      } catch (error) {
        console.log('Could not unlock orientation:', error);
      }
    }
  }


  function navigateHDR(step) {
    const figures = document.querySelectorAll('#hdr-grid figure');
    if (!figures.length) return;

    console.log('HDR navigation: Starting with currentHDRIndex =', currentHDRIndex, 'step =', step, 'figures.length =', figures.length);
    
    const newIndex = currentHDRIndex + step;
    console.log('HDR navigation: newIndex =', newIndex);
    
    // If trying to navigate beyond loaded images, load more
    if (newIndex >= figures.length && newIndex < TOTAL_HDR_IMAGES) {
      console.log('HDR navigation: Loading more images...');
      loadMoreHDRImages();
      // Wait a bit for images to load, then try again
      setTimeout(() => {
        navigateHDR(step);
      }, 500);
      return;
    }
    
    // Handle wrapping around
    if (newIndex < 0) {
      currentHDRIndex = figures.length - 1;
      console.log('HDR navigation: Wrapped to end, new currentHDRIndex =', currentHDRIndex);
    } else if (newIndex >= figures.length) {
      currentHDRIndex = 0;
      console.log('HDR navigation: Wrapped to beginning, new currentHDRIndex =', currentHDRIndex);
    } else {
      currentHDRIndex = newIndex;
      console.log('HDR navigation: Normal navigation, new currentHDRIndex =', currentHDRIndex);
    }
    
    // Find the figure with the matching data-index
    let targetFigure = null;
    for (let i = 0; i < figures.length; i++) {
      const figureIndex = parseInt(figures[i].getAttribute('data-index'), 10);
      if (figureIndex === currentHDRIndex) {
        targetFigure = figures[i];
        break;
      }
    }
    
    if (!targetFigure) {
      console.log('HDR navigation: Could not find figure with data-index =', currentHDRIndex);
      // Fallback: use array index
      targetFigure = figures[currentHDRIndex];
      console.log('HDR navigation: Using fallback array index, targetFigure =', targetFigure);
    }
    
    if (targetFigure) {
      // Check if HDR viewer is open
      const hdrFullscreen = document.getElementById('hdrFullscreen');
      const hdrImage = document.getElementById('hdrImage');
      const img = targetFigure.querySelector('img');
      
      if (hdrFullscreen && !hdrFullscreen.classList.contains('hidden') && hdrImage && img && img.src) {
        // Update the HDR image directly
        hdrImage.src = img.src;
        console.log('HDR navigation: Updated image to', img.src);
      } else {
        // If HDR viewer is not open, open it with the target figure
        openHDR(targetFigure);
        console.log('HDR navigation: Opened HDR viewer with figure', currentHDRIndex);
      }
    } else {
      console.log('HDR navigation: No target figure found!');
    }
    
    console.log('HDR navigation: Current index is now', currentHDRIndex, 'out of', figures.length, 'loaded figures');
  }


  document.addEventListener("keydown", (e) => {
    const isOpen = !document.getElementById('hdrFullscreen').classList.contains('hidden');
    if (!isOpen) return;
    if (e.key === "Escape") closeHDR();
    if (e.key === "ArrowRight") navigateHDR(1);
    if (e.key === "ArrowLeft") navigateHDR(-1);
  });

  // 🎛️ Mode Switching
  function toggleSliderMode(mode) {
    const exp = document.getElementById('carousel-zone');
    const art = document.getElementById('art-mode-slider');

    if (!exp || !art) return;

    if (mode === 'exp') {
      exp.style.display = 'block';
      art.style.display = 'none';
      closeHDR();
    } else {
      exp.style.display = 'none';
      art.style.display = 'block';
      setTimeout(() => {
        const firstFigure = document.querySelector('#art-mode-slider figure[data-index="0"]');
        if (firstFigure) openHDR(firstFigure);
      }, 100);
    }
  }

  // 🧪 Inject carusel images
  window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('carousel-images');
    if (container) {
      for (let i = 1; i <= 81; i++) {
        const img = document.createElement('img');
        img.src = `img/Carusel1 (${i})_small.png`;
        img.className = `carousel-slide ${i === 1 ? 'block' : 'hidden'} w-full`;
        container.appendChild(img);
      }
    }
    showSlide(0);
    
    // Initialize swipe support for the carousel
    initializeSwipeSupport();
    
    // Initialize HDR grid with first 20 images
    initializeHDRGrid();
  });

  // 🎨 HDR Grid Management
  let hdrImagesLoaded = 0;
  const HDR_BATCH_SIZE = window.innerWidth <= 768 ? 20 : 30; // Increased batch size for mobile
  const TOTAL_HDR_IMAGES = 151;
  let isLoadingHDR = false; // Prevent multiple simultaneous loads

  function initializeHDRGrid() {
    const grid = document.getElementById('hdr-grid');
    if (!grid) return;
    
    // Load more images initially for mobile users
    const initialLoad = window.innerWidth <= 768 ? 30 : HDR_BATCH_SIZE;
    loadHDRImages(0, initialLoad);
  }

  function loadHDRImages(startIndex, count) {
    const grid = document.getElementById('hdr-grid');
    if (!grid || isLoadingHDR) return;

    isLoadingHDR = true;
    let loadedCount = 0;
    const targetCount = Math.min(startIndex + count, TOTAL_HDR_IMAGES);

    for (let i = startIndex; i < targetCount; i++) {
      const figure = document.createElement('figure');
      figure.className = 'rounded-2xl shadow-xl overflow-hidden cursor-pointer hover:scale-110 transition-all duration-500 border-4 border-yellow-300 hover:border-pink-400 bg-gradient-to-br from-yellow-100 via-pink-100 to-purple-100 p-3 relative group';
      figure.setAttribute('data-index', i);
      figure.onclick = () => openHDR(figure);

      // Add animated background decoration
      const decoration = document.createElement('div');
      decoration.className = 'absolute inset-0 bg-gradient-to-br from-yellow-200/20 via-pink-200/20 to-purple-200/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none';
      figure.appendChild(decoration);

      const img = document.createElement('img');
      img.src = `https://ec04f79279368ef19713ae9212cac094.ipfs.4everland.link/ipfs/bafybeig4p7562trvm2uh4cns73hb3u5ef5ghmufixgizbu2om2mthn373u/${i}.PNG`;
      img.alt = `HDR Zoom ${i + 1}`;
      img.className = 'object-cover w-full h-auto max-h-[300px] rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 group-hover:brightness-110 relative z-10';
      img.loading = 'lazy';

      // Add error handling for image loading
      img.onerror = () => {
        console.warn(`Failed to load HDR image ${i}`);
        // Remove the figure if image fails to load
        if (figure.parentNode) {
          figure.parentNode.removeChild(figure);
        }
        loadedCount++;
        if (loadedCount >= targetCount - startIndex) {
          finishHDRLoading();
        }
      };

      img.onload = () => {
        loadedCount++;
        if (loadedCount >= targetCount - startIndex) {
          finishHDRLoading();
        }
      };

      const figcaption = document.createElement('figcaption');
      figcaption.className = 'text-sm text-yellow-800 mt-3 text-center font-bold bg-gradient-to-r from-yellow-200 to-pink-200 rounded-full px-4 py-2 mx-auto w-fit border-2 border-yellow-300 shadow-md hover:shadow-lg transition-all duration-300 group-hover:scale-105 relative z-10';
      figcaption.textContent = '🧀 Click to zoom';

      figure.appendChild(img);
      figure.appendChild(figcaption);
      grid.appendChild(figure);
    }

    // Fallback in case no images load
    setTimeout(() => {
      if (isLoadingHDR) {
        finishHDRLoading();
      }
    }, 5000);
  }

  function finishHDRLoading() {
    isLoadingHDR = false;
    // Count actual loaded figures instead of using batch size
    const figures = document.querySelectorAll('#hdr-grid figure');
    hdrImagesLoaded = Math.min(figures.length, TOTAL_HDR_IMAGES);
    
    // Update load more button
    const loadMoreBtn = document.getElementById('load-more-hdr');
    if (loadMoreBtn) {
      if (hdrImagesLoaded >= TOTAL_HDR_IMAGES) {
        loadMoreBtn.style.display = 'none';
      } else {
        loadMoreBtn.textContent = `🧀 Load More Cheese (${hdrImagesLoaded}/${TOTAL_HDR_IMAGES})`;
      }
    }
  }

  function loadMoreHDRImages() {
    if (!isLoadingHDR) {
      // For mobile users, load more images at once to get closer to all 151
      const remainingImages = TOTAL_HDR_IMAGES - hdrImagesLoaded;
      const loadAmount = window.innerWidth <= 768 ? Math.min(50, remainingImages) : HDR_BATCH_SIZE;
      loadHDRImages(hdrImagesLoaded, loadAmount);
    }
  }
</script>

<!-- 📓 Developer Lab Notes: GENESIS 12.0 -->
<div class="bg-white p-6 rounded-xl shadow border-l-4 border-yellow-400 mt-12">
  <h2 class="text-2xl font-bold mb-2">🧪 Developer Log · Experiment X</h2>
  <ul class="list-disc list-inside text-sm space-y-1 text-gray-700 leading-relaxed">
    
    <li>🧀 <strong>Slider Mode Switcher:</strong> Toggle between carousel and HDR art grid.</li>
    <li>🎨 <strong>HDR Zoom Mode:</strong> Uses IPFS-sourced <code>.PNG</code> visuals (up to 4K+) — ~150 assets total</li>
    <li>🧠 <strong>Slide Engine:</strong> Classic vanilla JS switcher (no external libs needed)</li>
    <li>📦 <strong>Future Integration:</strong> Add image filtering, fullscreen view, and swipe support (mobile)</li>
    <li>🌍 <strong>Experiment Context:</strong> Lore-mutation visuals, expression tests, and character evolution for Narrrfverse</li>
    <li>📜 <strong>Extra:</strong> Toggle UI persists across sessions (optionally extend to use riddle mode)</li>
    
  </ul>
</div>


</main>
<!-- 🧠 Done. Scroll to footer next. -->


  <!-- Footer -->
  <footer class="text-center py-6 text-sm text-purple-700">
    Built in the Lab with love and 🧀 | <a href="https://discord.gg/rHc4Jg5Q" class="underline text-pink-600">Join us on Discord</a>
  </footer>

<!-- Wallet + Carousel Scripts -->

<script>
    async function connectWallet() {
      const avatar = document.getElementById('user-avatar');
      const connectButton = document.getElementById('connect-wallet-btn');

      if ('solana' in window) {
        const provider = window.solana;
        if (provider.isPhantom) {
          try {
            const response = await provider.connect();
            const walletAddress = response.publicKey.toString();
            localStorage.setItem('walletAddress', walletAddress);
            connectButton.innerText = `🟢 ${walletAddress.slice(0, 4)}...${walletAddress.slice(-4)}`;
            connectButton.disabled = true;
            avatar?.classList.remove('hidden');
          } catch (err) {
            console.error("❌ Wallet connect error:", err);
          }
        }
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      const storedWallet = localStorage.getItem('walletAddress');
      const avatar = document.getElementById('user-avatar');
      const connectButton = document.getElementById('connect-wallet-btn');

      if (storedWallet && connectButton) {
        connectButton.innerText = `🟢 ${storedWallet.slice(0, 4)}...${storedWallet.slice(-4)}`;
        connectButton.disabled = true;
        avatar?.classList.remove('hidden');
      }

      showSlide(0); // start at first carousel slide
    });

      // 📱 Force Horizontal Mode Function
  function forceHorizontalMode() {
    if (screen.orientation && screen.orientation.lock) {
      try {
        screen.orientation.lock('landscape').then(() => {
          console.log('Screen locked to landscape mode');
        }).catch((error) => {
          console.log('Could not lock orientation:', error);
        });
      } catch (error) {
        console.log('Orientation lock not supported:', error);
      }
    } else {
      console.log('Screen orientation API not supported');
    }
  }
  </script>
<!-- 
===========================================================
🧠 NARRRF'S WORLD — GENESIS 12.0 · FULL SYSTEM PACKAGE
===========================================================

🎮 Certified By:
- 🧠 Brain 4.0
- 🧀 Masterchiefe (SQL Oracle)
- 👶 Narrrf (5yo Padawan Prime)
- 👽 The Alien Observer (Session Layer)

🌍 Purpose:
A self-sustaining, gamified Web3 system fusing:
- NFT Ownership + Wallet Roles
- SQL Game Logic + DOM Triggers
- Web2 Immersion + Web3 Interactivity

💾 Core Deployment Path:
→ `/public/index.html`, `/experiment-x.html`, `/api/*`, `/db/narrrf_world.sqlite`

📚 Reference DB Table: `tbl_cheese_clicks`

-----------------------------------------------------------
🧪 CORE MODULES IN PLAY – GENESIS 12.0
-----------------------------------------------------------

1. 🧀 CHEESE EGG ENGINE v1.4.2:
   - Moves eggs dynamically in DOM
   - Tracks clicks → wallet → DB
   - Hooks for unlockables and lore trails

2. 🔐 VIP ROLE GATE:
   - Validates Discord roles via `/api/user/roles.php`
   - Enables exclusive assets (VIP Art / HD Downloads)

3. 🧠 RIDDLE ENGINE v2.0:
   - Expands lore through egg-node interactions
   - Trait and time-based unlock gates
   - Future-ready: time-locked and map-wide riddles

-----------------------------------------------------------
📦 DATABASE DESIGN — MINIMAL AND SCALABLE
-----------------------------------------------------------

📂 `tbl_cheese_clicks`
- `user_wallet` TEXT
- `egg_id` TEXT
- `timestamp` DATETIME

✅ All interactions tracked via:
→ `localStorage.walletAddress`
→ `egg_id`
→ `Date.now()`

POST to:  
➡️ `/api/track-egg-click`

-----------------------------------------------------------
🧑‍💻 DEVELOPER PROTOCOL FOR NEXT GENERATIONS
-----------------------------------------------------------

🔧 Wallet Testing:
- Phantom, Brave, WalletConnect, Mobile DApps

🔧 Egg Logic QA:
- Console fetch logs
- DB validation post-interaction

🔧 DOM Guardrails:
- VIP roles = "VIP_pass" or "VIP Holder"
- Non-null checks on all user-triggered UI

🔧 Carousel + IPFS Grid:
- JS-powered image injection
- Toggle logic: `toggleSliderMode('exp'|'art')`

-----------------------------------------------------------
🔮 FUTURE EVOLUTION
-----------------------------------------------------------

🚀 Cheese Dungeons + Puzzle Grids  
🧬 Lore-driven trait evolutions  
🎁 Time-released NFT rewards  
🪙 Direct $SPOINC → unlock mechanisms  
🧠 AI-generated riddle chains (2026-ready)

-----------------------------------------------------------
🧠 Certified by Narrrf Core · Last Updated: 2025-07-23
💾 Status: GENESIS 12.0 – LIVE AND LEARNING
-----------------------------------------------------------
-->


<!-- ======================================== -->
<!-- 🧠 HTML Brain 4.0 Footer · Lab Portal -->
<!-- ======================================== -->

<section id="hytopia-portal" class="mt-16 px-6">
  <div class="max-w-xl mx-auto text-center">
    <a href="/hytopia.html" class="group inline-block relative" title="🧀 Hytopia portal is closed... for now.">
      <div class="relative p-4 rounded-full bg-yellow-300/90 hover:bg-yellow-400 transition-all duration-300 shadow-2xl animate-pulse">
        <img src="img/cheese-portal.PNG" alt="Enter Hytopia" class="w-24 h-24 sm:w-32 sm:h-32 mx-auto group-hover:scale-105 transition-transform duration-300 drop-shadow-lg" />
        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          <div class="text-xs bg-black/80 text-yellow-300 px-3 py-1 rounded-full shadow-md animate-pulse">
            🧀 Portal Closed · Opening Soon!
          </div>
        </div>
      </div>
      <p class="mt-3 text-base font-bold text-yellow-800 group-hover:text-yellow-900">
        ✨ Step Toward Hytopia
      </p>
    </a>
  </div>
</section>

<footer class="text-center text-xs text-yellow-600 py-4 mt-12">
  🧠 Powered by Cheese Architect 12.0 · Brain Sync Complete 🧬<br>
  ⛩️ Built in the Narrrf Lab | Last Update: 2025 · Coreforge Verified 🔐<br>
  🧀 Built with brain & cheese · Genesis 12.0 Protocol Active
</footer>

<!-- 🧬 This marks the official footer of all lore- and riddle-linked surfaces. -->
<!-- 🚫 DO NOT REMOVE UNLESS INSTRUCTED BY THE OVER BRAIN. -->


<!-- Add wallet.js before the closing body tag -->
<script src="js/wallet.js"></script>
</body>
</html>
