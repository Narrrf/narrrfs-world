<!DOCTYPE html>
<html lang="en">
<?php
// Include Discord invite configuration
require_once 'discord-invite.php';
?>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Narrrf's World Admin Interface</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- üîó Discord Token of Render System -->
  <script src="discord-config.js"></script>
  
  <!-- üåç Environment Detection -->
  <script>
    // Detect environment and set API base URL
    const isProduction = window.location.hostname === 'narrrfs.world';
    const API_BASE_URL = isProduction ? 'https://narrrfs.world' : '';
    
    console.log('üåç Environment detected:', isProduction ? 'Production' : 'Local');
    console.log('üîó API Base URL:', API_BASE_URL);
  </script>
  
  <style>
    .admin-card {
      background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
      border-radius: 15px;
      padding: 20px;
      margin: 10px;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .stats-card {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      border-radius: 12px;
      padding: 15px;
      margin: 8px;
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .user-card {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 8px;
      border-left: 4px solid #f0c92c;
      transition: all 0.3s ease;
    }
    .user-card:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    .tab-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
    }
    .tab-btn.active {
      background: rgba(255,255,255,0.3);
      border-color: rgba(255,255,255,0.5);
    }
    .game-tab-content {
      display: none;
    }
    .game-tab-content:first-child {
      display: block;
    }
    .history-item {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px;
      margin: 5px 0;
      border-left: 4px solid #f0c92c;
    }
    .positive { border-left-color: #10b981; }
    .negative { border-left-color: #ef4444; }
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Boss notification animations */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    .notification-toast {
      z-index: 9999;
    }
    
    /* Enhanced data display styles */
    .data-summary {
      border-left: 4px solid;
      animation: fadeIn 0.5s ease-in;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border-radius: 0.5rem;
    }
    
    /* Enhanced leaderboard styles */
    .leaderboard-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: 0.5rem;
      background: rgba(31, 41, 55, 0.5);
    }
    
    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 1rem 1.25rem;
      margin-bottom: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(31, 41, 55, 0.6);
      border: 1px solid rgba(75, 85, 99, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: slideIn 0.4s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    .leaderboard-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }
    
    .leaderboard-item:hover {
      background: rgba(59, 130, 246, 0.15);
      transform: translateX(6px) translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
    }
    
    .leaderboard-item:hover::before {
      transform: scaleY(1);
    }
    
    .leaderboard-item:last-child {
      margin-bottom: 0;
    }
    
    .leaderboard-rank {
      font-weight: bold;
      font-size: 1.25rem;
      min-width: 3rem;
      text-align: center;
      padding: 0.5rem;
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      margin-right: 1rem;
      transition: all 0.3s ease;
    }
    
    .leaderboard-rank.gold { 
      color: #fbbf24; 
      background: rgba(251, 191, 36, 0.15);
      text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
    }
    .leaderboard-rank.silver { 
      color: #9ca3af; 
      background: rgba(156, 163, 175, 0.15);
      text-shadow: 0 0 10px rgba(156, 163, 175, 0.5);
    }
    .leaderboard-rank.bronze { 
      color: #d97706; 
      background: rgba(217, 119, 6, 0.15);
      text-shadow: 0 0 10px rgba(217, 119, 6, 0.5);
    }
    
    .leaderboard-info {
      flex: 1;
      margin-left: 0.5rem;
    }
    
    .leaderboard-name {
      font-weight: 700;
      color: #f9fafb;
      margin-bottom: 0.375rem;
      font-size: 1.1rem;
      letter-spacing: 0.025em;
    }
    
    .leaderboard-score {
      font-size: 0.9rem;
      color: #d1d5db;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      display: inline-block;
    }
    
    .leaderboard-date {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-left: auto;
      padding: 0.5rem 0.75rem;
      background: rgba(75, 85, 99, 0.2);
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .leaderboard-item:hover .leaderboard-date {
      background: rgba(75, 85, 99, 0.4);
      color: #d1d5db;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    .data-summary[class*="bg-blue"] {
      border-left-color: #3b82f6;
    }
    
    .data-summary[class*="bg-green"] {
      border-left-color: #10b981;
    }
    
    .data-summary[class*="bg-purple"] {
      border-left-color: #8b5cf6;
    }
    
    .stats-value {
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      display: inline-block;
      margin: 0.25rem 0;
    }
    
    .stats-value:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Enhanced Game Stat Cards */
    .game-stat-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .game-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8, #3b82f6);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .game-stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    
    .game-stat-card:hover::before {
      transform: scaleX(1);
    }
    
    .game-stat-header {
      transition: all 0.3s ease;
    }
    
    .game-stat-card:hover .game-stat-header {
      transform: scale(1.05);
    }
    
    .game-stat-value {
      transition: all 0.3s ease;
    }
    
    .game-stat-card:hover .game-stat-value {
      transform: scale(1.1);
      text-shadow: 0 0 20px currentColor;
    }
    
    /* Enhanced Button Styles */
    .admin-button {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .admin-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }
    
    .admin-button:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .admin-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    /* Loading States */
    .loading-skeleton {
      background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Enhanced Empty States */
    .empty-state {
      animation: fadeInUp 0.6s ease-out;
      background: linear-gradient(135deg, rgba(31, 41, 55, 0.8), rgba(55, 65, 81, 0.8));
      border: 1px solid rgba(75, 85, 99, 0.3);
      backdrop-filter: blur(10px);
    }
    
    /* Responsive Enhancements */
    @media (max-width: 768px) {
      .game-stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .leaderboard-item {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem 1rem;
      }
      
      .leaderboard-rank {
        margin-bottom: 0.75rem;
        margin-right: 0;
      }
      
      .leaderboard-date {
        margin-top: 0.75rem;
        margin-left: 0;
      }
    }
    
    .leaderboard-item {
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      margin-bottom: 0.5rem;
      border-radius: 0.5rem;
      overflow: hidden;
    }
    
    .leaderboard-item:hover {
      border-left-color: #f59e0b;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced game management styles */
    .game-tab-content {
      display: none;
      animation: slideIn 0.4s ease-out;
    }
    
    .game-tab-content:first-child {
      display: block;
    }
    
    .game-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .game-stat-card {
      background: rgba(55, 65, 81, 0.8);
      border-radius: 0.75rem;
      padding: 1.5rem;
      border: 1px solid rgba(75, 85, 99, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .game-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border-color: rgba(75, 85, 99, 0.5);
    }
    
    .game-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .game-stat-card:hover::before {
      opacity: 1;
    }
    
    .game-stat-header {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .game-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
    }
    
    .game-stat-label {
      font-size: 0.875rem;
      color: #9ca3af;
      margin-bottom: 0.25rem;
    }
    
    .game-stat-subvalue {
      font-size: 0.75rem;
      color: #6b7280;
    }
    
    /* Enhanced leaderboard styles */
    .leaderboard-container {
      background: rgba(55, 65, 81, 0.8);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(75, 85, 99, 0.3);
    }
    
    .leaderboard-header {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #f59e0b;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .leaderboard-item {
      background: rgba(75, 85, 99, 0.6);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-left: 3px solid transparent;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .leaderboard-item:hover {
      background: rgba(75, 85, 99, 0.8);
      border-left-color: #f59e0b;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .leaderboard-rank {
      font-size: 1.25rem;
      font-weight: 700;
      color: #f59e0b;
      min-width: 3rem;
    }
    
    .leaderboard-player {
      flex: 1;
      margin-left: 1rem;
    }
    
    .leaderboard-score {
      text-align: right;
      margin-left: 1rem;
    }
    
    .leaderboard-score-main {
      font-size: 1.125rem;
      font-weight: 600;
      color: #10b981;
    }
    
    .leaderboard-score-sub {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }
    
    /* Enhanced button styles */
    .game-action-btn {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .game-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
      background: linear-gradient(135deg, #2563eb, #1e40af);
    }
    
    .game-action-btn:active {
      transform: translateY(0);
    }
    
    .game-action-btn.danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .game-action-btn.danger:hover {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }
    
    .game-action-btn.success {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .game-action-btn.success:hover {
      background: linear-gradient(135deg, #059669, #047857);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }
    
    /* Enhanced loading states */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.75rem;
      z-index: 10;
    }
    
    .loading-spinner {
      width: 3rem;
      height: 3rem;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
      .game-stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .game-stat-card {
        padding: 1rem;
      }
      
      .leaderboard-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .leaderboard-score {
        text-align: left;
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>
  
  <style>
    .admin-card {
      background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
      border-radius: 15px;
      padding: 20px;
      margin: 10px;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .stats-card {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      border-radius: 12px;
      padding: 15px;
      margin: 8px;
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .user-card {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 8px;
      border-left: 4px solid #f0c92c;
      transition: all 0.3s ease;
    }
    .user-card:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    .tab-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
    }
    .tab-btn.active {
      background: rgba(255,255,255,0.3);
      border-color: rgba(255,255,255,0.5);
    }
    .game-tab-content {
      display: none;
    }
    .game-tab-content:first-child {
      display: block;
    }
    .history-item {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px;
      margin: 5px 0;
      border-left: 4px solid #f0c92c;
    }
    .positive { border-left-color: #10b981; }
    .negative { border-left-color: #ef4444; }
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    /* Enhanced data display styles */
    .data-summary {
      border-left: 4px solid;
      animation: fadeIn 0.5s ease-in;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border-radius: 0.5rem;
    }
    
    /* Enhanced leaderboard styles */
    .leaderboard-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: 0.5rem;
      background: rgba(31, 41, 55, 0.5);
    }
    
    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 1rem 1.25rem;
      margin-bottom: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(31, 41, 55, 0.6);
      border: 1px solid rgba(75, 85, 99, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: slideIn 0.4s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    .leaderboard-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }
    
    .leaderboard-item:hover {
      background: rgba(59, 130, 246, 0.15);
      transform: translateX(6px) translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.4);
    }
    
    .leaderboard-item:hover::before {
      transform: scaleY(1);
    }
    
    .leaderboard-item:last-child {
      margin-bottom: 0;
    }
    
    .leaderboard-rank {
      font-weight: bold;
      font-size: 1.25rem;
      min-width: 3rem;
      text-align: center;
      padding: 0.5rem;
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      margin-right: 1rem;
      transition: all 0.3s ease;
    }
    
    .leaderboard-rank.gold { 
      color: #fbbf24; 
      background: rgba(251, 191, 36, 0.15);
      text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
    }
    .leaderboard-rank.silver { 
      color: #9ca3af; 
      background: rgba(156, 163, 175, 0.15);
      text-shadow: 0 0 10px rgba(156, 163, 175, 0.5);
    }
    .leaderboard-rank.bronze { 
      color: #d97706; 
      background: rgba(217, 119, 6, 0.15);
      text-shadow: 0 0 10px rgba(217, 119, 6, 0.5);
    }
    
    .leaderboard-info {
      flex: 1;
      margin-left: 0.5rem;
    }
    
    .leaderboard-name {
      font-weight: 700;
      color: #f9fafb;
      margin-bottom: 0.375rem;
      font-size: 1.1rem;
      letter-spacing: 0.025em;
    }
    
    .leaderboard-score {
      font-size: 0.9rem;
      color: #d1d5db;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      display: inline-block;
    }
    
    .leaderboard-date {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-left: auto;
      padding: 0.5rem 0.75rem;
      background: rgba(75, 85, 99, 0.2);
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .leaderboard-item:hover .leaderboard-date {
      background: rgba(75, 85, 99, 0.4);
      color: #d1d5db;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    .data-summary[class*="bg-blue"] {
      border-left-color: #3b82f6;
    }
    
    .data-summary[class*="bg-green"] {
      border-left-color: #10b981;
    }
    
    .data-summary[class*="bg-purple"] {
      border-left-color: #8b5cf6;
    }
    
    .stats-value {
      transition: all 0.3s ease;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      display: inline-block;
      margin: 0.25rem 0;
    }
    
    .stats-value:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Enhanced Game Stat Cards */
    .game-stat-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .game-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8, #3b82f6);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }
    
    .game-stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    
    .game-stat-card:hover::before {
      transform: scaleX(1);
    }
    
    .game-stat-header {
      transition: all 0.3s ease;
    }
    
    .game-stat-card:hover .game-stat-header {
      transform: scale(1.05);
    }
    
    .game-stat-value {
      transition: all 0.3s ease;
    }
    
    .game-stat-card:hover .game-stat-value {
      transform: scale(1.1);
      text-shadow: 0 0 20px currentColor;
    }
    
    /* Enhanced Button Styles */
    .admin-button {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .admin-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }
    
    .admin-button:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .admin-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    /* Loading States */
    .loading-skeleton {
      background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Enhanced Empty States */
    .empty-state {
      animation: fadeInUp 0.6s ease-out;
      background: linear-gradient(135deg, rgba(31, 41, 55, 0.8), rgba(55, 65, 81, 0.8));
      border: 1px solid rgba(75, 85, 99, 0.3);
      backdrop-filter: blur(10px);
    }
    
    /* Responsive Enhancements */
    @media (max-width: 768px) {
      .game-stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .leaderboard-item {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem 1rem;
      }
      
      .leaderboard-rank {
        margin-bottom: 0.75rem;
        margin-right: 0;
      }
      
      .leaderboard-date {
        margin-top: 0.75rem;
        margin-left: 0;
      }
    }
    
    .leaderboard-item {
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      margin-bottom: 0.5rem;
      border-radius: 0.5rem;
      overflow: hidden;
    }
    
    .leaderboard-item:hover {
      border-left-color: #f59e0b;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced game management styles */
    .game-tab-content {
      display: none;
      animation: slideIn 0.4s ease-out;
    }
    
    .game-tab-content:first-child {
      display: block;
    }
    
    .game-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .game-stat-card {
      background: rgba(55, 65, 81, 0.8);
      border-radius: 0.75rem;
      padding: 1.5rem;
      border: 1px solid rgba(75, 85, 99, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .game-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border-color: rgba(75, 85, 99, 0.5);
    }
    
    .game-stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .game-stat-card:hover::before {
      opacity: 1;
    }
    
    .game-stat-header {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .game-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      transition: color 0.3s ease;
    }
    
    .game-stat-label {
      font-size: 0.875rem;
      color: #9ca3af;
      margin-bottom: 0.25rem;
    }
    
    .game-stat-subvalue {
      font-size: 0.75rem;
      color: #6b7280;
    }
    
    /* Enhanced leaderboard styles */
    .leaderboard-container {
      background: rgba(55, 65, 81, 0.8);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(75, 85, 99, 0.3);
    }
    
    .leaderboard-header {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: #f59e0b;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .leaderboard-item {
      background: rgba(75, 85, 99, 0.6);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-left: 3px solid transparent;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .leaderboard-item:hover {
      background: rgba(75, 85, 99, 0.8);
      border-left-color: #f59e0b;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .leaderboard-rank {
      font-size: 1.25rem;
      font-weight: 700;
      color: #f59e0b;
      min-width: 3rem;
    }
    
    .leaderboard-player {
      flex: 1;
      margin-left: 1rem;
    }
    
    .leaderboard-score {
      text-align: right;
      margin-left: 1rem;
    }
    
    .leaderboard-score-main {
      font-size: 1.125rem;
      font-weight: 600;
      color: #10b981;
    }
    
    .leaderboard-score-sub {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }
    
    /* Enhanced button styles */
    .game-action-btn {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .game-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
      background: linear-gradient(135deg, #2563eb, #1e40af);
    }
    
    .game-action-btn:active {
      transform: translateY(0);
    }
    
    .game-action-btn.danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .game-action-btn.danger:hover {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }
    
    .game-action-btn.success {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .game-action-btn.success:hover {
      background: linear-gradient(135deg, #059669, #047857);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }
    
    /* Enhanced loading states */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.75rem;
      z-index: 10;
    }
    
    .loading-spinner {
      width: 3rem;
      height: 3rem;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
      .game-stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .game-stat-card {
        padding: 1rem;
      }
      
      .leaderboard-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .leaderboard-score {
        text-align: left;
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-purple-50 to-pink-100 min-h-screen p-4">
  
  <div class="max-w-7xl mx-auto">
    
    <!-- Header -->
    <div class="text-center mb-6">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">üéÆ Narrrf's World Admin Interface</h1>
      <p class="text-gray-600">Complete Discord Bot Management System</p>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="stats-card">
        <h3 class="text-lg font-semibold">üë• Total Users</h3>
        <p class="text-2xl font-bold" id="totalUsers">Loading...</p>
      </div>
      <div class="stats-card">
        <h3 class="text-lg font-semibold">üí∞ Total Scores</h3>
        <p class="text-2xl font-bold" id="totalScores">Loading...</p>
      </div>
      <div class="stats-card">
        <h3 class="text-lg font-semibold">üè™ Store Items</h3>
        <p class="text-2xl font-bold" id="totalItems">Loading...</p>
      </div>
      <div class="stats-card">
        <h3 class="text-lg font-semibold">üèÜ Active Quests</h3>
        <p class="text-2xl font-bold" id="activeQuests">Loading...</p>
      </div>
      <div class="stats-card" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);">
        <h3 class="text-lg font-semibold">üëë Boss Notifications</h3>
        <p class="text-2xl font-bold" id="bossNotifications">Loading...</p>
      </div>

    </div>
    
    <!-- Database Access Quick Button -->
    <div class="text-center mb-6">
      <div id="headerDatabaseUnlock">
        <button onclick="showDatabaseUnlock()" class="inline-block bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white font-bold py-3 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 text-lg shadow-lg">
          üîì Unlock Database Access
        </button>
        <p class="text-sm text-gray-600 mt-2">Click to unlock database download, upload, and management features</p>
      </div>
      
      <div id="headerDatabaseOptions" style="display: none;">
        <h3 class="text-lg font-semibold text-green-600 mb-3">‚úÖ Database Access Unlocked</h3>
        <div class="flex flex-wrap justify-center gap-3">
          <button onclick="downloadDatabase()" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
            üì• Download Database
          </button>
          <button onclick="showUploadModal()" class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
            üì§ Upload Database
          </button>
          <button onclick="showDatabaseViewer()" class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
            üëÅÔ∏è Database Viewer
          </button>
          <button onclick="triggerBackup()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
            üóÑÔ∏è Database Backup
          </button>
        </div>
      </div>
    </div>

    <!-- Admin Authentication -->
    <div class="admin-card mb-6" id="authPanel">
      <h2 class="text-xl font-semibold mb-4">üîê Admin Authentication</h2>
      
      <!-- Discord Auth for Moderators -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üéÆ Discord Authentication (Moderators)</h3>
        <p class="text-sm text-gray-300 mb-3">If you have the moderator role in Discord, you can access basic admin features:</p>
        <button onclick="authenticateDiscord()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded">
          üîó Login with Discord
        </button>
        <div id="discordAuthStatus" class="mt-2 text-sm"></div>
      </div>

      <!-- Password Auth for Super Admin -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üîë Super Admin Access</h3>
        <p class="text-sm text-gray-300 mb-3">For advanced features and user management:</p>
        
        <!-- Login Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium mb-2">Username:</label>
            <input type="text" id="loginUsername" placeholder="Enter username" class="w-full px-3 py-2 rounded text-gray-800">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Password:</label>
            <input type="password" id="loginPassword" placeholder="Enter password" class="w-full px-3 py-2 rounded text-gray-800">
          </div>
        </div>
        <div class="flex gap-2">
          <button onclick="loginAdmin()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">Super Admin Login</button>
          <button onclick="showUserManagement()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">Manage Users</button>
        </div>
      </div>

      <!-- User Management (Super Admin Only) -->
      <div id="userManagementPanel" class="hidden">
        <h3 class="text-lg font-semibold mb-4">üë• User Management</h3>
        
        <!-- Add New User -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-4">
          <h4 class="text-md font-semibold mb-3">‚ûï Add New User</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" id="newUsername" placeholder="Username" class="px-3 py-2 rounded text-gray-800">
            <input type="password" id="newPassword" placeholder="Password" class="px-3 py-2 rounded text-gray-800">
            <select id="newRole" class="px-3 py-2 rounded text-gray-800">
              <option value="moderator">Moderator</option>
              <option value="admin">Admin</option>
            </select>
            <input type="text" id="newDiscordId" placeholder="Discord ID (optional)" class="px-3 py-2 rounded text-gray-800">
          </div>
          <button onclick="addUser()" class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Add User</button>
        </div>

        <!-- Current Users -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="text-md font-semibold mb-3">üìã Current Users</h4>
          <div id="currentUsersList" class="space-y-2">
            <div class="text-gray-300">Loading users...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="admin-card mb-6" id="navPanel" style="display: block;">
      <div class="flex flex-wrap gap-2 mb-4">
        <button class="tab-btn active px-4 py-2 rounded" data-tab="dashboard">üìä Dashboard</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="users">üë• User Management</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="points">üí∞ Point Management</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="store">üè™ Store Management</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="quests">üèÜ Quest System</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="games">üéÆ Game Management</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="games2">üöÄ Game Management 2.0</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="bosses">üëë Boss Management</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="bossNotifications">üèÜ Boss Notifications</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="discord">üîó Discord Config</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="holderVerification">üé¥ Holder Verification</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="cheeseGuide">üßÄ Cheese Guide</button>
        <button class="tab-btn px-4 py-2 rounded" data-tab="communityFunds">üí∞ Community Funds</button>
      </div>
      
      <!-- Quick Actions Section -->
      <div class="text-center mt-4 pt-4 border-t border-gray-600">
        <h3 class="text-lg font-semibold text-blue-300 mb-3">‚ö° Quick Actions</h3>
        
                  <!-- All admin users can see Home link -->
        <a href="index.html" class="inline-block bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 mr-4">
            üè† Home
          </a>
          
          <!-- Test all tabs button -->
        <button onclick="testAllTabs()" class="inline-block bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 mr-4">
          üß™ Test All Tabs
          </button>
          
        <!-- Force refresh button -->
        <button onclick="forceRefreshAllTabs()" class="inline-block bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 mr-4">
          üîÑ Force Refresh
          </button>
          
        <!-- Debug button to manually show navigation -->
        <button onclick="debugShowNavigation()" class="inline-block bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 ml-2">
          üêõ Debug Nav
          </button>
      </div>
    </div>

    <!-- Dashboard Tab -->
    <div class="admin-card mb-6" id="dashboardTab">
      <h2 class="text-xl font-semibold mb-4">üìä System Dashboard</h2>
      
      <!-- System Stats -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üìà Detailed System Statistics</h3>
        <div id="systemStats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="text-center">
            <div class="text-2xl font-bold text-green-400" id="totalUsersDetail">-</div>
            <div class="text-sm text-gray-300">Total Users</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-400" id="totalScoresDetail">-</div>
            <div class="text-sm text-gray-300">Score Records</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-400" id="totalItemsDetail">-</div>
            <div class="text-sm text-gray-300">Store Items</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-purple-400" id="activeQuestsDetail">-</div>
            <div class="text-sm text-gray-300">Active Quests</div>
          </div>
        </div>
        
        <!-- Cheese Click Statistics -->
        <div class="mt-6 pt-6 border-t border-gray-600">
          <h4 class="text-md font-semibold mb-3 text-orange-400">üßÄ Cheese Click Statistics</h4>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="text-center">
              <div class="text-xl font-bold text-orange-400" id="totalCheeseClicks">-</div>
              <div class="text-sm text-gray-300">Total Cheese Clicks</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-orange-400" id="recentCheeseClicks">-</div>
              <div class="text-sm text-gray-300">Last 24h Clicks</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-orange-400" id="topCheeseUser">-</div>
              <div class="text-sm text-gray-300">Top Clicker</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-orange-400" id="mostClickedCheese">-</div>
              <div class="text-sm text-gray-300">Most Clicked</div>
            </div>
          </div>
          
          <!-- Detailed Cheese Stats -->
          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h5 class="text-sm font-semibold mb-2 text-orange-300">Clicks by Cheese Type:</h5>
              <div id="cheeseClicksByType" class="text-sm text-gray-300">
                Loading cheese click data...
              </div>
            </div>
            <div>
              <h5 class="text-sm font-semibold mb-2 text-orange-300">Top Cheese Clickers:</h5>
              <div id="topCheeseClickers" class="text-sm text-gray-300">
                Loading top clickers...
              </div>
            </div>
          </div>
        </div>
        
        <!-- Quest and Role Statistics -->
        <div class="mt-6 pt-6 border-t border-gray-600">
          <h4 class="text-md font-semibold mb-3 text-green-400">üéØ Quest & Role Statistics</h4>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="text-center">
              <div class="text-xl font-bold text-green-400" id="openQuests">-</div>
              <div class="text-sm text-gray-300">Open Quests</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-yellow-400" id="pendingClaims">-</div>
              <div class="text-sm text-gray-300">Pending Claims</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-blue-400" id="completedQuests">-</div>
              <div class="text-sm text-gray-300">Completed Quests</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-purple-400" id="rolesGranted">-</div>
              <div class="text-sm text-gray-300">Roles Granted</div>
            </div>
          </div>
          
          <!-- Detailed Quest Stats -->
          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h5 class="text-sm font-semibold mb-2 text-green-300">Recent Quest Claims:</h5>
              <div id="recentQuestClaims" class="text-sm text-gray-300">
                Loading quest claims...
              </div>
            </div>
            <div>
              <h5 class="text-sm font-semibold mb-2 text-purple-300">Active Quests by Type:</h5>
              <div id="activeQuestsByType" class="text-sm text-gray-300">
                Loading active quests...
              </div>
            </div>
          </div>
        </div>

        <!-- Boss Level Claims Statistics -->
        <div class="mt-6 pt-6 border-t border-gray-600">
          <h4 class="text-md font-semibold mb-3 text-orange-400">üëë Boss Level Claims</h4>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="text-center">
              <div class="text-xl font-bold text-orange-400" id="pendingBossClaims">-</div>
              <div class="text-sm text-gray-300">Pending Boss Claims</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-green-400" id="totalBossRewards">-</div>
              <div class="text-sm text-gray-300">Total DSPOINC Given</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-blue-400" id="bossClaimsToday">-</div>
              <div class="text-sm text-gray-300">Claims Today</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-purple-400" id="avgBossReward">-</div>
              <div class="text-sm text-gray-300">Avg Reward</div>
            </div>
          </div>
          
          <!-- Detailed Boss Stats -->
          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h5 class="text-sm font-semibold mb-2 text-orange-300">Recent Boss Claims:</h5>
              <div id="recentBossClaims" class="text-sm text-gray-300">
                Loading boss claims...
              </div>
            </div>
            <div>
              <h5 class="text-sm font-semibold mb-2 text-green-300">Boss Achievement Types:</h5>
              <div id="bossAchievementTypes" class="text-sm text-gray-300">
                Loading boss types...
              </div>
            </div>
          </div>
        </div>
        
        <!-- Database Access Section -->
        <div class="mt-6 pt-6 border-t border-gray-600">
          <h4 class="text-md font-semibold mb-3 text-blue-400">üóÑÔ∏è Database Access</h4>
          <div class="text-center">
            <!-- Database access unlock button - Dashboard version -->
            <div id="dashboardDatabaseUnlock" class="mb-3">
              <button onclick="showDatabaseUnlock()" class="inline-block bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
                üîì Unlock Database Access
              </button>
              <p class="text-sm text-gray-400 mt-2">Unlock database management features</p>
            </div>
            
            <!-- Database options for dashboard (password protected) -->
            <div id="dashboardDatabaseOptions" style="display: none;">
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="downloadDatabase()" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                  üì• Download
                </button>
                <button onclick="showUploadModal()" class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                  üì§ Upload
                </button>
                <button onclick="showDatabaseViewer()" class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                  üëÅÔ∏è Viewer
                </button>
                <button onclick="triggerBackup()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                  üóÑÔ∏è Backup
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Statistics -->
        <div class="mt-6 pt-6 border-t border-gray-600">
          <h4 class="text-md font-semibold mb-3 text-cyan-400">üöÄ Enhanced Statistics</h4>
          
          <!-- Immediate Stats -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
            <div class="text-center">
              <div class="text-xl font-bold text-cyan-400" id="avgClicksPerUser">-</div>
              <div class="text-sm text-gray-300">Avg Clicks/User</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-emerald-400" id="totalDSPOINC">-</div>
              <div class="text-sm text-gray-300">Total $DSPOINC</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-pink-400" id="questCompletionRate">-</div>
              <div class="text-sm text-gray-300">Quest Success %</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-indigo-400" id="avgQuestReward">-</div>
              <div class="text-sm text-gray-300">Avg Quest Reward</div>
            </div>
          </div>

          <!-- Daily Activity Stats -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
            <div class="text-center">
              <div class="text-lg font-bold text-yellow-400" id="clicksLast24h">-</div>
              <div class="text-sm text-gray-300">Clicks (24h)</div>
            </div>
            <div class="text-center">
              <div class="text-lg font-bold text-green-400" id="newUsersToday">-</div>
              <div class="text-sm text-gray-300">New Users (24h)</div>
            </div>
            <div class="text-center">
              <div class="text-lg font-bold text-blue-400" id="questsClaimedToday">-</div>
              <div class="text-sm text-gray-300">Quests (24h)</div>
            </div>
            <div class="text-center">
              <div class="text-lg font-bold text-purple-400" id="rolesGrantedToday">-</div>
              <div class="text-sm text-gray-300">Roles (24h)</div>
            </div>
          </div>

          <!-- Engagement Stats -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h5 class="text-sm font-semibold mb-2 text-cyan-300">User Engagement:</h5>
              <div id="engagementStats" class="text-sm text-gray-300">
                Loading engagement data...
              </div>
            </div>
            <div>
              <h5 class="text-sm font-semibold mb-2 text-emerald-300">Wealth Distribution:</h5>
              <div id="wealthStats" class="text-sm text-gray-300">
                Loading wealth data...
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">‚ö° Quick Actions</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <button onclick="refreshDashboard()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
            üîÑ Refresh Data
          </button>
          <!-- Database actions (password protected) -->
          <div id="databaseQuickActions" style="display: none;">
            <button onclick="showUploadModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
              üì§ Upload DB
            </button>
            <button onclick="showDatabaseViewer()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
              üëÅÔ∏è View DB
            </button>
            <button onclick="triggerBackup()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-all duration-300">
              üíæ Backup DB
            </button>
            <button onclick="testBackup()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300 ml-2">
              üß™ Test Backup
            </button>
            <button onclick="testCopyOperation()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition-all duration-300 ml-2">
              üìã Test Copy to /data/
            </button>
            <button onclick="testBackupDryRun()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg transition-all duration-300 ml-2">
              üîç Test Backup Dry Run
            </button>
            <button onclick="testShellCommand()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg transition-all duration-300 ml-2">
              üêö Test Shell Command
            </button>
            <button onclick="testDatabasePath()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition-all duration-300 ml-2">
              üîç Test DB Path
            </button>
            <button onclick="debugDatabasePaths()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-all duration-300 ml-2">
              üêõ Debug DB Paths
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div>
          <h3 class="text-lg font-semibold mb-3">üîÑ Recent Point Adjustments</h3>
          <div id="recentAdjustments" class="max-h-64 overflow-y-auto">
            <div class="text-gray-300">Loading recent adjustments...</div>
          </div>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-3">üèÜ Top Users by Balance</h3>
          <div id="topUsers" class="max-h-64 overflow-y-auto">
            <div class="text-gray-300">Loading top users...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Management Tab -->
    <div class="admin-card mb-6" id="usersTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üë• User Management</h2>
      
      <!-- Instant User Search -->
      <div class="mb-6">
        <label class="block text-sm font-medium mb-2">üîç Instant User Search:</label>
        <div class="flex gap-2">
          <input type="text" id="userSearch" placeholder="Search by Discord ID or username..." 
                 class="flex-1 px-3 py-2 rounded text-gray-800" 
                 oninput="searchUsersInstant(this.value)">
          <button onclick="searchUsers()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Search</button>
        </div>
      </div>

      <!-- User Results -->
      <div id="userResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="text-gray-300">Search for users to see results...</div>
      </div>

      <!-- User Quest History Section -->
      <div class="mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üèÜ User Quest History</h3>
        <div class="mb-4">
          <div class="flex gap-2">
            <input type="text" id="questHistoryUserId" placeholder="Enter Discord ID or username..." 
                   class="flex-1 px-3 py-2 rounded text-gray-800">
            <button onclick="loadUserQuestHistory()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Load History</button>
          </div>
        </div>
        
        <!-- User Quest History Results -->
        <div id="userQuestHistory" class="space-y-4">
          <div class="text-gray-300">Enter a user ID or username to view their quest and cheese click history...</div>
        </div>
      </div>
    </div>

    <!-- Point Management Tab -->
    <div class="admin-card mb-6" id="pointsTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üí∞ Point Management</h2>
      
      <!-- Quick User Selection -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üéØ Quick User Selection</h3>
        <div class="flex gap-2">
          <input type="text" id="quickUserId" placeholder="Enter username or ID" 
                 class="flex-1 px-3 py-2 rounded text-gray-800" oninput="quickSearchUsersInstant(this.value)">
          <button onclick="quickSelectUser()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded">Select User</button>
        </div>
        <div id="quickUserResults" class="mt-3 max-h-48 overflow-y-auto">
          <div class="text-gray-300">Enter at least 2 characters to search...</div>
        </div>
        <div id="selectedUserInfo" class="mt-3 p-3 bg-gray-700 rounded hidden">
          <!-- Selected user info will appear here -->
        </div>
      </div>

      <!-- Point Operations -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        
        <!-- Add Points -->
        <div class="bg-green-900 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">‚ûï Add Points</h3>
          <div class="space-y-3">
            <input type="text" id="addUserId" placeholder="Discord User ID" class="w-full px-3 py-2 rounded text-gray-800">
            <input type="number" id="addAmount" placeholder="Amount to add" class="w-full px-3 py-2 rounded text-gray-800">
            <input type="text" id="addReason" placeholder="Reason (optional)" class="w-full px-3 py-2 rounded text-gray-800">
            <button onclick="addPoints()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Add Points</button>
          </div>
        </div>

        <!-- Set Points -->
        <div class="bg-blue-900 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üéØ Set Points</h3>
          <div class="space-y-3">
            <input type="text" id="setUserId" placeholder="Discord User ID" class="w-full px-3 py-2 rounded text-gray-800">
            <input type="number" id="setAmount" placeholder="New total amount" class="w-full px-3 py-2 rounded text-gray-800">
            <input type="text" id="setReason" placeholder="Reason (optional)" class="w-full px-3 py-2 rounded text-gray-800">
            <button onclick="setPoints()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Set Points</button>
          </div>
        </div>

        <!-- Remove Points -->
        <div class="bg-red-900 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">‚ûñ Remove Points</h3>
          <div class="space-y-3">
            <input type="text" id="removeUserId" placeholder="Discord User ID" class="w-full px-3 py-2 rounded text-gray-800">
            <input type="number" id="removeAmount" placeholder="Amount to remove" class="w-full px-3 py-2 rounded text-gray-800">
            <input type="text" id="removeReason" placeholder="Reason (optional)" class="w-full px-3 py-2 rounded text-gray-800">
            <button onclick="removePoints()" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Remove Points</button>
          </div>
        </div>
      </div>

      <!-- Balance & History -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Quick Balance Check -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üí≥ Quick Balance Check</h3>
          <div class="flex gap-2">
            <input type="text" id="balanceUserId" placeholder="Discord User ID" class="flex-1 px-3 py-2 rounded text-gray-800">
            <button onclick="checkBalance()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded">Check Balance</button>
          </div>
          <div id="balanceResult" class="mt-3 p-3 bg-gray-700 rounded hidden">
            <!-- Balance result will be shown here -->
          </div>
        </div>

        <!-- Transaction History -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üìã Transaction History</h3>
          <div class="flex gap-2 mb-3">
            <input type="text" id="historyUserId" placeholder="Discord User ID" class="flex-1 px-3 py-2 rounded text-gray-800">
            <button onclick="getHistory()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">Get History</button>
          </div>
          <div id="historyResult" class="max-h-64 overflow-y-auto">
            <!-- History will be shown here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Store Management Tab -->
    <div class="admin-card mb-6" id="storeTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üè™ Store Management</h2>
      
      <!-- Store Items -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">üì¶ Available Store Items</h3>
        <button onclick="loadStoreItems()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mb-3">Refresh Items</button>
        <div id="storeItems" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="text-gray-300">Click "Refresh Items" to load store items...</div>
        </div>
      </div>

      <!-- Add New Item -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3">‚ûï Add New Store Item</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input type="text" id="newItemName" placeholder="Item Name" class="px-3 py-2 rounded text-gray-800">
          <input type="number" id="newItemPrice" placeholder="Price in $DSPOINC" class="px-3 py-2 rounded text-gray-800">
          <input type="text" id="newItemImageUrl" placeholder="Image URL (optional)" class="px-3 py-2 rounded text-gray-800">
          <textarea id="newItemDescription" placeholder="Item Description" class="px-3 py-2 rounded text-gray-800 md:col-span-2"></textarea>
          <button onclick="createStoreItem()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Create Item</button>
        </div>
      </div>

      <!-- Give Item to User -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3">üéÅ Give Item to User</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="relative">
            <input type="text" id="giveItemUserId" placeholder="Search User ID or Username" class="px-3 py-2 rounded text-gray-800 w-full" oninput="giveItemSearchUsersInstant(this.value)">
            <div id="giveItemUserResults" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded mt-1 max-h-40 overflow-y-auto" style="display: none;"></div>
          </div>
          <input type="text" id="giveItemName" placeholder="Item Name" class="px-3 py-2 rounded text-gray-800">
          <input type="number" id="giveItemQuantity" placeholder="Quantity" value="1" class="px-3 py-2 rounded text-gray-800">
        </div>
        <button onclick="giveItemToUser()" class="mt-3 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">Give Item</button>
      </div>

      <!-- View User Inventory -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üë§ View User Inventory</h3>
        <div class="flex gap-2">
          <div class="relative flex-1">
            <input type="text" id="viewInventoryUserId" placeholder="Search User ID or Username" class="px-3 py-2 rounded text-gray-800 w-full" oninput="viewInventorySearchUsersInstant(this.value)">
            <div id="viewInventoryUserResults" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded mt-1 max-h-40 overflow-y-auto" style="display: none;"></div>
          </div>
          <button onclick="viewUserInventory()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">View Inventory</button>
        </div>
        <div id="userInventoryList" class="mt-3">
          <div class="text-gray-300">Search for a user and click "View Inventory"...</div>
        </div>
      </div>
    </div>

    <!-- Quest System Tab -->
    <div class="admin-card mb-6" id="questsTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üèÜ Quest System</h2>
      
      <!-- Active Quests -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">üéØ Active Quests</h3>
        <div id="activeQuestsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="text-gray-300">Loading active quests...</div>
        </div>
      </div>

      <!-- Create New Quest -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">‚ûï Create New Quest</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <select id="newQuestType" class="px-3 py-2 rounded text-gray-800" onchange="toggleCheeseQuestConfig()">
            <option value="">Select Quest Type...</option>
            <option value="cheese_hunt">üßÄ Cheese Hunt</option>
            <option value="tetris">üü¶ Tetris Quest</option>
            <option value="snake">üêç Snake Quest</option>
            <option value="hytopia_game">üéÆ Hytopia Game Quest</option>
            <option value="tweet">üê¶ Twitter Quest</option>
            <option value="invite">üë• Invite Friends</option>
            <option value="custom">‚öôÔ∏è Custom Quest</option>
          </select>
          <input type="number" id="newQuestReward" placeholder="Reward in $DSPOINC" class="px-3 py-2 rounded text-gray-800">
          <input type="text" id="newQuestUrl" placeholder="Quest URL" class="px-3 py-2 rounded text-gray-800">
          <textarea id="newQuestDescription" placeholder="Quest Description" class="px-3 py-2 rounded text-gray-800 md:col-span-2"></textarea>
          
          <!-- Role Granting Options -->
          <div class="md:col-span-2 bg-gray-700 p-4 rounded-lg">
            <h4 class="text-lg font-semibold mb-3 text-green-400">üé≠ Role Granting Options</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="flex items-center">
                <input type="checkbox" id="grantRoleCheckbox" class="mr-2 w-4 h-4 text-green-600 bg-gray-700 border-gray-600 rounded focus:ring-green-500 focus:ring-2">
                <label for="grantRoleCheckbox" class="text-sm font-medium">Grant Discord Role on Completion</label>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Discord Role ID:</label>
                <select id="questRoleId" class="w-full px-3 py-2 rounded text-gray-800">
                  <option value="">Select a role...</option>
                  <option value="1399651053682692208">üßÄ Cheese Hunter (1399651053682692208)</option>
                  <option value="1332017770937847809">üèÜ Alpha Caller (1332017770937847809)</option>
                  <option value="1332017420591697972">ü•á Champion (1332017420591697972)</option>
                  <option value="1332017969181622342">üë• Community Member (1332017969181622342)</option>
                  <option value="1332017063610548445">üåΩ Corny Companion (1332017063610548445)</option>
                  <option value="1332017858342944808">üí¨ Engager (1332017858342944808)</option>
                  <option value="1332016854390280306">üåà Kaleido Supporter (1332016854390280306)</option>
                  <option value="1332049628300054679">üõ°Ô∏è Moderator (1332049628300054679)</option>
                  <option value="1332017533800284211">üÉè Poker OG (1332017533800284211)</option>
                  <option value="1332017205667299489">üê∞ Bunny Buddy (1332017205667299489)</option>
                  <option value="1332017710351122482">ü•ä Rumble Champ (1332017710351122482)</option>
                  <option value="1356296242757369898">üöÄ Server Booster (1356296242757369898)</option>
                  <option value="1332016526848692345">üëë VIP Cheese Lord (1332016526848692345)</option>
                  <option value="1333347801408737323">‚úÖ Verified (1333347801408737323)</option>
                  <option value="1332017340392538123">üåø Weedery (1332017340392538123)</option>
                  <option value="1332108350518857842">üèÜ WL (1332108350518857842)</option>
                </select>
                <p class="text-xs text-gray-400 mt-1">Select the Discord role to grant when quest is completed</p>
              </div>
            </div>
          </div>
          
          <!-- Cheese Quest Configuration (shown when type is cheese_hunt) -->
          <div id="cheeseQuestConfig" class="md:col-span-2 bg-gray-700 p-4 rounded-lg" style="display: none;">
            <h4 class="text-lg font-semibold mb-3 text-yellow-400">üßÄ Cheese Hunt Configuration</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Movement Pattern:</label>
                <select id="cheeseMovementPattern" class="w-full px-3 py-2 rounded text-gray-800">
                  <option value="random">Random Jump</option>
                  <option value="edge_hunter">Edge Hunter</option>
                  <option value="sneaky">Sneaky (Hidden Areas)</option>
                  <option value="corner_lurker">Corner Lurker</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Movement Speed:</label>
                <select id="cheeseMovementSpeed" class="w-full px-3 py-2 rounded text-gray-800">
                  <option value="fast">Fast & Sneaky</option>
                  <option value="normal" selected>Normal Hunter</option>
                  <option value="slow">Slow & Patient</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Cheese Count:</label>
                <input type="number" id="cheeseCount" value="3" min="1" max="10" class="w-full px-3 py-2 rounded text-gray-800">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Hidden Areas:</label>
                <select id="cheeseHiddenAreas" class="w-full px-3 py-2 rounded text-gray-800">
                  <option value="true" selected>Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Discord Ticket:</label>
                <select id="cheeseDiscordTicket" class="w-full px-3 py-2 rounded text-gray-800">
                  <option value="true" selected>Create Ticket</option>
                  <option value="false">No Ticket</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Screenshot Required:</label>
                <select id="cheeseScreenshotRequired" class="w-full px-3 py-2 rounded text-gray-800">
                  <option value="true" selected>Required</option>
                  <option value="false">Optional</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Game Settings Section -->
          <div class="md:col-span-2 bg-gray-700 p-4 rounded-lg">
            <h4 class="text-lg font-semibold mb-3 text-blue-400">üéÆ Game Settings & WL Role Grants</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Tetris WL Settings -->
              <div class="bg-gray-600 p-3 rounded-lg">
                <h5 class="text-md font-semibold mb-2 text-green-400">üü¶ Tetris WL Settings</h5>
                <div class="space-y-2">
                  <div class="flex items-center">
                    <input type="checkbox" id="tetrisWlEnabled" class="mr-2 w-4 h-4 text-green-600 bg-gray-700 border-gray-600 rounded focus:ring-green-500 focus:ring-2">
                    <label for="tetrisWlEnabled" class="text-sm font-medium">Enable WL Role Grant</label>
                  </div>
                  <div>
                    <label class="block text-xs font-medium mb-1">Score Threshold:</label>
                    <input type="number" id="tetrisWlThreshold" value="4000" min="1000" max="10000" class="w-full px-2 py-1 rounded text-gray-800 text-sm">
                  </div>
                                 <div>
                 <label class="block text-xs font-medium mb-1">WL Role ID:</label>
                 <select id="tetrisWlRoleId" class="w-full px-2 py-1 rounded text-gray-800 text-sm">
                   <option value="">Select WL role...</option>
                   <option value="1399651053682692208">üßÄ Cheese Hunter (1399651053682692208)</option>
                   <option value="1332017770937847809">üèÜ Alpha Caller (1332017770937847809)</option>
                   <option value="1332017420591697972">ü•á Champion (1332017420591697972)</option>
                   <option value="1332016526848692345">üëë VIP Cheese Lord (1332016526848692345)</option>
                   <option value="1333347801408737323">‚úÖ Verified (1333347801408737323)</option>
                 </select>
               </div>
               <div>
                 <label class="block text-xs font-medium mb-1">Bonus Points:</label>
                 <input type="number" id="tetrisWlBonus" value="1000" min="100" max="10000" class="w-full px-2 py-1 rounded text-gray-800 text-sm">
               </div>
                </div>
              </div>
              
              <!-- Snake WL Settings -->
              <div class="bg-gray-600 p-3 rounded-lg">
                <h5 class="text-md font-semibold mb-2 text-green-400">üêç Snake WL Settings</h5>
                <div class="space-y-2">
                  <div class="flex items-center">
                    <input type="checkbox" id="snakeWlEnabled" class="mr-2 w-4 h-4 text-green-600 bg-gray-700 border-gray-600 rounded focus:ring-green-500 focus:ring-2">
                    <label for="snakeWlEnabled" class="text-sm font-medium">Enable WL Role Grant</label>
                  </div>
                  <div>
                    <label class="block text-xs font-medium mb-1">Score Threshold:</label>
                    <input type="number" id="snakeWlThreshold" value="4000" min="1000" max="10000" class="w-full px-2 py-1 rounded text-gray-800 text-sm">
                  </div>
                                 <div>
                 <label class="block text-xs font-medium mb-1">WL Role ID:</label>
                 <select id="snakeWlRoleId" class="w-full px-2 py-1 rounded text-gray-800 text-sm">
                   <option value="">Select WL role...</option>
                   <option value="1399651053682692208">üßÄ Cheese Hunter (1399651053682692208)</option>
                   <option value="1332017770937847809">üèÜ Alpha Caller (1332017770937847809)</option>
                   <option value="1332017420591697972">ü•á Champion (1332017420591697972)</option>
                   <option value="1332016526848692345">üëë VIP Cheese Lord (1332016526848692345)</option>
                   <option value="1333347801408737323">‚úÖ Verified (1333347801408737323)</option>
                 </select>
               </div>
               <div>
                 <label class="block text-xs font-medium mb-1">Bonus Points:</label>
                 <input type="number" id="snakeWlBonus" value="1000" min="100" max="10000" class="w-full px-2 py-1 rounded text-gray-800 text-sm">
               </div>
                </div>
              </div>
            </div>
            <div class="mt-3">
              <button onclick="saveGameSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                üíæ Save Game Settings
              </button>
            </div>
          </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium mb-1">Winner Message:</label>
                <input type="text" id="cheeseWinnerMessage" value="üéØ Congratulations! You found the cheese!" class="w-full px-3 py-2 rounded text-gray-800">
              </div>
            </div>
          </div>
          
          <button onclick="createQuest()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Create Quest</button>
        </div>
      </div>
      
      <!-- Quest Claims Management -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mt-6">
        <h3 class="text-lg font-semibold mb-3">üìã Quest Claims Management</h3>
        <div class="mb-4">
          <button onclick="loadEnhancedQuestClaims()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded mr-2">üîÑ Refresh Claims</button>
          <button onclick="testQuestClaimsTable()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded mr-2">üß™ Test Table</button>
          <select id="claimStatusFilter" onchange="filterQuestClaims()" class="px-3 py-2 rounded text-gray-800">
            <option value="all">All Claims</option>
            <option value="pending">Pending Review</option>
            <option value="approved">Approved</option>
            <option value="rejected">Rejected</option>
          </select>
          <button onclick="toggleUserHistoryView()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded ml-2">üë§ Show User History</button>
        </div>
        <div id="questClaimsList" class="space-y-4 max-h-96 overflow-y-auto">
          <div class="text-gray-300">Click "Refresh Claims" to load quest submissions...</div>
        </div>
      </div>
    </div>

    <!-- Boss Notifications Tab -->
    <div class="admin-card mb-6" id="bossNotificationsTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üèÜ Boss Notifications - Space Invaders Achievements</h2>
      
      <!-- Boss Notification Management Controls -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3">üéÆ Boss Achievement Management</h3>
        <div class="flex flex-wrap gap-2 mb-4">
          <button onclick="loadBossNotifications()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">üîÑ Refresh Notifications</button>
          <button onclick="testBossNotificationTable()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded mr-2">üß™ Test Table</button>
          <select id="bossNotificationStatusFilter" onchange="filterBossNotifications()" class="px-3 py-2 rounded text-gray-800">
            <option value="all">All Notifications</option>
            <option value="pending">Pending Review</option>
            <option value="approved">Approved</option>
            <option value="rejected">Rejected</option>
          </select>
          <button onclick="toggleBossUserHistoryView()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded ml-2">üë§ Show User History</button>
        </div>
        <div id="bossNotificationsList" class="space-y-4 max-h-96 overflow-y-auto">
          <div class="text-gray-300">Click "Refresh Notifications" to load boss achievements...</div>
        </div>
      </div>
    </div>

    <!-- Admin Activity Log -->
    <div class="admin-card mb-6">
      <h2 class="text-xl font-semibold mb-4">üìä Admin Activity Log</h2>
      <div id="statusLog" class="bg-gray-800 p-4 rounded text-sm font-mono h-40 overflow-y-auto border border-gray-600">
        <div class="text-green-400">üîÑ Admin interface initializing...</div>
      </div>
      <div class="text-xs text-gray-400 mt-2 text-center">üí° Activity log moved to top for better visibility - no more scrolling needed!</div>
    </div>

    <!-- Boss Management Tab -->
    <div class="admin-card mb-6" id="bossesTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üëë Boss Management - Space Cheese Invaders</h2>
      
      <!-- Boss Selection -->
      <div class="flex flex-wrap gap-2 mb-6">
        <button class="boss-tab-btn px-4 py-2 rounded active" data-boss-tab="cheeseKing" onclick="switchBossTab('cheeseKing')">üßÄ Cheese King</button>
        <button class="boss-tab-btn px-4 py-2 rounded" data-boss-tab="cheeseEmperor" onclick="switchBossTab('cheeseEmperor')">üëë Cheese Emperor</button>
        <button class="boss-tab-btn px-4 py-2 rounded" data-boss-tab="cheeseGod" onclick="switchBossTab('cheeseGod')">‚ö° Cheese God</button>
        <button class="boss-tab-btn px-4 py-2 rounded" data-boss-tab="cheeseDestroyer" onclick="switchBossTab('cheeseDestroyer')">üíÄ Cheese Destroyer</button>
        <button onclick="refreshBossConfigurations()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded ml-2">üîÑ Refresh All Bosses</button>
        <button onclick="resetAllBossConfigurations()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded ml-2">üîÑ Reset All to Defaults</button>
      </div>

      <!-- Boss Configuration Content -->
      <div id="bossConfigContent" class="space-y-6">
        <!-- Boss configuration forms will be loaded here -->
        <div class="text-center text-gray-400">
          <div class="text-lg">üëë Select a boss to configure</div>
          <div class="text-sm">Each boss has unique abilities and can be customized individually</div>
        </div>
      </div>
    </div>

    <!-- Game Management Tab -->
    <div class="admin-card mb-6" id="gamesTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üéÆ Game Management</h2>
      
                <!-- Game Management Tabs -->
          <div class="flex flex-wrap gap-2 mb-6">
            <button class="tab-btn px-4 py-2 rounded active" data-game-tab="overview" onclick="switchGameTab('overview')">üìä Overview Dashboard</button>
            <button class="tab-btn px-4 py-2 rounded" data-game-tab="tetris" onclick="switchGameTab('tetris')">üß© Tetris</button>
                    <button class="tab-btn px-4 py-2 rounded" data-game-tab="snake" onclick="switchGameTab('snake')">üêç Snake</button>
        <button class="tab-btn px-4 py-2 rounded" data-game-tab="space-invaders" onclick="switchGameTab('space-invaders')">üëæ Space Invaders</button>
            <button class="tab-btn px-4 py-2 rounded" data-game-tab="cheese-hunt" onclick="switchGameTab('cheese-hunt')">üßÄ Cheese Hunt</button>
            <button class="tab-btn px-4 py-2 rounded" data-game-tab="discord-race" onclick="switchGameTab('discord-race')">üèÅ Discord Cheese Race</button>
            <button onclick="refreshAllGameData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded ml-2">üîÑ Refresh All Games</button>
        <button onclick="debugAllGameTabs()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded ml-2">üîç Debug All Game Tabs</button>
          </div>



      <!-- Overview Dashboard Tab -->
      <div id="overviewTab" class="game-tab-content">
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üìä System Overview</h3>
        <div class="game-stats-grid">
            <!-- Total Players -->
          <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üë•</span>
                <span>Total Players</span>
              </div>
              <div class="game-stat-value" id="totalActivePlayers">-</div>
              <div class="game-stat-label">Active players</div>
              <div class="game-stat-subvalue">This week: <span id="totalWeeklyPlayers" class="text-blue-400">-</span></div>
            </div>

            <!-- Total Games -->
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üéÆ</span>
                <span>Total Games</span>
              </div>
              <div class="game-stat-value" id="totalGamesPlayed">-</div>
              <div class="game-stat-label">Games played</div>
              <div class="game-stat-subvalue">Today: <span id="totalGamesToday" class="text-green-400">-</span></div>
            </div>

            <!-- System Health -->
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üíö</span>
                <span>System Health</span>
              </div>
              <div class="game-stat-value" id="systemStatus">üü¢ Online</div>
              <div class="game-stat-label">System status</div>
              <div class="game-stat-subvalue">
                <span id="systemUptime" class="text-purple-400">99.9%</span> | 
                <span id="dataLoadStatus" class="text-blue-400">Loading...</span>
              </div>
            </div>

            <!-- Top Performers -->
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üèÜ</span>
                <span>Top Performers</span>
              </div>
              <div class="game-stat-value" id="topPerformersWeek">-</div>
              <div class="game-stat-label">This week</div>
              <div class="game-stat-subvalue">All time: <span id="topPerformersAllTime" class="text-yellow-400">-</span></div>
            </div>
          </div>
          
          <button onclick="loadGameOverview()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">üîÑ Refresh Overview</button>
        </div>

        <!-- Daily/Weekly Activity Summary -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
            <h4 class="font-semibold text-blue-400 mb-3">üìà Daily Activity (Last 7 Days)</h4>
            <div id="dailyActivityChart" class="h-48 bg-gray-700 rounded p-4">
              <div class="text-gray-400 text-center">Loading chart...</div>
            </div>
          </div>
          
          <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
            <h4 class="font-semibold text-green-400 mb-3">üéØ Weekly Performance</h4>
            <div id="weeklyPerformance" class="space-y-3">
              <div class="text-gray-400 text-center">Loading data...</div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-purple-400 mb-3">‚ö° Quick Actions</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <button onclick="resetAllGameScores()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">üîÑ Reset All Scores</button>
            <button onclick="exportGameData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">üìä Export Data</button>
            <button onclick="backupGameData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">üíæ Backup Data</button>
          </div>
        </div>
      </div>

      <!-- Tetris Tab -->
      <div id="tetrisTab" class="game-tab-content" style="display: none;">
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üß© Tetris Management</h3>
          
          <!-- Tetris Statistics -->
          <div class="game-stats-grid">
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìä</span>
                <span>Score Statistics</span>
              </div>
              <div class="game-stat-value" id="tetrisTotalScores">-</div>
              <div class="game-stat-label">Total Scores</div>
              <div class="game-stat-subvalue">Players: <span id="tetrisUniquePlayers" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Highest: <span id="tetrisMaxScore" class="text-green-400">-</span></div>
              <div class="game-stat-subvalue">Average: <span id="tetrisAvgScore" class="text-blue-400">-</span></div>
            </div>

          <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üéØ</span>
                <span>Season Data</span>
              </div>
              <div class="game-stat-value" id="tetrisCurrentSeason">-</div>
              <div class="game-stat-label">Current Season</div>
              <div class="game-stat-subvalue">Scores: <span id="tetrisSeasonScores" class="text-green-400">-</span></div>
              <div class="game-stat-subvalue">Players: <span id="tetrisSeasonPlayers" class="text-blue-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìà</span>
                <span>Recent Activity</span>
              </div>
              <div class="game-stat-value" id="tetrisRecent24h">-</div>
              <div class="game-stat-label">Last 24 hours</div>
              <div class="game-stat-subvalue">7 days: <span id="tetrisRecent7d" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">30 days: <span id="tetrisRecent30d" class="text-green-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>‚öôÔ∏è</span>
                <span>Game Settings</span>
              </div>
              <div class="game-stat-value" id="tetrisStatus">üü¢ Active</div>
              <div class="game-stat-label">Game status</div>
              <div class="game-stat-subvalue">Difficulty: <span id="tetrisDifficulty" class="text-blue-400">Normal</span></div>
            </div>
          </div>

          <!-- Tetris Leaderboard -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <h4 class="font-semibold text-yellow-400 mb-3">üèÜ Top 10 Players</h4>
            <div id="tetrisLeaderboard" class="space-y-2">
              <div class="text-gray-400 text-center">Loading leaderboard...</div>
            </div>
          </div>

          <!-- Tetris Actions -->
          <div class="flex flex-wrap gap-3">
            <button onclick="loadTetrisData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded admin-button">üîÑ Refresh Data</button>
            <button onclick="resetTetrisScores()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded admin-button">üîÑ Reset Scores</button>
            <button onclick="exportTetrisData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded admin-button">üìä Export Data</button>
          </div>
        </div>
      </div>

      <!-- Snake Tab -->
      <div id="snakeTab" class="game-tab-content" style="display: none;">
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üêç Snake Management</h3>
          
          <!-- Snake Statistics -->
          <div class="game-stats-grid">
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìä</span>
                <span>High Score Rankings</span>
              </div>
              <div class="game-stat-value" id="snakeTotalScores">-</div>
              <div class="game-stat-label">Total Scores</div>
              <div class="game-stat-subvalue">Players: <span id="snakeUniquePlayers" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Highest: <span id="snakeMaxScore" class="text-green-400">-</span></div>
              <div class="game-stat-subvalue">Average: <span id="snakeAvgScore" class="text-blue-400">-</span></div>
            </div>

          <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üë•</span>
                <span>Player Statistics</span>
              </div>
              <div class="game-stat-value" id="snakeActivePlayers">-</div>
              <div class="game-stat-label">Active Players</div>
              <div class="game-stat-subvalue">New: <span id="snakeNewPlayers" class="text-green-400">-</span></div>
              <div class="game-stat-subvalue">Returning: <span id="snakeReturningPlayers" class="text-blue-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìà</span>
                <span>Activity Trends</span>
              </div>
              <div class="game-stat-value" id="snakeRecent24h">-</div>
              <div class="game-stat-label">Last 24 hours</div>
              <div class="game-stat-subvalue">7 days: <span id="snakeRecent7d" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Growth: <span id="snakeGrowthRate" class="text-green-400">-</span></div>
            </div>

          <div class="game-stat-card">
              <div class="game-stat-header">
                <span>‚öôÔ∏è</span>
                <span>Game Configuration</span>
              </div>
              <div class="game-stat-value" id="snakeStatus">üü¢ Active</div>
              <div class="game-stat-label">Game status</div>
              <div class="game-stat-subvalue">Speed: <span id="snakeSpeed" class="text-blue-400">Normal</span></div>
            </div>

          <!-- Snake Leaderboard -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <h4 class="font-semibold text-yellow-400 mb-3">üèÜ Top 10 Players</h4>
            <div id="snakeLeaderboard" class="space-y-2">
              <div class="text-gray-400 text-center">Loading leaderboard...</div>
            </div>
          </div>

          <!-- Snake Actions -->
          <div class="flex flex-wrap gap-3">
            <button onclick="loadSnakeData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded admin-button">üîÑ Refresh Data</button>
            <button onclick="resetSnakeScores()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded admin-button">üîÑ Reset Scores</button>
            <button onclick="exportSnakeData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded admin-button">üìä Export Data</button>
          </div>
        </div>
      </div>



      <!-- Cheese Hunt Tab -->
      <div id="cheeseHuntTab" class="game-tab-content" style="display: none;">
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üßÄ Cheese Hunt Management</h3>
          
          <!-- Cheese Hunt Top Players -->
          <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
              <h4 class="font-semibold text-yellow-400 mb-3">üßÄ Cheese Hunt Top Players</h4>
              <div id="cheeseHuntTopPlayers" class="space-y-2 max-h-64 overflow-y-auto">
                <div class="text-gray-300">Loading top players...</div>
              </div>
            </div>
            
            <!-- Cheese Hunt Recent Activity -->
            <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
              <h4 class="font-semibold text-blue-400 mb-3">üìä Recent Activity</h4>
              <div id="cheeseHuntRecentActivity" class="space-y-2 max-h-64 overflow-y-auto">
                <div class="text-gray-300">Loading recent activity...</div>
              </div>
            </div>
            
            <!-- Cheese Hunt Achievements -->
            <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
              <h4 class="font-semibold text-green-400 mb-3">üèÜ Achievements</h4>
              <div id="cheeseHuntAchievements" class="space-y-2 max-h-64 overflow-y-auto">
                <div class="text-gray-400 text-center py-4">
                  <div class="text-2xl mb-2">üßÄ</div>
                  <p class="text-sm">No achievements yet</p>
                  <p class="text-xs text-gray-500">Start hunting to unlock!</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Cheese Hunt Statistics -->
          <div class="game-stats-grid">
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìä</span>
                <span>Click Statistics</span>
              </div>
              <div class="game-stat-value" id="cheeseTotalClicks">-</div>
              <div class="game-stat-label">Total Clicks</div>
              <div class="game-stat-subvalue">Players: <span id="cheeseUniquePlayers" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Today: <span id="cheeseClicksToday" class="text-green-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>ü•ö</span>
                <span>Egg Data</span>
              </div>
              <div class="game-stat-value" id="cheeseAvgClicks">-</div>
              <div class="game-stat-label">Average Clicks</div>
              <div class="game-stat-subvalue">Regular: <span id="cheeseRegularEggs" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Golden: <span id="cheeseGoldenEggs" class="text-yellow-400">-</span></div>
              <div class="game-stat-subvalue">Rare: <span id="cheeseRareEggs" class="text-purple-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìà</span>
                <span>Recent Activity</span>
              </div>
              <div class="game-stat-value" id="cheeseClicksToday">-</div>
              <div class="game-stat-label">Last 24 hours</div>
              <div class="game-stat-subvalue">7 days: <span id="cheeseRecent7d" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Active: <span id="cheeseActiveHunters" class="text-green-400">-</span></div>
              <div class="game-stat-subvalue">Completion: <span id="cheeseCompletionRate" class="text-purple-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>‚öôÔ∏è</span>
                <span>Game Settings</span>
              </div>
              <div class="game-stat-value" id="cheeseStatus">üü¢ Active</div>
              <div class="game-stat-label">Game status</div>
              <div class="game-stat-subvalue">Achievements: <span id="cheeseAchievements" class="text-blue-400">-</span></div>
            </div>
          </div>

          <!-- Cheese Hunt Leaderboard -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <h4 class="font-semibold text-yellow-400 mb-3">üèÜ Top 10 Cheese Hunters</h4>
            <div id="cheeseLeaderboard" class="space-y-2">
              <div class="text-gray-400 text-center">Loading leaderboard...</div>
            </div>
          </div>

          <!-- Cheese Hunt Actions -->
          <div class="flex flex-wrap gap-3">
            <button onclick="loadCheeseHuntData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded admin-button">üîÑ Refresh Data</button>
            <button onclick="resetCheeseData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded admin-button">üîÑ Reset Data</button>
            <button onclick="exportCheeseData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded admin-button">üìä Export Data</button>
          </div>
        </div>
      </div>

      <!-- Space Invaders Tab -->
      <div id="spaceInvadersTab" class="game-tab-content" style="display: none;">
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üëæ Space Invaders & Cheese Invaders Management</h3>
          
          <!-- Space Invaders Statistics -->
          <div class="game-stats-grid">
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìä</span>
                <span>Invader Statistics</span>
              </div>
              <div class="game-stat-value" id="spaceInvadersTotalScores">-</div>
              <div class="game-stat-label">Total Scores</div>
              <div class="game-stat-subvalue">Players: <span id="spaceInvadersUniquePlayers" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Highest: <span id="spaceInvadersMaxScore" class="text-green-400">-</span></div>
              <div class="game-stat-subvalue">Average: <span id="spaceInvadersAvgScore" class="text-blue-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üë•</span>
                <span>Player Statistics</span>
              </div>
              <div class="game-stat-value" id="spaceInvadersActivePlayers">-</div>
              <div class="game-stat-label">Active Players</div>
              <div class="game-stat-subvalue">New: <span id="spaceInvadersNewPlayers" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Returning: <span id="spaceInvadersReturningPlayers" class="text-green-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìà</span>
                <span>Activity Trends</span>
              </div>
              <div class="game-stat-value" id="spaceInvadersRecent24h">-</div>
              <div class="game-stat-label">Last 24 hours</div>
              <div class="game-stat-subvalue">7 days: <span id="spaceInvadersRecent7d" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Growth: <span id="spaceInvadersGrowthRate" class="text-green-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìä</span>
                <span>Season Data</span>
              </div>
              <div class="game-stat-value" id="spaceInvadersSeasonScores">-</div>
              <div class="game-stat-label">Season Scores</div>
              <div class="game-stat-subvalue">Current: <span id="spaceInvadersCurrentSeason" class="text-blue-400">Season 1</span></div>
            </div>


          </div>

          <!-- Space Invaders Leaderboard -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <h4 class="font-semibold text-yellow-400 mb-3">üèÜ Top 10 Players</h4>
            <div id="spaceInvadersLeaderboard" class="space-y-2">
              <div class="text-gray-400 text-center">Loading leaderboard...</div>
            </div>
          </div>

          <!-- Space Invaders Actions -->
          <div class="flex flex-wrap gap-3">
            <button onclick="loadSpaceInvadersData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded admin-button">üîÑ Refresh Data</button>
            <button onclick="resetInvadersScores()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded admin-button">üîÑ Reset Scores</button>
            <button onclick="exportInvadersData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded admin-button">üìä Export Data</button>
          </div>

          <!-- Boss Level Notifications -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-semibold text-orange-400">üëë Boss Level Notifications</h4>
              <div class="flex gap-3">
                <div class="text-sm text-blue-400 bg-blue-900 bg-opacity-30 px-3 py-1 rounded-full">
                  ‚è≥ Pending: <span id="pendingBossNotifications">0</span>
                </div>
                <div class="text-sm text-yellow-400 bg-yellow-900 bg-opacity-30 px-3 py-1 rounded-full">
                  üí∞ Total DSPOINC Rewards: <span id="totalBossRewards">0</span>
                </div>
              </div>
            </div>
            <div class="text-sm text-gray-300 mb-3">
              Players who reach boss levels will appear here for admin review and potential special rewards
            </div>
            
            <!-- Real-time notification indicator -->
            <div id="bossNotificationIndicator" class="hidden mb-3 p-2 bg-orange-600 bg-opacity-50 border border-orange-500 rounded-lg">
              <div class="flex items-center gap-2 text-orange-200">
                <span class="animate-pulse">üîî</span>
                <span class="text-sm font-semibold">New boss level notification received!</span>
                <button onclick="loadBossNotifications()" class="ml-auto bg-orange-700 hover:bg-orange-800 text-white px-2 py-1 rounded text-xs">View Now</button>
              </div>
            </div>
            
            <!-- Notification Filters -->
            <div class="flex flex-wrap gap-3 mb-4">
              <select id="bossNotificationFilter" onchange="filterBossNotifications()" class="bg-gray-600 text-white px-3 py-2 rounded text-sm">
                <option value="all">All Notifications</option>
                <option value="pending">Pending Review</option>
                <option value="reviewed">Reviewed</option>
                <option value="rewarded">Special Rewards Given</option>
              </select>
              <button onclick="loadBossNotifications()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm">üîÑ Refresh</button>
              <button onclick="clearOldNotifications()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded text-sm">üóëÔ∏è Clear Old</button>
            </div>
            
            <!-- Notifications List -->
            <div id="bossNotificationsList" class="space-y-3 max-h-64 overflow-y-auto">
              <div class="text-gray-400 text-center py-4">Loading boss notifications...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Discord Cheese Race Tab -->
      <div id="discordRaceTab" class="game-tab-content" style="display: none;">
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üèÅ Discord Cheese Race Management</h3>
          
          <!-- Discord Race Statistics -->
          <div class="game-stats-grid">
            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üèÅ</span>
                <span>Race Statistics</span>
              </div>
              <div class="game-stat-value" id="raceTotalRaces">-</div>
              <div class="game-stat-label">Total Races</div>
              <div class="game-stat-subvalue">Participants: <span id="raceTotalParticipants" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Winners: <span id="raceTotalWinners" class="text-green-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üë•</span>
                <span>Participation</span>
              </div>
              <div class="game-stat-value" id="raceCompletedRaces">-</div>
              <div class="game-stat-label">Completed Races</div>
              <div class="game-stat-subvalue">Active: <span id="raceActiveRaces" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Avg: <span id="raceAvgParticipants" class="text-green-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>üìä</span>
                <span>Performance</span>
              </div>
              <div class="game-stat-value" id="raceSuccessRate">-</div>
              <div class="game-stat-label">Success Rate</div>
              <div class="game-stat-subvalue">Peak: <span id="racePeakParticipation" class="text-blue-400">-</span></div>
              <div class="game-stat-subvalue">Top: <span id="raceTopWinner" class="text-yellow-400">-</span></div>
            </div>

            <div class="game-stat-card">
              <div class="game-stat-header">
                <span>‚öôÔ∏è</span>
                <span>Race Settings</span>
              </div>
              <div class="game-stat-value" id="raceStatus">üü¢ Active</div>
              <div class="game-stat-label">Bot status</div>
              <div class="game-stat-subvalue">Unique: <span id="raceUniqueWinners" class="text-blue-400">-</span></div>
            </div>
          </div>

          <!-- Discord Race Leaderboard -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <h4 class="font-semibold text-yellow-400 mb-3">üèÜ Top 10 Racers</h4>
            <div id="raceLeaderboard" class="space-y-2">
              <div class="text-gray-400 text-center">Loading leaderboard...</div>
            </div>
          </div>

          <!-- Race Overview Table -->
          <div class="bg-gray-700 p-4 rounded mb-4">
            <h4 class="font-semibold text-yellow-400 mb-3">üèÅ Race Overview</h4>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-600">
                    <th class="text-left p-2">Race ID</th>
                    <th class="text-left p-2">Creator</th>
                    <th class="text-left p-2">Status</th>
                    <th class="text-left p-2">Players</th>
                    <th class="text-left p-2">Created</th>
                    <th class="text-left p-2">Duration</th>
                    <th class="text-left p-2">Reward</th>
                    <th class="text-left p-2">Cheese Stats</th>
                  </tr>
                </thead>
                <tbody id="raceOverviewTable">
                  <tr>
                    <td colspan="8" class="text-center p-4 text-gray-400">Loading race overview...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Recent Race Activity -->
          <div class="activity-section">
            <div class="activity-header">
              <h4 class="activity-title">
                <span class="activity-icon">üìà</span>
                Recent Race Activity
              </h4>
              <div class="activity-actions">
                <button class="activity-action-btn" onclick="refreshRaceActivity()">
                  <span class="action-icon">üîÑ</span>Refresh
                </button>
              </div>
            </div>
            <div class="activity-content">
              <div id="recentRaceActivity" class="activity-list">
                <div class="activity-loading">
                  <div class="loading-spinner"></div>
                  <span>Loading recent activity...</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Discord Race Actions -->
          <div class="flex flex-wrap gap-3">
            <button onclick="loadDiscordRaceData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded admin-button">üîÑ Refresh Data</button>
            <button onclick="syncDiscordRaceData()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded admin-button">üîÑ Sync Discord Bot</button>
            <button onclick="exportRaceData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded admin-button">üìä Export Data</button>
            <button onclick="manageRaceBot()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded admin-button">ü§ñ Bot Settings</button>
          </div>
        </div>
      </div>

      <!-- Score Reset Management -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üîÑ Score Reset Management</h3>
        
        <!-- Reset Options -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
          <!-- Game Selection -->
          <div>
            <label class="block text-sm font-medium mb-2">üéÆ Select Game:</label>
            <select id="resetGameType" class="w-full px-3 py-2 rounded text-gray-800">
              <option value="all">All Games (Tetris + Snake + Space Invaders + Cheese Hunt + Discord Race)</option>
              <option value="tetris">üü¶ Tetris Only</option>
              <option value="snake">üêç Snake Only</option>
              <option value="space_invaders">üëæ Space Invaders Only</option>
              <option value="cheese_hunt">üßÄ Cheese Hunt Only</option>
              <option value="discord_race">üèÅ Discord Race Only</option>
            </select>
          </div>

          <!-- Reset Type -->
          <div>
            <label class="block text-sm font-medium mb-2">üîÑ Reset Type:</label>
            <select id="resetType" class="w-full px-3 py-2 rounded text-gray-800" onchange="toggleResetOptions()">
              <option value="season">üÜï New Season (Preserve Data)</option>
              <option value="all">üóëÔ∏è All Scores (Delete)</option>
              <option value="top_scores">üìä Top Scores Only</option>
              <option value="user">üë§ Specific User</option>
            </select>
          </div>
        </div>

        <!-- Additional Options -->
        <div id="resetOptions" class="space-y-4">
          <!-- Season Option -->
          <div id="seasonOption" class="hidden">
            <label class="block text-sm font-medium mb-2">üìÖ Season Name (Optional):</label>
            <input type="text" id="seasonName" placeholder="e.g., Summer 2024, Season 2, etc." class="w-full px-3 py-2 rounded text-gray-800">
            <p class="text-xs text-gray-400 mt-1">Leave empty for auto-generated season name. Current data will be preserved as historical data.</p>
          </div>

          <!-- Top Scores Option -->
          <div id="topScoresOption" class="hidden">
            <label class="block text-sm font-medium mb-2">üìä Number of Top Scores to Reset:</label>
            <input type="number" id="topCount" value="10" min="1" max="100" class="w-full px-3 py-2 rounded text-gray-800">
            <p class="text-xs text-gray-400 mt-1">Enter the number of top scores to remove (e.g., 10 = remove top 10 scores)</p>
          </div>

          <!-- User Option -->
          <div id="userOption" class="hidden">
            <label class="block text-sm font-medium mb-2">üë§ Discord User ID:</label>
            <input type="text" id="resetUserId" placeholder="Enter Discord ID (e.g., 123456789012345678)" class="w-full px-3 py-2 rounded text-gray-800">
            <p class="text-xs text-gray-400 mt-1">Enter the Discord ID of the user whose scores you want to reset</p>
          </div>
        </div>

        <!-- Reset Button -->
        <div class="mt-6">
          <button onclick="resetGameScores()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded font-semibold">
            ‚ö†Ô∏è Reset Game Scores
          </button>
          <p class="text-xs text-red-400 mt-2">‚ö†Ô∏è This action cannot be undone! For season resets, data is preserved as historical records.</p>
        </div>
      </div>

      <!-- Top Players -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Tetris Top Players -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-blue-400 mb-3">üü¶ Tetris Top Players</h4>
          <div id="tetrisTopPlayers" class="space-y-2 max-h-64 overflow-y-auto">
            <div class="text-gray-300">Loading top players...</div>
          </div>
        </div>

        <!-- Snake Top Players -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-green-400 mb-3">üêç Snake Top Players</h4>
          <div id="snakeTopPlayers" class="space-y-2 max-h-64 overflow-y-auto">
            <div class="text-gray-300">Loading top players...</div>
          </div>
        </div>

        <!-- Space Invaders Top Players -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-orange-400 mb-3">üëæ Space Invaders Top Players</h4>
          <div id="spaceInvadersTopPlayers" class="space-y-2 max-h-64 overflow-y-auto">
            <div class="text-gray-300">Loading top players...</div>
          </div>
        </div>
      </div>
      
      <!-- Additional Game Statistics -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Cheese Hunt Statistics -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-yellow-400 mb-3">üßÄ Cheese Hunt Statistics</h4>
          <div id="cheeseHuntStats" class="space-y-2">
            <div class="text-gray-300">Loading cheese hunt stats...</div>
          </div>
        </div>

        <!-- Discord Race Statistics -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-purple-400 mb-3">üèÅ Discord Race Statistics</h4>
          <div id="discordRaceStats" class="space-y-2">
            <div class="text-gray-300">Loading discord race stats...</div>
          </div>
        </div>
      </div>

      <!-- Season Statistics -->
      <div class="mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h4 class="font-semibold text-yellow-400 mb-3">üèÜ Season Statistics & Legends</h4>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium mb-2">üìÖ Select Season:</label>
            <select id="seasonSelector" class="w-full px-3 py-2 rounded text-gray-800" onchange="loadSeasonStats()">
              <option value="season_2">Season 2 - The Great Reset (2025)</option>
              <option value="season_1">Season 1 - Historical</option>
              <option value="all">All Seasons Combined</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">üéÆ Game Filter:</label>
            <select id="gameFilter" class="w-full px-3 py-2 rounded text-gray-800" onchange="loadSeasonStats()">
              <option value="all">All Games</option>
              <option value="tetris">Tetris Only</option>
              <option value="snake">Snake Only</option>
              <option value="space_invaders">Space Invaders Only</option>
              <option value="cheese_hunt">Cheese Hunt Only</option>
              <option value="discord_race">Discord Race Only</option>
            </select>
          </div>
        </div>
        <div id="seasonStats" class="space-y-4">
          <div class="text-gray-300">Loading season statistics...</div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h4 class="font-semibold text-purple-400 mb-3">üìä Recent Game Activity</h4>
        <div id="recentGameActivity" class="space-y-2 max-h-48 overflow-y-auto">
          <div class="text-gray-300">Loading recent activity...</div>
        </div>
      </div>

      <!-- Discord Activity Feed -->
      <div class="mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <div class="flex justify-between items-center mb-3">
          <h4 class="font-semibold text-blue-400 mb-0">üîó Discord Activity Feed</h4>
          <div class="flex items-center space-x-2">
            <button id="toggleDiscordFeed" onclick="toggleDiscordFeed()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
              <span id="feedStatus">‚ñ∂Ô∏è Start</span>
            </button>
            <button onclick="clearDiscordFeed()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
              üóëÔ∏è Clear
            </button>
          </div>
        </div>
        <div class="bg-black bg-opacity-80 p-3 rounded-lg border border-gray-600">
          <div id="discordActivityFeed" class="space-y-1 max-h-64 overflow-y-auto font-mono text-sm">
            <div class="text-gray-400 text-center py-4">
              <div class="text-lg mb-2">ü§ñ Discord Bot Activity</div>
              <div class="text-sm">Click "Start" to begin monitoring Discord events</div>
            </div>
          </div>
        </div>
        <div class="mt-2 text-xs text-gray-400">
          <span id="feedStats">Events: 0 | Last update: Never</span>
        </div>
      </div>

      <!-- Season Management & Control -->
      <div class="mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h4 class="font-semibold text-yellow-400 mb-3">üéÆ Season Management & Control</h4>
        <p class="text-sm text-gray-300 mb-4">Manage active seasons, switch between seasons, and control which season is currently active for all 5 games.</p>
        
        <!-- Current Season Status -->
        <div class="mb-6 p-4 bg-green-900 bg-opacity-30 rounded-lg border border-green-700">
          <h5 class="font-semibold text-green-400 mb-3">üü¢ Current Active Season</h5>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <div class="flex justify-between">
                <span class="text-gray-400">üéØ Active Season:</span>
                <span class="text-green-400 font-bold text-lg">Season 2 - The Great Reset (2025)</span>
              </div>
              <div class="flex justify-between mt-2">
                <span class="text-gray-400">üìÖ Start Date:</span>
                <span class="text-white">2025-08-05</span>
              </div>
              <div class="flex justify-between mt-2">
                <span class="text-gray-400">üéÆ Games Using Season 2:</span>
                <span class="text-green-400">All 5 Games (New Default)</span>
              </div>
            </div>
            <div>
              <div class="flex justify-between">
                <span class="text-gray-400">üìä Historical Data:</span>
                <span class="text-blue-400">Season 1 Preserved</span>
              </div>
              <div class="flex justify-between mt-2">
                <span class="text-gray-400">üîÑ New Games:</span>
                <span class="text-green-400">Auto-Use Season 2</span>
              </div>
              <div class="flex justify-between mt-2">
                <span class="text-gray-400">üèÜ Competition:</span>
                <span class="text-yellow-400">Fresh Start Active</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Season Switching Controls -->
        <div class="mb-6 p-4 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-700">
          <h5 class="font-semibold text-blue-400 mb-3">üîÑ Season Switching Controls</h5>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-2">üéØ Switch to Season:</label>
              <select id="seasonSwitchSelector" class="w-full px-3 py-2 rounded text-gray-800 mb-3">
                <option value="season_2">Season 2 - The Great Reset (2025)</option>
                <option value="season_1">Season 1 - Historical</option>
              </select>
              <button onclick="switchActiveSeason()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                üîÑ Switch Active Season
              </button>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">üìä View Season Data:</label>
              <select id="viewSeasonSelector" class="w-full px-3 py-2 rounded text-gray-800 mb-3" onchange="loadSeasonData()">
                <option value="season_2">Season 2 - Current Active</option>
                <option value="season_1">Season 1 - Historical</option>
                <option value="all">All Seasons Combined</option>
              </select>
              <button onclick="refreshSeasonData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm">
                üîÑ Refresh Data
              </button>
            </div>
          </div>
        </div>

      <!-- Season Settings Management -->
      <div class="mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h4 class="font-semibold text-yellow-400 mb-3">‚öôÔ∏è Season Settings Management</h4>
        <p class="text-sm text-gray-300 mb-4">Configure game scoring ratios, maximum scores, and other season-based settings for Tetris and Snake games.</p>
        
        <!-- Current Season Settings -->
        <div class="mb-6 p-4 bg-gray-700 rounded-lg">
          <h5 class="font-semibold text-blue-400 mb-3">üìã Current Season Settings</h5>
          <div id="currentSeasonSettings" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-400">üéØ Tetris Max Score:</span>
                <span class="text-white font-semibold" id="currentTetrisMax">-</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">üêç Snake Max Score:</span>
                <span class="text-white font-semibold" id="currentSnakeMax">-</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">üöÄ Space Invaders Max Score:</span>
                <span class="text-white font-semibold" id="currentSpaceInvadersMax">-</span>
              </div>
            </div>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-400">üìä Points Per Line (Tetris):</span>
                <span class="text-white font-semibold" id="currentPointsPerLine">-</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">üßÄ Points Per Cheese (Snake):</span>
                <span class="text-white font-semibold" id="currentPointsPerCheese">-</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">üëæ Points Per Invader (Space Invaders):</span>
                <span class="text-white font-semibold" id="currentPointsPerInvader">-</span>
              </div>
            </div>
          </div>
          
          <!-- Scoring Ratio Display -->
          <div class="mt-4 p-3 bg-gray-600 rounded-lg">
            <h6 class="font-semibold text-yellow-400 mb-2">üéØ Current Scoring Ratios</h6>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
              <div class="flex justify-between items-center">
                <span class="text-gray-300">üü¶ Tetris Ratio:</span>
                <span class="text-green-400 font-semibold" id="tetrisRatio">-</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-300">üêç Snake Ratio:</span>
                <span class="text-green-400 font-semibold" id="snakeRatio">-</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-gray-300">üöÄ Space Invaders Ratio:</span>
                <span class="text-green-400 font-semibold" id="spaceInvadersRatio">-</span>
              </div>
            </div>
          </div>
          
          <button onclick="loadCurrentSeasonSettings()" class="mt-3 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">üîÑ Refresh Settings</button>
        </div>

        <!-- Update Season Settings -->
        <div class="p-4 bg-gray-700 rounded-lg">
          <h5 class="font-semibold text-green-400 mb-3">üîÑ Update Season Settings</h5>
          <p class="text-sm text-gray-300 mb-4">Configure scoring ratios and maximum scores for both games. Changes apply immediately to new game scores.</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium mb-2">üéØ Tetris Max Score:</label>
              <input type="number" id="newTetrisMax" placeholder="10000" min="100" max="100000" class="w-full px-3 py-2 rounded text-gray-800">
              <p class="text-xs text-gray-400 mt-1">Maximum DSPOINC score for Tetris (cheat prevention)</p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">üêç Snake Max Score:</label>
              <input type="number" id="newSnakeMax" placeholder="10000" min="100" max="100000" class="w-full px-3 py-2 rounded text-gray-800">
              <p class="text-xs text-gray-400 mt-1">Maximum DSPOINC score for Snake (cheat prevention)</p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">üöÄ Space Invaders Max Score:</label>
              <input type="number" id="newSpaceInvadersMax" placeholder="10000" min="100" max="100000" class="w-full px-3 py-2 rounded text-gray-800">
              <p class="text-xs text-gray-400 mt-1">Maximum DSPOINC score for Space Invaders (cheat prevention)</p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">üìä Points Per Line (Tetris):</label>
              <input type="number" id="newPointsPerLine" placeholder="1" min="1" max="100" class="w-full px-3 py-2 rounded text-gray-800">
              <p class="text-xs text-gray-400 mt-1">DSPOINC points awarded per line cleared in Tetris (1:1 = exact score)</p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">üßÄ Points Per Cheese (Snake):</label>
              <input type="number" id="newPointsPerCheese" placeholder="1" min="1" max="100" class="w-full px-3 py-2 rounded text-gray-800">
              <p class="text-xs text-gray-400 mt-1">DSPOINC points awarded per cheese collected in Snake (1:1 = exact score)</p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-2">üëæ Points Per Invader (Space Invaders):</label>
              <input type="number" id="newPointsPerInvader" placeholder="0.1" min="0.001" max="1" step="0.001" class="w-full px-3 py-2 rounded text-gray-800">
              <p class="text-xs text-gray-400 mt-1">DSPOINC points awarded per invader destroyed (0.1 = 10 invaders = 1 DSPOINC)</p>
            </div>
          </div>
          
          <!-- Quick Ratio Presets -->
          <div class="mb-4 p-3 bg-gray-600 rounded-lg">
            <h6 class="font-semibold text-yellow-400 mb-2">‚ö° Quick Ratio Presets</h6>
            <div class="flex flex-wrap gap-2">
              <button onclick="setRatioPreset(1, 1, 0.1)" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">1:1:0.1 (Exact Score)</button>
              <button onclick="setRatioPreset(10, 10, 0.1)" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">10:1:0.1 (10x Multiplier)</button>
              <button onclick="setRatioPreset(5, 5, 0.1)" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm">5:1:0.1 (5x Multiplier)</button>
              <button onclick="setRatioPreset(2, 2, 0.1)" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm">2:1:0.1 (2x Multiplier)</button>
            </div>
          </div>
          
          <button onclick="updateSeasonSettings()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-semibold">
            ‚úÖ Update Season Settings
          </button>
          <p class="text-xs text-green-400 mt-2">‚úÖ These settings will apply to all new game scores immediately.</p>
        </div>
      </div>
    </div>

    <!-- Game Management 2.0 Tab -->
    <div class="admin-card mb-6" id="games2Tab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üöÄ Game Management 2.0 - Advanced Season Management</h2>
      <p class="text-gray-300 mb-6">Comprehensive season management, game statistics, and advanced controls for all 5 games.</p>
      
      <!-- Debug Info -->
      <div class="mb-4 p-3 bg-yellow-900 bg-opacity-50 rounded-lg border border-yellow-700">
        <h3 class="text-lg font-semibold text-yellow-300 mb-2">üîç Debug Information</h3>
        <p class="text-yellow-200 text-sm">Tab ID: games2Tab | Status: <span id="games2TabStatus">Loading...</span></p>
        <p class="text-yellow-200 text-sm">Functions Status: <span id="games2FunctionsStatus">Checking...</span></p>
        <button onclick="testGames2Tab()" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
          üß™ Test Tab Functions
        </button>
      </div>
      
      <!-- Database Access Quick Button -->
      <div class="mb-4 p-3 bg-blue-900 bg-opacity-50 rounded-lg border border-blue-700">
        <h3 class="text-lg font-semibold text-blue-300 mb-2">üóÑÔ∏è Database Access</h3>
        <div class="text-center">
          <!-- Database access unlock button - Games2 tab version -->
          <div id="games2DatabaseUnlock">
            <button onclick="showDatabaseUnlock()" class="inline-block bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
              üîì Unlock Database Access
            </button>
            <p class="text-sm text-blue-200 mt-2">Unlock database management features</p>
          </div>
          
          <!-- Database options for games2 tab (password protected) -->
          <div id="games2DatabaseOptions" style="display: none;">
            <div class="grid grid-cols-2 gap-3 mt-3">
              <button onclick="downloadDatabase()" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                üì• Download
              </button>
              <button onclick="showUploadModal()" class="bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                üì§ Upload
              </button>
              <button onclick="showDatabaseViewer()" class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                üëÅÔ∏è Viewer
              </button>
              <button onclick="triggerBackup()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105 text-sm">
                üóÑÔ∏è Backup
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Season Overview Dashboard -->
      <div class="mb-8 bg-gradient-to-r from-blue-900 to-purple-900 p-6 rounded-lg border border-blue-700">
        <h3 class="text-lg font-semibold text-blue-300 mb-4">üìä Season Overview Dashboard</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-blue-800 bg-opacity-50 p-4 rounded-lg border border-blue-600">
            <div class="text-center">
              <div class="text-3xl font-bold text-blue-300" id="currentSeasonDisplay2">Season 2</div>
              <div class="text-sm text-blue-200">Current Active Season</div>
            </div>
          </div>
          <div class="bg-green-800 bg-opacity-50 p-4 rounded-lg border border-green-600">
            <div class="text-center">
              <div class="text-3xl font-bold text-green-300" id="totalGamesDisplay2">0</div>
              <div class="text-sm text-green-200">Total Games This Season</div>
            </div>
          </div>
          <div class="bg-purple-800 bg-opacity-50 p-4 rounded-lg border border-purple-600">
            <div class="text-center">
              <div class="text-3xl font-bold text-purple-300" id="activePlayersDisplay2">0</div>
              <div class="text-sm text-purple-200">Active Players</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Season Management Controls -->
      <div class="mb-8 bg-gradient-to-r from-green-900 to-blue-900 p-6 rounded-lg border border-green-700">
        <h3 class="text-lg font-semibold text-green-300 mb-4">üéÆ Season Management Controls</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-green-200 mb-3">üîÑ Season Switching</h4>
            <select id="seasonSwitchSelector2" class="w-full px-3 py-2 rounded text-gray-800 mb-3">
              <option value="season_2">Season 2 - The Great Reset (2025)</option>
              <option value="season_1">Season 1 - Historical</option>
            </select>
            <button onclick="switchActiveSeason2()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">
              üîÑ Switch Active Season
            </button>
          </div>
          <div>
            <h4 class="font-semibold text-green-200 mb-3">üìä Season Data Viewing</h4>
            <select id="viewSeasonSelector2" class="w-full px-3 py-2 rounded text-gray-800 mb-3" onchange="loadSeasonData2()">
              <option value="season_2">Season 2 - Current Active</option>
              <option value="season_1">Season 1 - Historical</option>
              <option value="all">All Seasons Combined</option>
            </select>
            <button onclick="refreshSeasonData2()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
              üîÑ Refresh Data
            </button>
          </div>
        </div>
      </div>

      <!-- Game Statistics by Season -->
      <div class="mb-8 bg-gradient-to-r from-yellow-900 to-orange-900 p-6 rounded-lg border border-yellow-700">
        <h3 class="text-lg font-semibold text-yellow-300 mb-4">üéØ Game Statistics by Season</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="gameStatsGrid2">
          <!-- Game stats will be loaded here -->
        </div>
      </div>

      <!-- Season Performance Analytics -->
      <div class="mb-8 bg-gradient-to-r from-purple-900 to-pink-900 p-6 rounded-lg border border-purple-700">
        <h3 class="text-lg font-semibold text-purple-300 mb-4">üìà Season Performance Analytics</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-purple-200 mb-3">üèÜ Top Performers by Season</h4>
            <div id="topPerformersDisplay2" class="space-y-2">
              <!-- Top performers will be loaded here -->
            </div>
          </div>
          <div>
            <h4 class="font-semibold text-purple-200 mb-3">üìä Season Comparison</h4>
            <div id="seasonComparisonDisplay2" class="space-y-2">
              <!-- Season comparison will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Advanced Season Controls -->
      <div class="mb-8 bg-gradient-to-r from-red-900 to-orange-900 p-6 rounded-lg border border-red-700">
        <h3 class="text-lg font-semibold text-red-300 mb-4">‚öôÔ∏è Advanced Season Controls</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-red-200 mb-3">üÜï Create New Season</h4>
            <input type="text" id="newSeasonName2" placeholder="e.g., Season 3 - Winter 2025" class="w-full px-3 py-2 rounded text-gray-800 mb-3">
            <button onclick="createNewSeason2()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">
              üÜï Create Season
            </button>
          </div>
          <div>
            <h4 class="font-semibold text-red-200 mb-3">üóÇÔ∏è Season Data Export</h4>
            <select id="exportSeasonSelector2" class="w-full px-3 py-2 rounded text-gray-800 mb-3">
              <option value="season_2">Season 2</option>
              <option value="season_1">Season 1</option>
              <option value="all">All Seasons</option>
            </select>
            <button onclick="exportSeasonData2()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded text-sm">
              üì• Export Data
            </button>
          </div>
        </div>
      </div>

      <!-- Real-time Season Monitoring -->
      <div class="bg-gradient-to-r from-indigo-900 to-blue-900 p-6 rounded-lg border border-indigo-700">
        <h3 class="text-lg font-semibold text-indigo-300 mb-4">üîç Real-time Season Monitoring</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-indigo-200 mb-3">üì± Live Activity Feed</h4>
            <div id="liveActivityFeed2" class="bg-black bg-opacity-50 p-3 rounded-lg border border-gray-600 max-h-48 overflow-y-auto">
              <div class="text-gray-400 text-center py-4">
                <div class="text-lg mb-2">üéÆ Live Game Activity</div>
                <div class="text-sm">Real-time updates from all 5 games</div>
              </div>
            </div>
          </div>
          <div>
            <h4 class="font-semibold text-indigo-200 mb-3">‚ö° Quick Actions</h4>
            <div class="space-y-2">
              <button onclick="refreshAllGameData2()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded text-sm">
                üîÑ Refresh All Data
              </button>
              <button onclick="resetSeasonStats2()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded text-sm">
                üîÑ Reset Season Stats
              </button>
              <button onclick="backupSeasonData2()" class="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm">
                üíæ Backup Season Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Discord Config Tab -->
    <div class="admin-card mb-6" id="discordTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üîó Discord Configuration</h2>
      
      <!-- Current Discord Settings -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div>
          <p><strong>Current Invite Code:</strong> <span id="currentCode" class="font-mono bg-gray-800 px-2 py-1 rounded"><?php echo $discord_invite_code; ?></span></p>
          <p><strong>Full Discord URL:</strong> <span id="currentUrl" class="font-mono bg-gray-800 px-2 py-1 rounded"><?php echo $discord_url; ?></span></p>
        </div>
        <div>
          <p><strong>System Version:</strong> <span id="systemVersion" class="font-mono bg-gray-800 px-2 py-1 rounded">12.0</span></p>
          <p><strong>Last Updated:</strong> <span id="lastUpdated" class="font-mono bg-gray-800 px-2 py-1 rounded">2025-06-25</span></p>
        </div>
      </div>
      
      <!-- Update Discord Settings -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üîÑ Update Discord Settings</h3>
        <div class="flex gap-2">
          <input type="text" id="newInviteCode" placeholder="Enter new invite code" class="flex-1 px-3 py-2 rounded text-gray-800" value="<?php echo $discord_invite_code; ?>">
          <button onclick="updateInviteCode()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Update</button>
        </div>
      </div>
    </div>



    <!-- Cheese Egg Difficulty Guide Tab -->
    <div class="admin-card mb-6" id="cheeseGuideTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üßÄ Cheese Egg Difficulty Guide</h2>
      
      <!-- Overview Section -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3 text-yellow-400">üéØ Cheese Egg System Overview</h3>
        <p class="text-gray-300 mb-4">
          The cheese egg system is designed to provide an engaging hunting experience while preventing cheating through advanced anti-cheating measures. 
          This guide explains all difficulty settings and their impact on gameplay.
        </p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-green-400 mb-2">‚úÖ Anti-Cheating Features</h4>
            <ul class="text-sm text-gray-300 space-y-1">
              <li>‚Ä¢ Session-based randomization</li>
              <li>‚Ä¢ Anti-reload protection</li>
              <li>‚Ä¢ Time-based difficulty scaling</li>
              <li>‚Ä¢ Hidden area preference</li>
              <li>‚Ä¢ Visual indicators for hidden eggs</li>
            </ul>
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-blue-400 mb-2">üéÆ Difficulty Levels</h4>
            <ul class="text-sm text-gray-300 space-y-1">
              <li>‚Ä¢ 4 Movement Patterns</li>
              <li>‚Ä¢ 3 Speed Settings</li>
              <li>‚Ä¢ 1-10 Cheese Count</li>
              <li>‚Ä¢ Hidden Areas Toggle</li>
              <li>‚Ä¢ Screenshot Requirements</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Movement Patterns Section -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3 text-yellow-400">üîÑ Movement Pattern Settings</h3>
        <div class="space-y-4">
          <div class="border-l-4 border-green-500 pl-4">
            <h4 class="font-semibold text-green-400">Random Jump</h4>
            <p class="text-gray-300 text-sm mb-2">Default pattern with enhanced anti-cheating</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ Moves to any random area initially</li>
              <li>‚Ä¢ 70% chance to hide after 30 seconds</li>
              <li>‚Ä¢ Prefers hidden areas (above/below viewport)</li>
              <li>‚Ä¢ Session-based positioning prevents reload cheating</li>
            </ul>
          </div>
          
          <div class="border-l-4 border-blue-500 pl-4">
            <h4 class="font-semibold text-blue-400">Edge Hunter</h4>
            <p class="text-gray-300 text-sm mb-2">Advanced pattern for experienced hunters</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ Always prefers edges and corners</li>
              <li>‚Ä¢ Top, bottom, left, or right edges</li>
              <li>‚Ä¢ Positions eggs outside viewport boundaries</li>
              <li>‚Ä¢ Requires scrolling to find</li>
            </ul>
          </div>
          
          <div class="border-l-4 border-purple-500 pl-4">
            <h4 class="font-semibold text-purple-400">Sneaky (Hidden Areas)</h4>
            <p class="text-gray-300 text-sm mb-2">Expert level - very challenging</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ 70% chance to be completely hidden</li>
              <li>‚Ä¢ Far above or below viewport</li>
              <li>‚Ä¢ Requires extensive scrolling</li>
              <li>‚Ä¢ Visual pulse indicator when hidden</li>
            </ul>
          </div>
          
          <div class="border-l-4 border-red-500 pl-4">
            <h4 class="font-semibold text-red-400">Corner Lurker</h4>
            <p class="text-gray-300 text-sm mb-2">Master level - extremely difficult</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ Always in far corner areas</li>
              <li>‚Ä¢ Top-left, top-right, bottom-left, bottom-right</li>
              <li>‚Ä¢ Maximum distance from viewport center</li>
              <li>‚Ä¢ Requires strategic hunting approach</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Movement Speed Section -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3 text-yellow-400">‚ö° Movement Speed Settings</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-gray-700 p-3 rounded text-center">
            <h4 class="font-semibold text-green-400 mb-2">Fast & Sneaky</h4>
            <p class="text-gray-300 text-sm">Quick movements every 2-3 seconds</p>
            <p class="text-xs text-gray-400 mt-2">Best for: Active hunting, time pressure</p>
          </div>
          <div class="bg-gray-700 p-3 rounded text-center">
            <h4 class="font-semibold text-blue-400 mb-2">Normal Hunter</h4>
            <p class="text-gray-300 text-sm">Standard speed every 4-5 seconds</p>
            <p class="text-xs text-gray-400 mt-2">Best for: Balanced gameplay</p>
          </div>
          <div class="bg-gray-700 p-3 rounded text-center">
            <h4 class="font-semibold text-purple-400 mb-2">Slow & Patient</h4>
            <p class="text-gray-300 text-sm">Slow movements every 6-8 seconds</p>
            <p class="text-xs text-gray-400 mt-2">Best for: Strategic hunting</p>
          </div>
        </div>
      </div>

      <!-- Anti-Cheating Features Section -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3 text-yellow-400">üîí Anti-Cheating Features Explained</h3>
        <div class="space-y-4">
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-red-400 mb-2">Session-Based Randomization</h4>
            <p class="text-gray-300 text-sm mb-2">Each page load gets a unique seed that determines egg positions</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ Prevents reload cheating</li>
              <li>‚Ä¢ Consistent positioning within session</li>
              <li>‚Ä¢ Unpredictable between sessions</li>
            </ul>
          </div>
          
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-orange-400 mb-2">Time-Based Difficulty Scaling</h4>
            <p class="text-gray-300 text-sm mb-2">Difficulty increases over time to prevent quick wins</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ Gets harder over 5 minutes</li>
              <li>‚Ä¢ More hidden area preference</li>
              <li>‚Ä¢ Reduced visible positioning</li>
            </ul>
          </div>
          
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-yellow-400 mb-2">Hidden Area Bias</h4>
            <p class="text-gray-300 text-sm mb-2">Eggs prefer to hide in harder-to-find areas</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ 70% chance to hide after 30 seconds</li>
              <li>‚Ä¢ Above/below viewport positioning</li>
              <li>‚Ä¢ Requires scrolling and exploration</li>
            </ul>
          </div>
          
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-green-400 mb-2">Visual Indicators</h4>
            <p class="text-gray-300 text-sm mb-2">Subtle hints for hidden eggs</p>
            <ul class="text-xs text-gray-400 space-y-1">
              <li>‚Ä¢ Pulsing animation for hidden eggs</li>
              <li>‚Ä¢ Enhanced glow effects</li>
              <li>‚Ä¢ Brightness variations</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Quest Configuration Tips -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg mb-6">
        <h3 class="text-lg font-semibold mb-3 text-yellow-400">üí° Quest Configuration Tips</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-blue-400 mb-2">Beginner Quests</h4>
            <ul class="text-sm text-gray-300 space-y-1">
              <li>‚Ä¢ Movement: Random Jump</li>
              <li>‚Ä¢ Speed: Normal Hunter</li>
              <li>‚Ä¢ Cheese Count: 1-2</li>
              <li>‚Ä¢ Hidden Areas: Disabled</li>
            </ul>
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-purple-400 mb-2">Advanced Quests</h4>
            <ul class="text-sm text-gray-300 space-y-1">
              <li>‚Ä¢ Movement: Sneaky or Corner Lurker</li>
              <li>‚Ä¢ Speed: Fast & Sneaky</li>
              <li>‚Ä¢ Cheese Count: 3-5</li>
              <li>‚Ä¢ Hidden Areas: Enabled</li>
            </ul>
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-red-400 mb-2">Expert Quests</h4>
            <ul class="text-sm text-gray-300 space-y-1">
              <li>‚Ä¢ Movement: Corner Lurker</li>
              <li>‚Ä¢ Speed: Fast & Sneaky</li>
              <li>‚Ä¢ Cheese Count: 5-10</li>
              <li>‚Ä¢ Hidden Areas: Enabled</li>
              <li>‚Ä¢ Screenshot: Required</li>
            </ul>
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h4 class="font-semibold text-yellow-400 mb-2">Tournament Quests</h4>
            <ul class="text-sm text-gray-300 space-y-1">
              <li>‚Ä¢ Movement: Corner Lurker</li>
              <li>‚Ä¢ Speed: Fast & Sneaky</li>
              <li>‚Ä¢ Cheese Count: 8-10</li>
              <li>‚Ä¢ Hidden Areas: Enabled</li>
              <li>‚Ä¢ Discord Ticket: Required</li>
              <li>‚Ä¢ Screenshot: Required</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Main Content Grid - Reorganized for better flow -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        
        <!-- Left Column: Verification Management -->
        <div class="lg:col-span-2 space-y-6">
          
          <!-- View Verifications - Enhanced with better data display -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-3 text-blue-300 flex items-center">
              <span class="mr-2">üîç</span> View Verifications
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-1">Filter by Collection:</label>
                <select id="verificationCollectionFilter" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
                <option value="">All Collections</option>
                <option value="genesis">üß† Genesis Collection</option>
                <option value="vip">üé¥ VIP Collection</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-1">Filter by Status:</label>
                <select id="verificationStatusFilter" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
                <option value="">All Statuses</option>
                <option value="1">‚úÖ Role Granted</option>
                <option value="0">‚ùå Role Not Granted</option>
              </select>
            </div>
            </div>
            <button onclick="loadVerifications()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg mb-4">
              üîç Load Verifications
            </button>
          
            <!-- Enhanced verification results display -->
            <div id="verificationsList" class="space-y-2 max-h-80 overflow-y-auto bg-gray-900 p-3 rounded">
              <div class="text-gray-400 text-center py-4">Click "Load Verifications" to view data</div>
          </div>
        </div>

          <!-- NFT Ownership Management - Enhanced -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-3 text-green-300 flex items-center">
              <span class="mr-2">üé¥</span> NFT Ownership Management
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-1">Wallet Address:</label>
                <input type="text" id="nftWalletAddress" placeholder="Enter wallet address" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-1">Collection:</label>
                <select id="nftCollection" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
                <option value="genesis">üß† Genesis Collection</option>
                <option value="vip">üé¥ VIP Collection</option>
              </select>
            </div>
            </div>
            <button onclick="searchNFTs()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg mb-4">
              üîç Search NFTs
            </button>
          
            <!-- Enhanced NFT search results -->
            <div id="nftSearchResults" class="space-y-2 max-h-80 overflow-y-auto bg-gray-900 p-3 rounded">
              <div class="text-gray-400 text-center py-4">Search for NFTs to view ownership</div>
          </div>
        </div>
      </div>

        <!-- Right Column: Role Management - Streamlined -->
        <div class="space-y-6">
          
          <!-- Role Granting - Enhanced -->
          <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-3 text-green-300 flex items-center">
              <span class="mr-2">‚úÖ</span> Grant Roles
            </h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Search User:</label>
                <div class="flex gap-2">
                  <input type="text" id="holderUserSearch" placeholder="Search by Discord ID or username" 
                         class="flex-1 px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600" 
                         oninput="searchHolderUsersInstant(this.value)">
                  <button onclick="searchHolderUsers()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm">
                    üîç
                  </button>
                </div>
                <div id="holderUserSearchResults" class="mt-2 max-h-32 overflow-y-auto bg-gray-700 rounded p-2 hidden">
                  <div class="text-gray-400 text-sm">Enter at least 2 characters to search...</div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Discord User ID:</label>
                <input type="text" id="roleUserId" placeholder="Enter Discord user ID" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Role to Grant:</label>
                <select id="roleToGrant" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
                  <option value="1402668301414563971">üèÜ Holder (1402668301414563971)</option>
                  <option value="1332016526848692345">üé¥ VIP Holder (1332016526848692345)</option>
                  <option value="1332108350518857842">üßÄ Cheese Hunter (1332108350518857842)</option>
                  <option value="1332108350518857843">üéØ Alpha Caller (1332108350518857843)</option>
                  <option value="1332108350518857844">üèÖ Champion (1332108350518857844)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Reason:</label>
                <input type="text" id="roleGrantReason" placeholder="Reason for role grant" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
              </div>
              <button onclick="grantRole()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                ‚úÖ Grant Role
              </button>
            </div>
          </div>

          <!-- Role Revoking - Enhanced -->
          <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-3 text-red-300 flex items-center">
              <span class="mr-2">‚ùå</span> Revoke Roles
            </h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Search User:</label>
                <div class="flex gap-2">
                  <input type="text" id="revokeUserSearch" placeholder="Search by Discord ID or username" 
                         class="flex-1 px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600" 
                         oninput="searchRevokeUsersInstant(this.value)">
                  <button onclick="searchRevokeUsers()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm">
                    üîç
                  </button>
                </div>
                <div id="revokeUserSearchResults" class="mt-2 max-h-32 overflow-y-auto bg-gray-700 rounded p-2 hidden">
                  <div class="text-gray-400 text-sm">Enter at least 2 characters to search...</div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Discord User ID:</label>
                <input type="text" id="revokeUserId" placeholder="Enter Discord user ID" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Role to Revoke:</label>
                <select id="roleToRevoke" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
                  <option value="1402668301414563971">üèÜ Holder (1402668301414563971)</option>
                  <option value="1332016526848692345">üé¥ VIP Holder (1332016526848692345)</option>
                  <option value="1332108350518857842">üßÄ Cheese Hunter (1332108350518857842)</option>
                  <option value="1332108350518857843">üéØ Alpha Caller (1332108350518857843)</option>
                  <option value="1332108350518857844">üèÖ Champion (1332108350518857844)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Reason:</label>
                <input type="text" id="roleRevokeReason" placeholder="Reason for role revocation" class="w-full px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600">
              </div>
              <button onclick="revokeRole()" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                ‚ùå Revoke Role
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Section: Logs and History -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        
        <!-- Verification Log - Enhanced -->
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3 text-blue-300 flex items-center">
            <span class="mr-2">üìã</span> Verification Log
          </h3>
          <div id="verificationLog" class="bg-gray-900 p-4 rounded text-sm font-mono h-48 overflow-y-auto border border-gray-600">
          <div class="text-blue-400">üîÑ Holder verification system ready...</div>
        </div>
      </div>

        <!-- Role Grant History - Enhanced -->
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h3 class="text-lg font-semibold mb-3 text-purple-300 flex items-center">
            <span class="mr-2">üìä</span> Role Grant History
          </h3>
        <div class="space-y-3 mb-4">
          <div class="flex flex-wrap gap-2">
            <button onclick="loadRoleHistory('all')" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm">
              All Actions
            </button>
            <button onclick="loadRoleHistory('granted')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
              ‚úÖ Granted Only
            </button>
            <button onclick="loadRoleHistory('revoked')" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
              ‚ùå Revoked Only
            </button>
          </div>
          <div class="flex gap-2">
              <input type="text" id="historyUserSearch" placeholder="Search by user ID or username" 
                     class="flex-1 px-3 py-2 rounded text-gray-800 bg-gray-700 border border-gray-600 text-sm">
            <button onclick="searchRoleHistory()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm">
                üîç
            </button>
          </div>
        </div>
        
          <div id="roleHistoryList" class="space-y-2 max-h-48 overflow-y-auto bg-gray-900 p-3 rounded border border-gray-600">
          <div class="text-gray-400 text-center py-4">Click "All Actions" to view role grant history</div>
          </div>
        </div>
      </div>
    </div>

  </div>

    <!-- Holder Verification Tab -->
    <div class="admin-card mb-6" id="holderVerificationTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üé¥ Holder Verification Management</h2>
      
      <!-- Verification Statistics -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üìä Verification Statistics</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="text-center">
            <div class="text-2xl font-bold text-green-400" id="totalVerifications">-</div>
            <div class="text-sm text-gray-300">Total Verifications</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-400" id="pendingVerifications">-</div>
            <div class="text-sm text-gray-300">Pending</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-400" id="approvedVerifications">-</div>
            <div class="text-sm text-gray-300">Approved</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-red-400" id="rejectedVerifications">-</div>
            <div class="text-sm text-gray-300">Rejected</div>
          </div>
        </div>
      </div>

      <!-- Verification Actions -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üîç Verification Actions</h3>
        <div class="flex flex-wrap gap-4">
          <button onclick="refreshVerificationStats()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            üîÑ Refresh Stats
          </button>
          <button onclick="exportVerificationData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            üì• Export Data
          </button>
        </div>
      </div>

      <!-- Verification Log -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üìù Verification Log</h3>
        <div id="verificationLog" class="bg-gray-700 p-3 rounded max-h-40 overflow-y-auto text-sm text-gray-300">
          <div class="text-gray-400">Verification log will appear here...</div>
        </div>
      </div>
      
      <!-- Holder Verification Container -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üé¥ Holder Verifications</h3>
        <div id="holderVerificationContainer" class="space-y-4">
          <div class="text-gray-400">Loading holder verifications...</div>
        </div>
      </div>
    </div>

    <!-- Community Funds Tab -->
    <div class="admin-card mb-6" id="communityFundsTab" style="display: none;">
      <h2 class="text-xl font-semibold mb-4">üí∞ Community Funds Management</h2>
      
      <!-- CSV Import Section -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üìä Real Wallet Data Import</h3>
        <div class="flex flex-wrap gap-3 items-center mb-4">
          <button onclick="importWalletCSV()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors">
            üì• Import CSV Data
          </button>
          <button onclick="forceReimportCSV()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded transition-colors">
            üîÑ Force Reimport
          </button>
          <button onclick="refreshWalletData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors">
            üîÑ Refresh Data
          </button>
          <div class="text-sm text-gray-300" id="walletImportStatus">
            No wallet data imported yet
          </div>
        </div>
        
        <!-- Real Wallet Balance Display -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="text-center p-3 bg-gray-700 bg-opacity-50 rounded">
            <div class="text-2xl font-bold text-green-400" id="walletBalance">-</div>
            <div class="text-sm text-gray-300">Current Balance (SOL)</div>
          </div>
          <div class="text-center p-3 bg-gray-700 bg-opacity-50 rounded">
            <div class="text-xl font-semibold text-blue-400" id="wallet24hChange">-</div>
            <div class="text-sm text-gray-300">24h Change</div>
          </div>
          <div class="text-center p-3 bg-gray-700 bg-opacity-50 rounded">
            <div class="text-lg font-medium text-yellow-400" id="walletTransactions">-</div>
            <div class="text-sm text-gray-300">Total Transactions</div>
          </div>
        </div>
      </div>

      <!-- Community Wallet Overview -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üè¶ Community Wallet Overview</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="text-center">
            <div class="text-2xl font-bold text-green-400" id="solBalance">-</div>
            <div class="text-sm text-gray-300">SOL Balance</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-400" id="totalNfts">-</div>
            <div class="text-sm text-gray-300">Total NFTs</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-400" id="totalCollections">-</div>
            <div class="text-sm text-gray-300">Collections</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-purple-400" id="totalEntries">-</div>
            <div class="text-sm text-gray-300">Fund Entries</div>
          </div>
        </div>
        
        <!-- Statistics Section -->
        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="text-center p-3 bg-gray-700 bg-opacity-50 rounded">
            <div class="text-lg font-semibold text-green-400" id="monthlyTotal">-</div>
            <div class="text-sm text-gray-300">This Month</div>
          </div>
          <div class="text-center p-3 bg-gray-700 bg-opacity-50 rounded">
            <div class="text-lg font-semibold text-blue-400" id="lastMonthTotal">-</div>
            <div class="text-sm text-gray-300">Last Month</div>
          </div>
          <div class="text-center p-3 bg-gray-700 bg-opacity-50 rounded">
            <div class="text-lg font-semibold text-yellow-400" id="averageEntry">-</div>
            <div class="text-sm text-gray-300">Average Entry</div>
          </div>
        </div>
      </div>

      <!-- Collections and NFTs Section -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üñºÔ∏è Collections & NFTs</h3>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Collections Summary -->
          <div>
            <h4 class="text-md font-semibold mb-2 text-blue-400">Collections</h4>
            <div id="collectionsSummary" class="min-h-[200px]">
              <div class="text-center text-gray-300">Loading collections...</div>
            </div>
          </div>
          <!-- NFT Gallery -->
          <div>
            <h4 class="text-md font-semibold mb-2 text-green-400">NFT Gallery</h4>
            <div id="nftGallery" class="min-h-[200px]">
              <div class="text-center text-gray-300">Loading NFTs...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Real Wallet Transaction History -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üìä Real Wallet Transaction History</h3>
        <div class="flex flex-wrap gap-4 mb-4">
          <button onclick="loadRealWalletData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors">
            üîÑ Refresh History
          </button>
          <span class="text-sm text-gray-300">Showing imported CSV data</span>
        </div>
        
        <!-- Wallet Transactions Table -->
        <div class="overflow-x-auto max-h-96">
          <table class="min-w-full bg-gray-700 bg-opacity-50 rounded-lg">
            <thead class="sticky top-0 bg-gray-700">
              <tr class="border-b border-gray-600">
                <th class="px-4 py-2 text-left text-gray-300">TIME</th>
                <th class="px-4 py-2 text-left text-gray-300">TYPE</th>
                <th class="px-4 py-2 text-left text-gray-300">AMOUNT (SOL)</th>
                <th class="px-4 py-2 text-left text-gray-300">BALANCE (SOL)</th>
                <th class="px-4 py-2 text-left text-gray-300">FEE</th>
                <th class="px-4 py-2 text-left text-gray-300">ACTIONS</th>
              </tr>
            </thead>
            <tbody id="walletTransactionsTableBody">
              <tr><td colspan="6" class="text-center text-gray-400">Loading transaction history...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Fund Management -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üí∏ Fund Management</h3>
        <div class="flex flex-wrap gap-4 mb-4">
          <button onclick="showAddFundsModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            ‚ûï Add Funds
          </button>
          <button onclick="refreshCommunityFundsData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            üîÑ Refresh Data
          </button>
        </div>
        
        <!-- Funds Table -->
        <!-- üîß NEW: CSV Import Section -->
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üìä Community Funds CSV Import</h3>
          <div class="flex flex-wrap gap-4 items-center">
            <input type="file" id="communityFundsCsvInput" accept=".csv" class="text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700">
            <button onclick="importCommunityFundsCSV()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">
              üì• Import Community Funds
            </button>
            <button onclick="downloadCommunityFundsCSV()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
              üì§ Export Community Funds
            </button>
            <button onclick="loadCommunityFundsData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm">
              üîÑ Refresh
            </button>
          </div>
          <div id="communityFundsCsvStatus" class="mt-2 text-sm text-gray-400"></div>
        </div>
        
        <!-- üîß NEW: Wallet Transactions CSV Import Section -->
        <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">üí∞ Wallet Transactions CSV Import</h3>
          <div class="flex flex-wrap gap-4 items-center">
            <input type="file" id="walletTransactionsCsvInput" accept=".csv" class="text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700">
            <button onclick="importWalletTransactionsCSV()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">
              üì• Import Wallet Transactions
            </button>
            <button onclick="downloadWalletTransactionsCSV()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
              üì§ Export Wallet Transactions
            </button>
            <button onclick="loadWalletTransactionsData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm">
              üîÑ Refresh
            </button>
          </div>
          <div id="walletTransactionsCsvStatus" class="mt-2 text-sm text-gray-400"></div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-gray-300">
            <thead class="text-xs uppercase bg-gray-700">
              <tr>
                <th class="px-4 py-2 text-left">Type</th>
                <th class="px-4 py-2 text-left">Description</th>
                <th class="px-4 py-2 text-left">Amount</th>
                <th class="px-4 py-2 text-left">Date</th>
                <th class="px-4 py-2 text-left">Actions</th>
              </tr>
            </thead>
            <tbody id="communityFundsTableBody">
              <tr>
                <td colspan="5" class="px-4 py-2 text-center text-gray-400">Loading community funds...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="mb-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg">
        <h3 class="text-lg font-semibold mb-3">üìà Recent Activity</h3>
        <div id="recentActivity" class="text-gray-400 text-sm">
          Loading recent activity...
        </div>
      </div>
    </div>

  <script>
    // Global variables
    let currentAdmin = null;
    let currentTab = 'dashboard';
    let searchTimeout = null;

    // Initialize the interface
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ DOMContentLoaded event fired');
      
      setTimeout(async () => {
        console.log('‚è∞ Initialization timeout started');
        updateDisplay();
        
        // Add event listener for quest type input
        const questTypeInput = document.getElementById('newQuestType');
        console.log('üßÄ Setting up quest type input listener on:', questTypeInput);
        questTypeInput.addEventListener('input', toggleCheeseQuestConfig);
        console.log('üßÄ Event listener attached successfully');
        
        // Check if user is coming from admin interface redirect
        const adminRedirect = localStorage.getItem('adminRedirect');
        if (adminRedirect) {
          console.log('üîÑ Admin redirect detected, clearing flag');
          localStorage.removeItem('adminRedirect');
          addLog('üîÑ Redirected from Discord OAuth - checking authentication...');
        }
        
        // Debug: Show current authentication state
        console.log('üîç Current authentication state:', {
          currentAdmin,
          adminRedirect,
          localStorage: Object.keys(localStorage).filter(key => key.includes('admin') || key.includes('discord'))
        });
        
        // Check for existing Discord authentication first
        console.log('üîê Checking Discord authentication...');
        const discordAuthResult = await checkDiscordAuth();
        console.log('üîê Discord auth result:', discordAuthResult);
        
        if (!discordAuthResult) {
          // Hide all admin content until authentication
          console.log('‚ùå No Discord auth, hiding admin content');
          hideAllAdminContent();
          addLog('üéØ Admin interface loaded successfully');
          addLog('üîê Please authenticate to access admin features');
        } else {
          // User is authenticated, show admin content
          console.log('‚úÖ Discord auth successful, showing admin content');
          showAdminContent();
          loadDashboardData();
          
          // Force navigation panel to be visible as a fallback
          setTimeout(() => {
            const navPanel = document.getElementById('navPanel');
            if (navPanel) {
              navPanel.style.display = 'block';
              console.log('üîß Force-fixed navigation panel visibility');
            }
          }, 1000);
          
          // Check if Space Invaders tab is active and load boss notifications
          setTimeout(() => {
            const spaceInvadersTab = document.getElementById('spaceInvadersTab');
            if (spaceInvadersTab && spaceInvadersTab.style.display !== 'none') {
              loadBossNotifications();
              startBossNotificationChecking();
            }
          }, 2000);
          
          // Start real-time boss stats updating for dashboard
          startDashboardBossStatsUpdating();
        }
      }, 100);
    });

    // Update Discord display
    function updateDisplay() {
      document.getElementById('currentCode').textContent = DISCORD_CONFIG.inviteCode;
      document.getElementById('currentUrl').textContent = DISCORD_CONFIG.getCurrentUrl();
      document.getElementById('systemVersion').textContent = DISCORD_CONFIG.version;
      document.getElementById('lastUpdated').textContent = DISCORD_CONFIG.lastUpdated;
    }

    // Dashboard refresh function
    function refreshDashboard() {
      console.log('üîÑ Refreshing dashboard data...');
      loadDashboardData();
      addLog('‚úÖ Dashboard data refreshed');
    }

    // Hide all admin content until authentication
    function hideAllAdminContent() {
      // Hide navigation panel
      const navPanel = document.getElementById('navPanel');
      if (navPanel) navPanel.style.display = 'none';
      
      // Hide all tab content
      const tabContents = document.querySelectorAll('[id$="Tab"]');
      tabContents.forEach(tab => {
        if (tab) tab.style.display = 'none';
      });
      
      // Show only authentication panel
      const authPanel = document.getElementById('authPanel');
      if (authPanel) authPanel.style.display = 'block';
      
      // Clear sensitive data
      const sensitiveElements = ['totalUsers', 'totalScores', 'totalItems', 'activeQuests', 'bossNotifications'];
      sensitiveElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.textContent = 'üîí';
      });
    }

    // Show admin content after authentication
    function showAdminContent() {
      console.log('üîì showAdminContent() called - showing admin interface');
      
      // Hide authentication panel
      const authPanel = document.getElementById('authPanel');
      if (authPanel) {
        authPanel.style.display = 'none';
        console.log('‚úÖ Authentication panel hidden');
      }
      
      // Show navigation panel
      const navPanel = document.getElementById('navPanel');
      if (navPanel) {
        navPanel.style.display = 'block';
        console.log('‚úÖ Navigation panel shown');
      } else {
        console.error('‚ùå Navigation panel not found!');
      }
      
      // Show dashboard tab by default and load overview game stats
      showTab('dashboard');
      // Load overview game statistics for the dashboard and preload all game data
      setTimeout(async () => {
        await loadOverviewGameStats();
        // Preload all game data to avoid manual reloading
        await preloadAllGameData();
      }, 500); // Small delay to ensure dashboard is loaded first
      
      console.log('üîì Admin content should now be visible');
    }
    
    // Debug function to manually show navigation
    function debugShowNavigation() {
      console.log('üêõ Debug: Manually showing navigation panel');
      
      const navPanel = document.getElementById('navPanel');
      if (navPanel) {
        navPanel.style.display = 'block';
        console.log('‚úÖ Navigation panel manually shown');
        addLog('üêõ Navigation panel manually shown via debug button');
      } else {
        console.error('‚ùå Navigation panel not found in debug function');
        addLog('‚ùå Navigation panel not found in debug function');
      }
      
      // Also try to show all tabs
      const allTabs = document.querySelectorAll('[id$="Tab"]');
      console.log(`üêõ Found ${allTabs.length} tab elements`);
      allTabs.forEach((tab, index) => {
        console.log(`üêõ Tab ${index}: ${tab.id} - display: ${tab.style.display}`);
      });
    }
    
    // Test all tabs function
    function testAllTabs() {
      console.log('üß™ Testing all tabs...');
      addLog('üß™ Testing all tabs...');
      
      const tabNames = ['dashboard', 'users', 'points', 'store', 'quests', 'games', 'discord', 'holderVerification', 'cheeseGuide', 'communityFunds'];
      
      tabNames.forEach(tabName => {
        console.log(`üß™ Testing tab: ${tabName}`);
        const tabElement = document.getElementById(tabName + 'Tab');
        if (tabElement) {
          console.log(`‚úÖ Tab ${tabName} found: ${tabElement.id}`);
          console.log(`üìä Current display: ${tabElement.style.display}`);
          console.log(`üìä Computed display: ${window.getComputedStyle(tabElement).display}`);
        } else {
          console.error(`‚ùå Tab ${tabName} not found: ${tabName}Tab`);
        }
      });
      
      // Test tab switching
      console.log('üß™ Testing tab switching...');
      showTab('users');
      setTimeout(() => showTab('points'), 1000);
      setTimeout(() => showTab('dashboard'), 2000);
    }

    // Comprehensive test function for all game tabs
    async function testAllGameTabsComprehensive() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üß™ Starting comprehensive game tabs test...');
      
      try {
        // Test API endpoint
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (!data.success) {
          addLog('‚ùå API test failed: ' + (data.error || 'Unknown error'));
          return;
        }

        addLog('‚úÖ API test passed - data structure verified');
        
        // Test each game tab individually
        const games = ['tetris', 'snake', 'space_invaders', 'cheese_hunt', 'discord_race'];
        
        for (const game of games) {
          if (data.data.games[game]) {
            addLog(`‚úÖ ${game.toUpperCase()} data available: ${JSON.stringify(data.data.games[game].game_name)}`);
            
            // Test specific data loading
            switch(game) {
              case 'tetris':
                await loadTetrisData();
                break;
              case 'snake':
                await loadSnakeData();
                break;
              case 'space_invaders':
                await loadSpaceInvadersData();
                break;

              case 'cheese_hunt':
                await loadCheeseHuntData();
                break;
              case 'discord_race':
                await loadDiscordRaceData();
                break;
            }
          } else {
            addLog(`‚ùå ${game.toUpperCase()} data missing from API`);
          }
        }
        
        // Test overview totals
        const overview = data.data.overview;
        addLog(`üìä Overview totals: ${overview.total_games} games, ${overview.total_active_players} players, ${overview.total_games_played} games played`);
        
        addLog('üß™ Comprehensive test completed!');
        
      } catch (error) {
        addLog(`‚ùå Comprehensive test error: ${error.message}`);
        console.error('Comprehensive test error:', error);
      }
    }
    
    // Refresh All Game Data Function
    async function refreshAllGameData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Refreshing all game data...');
      
      try {
        // Load all game tabs in sequence
        await loadGameOverview();
        await loadTetrisData();
        await loadSnakeData();
        await loadSpaceInvadersData();
        await loadCheeseHuntData();
        await loadDiscordRaceData();
        
        addLog('‚úÖ All game data refreshed successfully');
      } catch (error) {
        addLog(`‚ùå Error refreshing game data: ${error.message}`);
        console.error('Error refreshing game data:', error);
      }
    }
    
    // Test database connection function
    async function testDatabaseConnection() {
      addLog('üîó Testing database connection...');
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/test-database-connection.php');
        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Database connection successful!`);
          addLog(`üìÅ Database path: ${data.database_path}`);
          addLog(`üìä Tables count: ${data.tables_count}`);
          addLog(`üë• User scores: ${data.user_scores_count}`);
          addLog(`üë§ Users: ${data.users_count}`);
        } else {
          addLog(`‚ùå Database connection failed: ${data.error}`);
          addLog(`üìÅ Attempted path: ${data.database_path}`);
        }
      } catch (error) {
        addLog(`‚ùå Database test error: ${error.message}`);
      }
    }

    // Test download endpoint function
    async function testDownloadEndpoint() {
      console.log('üß™ Testing download endpoint...');
      addLog('üß™ Testing download endpoint...');
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/download-database.php', {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer ' + (currentAdmin ? currentAdmin.token : '')
          }
        });
        
        console.log('üß™ Download test response:', response);
        console.log('üß™ Response status:', response.status);
        console.log('üß™ Response headers:', response.headers);
        
        const contentType = response.headers.get('content-type');
        console.log('üß™ Content-Type:', contentType);
        
        if (response.ok) {
          if (contentType && contentType.includes('application/json')) {
            const errorData = await response.json();
            console.log('üß™ JSON error response:', errorData);
            addLog('üß™ Download endpoint returned JSON error: ' + JSON.stringify(errorData));
          } else {
            const blob = await response.blob();
            console.log('üß™ File blob received:', blob);
            console.log('üß™ Blob size:', blob.size, 'bytes');
            addLog(`üß™ Download endpoint returned file blob: ${(blob.size / 1024 / 1024).toFixed(2)} MB`);
          }
        } else {
          const errorText = await response.text();
          console.log('üß™ Error response text:', errorText);
          addLog('üß™ Download endpoint error: ' + errorText);
        }
      } catch (error) {
        console.error('üß™ Download test error:', error);
        addLog('üß™ Download test error: ' + error.message);
      }
    }
    
    // Test tab display function
    async function testTabDisplay() {
      console.log('üß™ Testing tab display...');
      addLog('üß™ Testing tab display...');
      
      // Test showing a specific tab
      const testTab = document.getElementById('snakeTab');
      if (testTab) {
        console.log('üß™ Found snakeTab, testing display...');
        addLog('üß™ Found snakeTab, testing display...');
        
        // Check current state
        console.log('üß™ Current display style:', testTab.style.display);
        console.log('üß™ Current computed display:', window.getComputedStyle(testTab).display);
        addLog(`üß™ Current display style: ${testTab.style.display}`);
        addLog(`üß™ Current computed display: ${window.getComputedStyle(testTab).display}`);
        
        // Try to show it
        testTab.style.display = 'block';
        console.log('üß™ Set display to block');
        addLog('üß™ Set display to block');
        
        // Check new state
        console.log('üß™ New display style:', testTab.style.display);
        console.log('üß™ New computed display:', window.getComputedStyle(testTab).display);
        addLog(`üß™ New display style: ${testTab.style.display}`);
        addLog(`üß™ New computed display: ${window.getComputedStyle(testTab).display}`);
        
        // Check if it's actually visible - use multiple methods for better accuracy
        const rect = testTab.getBoundingClientRect();
        const computedStyle = window.getComputedStyle(testTab);
        const isVisible = computedStyle.display !== 'none' && 
                         computedStyle.visibility !== 'hidden' && 
                         testTab.offsetHeight > 0;
        
        console.log('üß™ Tab dimensions:', rect.width, 'x', rect.height);
        console.log('üß™ Tab offsetHeight:', testTab.offsetHeight);
        console.log('üß™ Tab is visible:', isVisible);
        addLog(`üß™ Tab dimensions: ${rect.width} x ${rect.height}`);
        addLog(`üß™ Tab offsetHeight: ${testTab.offsetHeight}`);
        addLog(`üß™ Tab is visible: ${isVisible ? 'YES' : 'NO'}`);
      } else {
        console.log('üß™ snakeTab not found');
        addLog('üß™ snakeTab not found');
      }
      
      // Enhanced: Test all game tabs to ensure they're working properly
      addLog('üß™ Testing all game tabs display...');
      
      try {

        
        
        // Test Cheese Hunt tab
        console.log('üß™ Testing Cheese Hunt tab...');
        await refreshCheeseHuntDisplay();
        
        // Test Discord Race tab
        console.log('üß™ Testing Discord Race tab...');
        await refreshDiscordRaceDisplay();
        
        addLog('‚úÖ All game tabs tested and refreshed successfully');
        console.log('‚úÖ All game tabs tested and refreshed successfully');
      } catch (error) {
        console.error('‚ùå Error testing game tabs:', error);
        addLog(`‚ùå Error testing game tabs: ${error.message}`);
      }
    }
    
    // Test backup endpoint function
    async function testBackupEndpoint() {
      try {
        addLog('üß™ Testing backup endpoint directly...');
        
        // Test the backup endpoint with test parameter
        const response = await fetch(API_BASE_URL + '/api/admin/backup-database.php?test=true', {
          method: 'GET'
        });
        
        addLog('üîç Backup endpoint test response status: ' + response.status + ' ' + response.statusText);
        addLog('üîç Backup endpoint test response headers: ' + JSON.stringify([...response.headers.entries()]));
        
        let data;
        try {
          data = await response.json();
          addLog('‚úÖ Backup endpoint test response parsed successfully');
        } catch (jsonError) {
          addLog('‚ùå Backup endpoint test response parsing failed: ' + jsonError.message);
          try {
            const responseText = await response.text();
            addLog('üîç Backup endpoint test response body: ' + responseText);
          } catch (textError) {
            addLog('üîç Could not read backup endpoint test response body');
          }
          return;
        }
        
        if (data.test) {
          addLog('üîç Backup Endpoint Test Results:');
          addLog(`üìÅ Source path: ${data.source_path}`);
          addLog(`üìÅ Source exists: ${data.source_exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìñ Source readable: ${data.source_readable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìä Source size: ${data.source_size}`);
          addLog(`üè† Environment: ${data.production_mode || 'Unknown'}`);
          addLog(`üìÅ Target dir exists: ${data.target_dir_exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`‚úèÔ∏è Target dir writable: ${data.target_dir_writable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üë§ Current user: ${data.current_user}`);
          addLog(`üêò PHP user: ${data.php_user}`);
          addLog(`üåê Web server user: ${data.web_server_user}`);
          
          // Critical verification
          if (data.source_exists && data.source_readable) {
            addLog('‚úÖ CRITICAL: Database path verification successful');
            addLog(`üìä Database size: ${data.source_size} - This should match your live database size`);
          } else {
            addLog('‚ùå CRITICAL: Database path verification FAILED');
            addLog('üö® This indicates a serious configuration issue!');
          }
        } else {
          addLog('‚ùå Backup endpoint test failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Backup endpoint test error: ' + error.message);
      }
    }

    // Sync Active Game Tab function - Loads data for currently active game tab only
    async function syncActiveGameTab() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Syncing active game tab data...');
      
      try {
        // Find which game tab is currently active
        const activeGameTab = document.querySelector('.game-tab-content[style*="display: block"]');
        
        if (!activeGameTab) {
          addLog('‚ùå No active game tab found. Please switch to a game tab first.');
          return;
        }

        const tabId = activeGameTab.id;
        addLog(`üéØ Detected active tab: ${tabId}`);
        
        // Determine which game data to load based on the active tab
        let gameName = '';
        let loadFunction = null;
        
        switch(tabId) {
          case 'overviewTab':
            gameName = 'Overview Dashboard';
            loadFunction = () => loadGameOverview();
            break;
          case 'tetrisTab':
            gameName = 'Tetris';
            loadFunction = () => loadTetrisData();
            break;
          case 'snakeTab':
            gameName = 'Snake';
            loadFunction = () => loadSnakeData();
            break;
          case 'spaceInvadersTab':
            gameName = 'Space Invaders';
            loadFunction = () => loadSpaceInvadersData();
            break;

          case 'cheeseHuntTab':
            gameName = 'Cheese Hunt';
            loadFunction = () => loadCheeseHuntData();
            break;
          case 'discordRaceTab':
            gameName = 'Discord Race';
            loadFunction = () => loadDiscordRaceData();
            break;
          default:
            addLog(`‚ùå Unknown tab type: ${tabId}`);
            return;
        }
        
        addLog(`üîÑ Loading ${gameName} data...`);
        
        // Load the specific game data
        if (loadFunction) {
          await loadFunction();
          addLog(`‚úÖ ${gameName} data synced successfully`);
        }
        
      } catch (error) {
        addLog(`‚ùå Error syncing active game tab: ${error.message}`);
        console.error('Error syncing active game tab:', error);
      }
    }

    // Clear all tab content to prevent mixed displays
    function clearAllTabContent() {
      addLog('üßπ Clearing all tab content...');
      
      // Clear dashboard content
      const dashboardElements = [
        'totalUsers', 'totalScores', 'totalItems', 'activeQuests',
        'solBalance', 'totalNfts', 'totalCollections', 'totalEntries',
        'monthlyTotal', 'lastMonthTotal', 'averageEntry',
        'collectionsSummary', 'nftGallery', 'recentActivity'
      ];
      
      dashboardElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          if (element.tagName === 'INPUT' || element.tagName === 'SELECT') {
            element.value = '';
          } else {
            element.innerHTML = '<div class="text-gray-400">-</div>';
          }
        }
      });
      
      // Clear quest claims list
      const questClaimsList = document.getElementById('questClaimsList');
      if (questClaimsList) {
        questClaimsList.innerHTML = '<div class="text-gray-300">Click "Refresh Claims" to load quest submissions...</div>';
      }
      
      // Clear store items
      const storeTableBody = document.getElementById('storeTableBody');
      if (storeTableBody) {
        storeTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-400">Loading store items...</td></tr>';
      }
      
      // Clear user management
      const userResults = document.getElementById('userResults');
      if (userResults) {
        userResults.innerHTML = '<div class="text-gray-400">Search for users to see results...</div>';
      }
      
      // Clear point management
      const pointResults = document.getElementById('pointResults');
      if (pointResults) {
        pointResults.innerHTML = '<div class="text-gray-400">Search for users to manage points...</div>';
      }
      
      // Clear holder verification
      const holderTableBody = document.getElementById('holderTableBody');
      if (holderTableBody) {
        holderTableBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-400">Loading holder verifications...</td></tr>';
      }
      
      // Clear community funds table
      const communityFundsTableBody = document.getElementById('communityFundsTableBody');
      if (communityFundsTableBody) {
        communityFundsTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-400">Loading community funds...</td></tr>';
      }
      
      // Clear wallet transaction history table
      const walletTransactionsTableBody = document.getElementById('walletTransactionsTableBody');
      if (walletTransactionsTableBody) {
        walletTransactionsTableBody.innerHTML = '<tr><td colspan="6" class="text-center text-gray-400">Loading transaction history...</td></tr>';
      }
      
      // Clear any other dynamic content areas
      const dynamicElements = [
        'recentAdjustments', 'topUsers', 'engagementStats', 'wealthStats',
        'activeQuestsList', 'recentQuestClaims', 'activeQuestsByType',
        'walletBalance', 'wallet24hChange', 'walletTransactions', 'walletImportStatus'
      ];
      
      dynamicElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          if (id.includes('wallet')) {
            element.innerHTML = id === 'walletImportStatus' ? 'No wallet data imported yet' : '-';
          } else {
            element.innerHTML = '<div class="text-gray-400">Loading...</div>';
          }
        }
      });
      
      // Clear any search inputs
      const searchInputs = document.querySelectorAll('input[type="text"], input[type="search"]');
      searchInputs.forEach(input => {
        if (input && input.placeholder && !input.placeholder.includes('Search')) {
          input.value = '';
        }
      });
      
      addLog('‚úÖ All tab content cleared');
    }

    // SUPER WORKING TAB SYSTEM - Clean and reliable
    function showTab(tabName) {
      console.log(`üöÄ SUPER TAB SYSTEM: Switching to ${tabName}`);
      
      // STEP 1: Update active tab button state
      document.querySelectorAll('.tab-btn[data-tab]').forEach(btn => {
        btn.classList.remove('active');
        btn.style.opacity = '0.7';
      });
      
      const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
        activeBtn.style.opacity = '1';
        console.log(`‚úÖ Active tab button updated: ${tabName}`);
      } else {
        console.error(`‚ùå Tab button not found for: ${tabName}`);
        return; // Exit if tab button not found
      }
      
      // STEP 2: Hide ALL tabs with smooth transition
      const allTabs = document.querySelectorAll('[id$="Tab"]');
      console.log(`üîÑ Hiding ${allTabs.length} tabs`);
      
      allTabs.forEach(tab => {
        if (tab) {
          tab.style.opacity = '0';
          tab.style.transform = 'translateY(10px)';
          tab.style.transition = 'all 0.3s ease';
          
          setTimeout(() => {
            tab.style.display = 'none';
          }, 150);
        }
      });
      
      // STEP 3: Show selected tab with smooth animation
      setTimeout(() => {
      const selectedTab = document.getElementById(tabName + 'Tab');
      if (selectedTab) {
        selectedTab.style.display = 'block';
          selectedTab.style.opacity = '0';
          selectedTab.style.transform = 'translateY(10px)';
          
          // Trigger animation
          setTimeout(() => {
            selectedTab.style.opacity = '1';
            selectedTab.style.transform = 'translateY(0)';
            console.log(`‚úÖ Tab displayed with animation: ${tabName}Tab`);
          }, 50);
      } else {
        console.error(`‚ùå Tab not found: ${tabName}Tab`);
          return;
      }
      
        // STEP 4: Update current tab and log
      currentTab = tabName;
        addLog(`üìã Successfully switched to ${tabName} tab`);
      
        // STEP 5: Load tab-specific data with error handling and auto-refresh
        try {
          console.log(`üîÑ Auto-loading data for tab: ${tabName}`);
          
          if (tabName === 'dashboard') {
            // Dashboard - Always refresh with latest data
            loadDashboardData();
            loadOverviewGameStats();
            addLog('üìä Dashboard data auto-loaded');
            
          } else if (tabName === 'users') {
            // User management - Auto-load recent user activity
            loadRecentUserActivity();
            addLog('üë• User management tab auto-loaded');
            
          } else if (tabName === 'points') {
            // Point management - Auto-load point statistics
            loadPointStatistics();
            addLog('üí∞ Point management tab auto-loaded');
            
          } else if (tabName === 'store') {
            // Store - Always refresh store items
            loadStoreItems();
            addLog('üè™ Store tab auto-loaded');
            
          } else if (tabName === 'quests') {
            // Quests - Always refresh quest data and claims
            loadQuests();
            loadEnhancedQuestClaims();
            addLog('üèÜ Quest system tab auto-loaded');
            
          } else if (tabName === 'bosses') {
            // Boss management - Auto-load all boss configurations
            loadAllBossConfigurations();
            addLog('üëë Boss management tab auto-loaded');
            
          } else if (tabName === 'bossNotifications') {
            // Boss notifications - Always refresh
            loadBossNotifications();
            addLog('üîî Boss notifications tab auto-loaded');
            
          } else if (tabName === 'games') {
            // Game Management - Load all data immediately with auto-refresh
            console.log('üéÆ Loading Game Management data...');
            loadGameOverview();
            loadSeasonStats();
            loadGameSettings();
            loadCurrentSeasonSettings();
            
            // Load all game data with auto-refresh
            loadTetrisData();
            loadSnakeData();
            loadSpaceInvadersData();
            loadCheeseHuntData();
            loadDiscordRaceData();
            
            // Switch to overview tab by default
            setTimeout(() => {
              switchGameTab('overview');
            }, 100);
            addLog('üéÆ Game management tab auto-loaded with all game data');
            
          } else if (tabName === 'games2') {
            // Game Management 2.0 - Comprehensive auto-load
            console.log('üöÄ Loading Game Management 2.0 data...');
            loadGameManagement2Data();
            loadSeasonOverview2();
            loadGameStatsBySeason2();
            loadTopPerformers2();
            loadSeasonComparison2();
            startLiveActivityFeed2();
            addLog('üöÄ Game management 2.0 tab auto-loaded');
            
          } else if (tabName === 'discord') {
            // Discord config - Auto-load with refresh
            loadDiscordConfigData();
            addLog('üì± Discord config tab auto-loaded');
            
          } else if (tabName === 'cheeseGuide') {
            // Cheese guide - Auto-load content
            loadCheeseGuideData();
            addLog('üßÄ Cheese guide tab auto-loaded');
            
          } else if (tabName === 'holderVerification') {
            // Holder verification - Auto-load verification data
            loadHolderVerificationData();
            addLog('‚úÖ Holder verification tab auto-loaded');
            
          } else if (tabName === 'communityFunds') {
            // Community funds - Auto-load wallet and funds data with delay to ensure DOM is ready
            setTimeout(() => {
              loadCommunityFundsData();
            }, 100);
            addLog('üí∞ Community funds tab auto-loaded');
          }
          
          // Mark tab as recently loaded
          markTabAsLoaded(tabName);
          console.log(`‚úÖ Tab ${tabName} data auto-loaded successfully`);
          
        } catch (error) {
          console.error(`‚ùå Error auto-loading tab ${tabName} data:`, error);
          addLog(`‚ùå Error auto-loading ${tabName} tab data: ${error.message}`);
        }
      }, 200);
    }

    // Load overview game statistics for all 5 games in Overview Dashboard
    async function loadOverviewGameStats() {
      console.log('üîÑ Loading overview game statistics for all 5 games...');
      addLog('üîÑ Loading overview game statistics for all 5 games...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        console.log('üéÆ Games stats API response status:', response.status);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('üéÆ Games stats API data received:', data);
        
        // Debug: Log the exact structure
        console.log('üîç Data structure analysis:', {
          success: data.success,
          hasData: !!data.data,
          hasGames: !!(data.data && data.data.games),
          gamesKeys: data.data && data.data.games ? Object.keys(data.data.games) : 'No games object',
          fullData: data.data
        });
        
        if (data.success && data.data && data.data.games) {
          const games = data.data.games;
          console.log('üéØ Processing games data:', games);
          
          // Load Tetris top players
          if (games.tetris && games.tetris.top_players) {
            console.log('üß© Tetris data found:', games.tetris.top_players);
            displayOverviewTetrisTopPlayers(games.tetris.top_players);
          } else {
            console.log('‚ö†Ô∏è No Tetris data or top_players found');
            displayOverviewTetrisTopPlayers([]);
          }
          
          // Load Snake top players
          if (games.snake && games.snake.top_players) {
            console.log('üêç Snake data found:', games.snake.top_players);
            displayOverviewSnakeTopPlayers(games.snake.top_players);
          } else {
            console.log('‚ö†Ô∏è No Snake data or top_players found');
            displayOverviewSnakeTopPlayers([]);
          }
          
          // Load Space Invaders top players (combined from both variants)
          if (games.space_invaders || games.cheese_invaders) {
            console.log('üëæ Space Invaders data found:', { space: games.space_invaders, cheese: games.cheese_invaders });
            displayOverviewSpaceInvadersTopPlayers(games);
          } else {
            console.log('‚ö†Ô∏è No Space Invaders data found');
            displayOverviewSpaceInvadersTopPlayers({});
          }
          
          // Load Cheese Hunt statistics
          if (games.cheese_hunt) {
            console.log('üßÄ Cheese Hunt data found:', games.cheese_hunt);
            displayOverviewCheeseHuntStats(games.cheese_hunt);
          } else {
            console.log('‚ö†Ô∏è No Cheese Hunt data found');
            displayOverviewCheeseHuntStats({});
          }
          
          // Load Discord Race statistics
          if (games.discord_race) {
            console.log('üèÅ Discord Race data found:', games.discord_race);
            displayOverviewDiscordRaceStats(games.discord_race);
          } else {
            console.log('‚ö†Ô∏è No Discord Race data found');
            displayOverviewDiscordRaceStats({});
          }
          
          console.log('‚úÖ Overview game statistics loaded successfully for all 5 games');
          addLog('‚úÖ Overview game statistics loaded successfully for all 5 games');
          
          // Update dashboard status
          updateDashboardStatus('Games data loaded');
        } else {
          console.error(`‚ùå Failed to load overview game statistics: ${data.error || 'No data available'}`);
          console.error('‚ùå Data structure:', data);
          addLog(`‚ùå Failed to load overview game statistics: ${data.error || 'No data available'}`);
          updateDashboardStatus('Games data error');
          
          // Try to display empty data to show containers exist
          displayOverviewTetrisTopPlayers([]);
          displayOverviewSnakeTopPlayers([]);
          displayOverviewSpaceInvadersTopPlayers({});
          displayOverviewCheeseHuntStats({});
          displayOverviewDiscordRaceStats({});
        }
      } catch (error) {
        console.error(`‚ùå Overview game statistics loading error: ${error.message}`);
        addLog(`‚ùå Overview game statistics loading error: ${error.message}`);
        updateDashboardStatus('Games data failed');
        
        // Display error state in all containers
        displayOverviewTetrisTopPlayers([]);
        displayOverviewSnakeTopPlayers([]);
        displayOverviewSpaceInvadersTopPlayers({});
        displayOverviewCheeseHuntStats({});
        displayOverviewDiscordRaceStats({});
      }
    }

    // Preload all game data to avoid manual reloading when switching tabs
    async function preloadAllGameData() {
      console.log('üîÑ Preloading all game data...');
      
      try {
        // Load data for all games in parallel for better performance
        const loadPromises = [
          loadTetrisData(),
          loadSnakeData(),
                  loadSpaceInvadersData(),
          loadCheeseHuntData(),
          loadDiscordRaceData()
        ];
        
        // Wait for all data to load
        await Promise.allSettled(loadPromises);
        
        console.log('‚úÖ All game data preloaded successfully');
        addLog('‚úÖ All game data preloaded - no manual reloading needed');
        
        // Update the dashboard to show that data is ready
        const dashboardStatus = document.getElementById('systemStatus');
        if (dashboardStatus) {
          dashboardStatus.innerHTML = 'üü¢ Online - All Data Ready';
        }
        
        // Update data load status
        const dataLoadStatus = document.getElementById('dataLoadStatus');
        if (dataLoadStatus) {
          dataLoadStatus.innerHTML = 'All Data Ready';
          dataLoadStatus.className = 'text-green-400';
        }
        
        // Mark all game tabs as having data loaded
        markGameTabsAsLoaded();
      } catch (error) {
        console.error('‚ùå Error preloading game data:', error);
        addLog(`‚ùå Error preloading game data: ${error.message}`);
      }
    }

    // Mark game tabs as having data loaded
    function markGameTabsAsLoaded() {
      const gameTabs = ['tetris', 'snake', 'space-invaders', 'cheese-hunt', 'discord-race'];
      
      gameTabs.forEach(gameName => {
        const button = document.querySelector(`[data-game-tab="${gameName}"]`);
        if (button) {
          // Add a visual indicator that data is loaded
          button.classList.add('data-loaded');
          button.setAttribute('title', 'Data loaded - ready to view');
          
          // Add a small indicator icon
          const indicator = document.createElement('span');
          indicator.className = 'ml-2 text-xs text-green-400';
          indicator.textContent = '‚úì';
          indicator.setAttribute('title', 'Data loaded');
          
          // Remove existing indicator if present
          const existingIndicator = button.querySelector('.text-green-400');
          if (existingIndicator) {
            existingIndicator.remove();
          }
          
          button.appendChild(indicator);
        }
      });
    }

    // Display Tetris top players in Overview Dashboard
    function displayOverviewTetrisTopPlayers(players) {
      const container = document.getElementById('tetrisTopPlayers');
      if (!container) {
        console.error('Tetris top players container not found');
        return;
      }

      try {
        if (players && players.length > 0) {
          container.innerHTML = players.slice(0, 5).map((player, index) => `
            <div class="flex justify-between items-center p-2 bg-gray-700 rounded hover:bg-gray-600 transition-colors">
              <div class="flex items-center space-x-2">
                <span class="text-sm font-semibold text-gray-300">#${index + 1}</span>
                <div>
                  <div class="text-sm font-semibold text-white">${player.username || 'Unknown'}</div>
                  <div class="text-xs text-gray-400">${player.discord_id || 'N/A'}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm font-bold text-blue-400">${(player.score || 0).toLocaleString()}</div>
                <div class="text-xs text-gray-400">${(player.score || 0) * 10} DSPOINC</div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div class="text-gray-400 text-sm">No players found</div>';
        }
      } catch (error) {
        console.error('Error displaying overview Tetris top players:', error);
        container.innerHTML = '<div class="text-red-400">Error loading Tetris top players</div>';
      }
    }

    // Display Snake top players in Overview Dashboard
    function displayOverviewSnakeTopPlayers(players) {
      const container = document.getElementById('snakeTopPlayers');
      if (!container) {
        console.error('Snake top players container not found');
        return;
      }

      try {
        if (players && players.length > 0) {
          container.innerHTML = players.slice(0, 5).map((player, index) => `
            <div class="flex justify-between items-center p-2 bg-gray-700 rounded hover:bg-gray-600 transition-colors">
              <div class="flex items-center space-x-2">
                <span class="text-sm font-semibold text-gray-300">#${index + 1}</span>
                <div>
                  <div class="text-sm font-semibold text-white">${player.username || 'Unknown'}</div>
                  <div class="text-xs text-gray-400">${player.discord_id || 'N/A'}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm font-bold text-green-400">${(player.score || 0).toLocaleString()}</div>
                <div class="text-xs text-gray-400">${(player.score || 0) * 10} DSPOINC</div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div class="text-gray-400 text-sm">No players found</div>';
        }
      } catch (error) {
        console.error('Error displaying overview Snake top players:', error);
        container.innerHTML = '<div class="text-red-400">Error loading Snake top players</div>';
      }
    }

    // Display Space Invaders top players in Overview Dashboard (combined from both variants)
    function displayOverviewSpaceInvadersTopPlayers(games) {
      const container = document.getElementById('spaceInvadersTopPlayers');
      if (!container) {
        console.error('Space Invaders top players container not found');
        return;
      }

      try {
        // Combine players from both Space Invaders variants
        const allPlayers = new Map();
        
        // Add Space Invaders players
        if (games.space_invaders && games.space_invaders.top_players) {
          games.space_invaders.top_players.forEach(player => {
            allPlayers.set(player.discord_id, {
              ...player,
              game: 'Space Invaders',
              game_emoji: 'üëæ'
            });
          });
        }
        
        // Add Cheese Invaders players (merge if same player)
        if (games.cheese_invaders && games.cheese_invaders.top_players) {
          games.cheese_invaders.top_players.forEach(player => {
            if (allPlayers.has(player.discord_id)) {
              // Player exists in both games, keep the higher score
              const existing = allPlayers.get(player.discord_id);
              if (player.score > existing.score) {
                allPlayers.set(player.discord_id, {
                  ...player,
                  game: 'Cheese Invaders',
                  game_emoji: 'üßÄ'
                });
              }
            } else {
              allPlayers.set(player.discord_id, {
                ...player,
                game: 'Cheese Invaders',
                game_emoji: 'üßÄ'
              });
            }
          });
        }
        
        // Convert to array and sort by score
        const topPlayers = Array.from(allPlayers.values())
          .sort((a, b) => (b.score || 0) - (a.score || 0))
          .slice(0, 5);
        
        if (topPlayers.length > 0) {
          container.innerHTML = topPlayers.map((player, index) => `
            <div class="flex justify-between items-center p-2 bg-gray-700 rounded hover:bg-gray-600 transition-colors">
              <div class="flex items-center space-x-2">
                <span class="text-sm font-semibold text-gray-300">#${index + 1}</span>
                <div>
                  <div class="text-sm font-semibold text-white">${player.username || 'Unknown'}</div>
                  <div class="text-xs text-gray-400">${player.discord_id || 'N/A'}</div>
                  <div class="text-xs text-orange-400">${player.game_emoji} ${player.game}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm font-bold text-orange-400">${(player.score || 0).toLocaleString()}</div>
                <div class="text-xs text-gray-400">${(player.score || 0) * 10} DSPOINC</div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div class="text-gray-400 text-sm">No players found</div>';
        }
      } catch (error) {
        console.error('Error displaying overview Space Invaders top players:', error);
        container.innerHTML = '<div class="text-red-400">Error loading Space Invaders top players</div>';
      }
    }

    // Display Cheese Hunt statistics in Overview Dashboard
    function displayOverviewCheeseHuntStats(cheeseData) {
      const statsElement = document.getElementById('cheeseHuntStats');
      if (!statsElement) {
        console.error('Cheese Hunt stats element not found');
        return;
      }

      try {
        const currentData = cheeseData.current_data || {};
        const allTimeData = cheeseData.all_time || {};
        
        statsElement.innerHTML = `
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Total Clicks</div>
              <div class="text-xl font-bold text-yellow-400">${currentData.total_clicks || 0}</div>
            </div>
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Unique Players</div>
              <div class="text-xl font-bold text-blue-400">${currentData.unique_players || 0}</div>
            </div>
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Max Clicks</div>
              <div class="text-xl font-bold text-green-400">${currentData.max_clicks || 0}</div>
            </div>
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Avg Clicks</div>
              <div class="text-xl font-bold text-purple-400">${Math.round(currentData.avg_clicks || 0)}</div>
            </div>
          </div>
          <div class="mt-3 text-xs text-gray-400">
            Recent 24h: ${currentData.recent_24h || 0} | Recent 7d: ${currentData.recent_7d || 0}
          </div>
        `;
      } catch (error) {
        console.error('Error displaying overview Cheese Hunt stats:', error);
        statsElement.innerHTML = '<div class="text-red-400">Error loading Cheese Hunt statistics</div>';
      }
    }

    // Display Discord Race statistics in Overview Dashboard
    function displayOverviewDiscordRaceStats(raceData) {
      const statsElement = document.getElementById('discordRaceStats');
      if (!statsElement) {
        console.error('Discord Race stats element not found');
        return;
      }

      try {
        const raceStats = raceData.race_data || {};
        
        statsElement.innerHTML = `
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Total Races</div>
              <div class="text-xl font-bold text-purple-400">${raceStats.total_races || 0}</div>
            </div>
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Total Participants</div>
              <div class="text-xl font-bold text-blue-400">${raceStats.total_participants || 0}</div>
            </div>
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Prizes Awarded</div>
              <div class="text-xl font-bold text-yellow-400">${raceStats.total_prizes_awarded || 0}</div>
            </div>
            <div class="bg-gray-700 p-3 rounded-lg">
              <div class="text-sm text-gray-400">Recent 24h</div>
              <div class="text-xl font-bold text-green-400">${raceStats.recent_24h || 0}</div>
            </div>
          </div>
          <div class="mt-3 text-xs text-gray-400">
            Recent 7d: ${raceStats.recent_7d || 0} | Current Race: ${raceStats.current_race ? 'Active' : 'None'}
          </div>
        `;
      } catch (error) {
        console.error('Error displaying overview Discord Race stats:', error);
        statsElement.innerHTML = '<div class="text-red-400">Error loading Discord Race statistics</div>';
      }
    }

    // Load dashboard data
    async function loadDashboardData() {
      try {
        // Load basic stats (always visible)
        const statsResponse = await fetch(API_BASE_URL + '/api/admin/get-stats.php');
        const stats = await statsResponse.json();
        
        if (stats.success) {
          // Update top menu stats (the quick overview boxes)
          updateTopMenuStats(stats.data || stats);
          
          // Update detailed dashboard stats
          updateSystemStats(stats.data || stats);
          
          // Load boss notifications count
          loadBossNotificationCount();
          } else {
          console.error('‚ùå Stats API returned error:', stats.error);
          addLog(`‚ùå Stats API error: ${stats.error || 'Unknown error'}`);
          
          // Set fallback values for both top menu and detailed stats
          const fallbackData = {
            total_users: 'Error',
            total_scores: 'Error',
            total_items: 'Error',
            active_quests: 'Error'
          };
          updateTopMenuStats(fallbackData);
          updateSystemStats(fallbackData);
        }

        // Load cheese click statistics (only for authenticated users)
        if (currentAdmin) {
          const cheeseStatsResponse = await fetch(API_BASE_URL + '/api/admin/get-cheese-stats.php');
          const cheeseStats = await cheeseStatsResponse.json();
          
          if (cheeseStats.success) {
            const stats = cheeseStats.stats;
            
            // Update cheese click stats
            document.getElementById('totalCheeseClicks').textContent = stats.total_clicks;
            document.getElementById('recentCheeseClicks').textContent = stats.recent_clicks_24h;
            
            // Top cheese clicker
            const topClicker = stats.top_clicker;
            const topClickerElement = document.getElementById('topCheeseUser');
            
            if (topClicker) {
              const username = topClicker.username || 'Anonymous Mouse';
              const displayName = username.length > 15 ? username.substring(0, 15) + '...' : username;
              const walletShort = topClicker.user_wallet.substring(0, 8) + '...';
              
              topClickerElement.innerHTML = `
                <a href="/profile.html?user_id=${encodeURIComponent(topClicker.user_wallet)}" 
                   class="text-orange-400 hover:text-orange-300 underline cursor-pointer" 
                   title="View ${username}'s profile">
                  ${displayName} (${walletShort})
                </a>
              `;
            } else {
              topClickerElement.textContent = 'None';
            }
            
            // Most clicked cheese
            const mostClicked = stats.clicks_by_egg.length > 0 ? stats.clicks_by_egg[0] : null;
            document.getElementById('mostClickedCheese').textContent = mostClicked ? 
              mostClicked.egg_id : 'None';
            
            // Display detailed cheese stats
            displayCheeseClicksByType(stats.clicks_by_egg);
            displayTopCheeseClickers(stats.top_users);
          }
        } else {
          // Hide cheese stats for non-authenticated users
          document.getElementById('totalCheeseClicks').textContent = 'üîí';
          document.getElementById('recentCheeseClicks').textContent = 'üîí';
          document.getElementById('topCheeseUser').textContent = 'üîí';
          document.getElementById('mostClickedCheese').textContent = 'üîí';
          document.getElementById('cheeseClicksByType').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
          document.getElementById('topCheeseClickers').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
        }

        // Load quest and role statistics (only for authenticated users)
        if (currentAdmin) {
          const questStatsResponse = await fetch(API_BASE_URL + '/api/admin/get-quest-stats.php');
          const questStats = await questStatsResponse.json();
          
          if (questStats.success) {
            const stats = questStats.stats;
            
            // Update quest stats
            document.getElementById('openQuests').textContent = stats.open_quests;
            document.getElementById('pendingClaims').textContent = stats.pending_claims;
            document.getElementById('completedQuests').textContent = stats.completed_quests;
            document.getElementById('rolesGranted').textContent = stats.roles_granted;
            
            // Display detailed quest stats
            displayRecentQuestClaims(stats.recent_claims);
            displayActiveQuestsByType(stats.active_quests_by_type);
            
            // Note: Quest claims are now loaded only when the quests tab is selected
            // to avoid showing quest data on every tab
          }
        } else {
          // Hide quest stats for non-authenticated users
          document.getElementById('openQuests').textContent = 'üîí';
          document.getElementById('pendingClaims').textContent = 'üîí';
          document.getElementById('completedQuests').textContent = 'üîí';
          document.getElementById('rolesGranted').textContent = 'üîí';
          document.getElementById('recentQuestClaims').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
          document.getElementById('activeQuestsByType').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
        }

        // Load boss level claims statistics (only for authenticated users)
        if (currentAdmin) {
          try {
            const bossStatsResponse = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php');
            const bossStats = await bossStatsResponse.json();
            
            if (bossStats.success && bossStats.notifications) {
              const notifications = bossStats.notifications;
              
              // Calculate boss stats
              const pendingBossClaims = notifications.filter(n => n.status === 'pending').length;
              const totalBossRewards = notifications
                .filter(n => n.special_reward_given && n.dspoinc_earned)
                .reduce((sum, n) => sum + (n.dspoinc_earned || 0), 0);
              
              const today = new Date().toDateString();
              const bossClaimsToday = notifications
                .filter(n => new Date(n.created_at).toDateString() === today).length;
              
              const rewardedNotifications = notifications.filter(n => n.special_reward_given && n.dspoinc_earned);
              const avgBossReward = rewardedNotifications.length > 0 
                ? Math.round(totalBossRewards / rewardedNotifications.length) 
                : 0;
              
              // Update boss stats
              document.getElementById('pendingBossClaims').textContent = pendingBossClaims;
              document.getElementById('totalBossRewards').textContent = totalBossRewards.toLocaleString();
              document.getElementById('bossClaimsToday').textContent = bossClaimsToday;
              document.getElementById('avgBossReward').textContent = avgBossReward.toLocaleString();
              
              // Display detailed boss stats
              displayRecentBossClaims(notifications.slice(0, 5)); // Show last 5
              displayBossAchievementTypes(notifications);
              
            } else {
              // Set default values if no boss notifications
              document.getElementById('pendingBossClaims').textContent = '0';
              document.getElementById('totalBossRewards').textContent = '0';
              document.getElementById('bossClaimsToday').textContent = '0';
              document.getElementById('avgBossReward').textContent = '0';
              document.getElementById('recentBossClaims').innerHTML = '<div class="text-gray-400">No boss claims yet</div>';
              document.getElementById('bossAchievementTypes').innerHTML = '<div class="text-gray-400">No boss achievements yet</div>';
            }
          } catch (error) {
            addLog(`‚ùå Boss stats loading error: ${error.message}`);
            // Set default values on error
            document.getElementById('pendingBossClaims').textContent = '0';
            document.getElementById('totalBossRewards').textContent = '0';
            document.getElementById('bossClaimsToday').textContent = '0';
            document.getElementById('avgBossReward').textContent = '0';
            document.getElementById('recentBossClaims').innerHTML = '<div class="text-gray-400">Error loading boss stats</div>';
            document.getElementById('bossAchievementTypes').innerHTML = '<div class="text-gray-400">Error loading boss types</div>';
          }
        } else {
          // Hide boss stats for non-authenticated users
          document.getElementById('pendingBossClaims').textContent = 'üîí';
          document.getElementById('totalBossRewards').textContent = 'üîí';
          document.getElementById('bossClaimsToday').textContent = 'üîí';
          document.getElementById('avgBossReward').textContent = 'üîí';
          document.getElementById('recentBossClaims').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
          document.getElementById('bossAchievementTypes').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
        }

        // Load recent adjustments (only for authenticated users)
        if (currentAdmin) {
          const adjustmentsResponse = await fetch(API_BASE_URL + '/api/admin/get-recent-adjustments.php');
          const adjustments = await adjustmentsResponse.json();
          
          if (adjustments.success) {
            displayRecentAdjustments(adjustments.adjustments);
          }
        } else {
          document.getElementById('recentAdjustments').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
        }

        // Load top users (only for authenticated users)
        if (currentAdmin) {
          const topUsersResponse = await fetch(API_BASE_URL + '/api/admin/get-top-users.php');
          const topUsers = await topUsersResponse.json();
          
          if (topUsers.success) {
            displayTopUsers(topUsers.users);
          }
        } else {
          document.getElementById('topUsers').innerHTML = '<div class="text-gray-400">üîí Authentication required</div>';
        }

        // Load enhanced statistics and engagement data
        try {
          await loadEnhancedDashboardStats();
        } catch (error) {
          console.error('‚ùå Error loading enhanced dashboard stats:', error);
          addLog(`‚ùå Error loading enhanced dashboard stats: ${error.message}`);
        }
      } catch (error) {
        addLog(`‚ùå Error loading dashboard data: ${error.message}`);
      }
    }
    
    // Load boss notification count
    async function loadBossNotificationCount() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php?status=pending');
        const data = await response.json();
        
        if (data.success) {
          const count = data.notifications ? data.notifications.length : 0;
          document.getElementById('bossNotifications').textContent = count;
          
          // Update color based on count
          const element = document.getElementById('bossNotifications').parentElement;
          if (count > 0) {
            element.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
            element.style.animation = count > 5 ? 'pulse 2s infinite' : 'none';
          } else {
            element.style.background = 'linear-gradient(135deg, #059669 0%, #047857 100%)';
            element.style.animation = 'none';
          }
        } else {
          document.getElementById('bossNotifications').textContent = '‚ùå';
        }
      } catch (error) {
        console.error('Error loading boss notification count:', error);
        document.getElementById('bossNotifications').textContent = '‚ùå';
      }
    }

    // Display cheese clicks by type
    function displayCheeseClicksByType(clicksByEgg) {
      const container = document.getElementById('cheeseClicksByType');
      
      if (clicksByEgg.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No cheese clicks recorded</div>';
        return;
      }

      container.innerHTML = clicksByEgg.map(click => `
        <div class="flex justify-between items-center py-1">
          <span class="text-orange-300">${click.egg_id}</span>
          <span class="text-white font-semibold">${click.click_count}</span>
        </div>
      `).join('');
    }

    // Display top cheese clickers
    function displayTopCheeseClickers(topUsers) {
      const container = document.getElementById('topCheeseClickers');
      
      if (topUsers.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No cheese clickers found</div>';
        return;
      }

      container.innerHTML = topUsers.slice(0, 5).map((user, index) => {
        const username = user.username || 'Anonymous Mouse';
        const displayName = username.length > 12 ? username.substring(0, 12) + '...' : username;
        const walletShort = user.user_wallet.substring(0, 8) + '...';
        
        return `
          <div class="flex justify-between items-center py-1">
            <span class="text-orange-300">
              #${index + 1} 
              <a href="/profile.html?user_id=${encodeURIComponent(user.user_wallet)}" 
                 class="hover:text-orange-200 underline cursor-pointer" 
                 title="View ${username}'s profile">
                ${displayName} (${walletShort})
              </a>
            </span>
            <span class="text-white font-semibold">${user.click_count}</span>
          </div>
        `;
      }).join('');
    }

    // Display recent adjustments
    function displayRecentAdjustments(adjustments) {
      const container = document.getElementById('recentAdjustments');
      
      if (adjustments.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No recent adjustments</div>';
        return;
      }

      container.innerHTML = adjustments.map(adj => {
        const amount = parseInt(adj.amount);
        const isPositive = amount > 0;
        const timestamp = new Date(adj.timestamp).toLocaleString();
        
        return `
          <div class="history-item ${isPositive ? 'positive' : 'negative'}">
            <div class="flex justify-between items-start">
              <div>
                <strong>${isPositive ? '+' : ''}${amount.toLocaleString()} $DSPOINC</strong>
                <span class="text-sm text-gray-300 ml-2">(${adj.action})</span>
              </div>
              <div class="text-xs text-gray-400">${timestamp}</div>
            </div>
            <div class="text-sm text-gray-300 mt-1">User: ${adj.user_id}</div>
            <div class="text-sm text-gray-300">Reason: ${adj.reason || 'No reason'}</div>
          </div>
        `;
      }).join('');
    }

    // Display top users
    function displayTopUsers(users) {
      const container = document.getElementById('topUsers');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No users found</div>';
        return;
      }

      container.innerHTML = users.map((user, index) => `
        <div class="user-card">
          <div class="flex justify-between items-center">
            <div>
              <h4 class="font-semibold">#${index + 1} ${user.username || 'Unknown User'}</h4>
              <p class="text-sm text-gray-300">ID: ${user.user_id}</p>
            </div>
            <div class="text-right">
              <p class="text-lg font-bold text-yellow-400">${user.total_score?.toLocaleString() || 0} $DSPOINC</p>
            </div>
          </div>
          <button onclick="selectUser('${user.user_id}', '${user.username || 'Unknown'}')" 
                  class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm w-full">
            Select User
          </button>
        </div>
      `).join('');
    }

    // Display engagement stats
    function displayEngagementStats(engagementStats) {
      const container = document.getElementById('engagementStats');
      
      if (!engagementStats) {
        container.innerHTML = '<div class="text-gray-400">No engagement data available</div>';
        return;
      }

      container.innerHTML = `
        <div class="space-y-2">
          <div class="flex justify-between">
            <span class="text-cyan-300">Power Users (>100 clicks):</span>
            <span class="text-white font-semibold">${engagementStats.power_users}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-cyan-300">Active Users (7 days):</span>
            <span class="text-white font-semibold">${engagementStats.active_users_7_days}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-cyan-300">Retention Rate:</span>
            <span class="text-white font-semibold">${engagementStats.user_retention_rate}%</span>
          </div>
        </div>
      `;
    }

    // Display wealth stats
    function displayWealthStats(wealthStats) {
      const container = document.getElementById('wealthStats');
      
      if (!wealthStats) {
        container.innerHTML = '<div class="text-gray-400">No wealth data available</div>';
        return;
      }

      container.innerHTML = `
        <div class="space-y-2">
          <div class="flex justify-between">
            <span class="text-emerald-300">Highest Balance:</span>
            <span class="text-white font-semibold">${wealthStats.max_balance?.toLocaleString() || 0}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-emerald-300">Lowest Balance:</span>
            <span class="text-white font-semibold">${wealthStats.min_balance?.toLocaleString() || 0}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-emerald-300">Average Balance:</span>
            <span class="text-white font-semibold">${wealthStats.avg_balance?.toLocaleString() || 0}</span>
          </div>
        </div>
      `;
    }

    // Set default enhanced stats on error
    function setDefaultEnhancedStats() {
      document.getElementById('avgClicksPerUser').textContent = '0';
      document.getElementById('totalDSPOINC').textContent = '0';
      document.getElementById('questCompletionRate').textContent = '0%';
      document.getElementById('avgQuestReward').textContent = '0';
      document.getElementById('clicksLast24h').textContent = '0';
      document.getElementById('newUsersToday').textContent = '0';
      document.getElementById('questsClaimedToday').textContent = '0';
      document.getElementById('rolesGrantedToday').textContent = '0';
      document.getElementById('engagementStats').innerHTML = '<div class="text-gray-400">Error loading data</div>';
      document.getElementById('wealthStats').innerHTML = '<div class="text-gray-400">Error loading data</div>';
    }

    // Admin authentication
    async function loginAdmin() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!username || !password) {
        addLog('‚ùå Please enter username and password');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/auth.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'login',
            username: username,
            password: password
          })
        });

        const data = await response.json();
        
        if (data.success) {
          currentAdmin = data.user;
          
          // Show admin content after authentication
          showAdminContent();
          
          // Show database unlock section for all authenticated users (but keep options hidden initially)
          document.getElementById('databaseUnlockSection').style.display = 'block';
          document.getElementById('databaseOptions').style.display = 'none';
          document.getElementById('databaseQuickActions').style.display = 'none';
          
          addLog(`‚úÖ Authenticated: ${username} (${data.user.role}) - Database access available with password`);
        } else {
          addLog(`‚ùå Login failed: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Login error: ${error.message}`);
      }
    }

    // Show user management panel
    function showUserManagement() {
      const panel = document.getElementById('userManagementPanel');
      if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        loadCurrentUsers();
      } else {
        panel.classList.add('hidden');
      }
    }

    // Load current users
    async function loadCurrentUsers() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!username || !password) {
        addLog('‚ùå Please enter your credentials first');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/auth.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'list_users',
            admin_username: username
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayCurrentUsers(data.users);
        } else {
          addLog(`‚ùå Failed to load users: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Load users error: ${error.message}`);
      }
    }

    // Display current users
    function displayCurrentUsers(users) {
      const container = document.getElementById('currentUsersList');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="flex justify-between items-center p-2 bg-gray-700 rounded">
          <div>
            <span class="font-semibold">${user.username}</span>
            <span class="text-sm text-gray-300 ml-2">(${user.role})</span>
            ${user.discord_id ? `<span class="text-xs text-gray-400 ml-2">Discord: ${user.discord_id}</span>` : ''}
          </div>
          ${user.username !== 'narrrf' ? `
            <button onclick="removeUser('${user.username}')" 
                    class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm">
              Remove
            </button>
          ` : '<span class="text-xs text-gray-400">Super Admin</span>'}
        </div>
      `).join('');
    }

    // Add new user
    async function addUser() {
      const adminUsername = document.getElementById('loginUsername').value.trim();
      const adminPassword = document.getElementById('loginPassword').value;
      const newUsername = document.getElementById('newUsername').value.trim();
      const newPassword = document.getElementById('newPassword').value;
      const newRole = document.getElementById('newRole').value;
      const newDiscordId = document.getElementById('newDiscordId').value.trim();
      
      if (!adminUsername || !adminPassword || !newUsername || !newPassword) {
        addLog('‚ùå Please fill in all required fields');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/auth.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'add_user',
            admin_username: adminUsername,
            new_username: newUsername,
            new_password: newPassword,
            new_role: newRole,
            new_discord_id: newDiscordId
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ ${data.message}`);
          // Clear form
          document.getElementById('newUsername').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('newDiscordId').value = '';
          // Reload users list
          loadCurrentUsers();
        } else {
          addLog(`‚ùå Failed to add user: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Add user error: ${error.message}`);
      }
    }

    // Remove user
    async function removeUser(username) {
      const adminUsername = document.getElementById('loginUsername').value.trim();
      const adminPassword = document.getElementById('loginPassword').value;
      
      if (!confirm(`Are you sure you want to remove user '${username}'?`)) {
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/auth.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'remove_user',
            admin_username: adminUsername,
            remove_username: username
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ ${data.message}`);
          loadCurrentUsers();
        } else {
          addLog(`‚ùå Failed to remove user: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Remove user error: ${error.message}`);
      }
    }

    // SUPER WORKING TAB EVENT LISTENERS - Clean and reliable
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ SUPER TAB SYSTEM: Initializing event listeners...');
      
      // Remove any existing event listeners to prevent conflicts
      const existingButtons = document.querySelectorAll('.tab-btn[data-tab]');
      existingButtons.forEach(btn => {
        const newBtn = btn.cloneNode(true);
        btn.parentNode.replaceChild(newBtn, btn);
      });
      
      // Add clean event listeners
    document.querySelectorAll('.tab-btn[data-tab]').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
        const tab = this.dataset.tab;
          console.log(`üöÄ SUPER TAB SYSTEM: Tab button clicked: ${tab}`);
          
          // Use the super working tab system
          showTab(tab);
        });
      });
      
      console.log('‚úÖ SUPER TAB SYSTEM: Event listeners initialized');
    });

    // Force refresh all tabs function
    function forceRefreshAllTabs() {
      console.log('üîÑ Force refreshing all tabs...');
      addLog('üîÑ Force refreshing all tabs...');
      
      // Clear all tab content
      clearAllTabContent();
      
      // Reset current tab to dashboard
      currentTab = 'dashboard';
      
      // Show dashboard tab
      showTab('dashboard');
      
      // Force reload of dashboard data
      setTimeout(() => {
        if (typeof loadDashboardData === 'function') {
          loadDashboardData();
        }
        if (typeof loadOverviewGameStats === 'function') {
          loadOverviewGameStats();
        }
        addLog('‚úÖ All tabs force refreshed successfully');
      }, 100);
    }

    // ULTIMATE COMBINED VERSION - Working Dashboard Functions
    async function loadDashboardData() {
      console.log('üìä Loading dashboard data...');
      addLog('üìä Loading dashboard data...');
      
      // Update dashboard status to loading
      updateDashboardStatus('Loading dashboard data...');
      
      try {
        // Load basic stats (always visible)
        const statsResponse = await fetch(API_BASE_URL + '/api/admin/get-stats.php');
        const stats = await statsResponse.json();
        
        if (stats.success) {
          // Update basic dashboard stats - API returns data directly
          const dashboardStats = {
            total_users: stats.totalUsers || '0',
            total_scores: stats.totalScores || '0',
            total_items: stats.totalItems || '0',
            active_quests: stats.activeQuests || '0'
          };
          
          updateSystemStats(dashboardStats);
          // CRITICAL FIX: Update top menu stats
          updateTopMenuStats(dashboardStats);
          
          // Load boss notifications count
          loadBossNotificationCount();
        } else {
          console.error('‚ùå Stats API returned error:', stats.error);
          addLog(`‚ùå Stats API error: ${stats.error || 'Unknown error'}`);
          updateSystemStats({
            total_users: 'Error',
            total_scores: 'Error',
            total_items: 'Error',
            active_quests: 'Error'
          });
        }

        // Load cheese click statistics
        try {
          const cheeseStatsResponse = await fetch(API_BASE_URL + '/api/admin/get-cheese-stats.php');
          const cheeseStats = await cheeseStatsResponse.json();
          
          if (cheeseStats.success) {
            updateCheeseClickStats(cheeseStats.stats || cheeseStats.data);
          } else {
            console.error('‚ùå Cheese stats API error:', cheeseStats.error);
            addLog(`‚ùå Cheese stats API error: ${cheeseStats.error || 'Unknown error'}`);
          }
        } catch (error) {
          console.error('‚ùå Error loading cheese stats:', error);
          addLog(`‚ùå Error loading cheese stats: ${error.message}`);
        }

        // Load quest and role statistics
        try {
          const questStatsResponse = await fetch(API_BASE_URL + '/api/admin/get-quest-stats.php');
          const questStats = await questStatsResponse.json();
          
          if (questStats.success) {
            updateQuestStats(questStats.stats || questStats.data);
          } else {
            console.error('‚ùå Quest stats API error:', questStats.error);
            addLog(`‚ùå Quest stats API error: ${questStats.error || 'Unknown error'}`);
          }
        } catch (error) {
          console.error('‚ùå Error loading quest stats:', error);
          addLog(`‚ùå Error loading quest stats: ${error.message}`);
        }
        
        // Load pending quest claims for dashboard stats
        try {
          await loadPendingQuestClaims();
        } catch (error) {
          console.error('‚ùå Error loading pending quest claims:', error);
          addLog(`‚ùå Error loading pending quest claims: ${error.message}`);
        }

        // Load boss notification statistics
        try {
          const bossResponse = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php');
          const bossData = await bossResponse.json();
          
          if (bossData.success) {
            updateBossNotificationStats(bossData.notifications || bossData.data);
          } else {
            console.error('‚ùå Boss notifications API error:', bossData.error);
            addLog(`‚ùå Boss notifications API error: ${bossData.error || 'Unknown error'}`);
          }
        } catch (error) {
          console.error('‚ùå Error loading boss notifications:', error);
          addLog(`‚ùå Error loading boss notifications: ${error.message}`);
        }

        // Load overview game stats
        if (typeof loadOverviewGameStats === 'function') {
          await loadOverviewGameStats();
        }
        
        // Load enhanced dashboard statistics
        try {
          await loadEnhancedDashboardStats();
        } catch (error) {
          console.error('‚ùå Error loading enhanced dashboard stats:', error);
          addLog(`‚ùå Error loading enhanced dashboard stats: ${error.message}`);
        }
        
        addLog('‚úÖ Dashboard data loaded successfully');
        updateDashboardStatus('Dashboard data loaded');
        
      } catch (error) {
        console.error('‚ùå Error loading dashboard data:', error);
        addLog(`‚ùå Error loading dashboard data: ${error.message}`);
        updateDashboardStatus('Dashboard loading failed');
        
        // Set fallback values
        const errorStats = {
          total_users: 'Error',
          total_scores: 'Error',
          total_items: 'Error',
          active_quests: 'Error'
        };
        updateSystemStats(errorStats);
        // CRITICAL FIX: Update top menu stats with error values
        updateTopMenuStats(errorStats);
      }
    }
    
    // Load additional dashboard data (cheese clicks, quests, etc.)
    async function loadAdditionalDashboardData() {
      console.log('üìä Loading additional dashboard data...');
      
      try {
        // Load cheese click statistics
        const cheeseResponse = await fetch(API_BASE_URL + '/api/admin/get-enhanced-stats.php');
        if (cheeseResponse.ok) {
          const cheeseData = await cheeseResponse.json();
          if (cheeseData.success) {
            updateCheeseClickStats(cheeseData.data);
          }
        }
        
        // Load quest statistics
        const questResponse = await fetch(API_BASE_URL + '/api/admin/get-quests.php');
        if (questResponse.ok) {
          const questData = await questResponse.json();
          if (questData.success) {
            updateQuestStats(questData.quests);
          }
        }
        
        // Load boss notification statistics
        const bossResponse = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php');
        if (bossResponse.ok) {
          const bossData = await bossResponse.json();
          if (bossData.success) {
            updateBossNotificationStats(bossData.notifications);
          }
        }
        
        addLog('‚úÖ Additional dashboard data loaded successfully');
      } catch (error) {
        console.error('‚ùå Error loading additional dashboard data:', error);
        addLog(`‚ùå Error loading additional dashboard data: ${error.message}`);
      }
    }
    
    // Update dashboard status
    function updateDashboardStatus(status) {
      const statusElement = document.getElementById('systemStatus');
      if (statusElement) {
        statusElement.innerHTML = status;
        statusElement.className = status.includes('Error') || status.includes('failed') ? 
          'text-red-400' : status.includes('Loading') ? 'text-yellow-400' : 'text-green-400';
      }
    }

    function loadStats() {
      console.log('üìà Loading system statistics...');
      addLog('üìà Loading system statistics...');
      
      // Load basic stats
      fetch(API_BASE_URL + '/api/admin/get-stats.php')
        .then(response => {
          console.log('üìä Stats API response status:', response.status);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return response.json();
        })
        .then(data => {
          console.log('üìä Stats API data received:', data);
          if (data.success) {
            // API returns data directly, not nested under data property
            const statsData = {
              total_users: data.totalUsers || '0',
              total_scores: data.totalScores || '0',
              total_items: data.totalItems || '0',
              active_quests: data.activeQuests || '0'
            };
            updateSystemStats(statsData);
            // CRITICAL FIX: Update top menu stats
            updateTopMenuStats(statsData);
            addLog('‚úÖ System statistics loaded successfully');
            } else {
            console.error('‚ùå Stats API returned error:', data.error);
            addLog(`‚ùå Stats API error: ${data.error || 'Unknown error'}`);
            // Set fallback values
            const errorStats = {
              total_users: 'Error',
              total_scores: 'Error',
              total_items: 'Error',
              active_quests: 'Error'
            };
            updateSystemStats(errorStats);
            // CRITICAL FIX: Update top menu stats with error values
            updateTopMenuStats(errorStats);
          }
        })
        .catch(error => {
          console.error('‚ùå Error loading stats:', error);
          addLog(`‚ùå Error loading system statistics: ${error.message}`);
          // Set fallback values
          const errorStats = {
            total_users: 'Error',
            total_scores: 'Error',
            total_items: 'Error',
            active_quests: 'Error'
          };
          updateSystemStats(errorStats);
          // CRITICAL FIX: Update top menu stats with error values
          updateTopMenuStats(errorStats);
        });
    }

    // Update top menu stats (the quick overview boxes)
    function updateTopMenuStats(data) {
      console.log('üìä Updating top menu stats with data:', data);
      
      const topMenuElements = {
        'totalUsers': data.total_users || data.totalUsers || '0',
        'totalScores': data.total_scores || data.totalScores || '0',
        'totalItems': data.total_items || data.totalItems || '0',
        'activeQuests': data.active_quests || data.activeQuests || '0'
      };
      
      Object.entries(topMenuElements).forEach(([elementId, value]) => {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = value;
          // Remove "Loading..." text and show actual value
          if (element.textContent.includes('Loading...')) {
            element.textContent = value;
          }
            } else {
          console.warn(`‚ö†Ô∏è Top menu element not found: ${elementId}`);
        }
      });
      
      addLog('‚úÖ Top menu statistics updated successfully');
    }

    function updateSystemStats(data) {
      console.log('üìä Updating system stats with data:', data);
      
      // Update dashboard statistics with better error handling
      const elements = {
        'totalUsersDetail': data.total_users || data.totalUsers || '0',
        'totalScoresDetail': data.total_scores || data.totalScores || '0',
        'totalItemsDetail': data.total_items || data.totalItems || '0',
        'activeQuestsDetail': data.active_quests || data.activeQuests || '0'
      };
      
      Object.entries(elements).forEach(([elementId, value]) => {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = value;
          element.className = value === 'Error' ? 'text-2xl font-bold text-red-400' : 
                            elementId === 'totalUsersDetail' ? 'text-2xl font-bold text-green-400' :
                            elementId === 'totalScoresDetail' ? 'text-2xl font-bold text-blue-400' :
                            elementId === 'totalItemsDetail' ? 'text-2xl font-bold text-yellow-400' :
                            'text-2xl font-bold text-purple-400';
            } else {
          console.warn(`‚ö†Ô∏è Element not found: ${elementId}`);
        }
      });
      
      // Update additional dashboard elements if they exist
      const additionalElements = {
        'bossNotificationsCount': data.boss_notifications || data.bossNotifications || '0'
      };
      
      Object.entries(additionalElements).forEach(([elementId, value]) => {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = value;
        }
      });
      
      addLog('‚úÖ Dashboard statistics updated successfully');
    }
    
    // Update cheese click statistics
    function updateCheeseClickStats(data) {
      console.log('üßÄ Updating cheese click stats:', data);
      
      const elements = {
        'totalCheeseClicks': data.total_clicks || '0',
        'last24hClicks': data.recent_24h || '0',
        'topClicker': data.top_clicker || 'None',
        'mostClicked': data.most_clicked || 'None'
      };
      
      Object.entries(elements).forEach(([elementId, value]) => {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = value;
        }
      });
      
      // Display detailed cheese stats if available
      if (data.clicks_by_egg) {
        displayCheeseClicksByType(data.clicks_by_egg);
      }
      if (data.top_users) {
        displayTopCheeseClickers(data.top_users);
      }
    }
    
    // Display cheese clicks by type
    function displayCheeseClicksByType(clicksByEgg) {
      const container = document.getElementById('cheeseClicksByType');
      if (!container) return;
      
      if (clicksByEgg.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No cheese clicks recorded</div>';
        return;
      }

      container.innerHTML = clicksByEgg.map(click => `
        <div class="flex justify-between items-center py-1">
          <span class="text-orange-300">${click.egg_id}</span>
          <span class="text-white font-semibold">${click.click_count}</span>
        </div>
      `).join('');
    }

    // Display top cheese clickers
    function displayTopCheeseClickers(topUsers) {
      const container = document.getElementById('topCheeseClickers');
      if (!container) return;
      
      if (topUsers.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No cheese clickers found</div>';
        return;
      }

      container.innerHTML = topUsers.slice(0, 5).map((user, index) => {
        const username = user.username || 'Anonymous Mouse';
        const displayName = username.length > 12 ? username.substring(0, 12) + '...' : username;
        const walletShort = user.user_wallet ? user.user_wallet.substring(0, 8) + '...' : 'Unknown';
        
        return `
          <div class="flex justify-between items-center py-1">
            <span class="text-orange-300">
              #${index + 1} 
              <a href="/profile.html?user_id=${encodeURIComponent(user.user_wallet)}" 
                 class="hover:text-orange-200 underline cursor-pointer" 
                 title="View ${username}'s profile">
                ${displayName} (${walletShort})
              </a>
            </span>
            <span class="text-white font-semibold">${user.click_count || 0}</span>
          </div>
        `;
      }).join('');
    }
    
    // Update quest statistics
    function updateQuestStats(quests) {
      console.log('üèÜ Updating quest stats:', quests);
      
      if (quests && Array.isArray(quests)) {
        const openQuests = quests.filter(q => q.is_active).length;
        const pendingClaims = quests.filter(q => q.status === 'pending').length;
        const completedQuests = quests.filter(q => q.status === 'completed').length;
        
        const elements = {
          'openQuests': openQuests.toString(),
          'pendingClaims': pendingClaims.toString(),
          'completedQuests': completedQuests.toString()
        };
        
        Object.entries(elements).forEach(([elementId, value]) => {
          const element = document.getElementById(elementId);
          if (element) {
            element.textContent = value;
          }
        });
        
        // Display detailed quest stats if available
        if (quests.length > 0) {
          displayRecentQuestClaims(quests.filter(q => q.status === 'completed').slice(0, 5));
          displayActiveQuestsByType(quests.filter(q => q.is_active));
        }
      }
    }
    
    // Load pending quest claims for dashboard
    async function loadPendingQuestClaims() {
      try {
        console.log('üèÜ Loading pending quest claims for dashboard...');
        addLog('üèÜ Loading pending quest claims for dashboard...');
        
        const response = await fetch(API_BASE_URL + '/api/admin/get-enhanced-quest-claims.php?status=pending');
        const data = await response.json();
        
        if (data.success && data.claims) {
          const pendingCount = data.claims.length;
          const pendingClaimsElement = document.getElementById('pendingClaims');
          
          if (pendingClaimsElement) {
            pendingClaimsElement.textContent = pendingCount.toString();
            console.log('‚úÖ Updated pending claims count:', pendingCount);
            addLog(`‚úÖ Updated pending claims count: ${pendingCount}`);
          } else {
            console.warn('‚ö†Ô∏è pendingClaims element not found');
          }
          
          // Also update the roles granted count if available
          const rolesGrantedElement = document.getElementById('rolesGranted');
          if (rolesGrantedElement) {
            // Count claims that have been approved
            const approvedCount = data.claims.filter(claim => claim.status === 'approved').length;
            rolesGrantedElement.textContent = approvedCount.toString();
            console.log('‚úÖ Updated roles granted count:', approvedCount);
          }
        } else {
          console.warn('‚ö†Ô∏è Failed to load pending quest claims:', data.error);
          addLog(`‚ö†Ô∏è Failed to load pending quest claims: ${data.error || 'Unknown error'}`);
        }
      } catch (error) {
        console.error('‚ùå Error loading pending quest claims:', error);
        addLog(`‚ùå Error loading pending quest claims: ${error.message}`);
      }
    }
    
    // Display recent quest claims
    function displayRecentQuestClaims(recentClaims) {
      const container = document.getElementById('recentQuestClaims');
      if (!container) return;
      
      if (recentClaims.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No recent quest claims</div>';
        return;
      }

      container.innerHTML = recentClaims.map(claim => `
        <div class="flex justify-between items-center py-1">
          <span class="text-green-300">${claim.username || 'Unknown User'}</span>
          <span class="text-white font-semibold">${claim.reward || 0} DSPOINC</span>
        </div>
      `).join('');
    }

    // Display active quests by type
    function displayActiveQuestsByType(activeQuests) {
      const container = document.getElementById('activeQuestsByType');
      if (!container) return;
      
      if (activeQuests.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No active quests</div>';
        return;
      }

      const questsByType = {};
      activeQuests.forEach(quest => {
        const type = quest.type || 'Unknown';
        questsByType[type] = (questsByType[type] || 0) + 1;
      });

      container.innerHTML = Object.entries(questsByType).map(([type, count]) => `
        <div class="flex justify-between items-center py-1">
          <span class="text-blue-300">${type}</span>
          <span class="text-white font-semibold">${count}</span>
        </div>
      `).join('');
    }
    
    // Unlock database access
    async function unlockDatabaseAccess() {
      console.log('üîì Unlocking database access...');
      addLog('üîì Unlocking database access...');
      
      try {
        const password = prompt('Enter database password to unlock access:');
        if (!password) {
          addLog('‚ùå No password entered');
          return;
        }
        
        const response = await fetch(API_BASE_URL + '/api/admin/validate-db-password.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Database access unlocked successfully');
          
          // Show database options
          const databaseOptions = document.getElementById('databaseOptions');
          const databaseQuickActions = document.getElementById('databaseQuickActions');
          
          if (databaseOptions) databaseOptions.style.display = 'block';
          if (databaseQuickActions) databaseQuickActions.style.display = 'block';
          
          // Update button text
          const unlockButton = document.querySelector('button[onclick="unlockDatabaseAccess()"]');
          if (unlockButton) {
            unlockButton.textContent = 'Database Access Unlocked';
            unlockButton.className = 'bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold text-lg transition-all duration-300';
            unlockButton.onclick = null; // Disable further clicks
          }
          
          // Load game management data now that database is unlocked
          if (typeof loadGameManagementData === 'function') {
            loadGameManagementData();
          }
            } else {
          addLog(`‚ùå Database unlock failed: ${data.error || 'Invalid password'}`);
        }
      } catch (error) {
        console.error('‚ùå Error unlocking database:', error);
        addLog(`‚ùå Error unlocking database: ${error.message}`);
      }
    }

    // Update boss notification statistics
    function updateBossNotificationStats(notifications) {
      console.log('üëë Updating boss notification stats:', notifications);
      
      if (notifications && Array.isArray(notifications)) {
        const pendingClaims = notifications.filter(n => n.status === 'pending').length;
        const totalDspoinc = notifications.reduce((sum, n) => sum + (n.dspoinc_earned || 0), 0);
        const claimsToday = notifications.filter(n => {
          const today = new Date().toDateString();
          const claimDate = new Date(n.created_at).toDateString();
          return today === claimDate;
        }).length;
        const avgReward = notifications.length > 0 ? Math.round(totalDspoinc / notifications.length) : 0;
        
        const elements = {
          'pendingBossClaims': pendingClaims.toString(),
          'totalDspoincGiven': totalDspoinc.toString(),
          'claimsToday': claimsToday.toString(),
          'avgReward': avgReward.toString()
        };
        
        Object.entries(elements).forEach(([elementId, value]) => {
          const element = document.getElementById(elementId);
          if (element) {
            element.textContent = value;
          }
        });
      }
    }
    
    // Load holder verification data
    function loadHolderVerificationData() {
      console.log('üé¥ Loading holder verification data...');
      addLog('üé¥ Loading holder verification data...');
      
      try {
        fetch(API_BASE_URL + '/api/admin/get-holder-verifications.php')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              updateHolderVerificationDisplay(data.verifications || []);
            } else {
              addLog(`‚ùå Failed to load holder verifications: ${data.error}`);
            }
          })
          .catch(error => {
            console.error('‚ùå Error loading holder verifications:', error);
            addLog(`‚ùå Error loading holder verifications: ${error.message}`);
          });
      } catch (error) {
        console.error('‚ùå Error in loadHolderVerificationData:', error);
        addLog(`‚ùå Error in loadHolderVerificationData: ${error.message}`);
      }
    }
    
    // Update holder verification display
    function updateHolderVerificationDisplay(verifications) {
      const container = document.getElementById('holderVerificationContainer');
      if (!container) return;
      
      if (verifications.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No holder verifications found</div>';
        return;
      }
      
      container.innerHTML = verifications.map(verification => `
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-600 mb-4">
          <div class="flex justify-between items-start">
            <div>
              <h4 class="font-semibold text-white">${verification.username}</h4>
              <p class="text-gray-300 text-sm">Wallet: ${verification.wallet}</p>
              <p class="text-gray-300 text-sm">Collection: ${verification.collection}</p>
              <p class="text-gray-300 text-sm">NFT Count: ${verification.nft_count}</p>
            </div>
            <div class="text-right">
              <span class="px-2 py-1 rounded text-xs ${verification.role_granted ? 'bg-green-600' : 'bg-yellow-600'}">
                ${verification.role_granted ? 'Role Granted' : 'Pending'}
              </span>
            </div>
          </div>
        </div>
      `).join('');
      
      addLog(`‚úÖ Loaded ${verifications.length} holder verifications`);
    }
    
    // Load cheese guide data
    function loadCheeseGuideData() {
      console.log('üßÄ Loading Cheese Guide data...');
      addLog('üßÄ Loading Cheese Guide data...');
      
      // Cheese guide is static content, just mark as loaded
      addLog('‚úÖ Cheese Guide data loaded successfully');
    }
    
    // Load community funds data
    function loadCommunityFundsData() {
      console.log('üí∞ Loading Community Funds data...');
      addLog('üí∞ Loading Community Funds data...');
      
      try {
        // Show loading states first
        showCommunityFundsLoadingStates();
        
        // Load community funds entries
        loadCommunityFundsEntries();
        
        // Load community wallet data
        loadCommunityWalletData();
        
        addLog('‚úÖ Community Funds data loading initiated');
      } catch (error) {
        console.error('‚ùå Error in loadCommunityFundsData:', error);
        addLog(`‚ùå Error in loadCommunityFundsData: ${error.message}`);
      }
    }
    
    // Update community funds display
    function updateCommunityFundsDisplay(entries) {
      // This function is not needed as we're using the existing table structure
      addLog('‚úÖ Community funds display updated');
    }
    
    // üîß REMOVED: Sample data function no longer needed since real data exists
    
    // Helper functions for Community Funds
    function displayCollectionsSummary(collections) {
      const container = document.getElementById('collectionsSummary');
      if (!container) {
        console.warn('collectionsSummary element not found');
        return;
      }
      
      if (!collections || collections.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-400">No collections found</div>';
        return;
      }
      
      let html = '<div class="space-y-2">';
      collections.forEach(collection => {
        html += `
          <div class="bg-gray-700 p-2 rounded text-sm">
            <div class="font-semibold text-blue-400">${collection.name || 'Unknown'}</div>
            <div class="text-gray-300">NFTs: ${collection.count || 0}</div>
          </div>
        `;
      });
      html += '</div>';
      
      container.innerHTML = html;
    }
    
    function displayNFTGallery(nfts) {
      const container = document.getElementById('nftGallery');
      if (!container) {
        console.warn('nftGallery element not found');
        return;
      }
      
      if (!nfts || nfts.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-400">No NFTs found</div>';
        return;
      }
      
      let html = '<div class="grid grid-cols-2 gap-2">';
      nfts.slice(0, 8).forEach(nft => {
        html += `
          <div class="bg-gray-700 p-2 rounded text-xs text-center">
            <div class="text-blue-400 font-semibold">${nft.name || 'Unknown'}</div>
            <div class="text-gray-300">${nft.collection || 'Unknown'}</div>
          </div>
        `;
      });
      html += '</div>';
      
      if (nfts.length > 8) {
        html += `<div class="text-center text-gray-400 text-xs mt-2">+${nfts.length - 8} more NFTs</div>`;
      }
      
      container.innerHTML = html;
    }
    
    function populateCollectionFilters(collections) {
      // This function can be implemented later if needed
      console.log('Collection filters populated:', collections?.length || 0);
    }
    
    function calculateAndDisplayStatistics(entries) {
      try {
        // Calculate monthly totals
        const now = new Date();
        const thisMonth = now.getMonth();
        const thisYear = now.getFullYear();
        
        const thisMonthEntries = entries.filter(entry => {
          const entryDate = new Date(entry.date);
          return entryDate.getMonth() === thisMonth && entryDate.getFullYear() === thisYear;
        });
        
        const lastMonthEntries = entries.filter(entry => {
          const entryDate = new Date(entry.date);
          const lastMonth = thisMonth === 0 ? 11 : thisMonth - 1;
          const lastMonthYear = thisMonth === 0 ? thisYear - 1 : thisYear;
          return entryDate.getMonth() === lastMonth && entryDate.getFullYear() === lastMonthYear;
        });
        
        // Calculate totals
        const thisMonthTotal = thisMonthEntries.reduce((sum, entry) => sum + (parseFloat(entry.amount) || 0), 0);
        const lastMonthTotal = lastMonthEntries.reduce((sum, entry) => sum + (parseFloat(entry.amount) || 0), 0);
        const averageEntry = entries.length > 0 ? entries.reduce((sum, entry) => sum + (parseFloat(entry.amount) || 0), 0) / entries.length : 0;
        
        // Update display elements
        const monthlyTotalEl = document.getElementById('monthlyTotal');
        const lastMonthTotalEl = document.getElementById('lastMonthTotal');
        const averageEntryEl = document.getElementById('averageEntry');
        
        if (monthlyTotalEl) monthlyTotalEl.textContent = thisMonthTotal.toFixed(3) + ' SOL';
        if (lastMonthTotalEl) lastMonthTotalEl.textContent = lastMonthTotal.toFixed(3) + ' SOL';
        if (averageEntryEl) averageEntryEl.textContent = averageEntry.toFixed(3) + ' SOL';
        
        addLog(`‚úÖ Statistics calculated: This month: ${thisMonthTotal.toFixed(3)} SOL, Last month: ${lastMonthTotal.toFixed(3)} SOL`);
      } catch (error) {
        console.error('Error calculating statistics:', error);
        addLog(`‚ùå Error calculating statistics: ${error.message}`);
      }
    }
    
    function displayCommunityFundsRecentActivity(entries) {
      try {
        const container = document.getElementById('recentActivity');
        if (!container) {
          console.warn('recentActivity element not found');
          return;
        }
        
        if (!entries || entries.length === 0) {
          container.innerHTML = '<div class="text-gray-400">No recent activity</div>';
          return;
        }
        
        // Show last 5 entries
        const recentEntries = entries.slice(0, 5);
        let html = '<div class="space-y-2">';
        
        recentEntries.forEach(entry => {
          const amountClass = entry.type === 'income' ? 'text-green-400' : 'text-red-400';
          const icon = entry.type === 'income' ? 'üì•' : 'üì§';
          
          html += `
            <div class="flex justify-between items-center text-sm">
              <span>${icon} ${entry.description}</span>
              <span class="${amountClass} font-semibold">${entry.amount} SOL</span>
            </div>
          `;
        });
        
        html += '</div>';
        container.innerHTML = html;
        
        addLog(`‚úÖ Recent activity displayed: ${recentEntries.length} entries`);
      } catch (error) {
        console.error('Error displaying recent activity:', error);
        addLog(`‚ùå Error displaying recent activity: ${error.message}`);
      }
    }

    function loadStoreItems() {
      console.log('üè™ Loading store items...');
      addLog('üè™ Loading store items...');
      
      // Load store items from API
      fetch(API_BASE_URL + '/api/admin/store-admin.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateStoreItems(data.items);
          }
        })
        .catch(error => {
          console.error('Error loading store items:', error);
          addLog('‚ùå Error loading store items');
        });
    }

    function updateStoreItems(items) {
      const tableBody = document.getElementById('storeTableBody');
      if (tableBody && items) {
        tableBody.innerHTML = items.map(item => `
          <tr>
            <td>${item.item_name}</td>
            <td>${item.description || 'No description'}</td>
            <td>${item.price} DSPOINC</td>
            <td>${item.is_active ? 'Active' : 'Inactive'}</td>
            <td>
              <button onclick="editStoreItem(${item.item_id})" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-sm">Edit</button>
            </td>
          </tr>
        `).join('');
      }
    }

    function loadQuests() {
      console.log('üèÜ Loading quests...');
      addLog('üèÜ Loading quests...');
      
      // Load quests from API
      fetch(API_BASE_URL + '/api/admin/get-quests.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateQuests(data.quests);
          }
        })
        .catch(error => {
          console.error('Error loading quests:', error);
          addLog('‚ùå Error loading quests');
        });
    }

    function updateQuests(quests) {
      const container = document.getElementById('activeQuestsList');
      if (container && quests) {
        container.innerHTML = quests.map(quest => `
          <div class="bg-gray-700 p-3 rounded border-l-4 border-green-500 mb-2">
            <div class="font-semibold">${quest.description}</div>
            <div class="text-sm text-gray-400">Reward: ${quest.reward} DSPOINC</div>
          </div>
        `).join('');
      }
    }

    function loadBossNotifications() {
      console.log('üèÜ Loading boss notifications...');
      addLog('üèÜ Loading boss notifications...');
      
      // Load boss notifications from API
              fetch(API_BASE_URL + '/api/admin/boss-level-notification.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateBossNotifications(data.notifications);
          }
        })
        .catch(error => {
          console.error('Error loading boss notifications:', error);
          addLog('‚ùå Error loading boss notifications');
        });
    }

    function updateBossNotifications(notifications) {
      const container = document.getElementById('bossNotificationsList');
      if (container && notifications) {
        container.innerHTML = notifications.map(notification => `
          <div class="bg-gray-700 p-3 rounded border-l-4 border-yellow-500 mb-2">
            <div class="font-semibold">${notification.player_username}</div>
            <div class="text-sm text-gray-400">${notification.boss_name} - Wave ${notification.wave_number}</div>
          </div>
        `).join('');
      }
    }

    function loadDiscordConfigData() {
      console.log('üîó Loading Discord config...');
      addLog('üîó Loading Discord config...');
      
      // Load Discord configuration
      fetch(API_BASE_URL + '/api/admin/get-discord-config.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateDiscordConfig(data.config);
          }
        })
        .catch(error => {
          console.error('Error loading Discord config:', error);
          addLog('‚ùå Error loading Discord config');
        });
    }

    function updateDiscordConfig(config) {
      // Update Discord configuration display
      console.log('Discord config updated:', config);
    }

    function loadCheeseGuideData() {
      console.log('üßÄ Loading cheese guide...');
      addLog('üßÄ Loading cheese guide...');
      
      // Load cheese guide data
      // This would load from a cheese guide API or static content
      addLog('‚úÖ Cheese guide loaded');
    }

    function loadHolderVerificationData() {
      console.log('üé¥ Loading holder verification...');
      addLog('üé¥ Loading holder verification...');
      
      // Load holder verification data
      fetch(API_BASE_URL + '/api/admin/get-holder-verifications.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateHolderVerifications(data.verifications);
          }
        })
        .catch(error => {
          console.error('Error loading holder verifications:', error);
          addLog('‚ùå Error loading holder verifications');
        });
    }

    function updateHolderVerifications(verifications) {
      const tableBody = document.getElementById('holderTableBody');
      if (tableBody && verifications) {
        tableBody.innerHTML = verifications.map(verification => `
          <tr>
            <td>${verification.username}</td>
            <td>${verification.collection}</td>
            <td>${verification.nft_count}</td>
            <td>${verification.role_granted ? 'Yes' : 'No'}</td>
          </tr>
        `).join('');
      }
    }

    // üîß REMOVED: Duplicate loadCommunityFundsData function (conflicting with main implementation)
    
    // üîß REMOVED: Duplicate updateCommunityFunds function (conflicting with main implementation)

    // Instant user search
    function searchUsersInstant(searchTerm) {
      if (searchTimeout) clearTimeout(searchTimeout);
      
      if (searchTerm.length < 2) {
        document.getElementById('userResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
        return;
      }

      searchTimeout = setTimeout(async () => {
        try {
          const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'searchuser',
              search: searchTerm
            })
          });

          const data = await response.json();
          
          if (data.success) {
            displayUserResults(data.users);
            addLog(`üîç Found ${data.users.length} users matching "${searchTerm}"`);
          } else {
            addLog(`‚ùå Search failed: ${data.error}`);
          }
        } catch (error) {
          addLog(`‚ùå Search error: ${error.message}`);
        }
      }, 300);
    }

    // Quick instant user search for point management
    function quickSearchUsersInstant(searchTerm) {
      if (searchTimeout) clearTimeout(searchTimeout);
      
      if (searchTerm.length < 2) {
        document.getElementById('quickUserResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
        return;
      }

      searchTimeout = setTimeout(async () => {
        try {
          const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'searchuser',
              search: searchTerm
            })
          });

          const data = await response.json();
          
          if (data.success) {
            displayQuickUserResults(data.users);
            addLog(`üîç Found ${data.users.length} users matching "${searchTerm}"`);
          } else {
            addLog(`‚ùå Search failed: ${data.error}`);
          }
        } catch (error) {
          addLog(`‚ùå Search error: ${error.message}`);
        }
      }, 300);
    }

    // User search
    async function searchUsers() {
      const searchTerm = document.getElementById('userSearch').value.trim();
      if (!searchTerm) {
        addLog('‚ùå Please enter a search term');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'searchuser',
            search: searchTerm
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayUserResults(data.users);
          addLog(`üîç Found ${data.users.length} users matching "${searchTerm}"`);
        } else {
          addLog(`‚ùå Search failed: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Search error: ${error.message}`);
      }
    }

    // Display user search results
    function displayUserResults(users) {
      const container = document.getElementById('userResults');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="user-card">
          <h4 class="font-semibold mb-2">${user.username || 'Unknown User'}</h4>
          <p class="text-sm text-gray-300 mb-2">ID: ${user.user_id}</p>
          <p class="text-sm text-yellow-400 mb-3">Balance: ${user.score?.toLocaleString() || 0} $DSPOINC</p>
          <div class="flex gap-2">
            <button onclick="selectUser('${user.user_id}', '${user.username || 'Unknown'}')" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex-1">
              Select User
            </button>
            <button onclick="loadUserAdjustments('${user.user_id}', '${user.username || 'Unknown'}')" 
                    class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm">
              View Adjustments
            </button>
          </div>
        </div>
      `).join('');
    }

    // Display quick user search results for point management
    function displayQuickUserResults(users) {
      const container = document.getElementById('quickUserResults');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="user-card mb-2">
          <div class="flex justify-between items-center">
            <div>
              <h4 class="font-semibold">${user.username || 'Unknown User'}</h4>
              <p class="text-sm text-gray-300">ID: ${user.user_id}</p>
              <p class="text-sm text-yellow-400">Balance: ${user.score?.toLocaleString() || 0} $DSPOINC</p>
            </div>
            <button onclick="quickSelectUserFromResults('${user.user_id}', '${user.username || 'Unknown'}', ${user.score || 0})" 
                    class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">
              Select
            </button>
          </div>
        </div>
      `).join('');
    }

    // Quick user selection from search results
    function quickSelectUserFromResults(userId, username, balance) {
      selectUser(userId, username);
      
      const infoDiv = document.getElementById('selectedUserInfo');
      infoDiv.innerHTML = `
        <div class="text-green-400">
          <strong>Selected User:</strong> ${username}<br>
          <strong>Balance:</strong> ${balance.toLocaleString()} $DSPOINC
        </div>
      `;
      infoDiv.classList.remove('hidden');
      
      // Clear the search results
      document.getElementById('quickUserResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
      
      addLog(`üë§ Selected user: ${username} (${balance.toLocaleString()} $DSPOINC)`);
    }

    // Give Item user search functionality
    function giveItemSearchUsersInstant(searchTerm) {
      if (searchTimeout) clearTimeout(searchTimeout);
      
      if (searchTerm.length < 2) {
        document.getElementById('giveItemUserResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
        document.getElementById('giveItemUserResults').style.display = 'none';
        return;
      }

      searchTimeout = setTimeout(async () => {
        try {
          const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'searchuser',
              search: searchTerm
            })
          });

          const data = await response.json();
          
          if (data.success) {
            displayGiveItemUserResults(data.users);
            document.getElementById('giveItemUserResults').style.display = 'block';
          } else {
            document.getElementById('giveItemUserResults').innerHTML = '<div class="text-gray-300">Search failed</div>';
            document.getElementById('giveItemUserResults').style.display = 'block';
          }
        } catch (error) {
          document.getElementById('giveItemUserResults').innerHTML = '<div class="text-gray-300">Search error</div>';
          document.getElementById('giveItemUserResults').style.display = 'block';
        }
      }, 300);
    }

    // Display Give Item user search results
    function displayGiveItemUserResults(users) {
      const container = document.getElementById('giveItemUserResults');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300 p-2">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="p-2 hover:bg-gray-600 cursor-pointer border-b border-gray-600" onclick="selectGiveItemUser('${user.user_id}', '${user.username || 'Unknown'}')">
          <div class="font-semibold text-white">${user.username || 'Unknown User'}</div>
          <div class="text-sm text-gray-300">ID: ${user.user_id}</div>
          <div class="text-sm text-yellow-400">Balance: ${user.score?.toLocaleString() || 0} $DSPOINC</div>
        </div>
      `).join('');
    }

    // Select user for Give Item
    function selectGiveItemUser(userId, username) {
      document.getElementById('giveItemUserId').value = userId;
      document.getElementById('giveItemUserResults').style.display = 'none';
      addLog(`‚úÖ Selected user for Give Item: ${username} (${userId})`);
    }

    // View Inventory user search functionality
    function viewInventorySearchUsersInstant(searchTerm) {
      if (searchTimeout) clearTimeout(searchTimeout);
      
      if (searchTerm.length < 2) {
        document.getElementById('viewInventoryUserResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
        document.getElementById('viewInventoryUserResults').style.display = 'none';
        return;
      }

      searchTimeout = setTimeout(async () => {
        try {
          const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'searchuser',
              search: searchTerm
            })
          });

          const data = await response.json();
          
          if (data.success) {
            displayViewInventoryUserResults(data.users);
            document.getElementById('viewInventoryUserResults').style.display = 'block';
          } else {
            document.getElementById('viewInventoryUserResults').innerHTML = '<div class="text-gray-300">Search failed</div>';
            document.getElementById('viewInventoryUserResults').style.display = 'block';
          }
        } catch (error) {
          document.getElementById('viewInventoryUserResults').innerHTML = '<div class="text-gray-300">Search error</div>';
          document.getElementById('viewInventoryUserResults').style.display = 'block';
        }
      }, 300);
    }

    // Display View Inventory user search results
    function displayViewInventoryUserResults(users) {
      const container = document.getElementById('viewInventoryUserResults');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300 p-2">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="p-2 hover:bg-gray-600 cursor-pointer border-b border-gray-600" onclick="selectViewInventoryUser('${user.user_id}', '${user.username || 'Unknown'}')">
          <div class="font-semibold text-white">${user.username || 'Unknown User'}</div>
          <div class="text-sm text-gray-300">ID: ${user.user_id}</div>
          <div class="text-sm text-yellow-400">Balance: ${user.score?.toLocaleString() || 0} $DSPOINC</div>
        </div>
      `).join('');
    }

    // Select user for View Inventory
    function selectViewInventoryUser(userId, username) {
      document.getElementById('viewInventoryUserId').value = userId;
      document.getElementById('viewInventoryUserResults').style.display = 'none';
      addLog(`‚úÖ Selected user for View Inventory: ${username} (${userId})`);
    }

    // Quick user selection
    async function quickSelectUser() {
      const userId = document.getElementById('quickUserId').value.trim();
      
      if (!userId) {
        addLog('‚ùå Please enter a user ID');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'getbalance',
            user_id: userId
          })
        });

        const data = await response.json();
        
        if (data.success) {
          selectUser(userId, `User ${userId}`);
          const infoDiv = document.getElementById('selectedUserInfo');
          infoDiv.innerHTML = `
            <div class="text-green-400">
              <strong>Selected User:</strong> ${userId}<br>
              <strong>Balance:</strong> ${data.balance.toLocaleString()} $DSPOINC
            </div>
          `;
          infoDiv.classList.remove('hidden');
          addLog(`üë§ Selected user: ${userId} (${data.balance.toLocaleString()} $DSPOINC)`);
        } else {
          addLog(`‚ùå User not found: ${userId}`);
        }
      } catch (error) {
        addLog(`‚ùå Error selecting user: ${error.message}`);
      }
    }

    // Select user for point operations
    function selectUser(userId, username) {
      // Fill all point operation forms with this user
      document.getElementById('addUserId').value = userId;
      document.getElementById('setUserId').value = userId;
      document.getElementById('removeUserId').value = userId;
      document.getElementById('balanceUserId').value = userId;
      document.getElementById('historyUserId').value = userId;
      document.getElementById('quickUserId').value = userId;
      
      // Clear search results
      if (document.getElementById('quickUserResults')) {
        document.getElementById('quickUserResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
      }
      
      addLog(`üë§ Selected user: ${username} (${userId})`);
    }

    // Add points
    async function addPoints() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate as admin first');
        return;
      }

      const userId = document.getElementById('addUserId').value.trim();
      const amount = parseInt(document.getElementById('addAmount').value);
      const reason = document.getElementById('addReason').value.trim() || 'Manual admin adjustment';

      if (!userId || !amount || amount <= 0) {
        addLog('‚ùå Please enter valid user ID and amount');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'addpoints',
            admin_id: currentAdmin.discord_id,
            user_id: userId,
            amount: amount,
            reason: reason
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ ${data.message} - New balance: ${data.new_balance.toLocaleString()} $DSPOINC`);
          // Clear form
          document.getElementById('addAmount').value = '';
          document.getElementById('addReason').value = '';
          // Reload dashboard data
          loadDashboardData();
        } else {
          addLog(`‚ùå Failed to add points: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Add points error: ${error.message}`);
      }
    }

    // Set points
    async function setPoints() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate as admin first');
        return;
      }

      const userId = document.getElementById('setUserId').value.trim();
      const amount = parseInt(document.getElementById('setAmount').value);
      const reason = document.getElementById('setReason').value.trim() || 'Manual set by admin';

      if (!userId || amount < 0) {
        addLog('‚ùå Please enter valid user ID and amount');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'setpoints',
            admin_id: currentAdmin.discord_id,
            user_id: userId,
            amount: amount,
            reason: reason
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ ${data.message}`);
          // Clear form
          document.getElementById('setAmount').value = '';
          document.getElementById('setReason').value = '';
          // Reload dashboard data
          loadDashboardData();
        } else {
          addLog(`‚ùå Failed to set points: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Set points error: ${error.message}`);
      }
    }

    // Remove points
    async function removePoints() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate as admin first');
        return;
      }

      const userId = document.getElementById('removeUserId').value.trim();
      const amount = parseInt(document.getElementById('removeAmount').value);
      const reason = document.getElementById('removeReason').value.trim() || 'Manual admin adjustment';

      if (!userId || !amount || amount <= 0) {
        addLog('‚ùå Please enter valid user ID and amount');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'removepoints',
            admin_id: currentAdmin.discord_id,
            user_id: userId,
            amount: amount,
            reason: reason
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ ${data.message} - New balance: ${data.new_balance.toLocaleString()} $DSPOINC`);
          // Clear form
          document.getElementById('removeAmount').value = '';
          document.getElementById('removeReason').value = '';
          // Reload dashboard data
          loadDashboardData();
        } else {
          addLog(`‚ùå Failed to remove points: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Remove points error: ${error.message}`);
      }
    }

    // Check balance
    async function checkBalance() {
      const userId = document.getElementById('balanceUserId').value.trim();
      
      if (!userId) {
        addLog('‚ùå Please enter a user ID');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'getbalance',
            user_id: userId
          })
        });

        const data = await response.json();
        
        if (data.success) {
          const resultDiv = document.getElementById('balanceResult');
          resultDiv.innerHTML = `
            <div class="text-green-400">
              <strong>User ID:</strong> ${data.user_id}<br>
              <strong>Balance:</strong> ${data.balance.toLocaleString()} $DSPOINC
            </div>
          `;
          resultDiv.classList.remove('hidden');
          addLog(`üí≥ Balance for ${userId}: ${data.balance.toLocaleString()} $DSPOINC`);
        } else {
          addLog(`‚ùå Failed to get balance: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Check balance error: ${error.message}`);
      }
    }

    // Get transaction history
    async function getHistory() {
      const userId = document.getElementById('historyUserId').value.trim();
      
      if (!userId) {
        addLog('‚ùå Please enter a user ID');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'gethistory',
            user_id: userId,
            limit: 20
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayHistory(data.history);
          addLog(`üìã Retrieved ${data.history.length} transactions for ${userId}`);
        } else {
          addLog(`‚ùå Failed to get history: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Get history error: ${error.message}`);
      }
    }

    // Display transaction history
    function displayHistory(history) {
      const container = document.getElementById('historyResult');
      
      if (history.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No transaction history found.</div>';
        return;
      }

      container.innerHTML = history.map(item => {
        const amount = parseInt(item.amount);
        const isPositive = amount > 0;
        const timestamp = new Date(item.timestamp).toLocaleString();
        
        return `
          <div class="history-item ${isPositive ? 'positive' : 'negative'}">
            <div class="flex justify-between items-start">
              <div>
                <strong>${isPositive ? '+' : ''}${amount.toLocaleString()} $DSPOINC</strong>
                <span class="text-sm text-gray-300 ml-2">(${item.action})</span>
              </div>
              <div class="text-xs text-gray-400">${timestamp}</div>
            </div>
            <div class="text-sm text-gray-300 mt-1">Reason: ${item.reason || 'No reason provided'}</div>
            <div class="text-xs text-gray-500">Admin: ${item.admin_id}</div>
          </div>
        `;
      }).join('');
    }

    // Load store items
    async function loadStoreItems() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/store-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'get_items' })
        });
        const data = await response.json();
        
        if (data.success) {
          displayStoreItems(data.items);
          addLog(`üè™ Loaded ${data.items.length} store items`);
        } else {
          addLog(`‚ùå Failed to load store items: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Store items error: ${error.message}`);
      }
    }

    // Display store items
    function displayStoreItems(items) {
      const container = document.getElementById('storeItems');
      
      if (items.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No store items found</div>';
        return;
      }

      container.innerHTML = items.map(item => `
        <div class="user-card">
          <h4 class="font-semibold mb-2">${item.item_name}</h4>
          <p class="text-sm text-gray-300 mb-2">${item.description || 'No description'}</p>
          <p class="text-lg font-bold text-yellow-400 mb-3">${item.price?.toLocaleString() || 0} $DSPOINC</p>
          <div class="flex gap-2">
            <button onclick="editStoreItem(${item.item_id})" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex-1">
              Edit
            </button>
            <button onclick="deleteStoreItem(${item.item_id})" 
                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm flex-1">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    // Edit store item (placeholder for future implementation)
    function editStoreItem(itemId) {
      addLog(`üîÑ Edit store item functionality coming soon! Item ID: ${itemId}`);
      // TODO: Implement edit store item modal/form
    }

    // Delete store item
    async function deleteStoreItem(itemId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      if (!confirm('Are you sure you want to delete this store item?')) {
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/store-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'delete_item',
            item_id: itemId
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Store item deleted successfully!`);
          loadStoreItems();
        } else {
          addLog(`‚ùå Failed to delete store item: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Store item deletion error: ${error.message}`);
      }
    }

    // Load quests
    async function loadQuests() {
      try {
        // Load quests list
        const response = await fetch(API_BASE_URL + '/api/admin/get-quests.php');
        const data = await response.json();
        
        if (data.success) {
          displayQuests(data.quests);
          addLog(`üèÜ Loaded ${data.quests.length} quests`);
        } else {
          addLog(`‚ùå Failed to load quests: ${data.error}`);
        }
        
        // Load quest claims for management (only when quests tab is selected)
        if (currentAdmin) {
          loadEnhancedQuestClaims();
        }
      } catch (error) {
        addLog(`‚ùå Quests error: ${error.message}`);
      }
    }

    // Display quests
    function displayQuests(quests) {
      const container = document.getElementById('activeQuestsList');
      
      if (quests.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No active quests found</div>';
        return;
      }

      container.innerHTML = quests.map(quest => `
        <div class="user-card">
          <h4 class="font-semibold mb-2">${quest.type}</h4>
          <p class="text-sm text-gray-300 mb-2">${quest.description || 'No description'}</p>
          <p class="text-lg font-bold text-yellow-400 mb-3">${quest.reward?.toLocaleString() || 0} $DSPOINC</p>
          <div class="flex gap-2">
            <button onclick="editQuest(${quest.quest_id})" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex-1">
              Edit
            </button>
            <button onclick="deleteQuest(${quest.quest_id})" 
                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm flex-1">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    // Create quest - REMOVED OLD VERSION, using enhanced version below
    
    // Show/hide cheese quest configuration based on quest type
    function toggleCheeseQuestConfig() {
      const questType = document.getElementById('newQuestType').value.trim();
      const cheeseConfig = document.getElementById('cheeseQuestConfig');
      
      console.log('üßÄ toggleCheeseQuestConfig called with:', questType);
      console.log('üßÄ cheeseConfig element:', cheeseConfig);
      
      if (questType === 'cheese_hunt') {
        cheeseConfig.style.display = 'block';
        addLog('üßÄ Cheese hunt configuration enabled');
        console.log('üßÄ Cheese config should now be visible');
      } else {
        cheeseConfig.style.display = 'none';
        console.log('üßÄ Cheese config hidden');
      }
    }

    // Edit quest (placeholder for future implementation)
    function editQuest(questId) {
      addLog(`üîÑ Edit quest functionality coming soon! Quest ID: ${questId}`);
      // TODO: Implement edit quest modal/form
    }

    // Delete quest
    async function deleteQuest(questId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      if (!confirm('Are you sure you want to delete this quest?')) {
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/create-quest.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'delete',
            quest_id: questId
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Quest deleted successfully!`);
          loadQuests();
        } else {
          addLog(`‚ùå Failed to delete quest: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Quest deletion error: ${error.message}`);
      }
    }

    // Store Management Functions - Duplicate removed, using the working version above

    async function createStoreItem() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const name = document.getElementById('newItemName').value.trim();
      const description = document.getElementById('newItemDescription').value.trim();
      const price = parseInt(document.getElementById('newItemPrice').value);
      const imageUrl = document.getElementById('newItemImageUrl').value.trim();

      if (!name || !description || !price || price <= 0) {
        addLog('‚ùå Please fill in all required fields: Name, Description, and Price (must be positive)');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/store-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'create_item',
            name: name,
            description: description,
            price: price,
            image_url: imageUrl,
            created_by: currentAdmin.discord_id
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Store item created successfully! ID: ${data.item_id}`);
          
          // Clear form
          document.getElementById('newItemName').value = '';
          document.getElementById('newItemDescription').value = '';
          document.getElementById('newItemPrice').value = '';
          document.getElementById('newItemImageUrl').value = '';
          
          // Reload store items
          loadStoreItems();
        } else {
          addLog(`‚ùå Failed to create store item: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Store item creation error: ${error.message}`);
      }
    }

    async function giveItemToUser() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const userId = document.getElementById('giveItemUserId').value.trim();
      const itemName = document.getElementById('giveItemName').value.trim();
      const quantity = parseInt(document.getElementById('giveItemQuantity').value);

      if (!userId || !itemName || !quantity || quantity <= 0) {
        addLog('‚ùå Please fill in all required fields: User ID, Item Name, and Quantity (must be positive)');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/store-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'give_item',
            user_id: userId,
            item_name: itemName,
            quantity: quantity,
            given_by: currentAdmin.discord_id
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Successfully gave ${quantity}x ${itemName} to user ${userId}`);
          
          // Clear form
          document.getElementById('giveItemUserId').value = '';
          document.getElementById('giveItemName').value = '';
          document.getElementById('giveItemQuantity').value = '1';
        } else {
          addLog(`‚ùå Failed to give item: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Give item error: ${error.message}`);
      }
    }

    async function viewUserInventory() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const userId = document.getElementById('viewInventoryUserId').value.trim();

      if (!userId) {
        addLog('‚ùå Please enter a user ID or username');
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/api/admin/store-management.php?action=get_user_inventory&user_id=${encodeURIComponent(userId)}`);
        const data = await response.json();
        
        if (data.success) {
          displayUserInventory(data.items, userId);
        } else {
          addLog(`‚ùå Failed to load user inventory: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå User inventory loading error: ${error.message}`);
      }
    }

    function displayUserInventory(items, userId) {
      const container = document.getElementById('userInventoryList');
      
      if (!items || items.length === 0) {
        container.innerHTML = `<div class="text-gray-300">No items found for user ${userId}.</div>`;
        return;
      }

      container.innerHTML = `
        <div class="bg-gray-700 p-4 rounded-lg">
          <h4 class="font-semibold text-white mb-3">Inventory for ${userId}</h4>
          <div class="space-y-2">
            ${items.map(item => `
              <div class="flex justify-between items-center bg-gray-600 p-2 rounded">
                <div>
                  <span class="font-semibold text-white">${item.item_name}</span>
                  <span class="text-gray-300 text-sm ml-2">x${item.quantity}</span>
                </div>
                <span class="text-gray-300 text-sm">${item.description || ''}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // Edit store item (placeholder for future implementation)
    function editStoreItem(itemId) {
      addLog(`üîÑ Edit store item functionality coming soon! Item ID: ${itemId}`);
      // TODO: Implement edit store item modal/form
    }

    // Delete store item functionality is already implemented above

    // Update invite code
    async function updateInviteCode() {
      const newCode = document.getElementById('newInviteCode').value.trim();
      if (!newCode) {
        addLog('‚ùå Please enter a valid invite code');
        return;
      }

      if (!currentAdmin) {
        addLog('‚ùå Please authenticate as admin first');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/update-discord-invite.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            admin_username: currentAdmin.username,
            new_invite_code: newCode
          })
        });

        const data = await response.json();
        
        if (data.success) {
          // Update the Discord config locally
          DISCORD_CONFIG.updateInviteCode(newCode);
          updateDisplay();
          addLog(`‚úÖ ${data.message}`);
          
          // Refresh all Discord links on the page
          DISCORD_CONFIG.updateAllLinks();
        } else {
          addLog(`‚ùå Failed to update invite code: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Update error: ${error.message}`);
      }
    }

    // Add log entry
    function addLog(message) {
      const log = document.getElementById('statusLog');
      const timestamp = new Date().toLocaleTimeString();
      log.innerHTML += `<div class="text-blue-400">[${timestamp}] ${message}</div>`;
      log.scrollTop = log.scrollHeight;
    }

    // Check for existing Discord authentication on page load
    async function checkDiscordAuth() {
      try {
        // Check if user is already authenticated via Discord
        const res = await fetch(API_BASE_URL + '/api/user/profile.php', { 
          credentials: 'include',
          headers: { 'Accept': 'application/json' }
        });

        if (res.ok) {
          const user = await res.json();
          console.log('üîê User profile loaded:', user);
          
          // Check if user has admin/moderator roles
          if (user.roles && (
              user.roles.includes("Moderator") || 
              user.roles.includes("Admin") || 
              user.roles.includes("super_admin") ||
              user.roles.includes("Founder") ||
              user.roles.includes("Bot Master") ||
              user.discord_id === "328601656659017732" // narrrf's Discord ID
          )) {
            // Auto-login as Discord moderator
            currentAdmin = {
              username: user.discord_name || 'Discord Moderator',
              discord_id: user.discord_id,
              role: 'moderator',
              auth_type: 'discord'
            };
            
            // Show admin content after authentication
            console.log('üîê Auto-authentication successful, calling showAdminContent()');
            showAdminContent();
            loadDashboardData();
            
            addLog(`‚úÖ Auto-authenticated as Discord moderator: ${user.discord_name}`);
            console.log('üîê Auto-authentication complete');
            return true;
          } else {
            console.log('üîê User authenticated but no admin roles found');
            addLog(`‚ÑπÔ∏è User ${user.discord_name} authenticated but no admin access`);
          }
        } else {
          console.log('üîê Profile request failed:', res.status, res.statusText);
        }
      } catch (error) {
        console.log('No existing Discord session found');
      }
      return false;
    }

    // Discord Authentication for Moderators
    async function authenticateDiscord() {
      const discordAuthStatus = document.getElementById('discordAuthStatus');
      discordAuthStatus.textContent = 'Redirecting to Discord OAuth...';
      
      // Redirect to Discord OAuth URL as specified by user
      const oauthUrl = "https://discord.com/oauth2/authorize?client_id=1357927342265204858&response_type=code&redirect_uri=https%3A%2F%2Fnarrrfs.world%2Fapi%2Fauth%2Fcallback.php&scope=guilds+identify+guilds.members.read";
      
      // Store the intended destination for after OAuth redirect
      localStorage.setItem('adminRedirect', 'true');
      
      // Redirect to Discord OAuth
      window.location.href = oauthUrl;
    }

    // === DATABASE FUNCTIONS ===
    
    // Show database unlock modal
    function showDatabaseUnlock() {
      const modal = document.getElementById('unlockModal');
      modal.classList.remove('hidden');
      document.getElementById('databasePassword').focus();
    }
    
    // Hide database unlock modal
    function hideDatabaseUnlock() {
      const modal = document.getElementById('unlockModal');
      modal.classList.add('hidden');
      document.getElementById('databasePassword').value = '';
      document.getElementById('unlockStatus').innerHTML = '';
    }
    
    // Unlock database access
    async function unlockDatabase() {
      const password = document.getElementById('databasePassword').value;
      const statusDiv = document.getElementById('unlockStatus');
      
      if (!password) {
        statusDiv.innerHTML = '<div class="text-red-600">‚ùå Please enter a password</div>';
        return;
      }
      
      // üîß CRITICAL FIX: Better authentication checking
      console.log('üîç Current admin state:', currentAdmin); // Debug logging
      
      if (!currentAdmin) {
        statusDiv.innerHTML = '<div class="text-red-600">‚ùå Authentication required - Please log in first</div>';
        addLog('‚ùå Database unlock failed: Authentication required');
        return;
      }
      
      if (!currentAdmin.token) {
        statusDiv.innerHTML = '<div class="text-red-600">‚ùå Admin token missing - Please re-authenticate</div>';
        addLog('‚ùå Database unlock failed: Admin token missing');
        return;
      }
      
      try {
        // Call secure server-side validation endpoint
        const response = await fetch(API_BASE_URL + '/api/admin/validate-db-password.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + (currentAdmin ? currentAdmin.token : '')
          },
          body: JSON.stringify({ password: password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Show database options in main navigation
          document.getElementById('databaseOptions').style.display = 'block';
          document.getElementById('databaseQuickActions').style.display = 'block';
          document.getElementById('databaseUnlockSection').style.display = 'none';
          
          // Show database options in dashboard
          document.getElementById('dashboardDatabaseOptions').style.display = 'block';
          document.getElementById('dashboardDatabaseUnlock').style.display = 'none';
          
          // Show database options in header
          document.getElementById('headerDatabaseOptions').style.display = 'block';
          document.getElementById('headerDatabaseUnlock').style.display = 'none';
          
          // Show database options in games2 tab
          document.getElementById('games2DatabaseOptions').style.display = 'block';
          document.getElementById('games2DatabaseUnlock').style.display = 'none';
          
          statusDiv.innerHTML = '<div class="text-green-600">‚úÖ Database access unlocked!</div>';
          addLog('üîì Database access unlocked successfully');
          
          // Hide modal after 1 second
          setTimeout(() => {
            hideDatabaseUnlock();
          }, 1000);
        } else {
          statusDiv.innerHTML = '<div class="text-red-600">‚ùå ' + (data.error || 'Incorrect password') + '</div>';
          addLog('‚ùå Database unlock failed: ' + (data.error || 'Incorrect password'));
        }
      } catch (error) {
        statusDiv.innerHTML = '<div class="text-red-600">‚ùå Validation error: ' + error.message + '</div>';
        addLog('‚ùå Database unlock error: ' + error.message);
      }
    }

    // === MISSING DATABASE FUNCTIONS ===
    
    // Download database
    async function downloadDatabase() {
      try {
        addLog('üì• Initiating LIVE production database download...');
        addLog('üéØ Target: /var/www/html/db/narrrf_world.sqlite (Render production)');
        
        // Call server-side download endpoint
        const response = await fetch(API_BASE_URL + '/api/admin/download-database.php', {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer ' + (currentAdmin ? currentAdmin.token : '')
          }
        });
        
        if (response.ok) {
          // Check if response is actually a file (not JSON error)
          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
            // This is an error response, not a file
            const errorData = await response.json();
            addLog('‚ùå Database download failed: ' + (errorData.error || 'Server error'));
            return;
          }
          
          // Create blob and download
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `narrrfs_world_LIVE_PRODUCTION_${new Date().toISOString().split('T')[0]}.sqlite`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
          
          addLog('‚úÖ LIVE production database downloaded successfully');
          addLog(`üìÅ File size: ${(blob.size / 1024 / 1024).toFixed(2)} MB`);
          addLog(`üéØ Source: /var/www/html/db/narrrf_world.sqlite (Render production)`);
        } else {
          // Handle error response - try to parse as JSON, but handle non-JSON gracefully
          let errorMessage = 'Server error';
          try {
            const errorData = await response.json();
            errorMessage = errorData.error || 'Server error';
          } catch (jsonError) {
            // If response is not JSON, get the text content
            try {
              const errorText = await response.text();
              errorMessage = errorText || `HTTP ${response.status}: ${response.statusText}`;
            } catch (textError) {
              // If we can't read the response body at all, use status info
              errorMessage = `HTTP ${response.status}: ${response.statusText}`;
            }
          }
          addLog('‚ùå LIVE production database download failed: ' + errorMessage);
        }
      } catch (error) {
        addLog('‚ùå LIVE production database download error: ' + error.message);
        console.error('Download error details:', error);
      }
    }
    
    // Trigger database backup
    async function triggerBackup() {
      try {
        addLog('üóÑÔ∏è Initiating LIVE production database backup...');
        addLog('üéØ Source: /var/www/html/db/narrrf_world.sqlite (Render production)');
        addLog('üéØ Target: /data/narrrf_world.sqlite (Production backup)');
        
        // Call server-side backup endpoint
        const response = await fetch(API_BASE_URL + '/api/admin/backup-database.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + (currentAdmin ? currentAdmin.token : '')
          }
        });
        
        let data;
        try {
          data = await response.json();
        } catch (jsonError) {
          addLog('‚ùå Backup response parsing failed: ' + jsonError.message);
          addLog('üîç Response status: ' + response.status + ' ' + response.statusText);
          try {
            const responseText = await response.text();
            addLog('üîç Response body: ' + responseText);
          } catch (textError) {
            addLog('üîç Could not read response body');
          }
          return;
        }
        
        if (data.success) {
          addLog('‚úÖ LIVE production database backup completed successfully');
          addLog(`üìÅ Backup saved to: ${data.target_path || '/data/narrrf_world.sqlite'}`);
          addLog(`üîß Backup method used: ${data.backup_method || 'Unknown'}`);
          addLog(`üìä Source size: ${data.source_size_formatted || data.source_size || 'Unknown'}`);
          addLog(`üìä Target size: ${data.target_size_formatted || data.target_size || 'Unknown'}`);
          
          // Show verification details if available
          if (data.backup_verification) {
            addLog('üîç Backup Verification:');
            addLog(`  üìÅ Source exists: ${data.backup_verification.source_exists ? '‚úÖ' : '‚ùå'}`);
            addLog(`  üìñ Source readable: ${data.backup_verification.source_readable ? '‚úÖ' : '‚ùå'}`);
            addLog(`  üìÅ Target exists: ${data.backup_verification.target_exists ? '‚úÖ' : '‚ùå'}`);
            addLog(`  üìñ Target readable: ${data.backup_verification.target_readable ? '‚úÖ' : '‚ùå'}`);
            addLog(`  üìä Size match: ${data.backup_verification.size_match ? '‚úÖ' : '‚ùå'}`);
          }
          
          addLog(`üéØ Production backup: LIVE database backed up to /data/`);
        } else {
          addLog('‚ùå LIVE production database backup failed: ' + (data.error || 'Server error'));
          if (data.source_path) addLog(`üìÅ Source: ${data.source_path}`);
          if (data.target_path) addLog(`üìÅ Target: ${data.target_path}`);
          if (data.source_size) addLog(`üìä Source size: ${data.source_size}`);
        }
      } catch (error) {
        addLog('‚ùå Database backup error: ' + error.message);
      }
    }
    
    // Test backup functionality (for debugging)
    async function testBackup() {
      try {
        addLog('üß™ Testing backup functionality...');
        
        // Test the backup endpoint with test parameter
        const response = await fetch(API_BASE_URL + '/api/admin/backup-database.php?test=true', {
          method: 'GET'
        });
        
        addLog('üîç Backup test response status: ' + response.status + ' ' + response.statusText);
        addLog('üîç Backup test response headers: ' + JSON.stringify([...response.headers.entries()]));
        
        let data;
        try {
          data = await response.json();
        } catch (jsonError) {
          addLog('‚ùå Backup test response parsing failed: ' + jsonError.message);
          try {
            const responseText = await response.text();
            addLog('üîç Backup test response body: ' + responseText);
          } catch (textError) {
            addLog('üîç Could not read backup test response body');
          }
          return;
        }
        
        if (data.test) {
          addLog('üîç Backup Test Results:');
          addLog(`üìÅ Source path: ${data.source_path}`);
          addLog(`üìÅ Source exists: ${data.source_exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìñ Source readable: ${data.source_readable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìä Source size: ${data.source_size}`);
          addLog(`üè† Environment: ${data.production_mode || 'Unknown'}`);
          addLog(`üìÅ Target dir exists: ${data.target_dir_exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`‚úèÔ∏è Target dir writable: ${data.target_dir_writable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üë§ Current user: ${data.current_user}`);
          addLog(`üêò PHP user: ${data.php_user}`);
          addLog(`üåê Web server user: ${data.web_server_user}`);
          
          // Critical verification
          if (data.source_exists && data.source_readable) {
            addLog('‚úÖ CRITICAL: Database path verification successful');
            addLog(`üìä Database size: ${data.source_size} - This should match your live database size`);
          } else {
            addLog('‚ùå CRITICAL: Database path verification FAILED');
            addLog('üö® This indicates a serious configuration issue!');
          }
        } else {
          addLog('‚ùå Test failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Test error: ' + error.message);
      }
    }
    
    // Test copy operation to /data/ directory (for debugging backup issues)
    async function testCopyOperation() {
      try {
        addLog('üìã Testing copy operation to /data/ directory...');
        
        // Test the backup endpoint with test_copy parameter
        const response = await fetch(API_BASE_URL + '/api/admin/backup-database.php?test_copy=true', {
          method: 'GET'
        });
        
        addLog('üîç Copy test response status: ' + response.status + ' ' + response.statusText);
        
        let data;
        try {
          data = await response.json();
        } catch (jsonError) {
          addLog('‚ùå Copy test response parsing failed: ' + jsonError.message);
          try {
            const responseText = await response.text();
            addLog('üîç Response body: ' + responseText);
          } catch (textError) {
            addLog('üîç Could not read response body');
          }
          return;
        }
        
        if (data.test_copy_mode) {
          addLog('üìã Copy Test Results:');
          addLog(`üìÅ Source path: ${data.source_path}`);
          addLog(`üìä Source size: ${data.source_size_formatted || data.source_size}`);
          addLog(`üìÅ Target path: ${data.target_path}`);
          addLog(`‚úÖ Copy success: ${data.copy_success ? '‚úÖ' : '‚ùå'}`);
          
          if (!data.copy_success) {
            addLog(`‚ùå Copy error: ${data.copy_error}`);
          } else {
            addLog(`üìä Target size: ${data.target_size_formatted || data.target_size}`);
            addLog(`üìä Size match: ${data.size_match ? '‚úÖ' : '‚ùå'}`);
          }
          
          addLog(`üìÅ /data directory exists: ${data.data_dir_status.exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`‚úèÔ∏è /data directory writable: ${data.data_dir_status.writable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üîê /data directory permissions: ${data.data_dir_status.permissions}`);
          
          // Critical verification
          if (data.copy_success && data.size_match) {
            addLog('‚úÖ CRITICAL: Copy operation verification successful');
            addLog('üéØ Database can be successfully copied to /data/ directory');
          } else {
            addLog('‚ùå CRITICAL: Copy operation verification FAILED');
            addLog('üö® This explains why backup to /data/ is not working!');
          }
        } else {
          addLog('‚ùå Copy test failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Copy test error: ' + error.message);
      }
    }
    
    // Test backup dry run (test backup process without creating files)
    async function testBackupDryRun() {
      try {
        addLog('üîç Testing backup dry run...');
        
        // Test the backup endpoint with dry_run parameter
        const response = await fetch(API_BASE_URL + '/api/admin/backup-database.php?dry_run=true', {
          method: 'GET'
        });
        
        addLog('üîç Dry run response status: ' + response.status + ' ' + response.statusText);
        
        let data;
        try {
          data = await response.json();
        } catch (jsonError) {
          addLog('‚ùå Dry run response parsing failed: ' + jsonError.message);
          try {
            const responseText = await response.text();
            addLog('üîç Response body: ' + responseText);
          } catch (textError) {
            addLog('üîç Could not read response body');
          }
          return;
        }
        
        if (data.dry_run_mode) {
          addLog('üîç Backup Dry Run Results:');
          addLog(`üìÅ Source path: ${data.source_path}`);
          addLog(`üìä Source size: ${data.source_size_formatted || data.source_size}`);
          addLog(`üìÅ Target path: ${data.target_path}`);
          addLog(`üìÅ Production backup path: ${data.production_backup_path}`);
          addLog(`üìÅ Backup dir writable: ${data.backup_dir_writable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìÅ /data directory exists: ${data.data_dir_exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`‚úèÔ∏è /data directory writable: ${data.data_dir_writable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìä Estimated backup size: ${data.estimated_backup_size_formatted || data.estimated_backup_size}`);
          
          addLog('üîß Available backup methods:');
          addLog(`  üìã File copy: ${data.backup_methods_available.file_copy ? '‚úÖ' : '‚ùå'}`);
          addLog(`  üóÑÔ∏è SQLite backup: ${data.backup_methods_available.sqlite_backup ? '‚úÖ' : '‚ùå'}`);
          addLog(`  üì§ SQLite dump: ${data.backup_methods_available.sqlite_dump ? '‚úÖ' : '‚ùå'}`);
          
          // Critical verification
          if (data.data_dir_exists && data.data_dir_writable) {
            addLog('‚úÖ CRITICAL: /data directory is accessible and writable');
            addLog('üéØ Production backup should work correctly');
          } else {
            addLog('‚ùå CRITICAL: /data directory is NOT accessible or writable');
            addLog('üö® This explains why production backup is failing!');
          }
        } else {
          addLog('‚ùå Dry run failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Dry run error: ' + error.message);
      }
    }
    
    // Test shell command execution (test the actual cp command)
    async function testShellCommand() {
      try {
        addLog('üêö Testing shell command execution...');
        
        // Test the shell command endpoint
        const response = await fetch(API_BASE_URL + '/api/admin/test-shell-command.php', {
          method: 'GET'
        });
        
        addLog('üîç Shell command test response status: ' + response.status + ' ' + response.statusText);
        
        let data;
        try {
          data = await response.json();
        } catch (jsonError) {
          addLog('‚ùå Shell command test response parsing failed: ' + jsonError.message);
          try {
            const responseText = await response.text();
            addLog('üîç Response body: ' + responseText);
          } catch (textError) {
            addLog('üîç Could not read response body');
          }
          return;
        }
        
        if (data.shell_test_mode) {
          addLog('üêö Shell Command Test Results:');
          addLog(`üîß Shell command: ${data.shell_command}`);
          addLog(`üìÅ Source path: ${data.source_path}`);
          addLog(`üìä Source size: ${data.source_size_formatted || data.source_size}`);
          addLog(`üìÅ Target path: ${data.target_path}`);
          addLog(`‚úÖ Shell command success: ${data.shell_success ? '‚úÖ' : '‚ùå'}`);
          addLog(`üî¢ Return code: ${data.return_code}`);
          
          if (!data.shell_success) {
            addLog(`‚ùå Shell command error: ${data.shell_error}`);
            if (data.shell_output && data.shell_output.length > 0) {
              addLog(`üì§ Shell output: ${data.shell_output.join(' ')}`);
            }
          } else {
            addLog(`üìä Target size: ${data.target_size_formatted || data.target_size}`);
            addLog(`üìä Size match: ${data.size_match ? '‚úÖ' : '‚ùå'}`);
          }
          
          addLog(`üìÅ /data directory exists: ${data.data_dir_status.exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`‚úèÔ∏è /data directory writable: ${data.data_dir_status.writable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üîê /data directory permissions: ${data.data_dir_status.permissions}`);
          
          // Critical verification
          if (data.shell_success && data.size_match) {
            addLog('‚úÖ CRITICAL: Shell command execution successful');
            addLog('üéØ The cp command works correctly and can copy to /data/');
          } else {
            addLog('‚ùå CRITICAL: Shell command execution FAILED');
            addLog('üö® This explains why the backup cp command is not working!');
          }
        } else {
          addLog('‚ùå Shell command test failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Shell command test error: ' + error.message);
      }
    }
    
    // Test database path detection (for debugging)
    async function testDatabasePath() {
      try {
        addLog('üß™ Testing database path detection...');
        
        const response = await fetch(API_BASE_URL + '/api/admin/test-database-path.php', {
          method: 'GET'
        });
        
        const data = await response.json();
        
        if (data.success) {
          addLog('üîç Database Path Test Results:');
          addLog(`üìÅ Database path: ${data.database_path}`);
          addLog(`üìÅ File exists: ${data.file_exists ? '‚úÖ' : '‚ùå'}`);
          addLog(`üìä File size: ${data.file_size}`);
          addLog(`üìñ Is readable: ${data.is_readable ? '‚úÖ' : '‚ùå'}`);
          addLog(`üè† Environment: ${data.environment}`);
          addLog(`üíª PHP OS: ${data.php_os}`);
          addLog(`üìÅ Document root: ${data.document_root}`);
          addLog(`üë§ Current user: ${data.current_user}`);
          
          // Critical verification
          if (data.file_exists && data.is_readable) {
            addLog('‚úÖ CRITICAL: Database path detection successful');
            addLog(`üìä Database size: ${data.file_size} - This should match your live database size`);
          } else {
            addLog('‚ùå CRITICAL: Database path detection FAILED');
            addLog('üö® This indicates a serious configuration issue!');
          }
        } else {
          addLog('‚ùå Database path test failed: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Database path test error: ' + error.message);
      }
    }

    // Debug database paths (detailed debugging)
    async function debugDatabasePaths() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üêõ Debugging database paths...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/debug-database-paths.php');
        const text = await response.text();
        
        addLog('üêõ Database path debug output:');
        addLog(text);
      } catch (error) {
        addLog(`‚ùå Database path debug error: ${error.message}`);
      }
    }
    
    // Show upload modal
    function showUploadModal() {
      const modal = document.getElementById('uploadModal');
      modal.classList.remove('hidden');
      document.getElementById('dbFile').focus();
    }
    
    // Hide upload modal
    function hideUploadModal() {
      const modal = document.getElementById('uploadModal');
      modal.classList.add('hidden');
      document.getElementById('dbFile').value = '';
      document.getElementById('uploadStatus').innerHTML = '';
    }
    
    // Upload database
    async function uploadDatabase() {
      const fileInput = document.getElementById('dbFile');
      const statusDiv = document.getElementById('uploadStatus');
      
      if (!fileInput.files[0]) {
        statusDiv.innerHTML = '<div class="text-red-600">‚ùå Please select a database file</div>';
        return;
      }
      
      const formData = new FormData();
      formData.append('database', fileInput.files[0]);
      
      try {
        statusDiv.innerHTML = '<div class="text-blue-600">‚è≥ Uploading database...</div>';
        
        const response = await fetch(API_BASE_URL + '/api/admin/upload-database.php', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + (currentAdmin ? currentAdmin.token : '')
          },
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          statusDiv.innerHTML = '<div class="text-green-600">‚úÖ Database uploaded successfully</div>';
          addLog('‚úÖ Database uploaded successfully');
          
          // Hide modal after 2 seconds
          setTimeout(() => {
            hideUploadModal();
          }, 2000);
        } else {
          statusDiv.innerHTML = '<div class="text-red-600">‚ùå ' + (data.error || 'Upload failed') + '</div>';
          addLog('‚ùå Database upload failed: ' + (data.error || 'Upload failed'));
        }
      } catch (error) {
        statusDiv.innerHTML = '<div class="text-red-600">‚ùå Upload error: ' + error.message + '</div>';
        addLog('‚ùå Database upload error: ' + error.message);
      }
    }
    
    // Show database viewer
    function showDatabaseViewer() {
      const modal = document.getElementById('viewerModal');
      modal.classList.remove('hidden');
      loadDatabaseViewerContent();
    }
    
    // Hide database viewer
    function hideDatabaseViewer() {
      const modal = document.getElementById('viewerModal');
      modal.classList.add('hidden');
      document.getElementById('viewerContent').innerHTML = '';
    }
    
    // Load database viewer content
    async function loadDatabaseViewerContent() {
      const contentDiv = document.getElementById('viewerContent');
      contentDiv.innerHTML = '<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div><p class="mt-2 text-gray-600">Loading database structure...</p></div>';
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-database-structure.php', {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer ' + (currentAdmin ? currentAdmin.token : '')
          }
        });
        
        const data = await response.json();
        
        if (data.success) {
          let html = '<div class="space-y-4">';
          
          // Display database tables
          if (data.tables && data.tables.length > 0) {
            html += '<h4 class="text-lg font-semibold text-gray-800 mb-3">üìä Database Tables</h4>';
            data.tables.forEach(table => {
              html += `
                <div class="bg-gray-100 p-4 rounded">
                  <h5 class="font-semibold text-gray-800 mb-2">${table.name}</h5>
                  <p class="text-sm text-gray-600 mb-2">Rows: ${table.row_count || 'Unknown'}</p>
                  ${table.columns ? `
                    <div class="text-xs text-gray-500">
                      <strong>Columns:</strong> ${table.columns.join(', ')}
                    </div>
                  ` : ''}
                </div>
              `;
            });
          }
          
          // Display database info
          if (data.info) {
            html += '<h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">‚ÑπÔ∏è Database Information</h4>';
            html += `
              <div class="bg-gray-100 p-4 rounded">
                <p class="text-sm text-gray-600"><strong>Size:</strong> ${data.info.size || 'Unknown'}</p>
                <p class="text-sm text-gray-600"><strong>Last Modified:</strong> ${data.info.last_modified || 'Unknown'}</p>
                <p class="text-sm text-gray-600"><strong>Version:</strong> ${data.info.version || 'Unknown'}</p>
              </div>
            `;
          }
          
          html += '</div>';
          contentDiv.innerHTML = html;
        } else {
          contentDiv.innerHTML = '<div class="text-red-600 text-center py-8">‚ùå Failed to load database structure: ' + (data.error || 'Server error') + '</div>';
        }
      } catch (error) {
        contentDiv.innerHTML = '<div class="text-red-600 text-center py-8">‚ùå Error loading database structure: ' + error.message + '</div>';
      }
    }

    function getStatusBorderColor(status) {
      switch (status) {
        case 'approved': return 'border-green-500';
        case 'rejected': return 'border-red-500';
        default: return 'border-yellow-500';
      }
    }

    function getStatusBadgeColor(status) {
      switch (status) {
        case 'approved': return 'bg-green-600 text-white';
        case 'rejected': return 'bg-red-600 text-white';
        default: return 'bg-yellow-600 text-white';
      }
    }

    function displayEnhancedQuestClaims(claims) {
      const container = document.getElementById('questClaimsList');
      
      if (!claims || claims.length === 0) {
        container.innerHTML = `<div class="text-gray-300">No quest claims found.</div>`;
        return;
      }

      container.innerHTML = claims.map(claim => `
        <div class="bg-gray-700 p-4 rounded-lg border-l-4 ${getStatusBorderColor(claim.status)}">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h4 class="font-semibold text-white">${claim.quest_title || `Quest #${claim.quest_id}`}</h4>
              <p class="text-gray-300 text-sm">Claim ID: ${claim.claim_id}</p>
            </div>
            <div class="text-right">
              <span class="px-2 py-1 rounded text-xs font-semibold ${getStatusBadgeColor(claim.status)}">
                ${claim.status || 'pending'}
              </span>
              <div class="mt-1">
                <span class="px-2 py-1 rounded text-xs font-semibold ${getRiskBadgeColor(claim.risk_assessment.level)}">
                  ${claim.risk_assessment.level} RISK
                </span>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
            <div>
              <p class="text-sm text-gray-300"><strong>User:</strong> ${claim.username || 'Unknown'} (${claim.user_id})</p>
              <p class="text-sm text-gray-300"><strong>Reward:</strong> ${claim.quest_reward || 0} $DSPOINC</p>
              <p class="text-sm text-gray-300"><strong>Claimed:</strong> ${formatDate(claim.claimed_at)}</p>
            </div>
            <div>
              <p class="text-sm text-gray-300"><strong>Role ID:</strong> ${claim.quest_role_id || 'None'}</p>
              ${claim.reviewed_at ? `<p class="text-sm text-gray-300"><strong>Reviewed:</strong> ${formatDate(claim.reviewed_at)}</p>` : ''}
              ${claim.proof ? `<p class="text-sm text-gray-300"><strong>Proof:</strong> <a href="${claim.proof}" target="_blank" class="text-blue-400 hover:underline">View Proof</a></p>` : ''}
            </div>
          </div>

          <!-- User Statistics -->
          <div class="bg-gray-800 p-3 rounded mb-3">
            <h5 class="font-semibold text-blue-400 mb-2">üë§ User Activity History</h5>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
              <div>
                <span class="text-gray-400">üßÄ Cheese Clicks:</span>
                <span class="text-white font-semibold">${claim.user_stats.cheese_clicks.total}</span>
              </div>
              <div>
                <span class="text-gray-400">üìä Quest Claims:</span>
                <span class="text-white font-semibold">${claim.user_stats.quests.total_claims}</span>
              </div>
              <div>
                <span class="text-gray-400">‚úÖ Approved:</span>
                <span class="text-green-400 font-semibold">${claim.user_stats.quests.approved}</span>
              </div>
              <div>
                <span class="text-gray-400">‚ùå Rejected:</span>
                <span class="text-red-400 font-semibold">${claim.user_stats.quests.rejected}</span>
              </div>
              <div>
                <span class="text-gray-400">üí∞ Balance:</span>
                <span class="text-yellow-400 font-semibold">${claim.user_stats.balance.toLocaleString()}</span>
              </div>
              <div>
                <span class="text-gray-400">üìà Success Rate:</span>
                <span class="text-blue-400 font-semibold">${claim.user_stats.quests.completion_rate}%</span>
              </div>
              <div>
                <span class="text-gray-400">üïí Last Cheese:</span>
                <span class="text-white font-semibold">${claim.user_stats.cheese_clicks.last_click ? formatDate(claim.user_stats.cheese_clicks.last_click) : 'Never'}</span>
              </div>
              <div>
                <span class="text-gray-400">üéØ Recent Activity:</span>
                <span class="text-white font-semibold">${claim.user_stats.cheese_clicks.clicks_24h} (24h)</span>
              </div>
            </div>
            
            <!-- Risk Factors -->
            ${claim.risk_assessment.factors.length > 0 ? `
              <div class="mt-2">
                <span class="text-red-400 text-xs">‚ö†Ô∏è Risk Factors:</span>
                <div class="text-xs text-gray-300 mt-1">
                  ${claim.risk_assessment.factors.map(factor => `‚Ä¢ ${factor}`).join('<br>')}
                </div>
              </div>
            ` : ''}
          </div>
          
          <!-- Quest-Specific Statistics (for cheese hunt quests) -->
          ${claim.user_stats.quest_specific_clicks ? `
            <div class="bg-orange-800 bg-opacity-30 p-3 rounded mb-3 border border-orange-600">
              <h5 class="font-semibold text-orange-400 mb-2">üßÄ Quest-Specific Cheese Hunt Data</h5>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs">
                <div>
                  <span class="text-orange-300">üéØ Quest Clicks:</span>
                  <span class="text-white font-semibold">${claim.user_stats.quest_specific_clicks.quest_clicks}</span>
                </div>
                <div>
                  <span class="text-orange-300">ü•ö Unique Eggs:</span>
                  <span class="text-white font-semibold">${claim.user_stats.quest_specific_clicks.unique_eggs_clicked}/3</span>
                </div>
                <div>
                  <span class="text-orange-300">üïí First Click:</span>
                  <span class="text-white font-semibold">${claim.user_stats.quest_specific_clicks.first_quest_click ? formatDate(claim.user_stats.quest_specific_clicks.first_quest_click) : 'None'}</span>
                </div>
                <div class="col-span-2 md:col-span-3">
                  <span class="text-orange-300">üßÄ Eggs Clicked:</span>
                  <span class="text-white font-semibold">${claim.user_stats.quest_specific_clicks.eggs_clicked.length > 0 ? claim.user_stats.quest_specific_clicks.eggs_clicked.join(', ') : 'None'}</span>
                </div>
              </div>
            </div>
          ` : ''}
          </div>
          
          ${claim.status === 'pending' ? `
            <div class="flex gap-2">
              <button onclick="approveQuestClaim(${claim.claim_id})" 
                      class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                ‚úÖ Approve & Pay
              </button>
              <button onclick="rejectQuestClaim(${claim.claim_id})" 
                      class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                ‚ùå Reject
              </button>
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    function getRiskBadgeColor(riskLevel) {
      switch (riskLevel) {
        case 'HIGH': return 'bg-red-600 text-white';
        case 'MEDIUM': return 'bg-yellow-600 text-white';
        case 'LOW': return 'bg-green-600 text-white';
        default: return 'bg-gray-600 text-white';
      }
    }

    async function loadUserQuestHistory() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const userId = document.getElementById('questHistoryUserId').value.trim();
      if (!userId) {
        addLog('‚ùå Please enter a user ID or username');
        return;
      }

      addLog(`üîÑ Loading quest history for user: ${userId}...`);

      try {
        const response = await fetch(`/api/admin/get-user-quest-history.php?user_id=${encodeURIComponent(userId)}`);
        const data = await response.json();
        
        if (data.success) {
          displayUserQuestHistory(data);
          addLog(`‚úÖ Loaded quest history for ${data.user.username || userId}`);
        } else {
          addLog(`‚ùå Failed to load quest history: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Quest history loading error: ${error.message}`);
      }
    }

    function displayUserQuestHistory(data) {
      const container = document.getElementById('userQuestHistory');
      
      container.innerHTML = `
        <div class="bg-gray-700 p-4 rounded-lg">
          <!-- User Info -->
          <div class="mb-4">
            <h4 class="text-lg font-semibold text-white mb-2">üë§ ${data.user.username || 'Unknown User'} (${data.user.discord_id})</h4>
            <p class="text-sm text-gray-300">User ID: ${data.user.discord_id}</p>
            <p class="text-sm text-gray-300">Current Balance: <span class="text-yellow-400 font-semibold">${data.balance.toLocaleString()} $DSPOINC</span></p>
          </div>

          <!-- Statistics Overview -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <!-- Cheese Click Stats -->
            <div class="bg-gray-800 p-3 rounded">
              <h5 class="font-semibold text-blue-400 mb-2">üßÄ Cheese Click Activity</h5>
              <div class="space-y-1 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-400">Total Clicks:</span>
                  <span class="text-white font-semibold">${data.cheese_stats.total_clicks}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Last 24h:</span>
                  <span class="text-green-400 font-semibold">${data.cheese_stats.clicks_24h}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Last 7 days:</span>
                  <span class="text-blue-400 font-semibold">${data.cheese_stats.clicks_7d}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Last 30 days:</span>
                  <span class="text-purple-400 font-semibold">${data.cheese_stats.clicks_30d}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">First Click:</span>
                  <span class="text-white font-semibold">${data.cheese_stats.first_click ? formatDate(data.cheese_stats.first_click) : 'Never'}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Last Click:</span>
                  <span class="text-white font-semibold">${data.cheese_stats.last_click ? formatDate(data.cheese_stats.last_click) : 'Never'}</span>
                </div>
              </div>
            </div>

            <!-- Egg Type Breakdown -->
            <div class="bg-gray-800 p-3 rounded">
              <h5 class="font-semibold text-yellow-400 mb-2">ü•ö Egg Type Breakdown</h5>
              <div class="space-y-1 text-sm">
                ${data.cheese_stats.clicks_by_egg && data.cheese_stats.clicks_by_egg.length > 0 ? 
                  data.cheese_stats.clicks_by_egg.map(egg => `
                    <div class="flex justify-between">
                      <span class="text-gray-400">${getEggDisplayName(egg.egg_id)}:</span>
                      <span class="text-white font-semibold">${egg.click_count}</span>
                    </div>
                  `).join('') : 
                  '<div class="text-gray-500 italic">No egg clicks recorded</div>'
                }
              </div>
            </div>

            <!-- Quest Stats -->
            <div class="bg-gray-800 p-3 rounded">
              <h5 class="font-semibold text-green-400 mb-2">üèÜ Quest Activity</h5>
              <div class="space-y-1 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-400">Total Claims:</span>
                  <span class="text-white font-semibold">${data.quest_stats.total_claims}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Approved:</span>
                  <span class="text-green-400 font-semibold">${data.quest_stats.approved_claims}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Rejected:</span>
                  <span class="text-red-400 font-semibold">${data.quest_stats.rejected_claims}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Pending:</span>
                  <span class="text-yellow-400 font-semibold">${data.quest_stats.pending_claims}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Success Rate:</span>
                  <span class="text-blue-400 font-semibold">${data.quest_stats.completion_rate}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Total Rewards:</span>
                  <span class="text-yellow-400 font-semibold">${data.quest_stats.total_rewards_earned.toLocaleString()}</span>
                </div>
              </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-gray-800 p-3 rounded">
              <h5 class="font-semibold text-purple-400 mb-2">üìä Recent Activity (30d)</h5>
              <div class="space-y-1 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-400">Quest Claims:</span>
                  <span class="text-white font-semibold">${data.quest_stats.recent_activity.claims_30d}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Approved:</span>
                  <span class="text-green-400 font-semibold">${data.quest_stats.recent_activity.approved_30d}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Rejected:</span>
                  <span class="text-red-400 font-semibold">${data.quest_stats.recent_activity.rejected_30d}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-400">Pending:</span>
                  <span class="text-yellow-400 font-semibold">${data.quest_stats.recent_activity.pending_30d}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Quest Claims History -->
          <div class="mb-4">
            <h5 class="font-semibold text-white mb-2">üìã Quest Claims History</h5>
            <div class="space-y-2 max-h-64 overflow-y-auto">
              ${data.quest_claims.length > 0 ? data.quest_claims.map(claim => `
                <div class="bg-gray-800 p-3 rounded border-l-4 ${getStatusBorderColor(claim.status)}">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="text-sm font-semibold text-white">${claim.quest_title || `Quest #${claim.quest_id}`}</p>
                      <p class="text-xs text-gray-400">${formatDate(claim.claimed_at)} - ${claim.quest_type || 'Unknown Type'}</p>
                    </div>
                    <div class="text-right">
                      <span class="px-2 py-1 rounded text-xs font-semibold ${getStatusBadgeColor(claim.status)}">
                        ${claim.status}
                      </span>
                      <p class="text-xs text-gray-400 mt-1">${claim.quest_reward || 0} $DSPOINC</p>
                    </div>
                  </div>
                </div>
              `).join('') : '<p class="text-gray-400 text-sm">No quest claims found.</p>'}
            </div>
          </div>

          <!-- Cheese Click Breakdown -->
          ${data.cheese_stats.clicks_by_egg.length > 0 ? `
            <div class="mb-4">
              <h5 class="font-semibold text-white mb-2">üßÄ Cheese Click Breakdown</h5>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                ${data.cheese_stats.clicks_by_egg.map(egg => `
                  <div class="bg-gray-800 p-2 rounded text-center">
                    <p class="text-xs text-gray-400">${getEggDisplayName(egg.egg_id)}</p>
                    <p class="text-sm font-semibold text-white">${egg.click_count}</p>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}

          <!-- Recent Cheese Clicks -->
          ${data.cheese_stats.recent_clicks.length > 0 ? `
            <div class="mb-4">
              <h5 class="font-semibold text-white mb-2">üïí Recent Cheese Clicks</h5>
              <div class="space-y-1 max-h-32 overflow-y-auto">
                ${data.cheese_stats.recent_clicks.slice(0, 10).map(click => `
                  <div class="bg-gray-800 p-2 rounded text-sm">
                    <span class="text-gray-400">${getEggDisplayName(click.egg_id)}</span>
                    <span class="text-gray-500 mx-2">‚Ä¢</span>
                    <span class="text-gray-300">${formatDate(click.timestamp)}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    function formatNumber(num) {
      if (num === null || num === undefined || num === '') return '0';
      if (typeof num === 'string') num = parseFloat(num);
      if (isNaN(num)) return '0';
      return num.toLocaleString();
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      return new Date(dateString).toLocaleString();
    }

    function getEggDisplayName(eggId) {
      const eggNames = {
        'cheese-egg-blue': 'üîµ Blue Egg',
        'cheese-egg-red': 'üî¥ Red Egg', 
        'cheese-egg-green': 'üü¢ Green Egg',
        'cheese-egg': 'üßÄ Cheese Egg',
        'cheese-egg-finance': 'üí∞ Finance Egg'
      };
      return eggNames[eggId] || eggId;
    }

    async function approveQuestClaim(claimId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      if (!confirm('Are you sure you want to approve this quest claim? This will award points and grant the Discord role if specified.')) {
        return;
      }

      addLog(`üîÑ Approving quest claim ${claimId}...`);

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/quest-claims.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            action: 'approve_claim',
            claim_id: claimId,
            admin_id: currentAdmin.discord_id
          })
        });

        const data = await response.json();
        
        if (data.success) {
          const roleMessage = data.role_granted ? 
            `‚úÖ Role granted: ${data.role_id}` : 
            data.role_error ? 
            `‚ö†Ô∏è Role grant failed: ${data.role_error}` : 
            '‚ÑπÔ∏è No role to grant';
          
          addLog(`‚úÖ Quest claim approved! Points added: ${data.points_added}, ${roleMessage}`);
          // Refresh the claims list
          loadQuestClaims();
        } else {
          addLog(`‚ùå Failed to approve claim: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Approve claim error: ${error.message}`);
      }
    }

    async function rejectQuestClaim(claimId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const reason = prompt('Enter rejection reason (optional):') || 'Rejected by admin';

      if (!confirm(`Are you sure you want to reject this quest claim?\nReason: ${reason}`)) {
        return;
      }

      addLog(`üîÑ Rejecting quest claim ${claimId}...`);

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/quest-claims.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'reject_claim',
            claim_id: claimId,
            admin_id: currentAdmin.discord_id,
            reason: reason
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Quest claim rejected successfully`);
          // Refresh the claims list
          loadQuestClaims();
        } else {
          addLog(`‚ùå Failed to reject claim: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Reject claim error: ${error.message}`);
      }
    }

    function filterQuestClaims() {
      loadQuestClaims();
    }
    
    // Load enhanced quest claims with comprehensive data
    async function loadEnhancedQuestClaims() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }
      
      addLog('üîÑ Loading enhanced quest claims...');
      
      try {
        const statusFilter = document.getElementById('claimStatusFilter')?.value || 'all';
        const apiUrl = API_BASE_URL + `/api/admin/get-enhanced-quest-claims.php?status=${statusFilter}`;
        
        addLog(`üîó API URL: ${apiUrl}`);
        
        const response = await fetch(apiUrl);
        
        addLog(`üì° Response status: ${response.status} ${response.statusText}`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const responseText = await response.text();
        addLog(`üìÑ Response body: ${responseText.substring(0, 200)}...`);
        
        let data;
        try {
          data = JSON.parse(responseText);
        } catch (parseError) {
          addLog(`‚ùå JSON parse error: ${parseError.message}`);
          addLog(`üìÑ Raw response: ${responseText}`);
          return;
        }
        
        if (data.success) {
          addLog(`üìä Parsed data: ${data.claims ? data.claims.length : 'no'} claims, pagination: ${data.pagination ? 'yes' : 'no'}`);
          displayEnhancedQuestClaims(data.claims);
          addLog(`‚úÖ Loaded ${data.claims.length} quest claims (${statusFilter} filter)`);
          
          // Update pagination info if available
          if (data.pagination) {
            addLog(`üìä Total claims: ${data.pagination.total}, Showing: ${data.pagination.offset + 1}-${Math.min(data.pagination.offset + data.pagination.limit, data.pagination.total)}`);
          }
        } else {
          addLog(`‚ùå Failed to load quest claims: ${data.error || 'Unknown error'}`);
        }
      } catch (error) {
        addLog(`‚ùå Error loading quest claims: ${error.message}`);
        console.error('Quest claims loading error:', error);
      }
    }
    
    // Load quest claims (legacy function for compatibility)
    async function loadQuestClaims() {
      await loadEnhancedQuestClaims();
    }
    
    // Toggle between quest claims and user history view
    function toggleUserHistoryView() {
      const claimsList = document.getElementById('questClaimsList');
      const button = event.target;
      
      if (button.textContent.includes('Show User History')) {
        // Switch to user history view
        button.textContent = 'üìã Show Quest Claims';
        button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
        button.classList.add('bg-green-600', 'hover:bg-green-700');
        
        // Load user quest history
        loadUserQuestHistory();
      } else {
        // Switch back to quest claims view
        button.textContent = 'üë§ Show User History';
        button.classList.remove('bg-green-600', 'hover:bg-green-700');
        button.classList.add('bg-blue-600', 'hover:bg-blue-700');
        
        // Load quest claims
        loadEnhancedQuestClaims();
      }
    }
    
    // Test quest claims table structure and data
    async function testQuestClaimsTable() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }
      
      addLog('üß™ Testing quest claims table...');
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/test-quest-claims.php');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Quest table test successful`);
          addLog(`üìä Quest tables found: ${data.quest_tables.join(', ')}`);
          addLog(`üìã Quest claims count: ${data.counts.quest_claims}`);
          addLog(`üèÜ Quests count: ${data.counts.quests}`);
          addLog(`üîç Sample claims: ${data.sample_claims.length} records`);
          addLog(`üéØ Sample quests: ${data.sample_quests.length} records`);
          
          // Show sample data in console for debugging
          console.log('Quest claims table test results:', data);
        } else {
          addLog(`‚ùå Quest table test failed: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Error testing quest table: ${error.message}`);
        console.error('Quest table test error:', error);
      }
    }

    // ============================================================================
    // BOSS NOTIFICATION MANAGEMENT FUNCTIONS
    // ============================================================================
    
    // Load boss notifications with filtering
    async function loadBossNotifications() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }
      
      addLog('üîÑ Loading boss notifications...');
      
      try {
        const statusFilter = document.getElementById('bossNotificationStatusFilter')?.value || 'all';
        const apiUrl = API_BASE_URL + `/api/admin/boss-level-notification.php?status=${statusFilter}`;
        
        addLog(`üîó API URL: ${apiUrl}`);
        
        const response = await fetch(apiUrl);
        
        addLog(`üì° Response status: ${response.status} ${response.statusText}`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const responseText = await response.text();
        addLog(`üìÑ Response body: ${responseText.substring(0, 200)}...`);
        
        let data;
        try {
          data = JSON.parse(responseText);
        } catch (parseError) {
          addLog(`‚ùå JSON parse error: ${parseError.message}`);
          addLog(`üìÑ Raw response: ${responseText}`);
          return;
        }
        
        if (data.success) {
          addLog(`üìä Parsed data: ${data.notifications ? data.notifications.length : 'no'} notifications`);
          displayBossNotifications(data.notifications);
          addLog(`‚úÖ Loaded ${data.notifications.length} boss notifications (${statusFilter} filter)`);
          
          // Update the dashboard count
          loadBossNotificationCount();
        } else {
          addLog(`‚ùå Failed to load boss notifications: ${data.error || 'Unknown error'}`);
        }
      } catch (error) {
        addLog(`‚ùå Error loading boss notifications: ${error.message}`);
        console.error('Boss notifications loading error:', error);
      }
    }
    
    // Display boss notifications with approve/reward options
    function displayBossNotifications(notifications) {
      const container = document.getElementById('bossNotificationsList');
      
      if (!notifications || notifications.length === 0) {
        container.innerHTML = `<div class="text-gray-300">No boss notifications found.</div>`;
        return;
      }

      container.innerHTML = notifications.map(notification => `
        <div class="bg-gray-700 p-4 rounded-lg border-l-4 ${getBossStatusBorderColor(notification.status)}">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h4 class="font-semibold text-white">üëë ${notification.boss_name} (Boss Level ${notification.boss_level})</h4>
              <p class="text-gray-300 text-sm">Notification ID: ${notification.id}</p>
            </div>
            <div class="text-right">
              <span class="px-2 py-1 rounded text-xs font-semibold ${getBossStatusBadgeColor(notification.status)}">
                ${notification.status || 'pending'}
              </span>
              <div class="mt-1">
                <span class="px-2 py-1 rounded text-xs font-semibold bg-blue-600 text-white">
                  WAVE ${notification.wave_number}
                </span>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
            <div>
              <p class="text-sm text-gray-300"><strong>Player:</strong> ${notification.player_username || 'Unknown'}</p>
              <p class="text-sm text-gray-300"><strong>Score:</strong> ${(notification.score || 0).toLocaleString()}</p>
              <p class="text-sm text-gray-300"><strong>DSPOINC Earned:</strong> ${(notification.dspoinc_earned || 0).toLocaleString()}</p>
              <p class="text-sm text-gray-300"><strong>Reached:</strong> ${formatDate(notification.created_at)}</p>
            </div>
            <div>
              <p class="text-sm text-gray-300"><strong>Boss Type:</strong> ${notification.boss_type || 'Unknown'}</p>
              <p class="text-sm text-gray-300"><strong>Game:</strong> ${notification.game_type || 'space_invaders'}</p>
              ${notification.reviewed_at ? `<p class="text-sm text-gray-300"><strong>Reviewed:</strong> ${formatDate(notification.reviewed_at)}</p>` : ''}
            </div>
          </div>

          <!-- Boss Achievement Details -->
          <div class="bg-gray-800 p-3 rounded mb-3">
            <h5 class="font-semibold text-blue-400 mb-2">üéÆ Boss Achievement Details</h5>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
              <div>
                <span class="text-gray-400">üåä Wave Reached:</span>
                <span class="text-white font-semibold">${notification.wave_number}</span>
              </div>
              <div>
                <span class="text-gray-400">üëë Boss Level:</span>
                <span class="text-yellow-400 font-semibold">${notification.boss_level}</span>
              </div>
              <div>
                <span class="text-gray-400">üìä Final Score:</span>
                <span class="text-green-400 font-semibold">${(notification.score || 0).toLocaleString()}</span>
              </div>
              <div>
                <span class="text-gray-400">üí∞ DSPOINC:</span>
                <span class="text-yellow-400 font-semibold">${(notification.dspoinc_earned || 0).toLocaleString()}</span>
              </div>
            </div>
          </div>
          
          ${notification.status === 'pending' ? `
            <div class="flex gap-2 items-center">
              <input type="number" 
                     id="bossReward_${notification.id}" 
                     placeholder="DSPOINC Reward" 
                     value="${notification.dspoinc_earned || 0}"
                     class="px-3 py-2 rounded text-gray-800 w-32" 
                     min="0" 
                     max="100000">
              <input type="text" 
                     id="bossNote_${notification.id}" 
                     placeholder="Achievement note (optional)" 
                     class="px-3 py-2 rounded text-gray-800 flex-1" 
                     maxlength="255">
              <button onclick="approveBossNotification(${notification.id})" 
                      class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm whitespace-nowrap">
                ‚úÖ Approve & Pay
              </button>
              <button onclick="rejectBossNotification(${notification.id})" 
                      class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                ‚ùå Reject
              </button>
            </div>
          ` : notification.reward_note ? `
            <div class="bg-gray-800 p-2 rounded mt-2">
              <p class="text-sm text-gray-300"><strong>Admin Note:</strong> ${notification.reward_note}</p>
            </div>
          ` : ''}
        </div>
      `).join('');
    }
    
    // Approve boss notification and award DSPOINC
    async function approveBossNotification(notificationId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const rewardAmount = document.getElementById(`bossReward_${notificationId}`)?.value;
      const rewardNote = document.getElementById(`bossNote_${notificationId}`)?.value || '';

      if (!rewardAmount || rewardAmount <= 0) {
        addLog('‚ùå Please enter a valid DSPOINC reward amount');
        return;
      }

      if (!confirm(`Are you sure you want to approve this boss achievement and award ${rewardAmount} DSPOINC?`)) {
        return;
      }

      addLog(`üîÑ Approving boss notification ${notificationId} with ${rewardAmount} DSPOINC...`);

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            notification_id: notificationId,
            status: 'approved',
            reward_amount: parseInt(rewardAmount),
            reward_note: rewardNote,
            admin_id: currentAdmin.discord_id
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Boss achievement approved! ${rewardAmount} DSPOINC awarded to ${data.player_username}`);
          // Refresh the notifications list and dashboard count
          loadBossNotifications();
          loadBossNotificationCount();
        } else {
          addLog(`‚ùå Failed to approve boss notification: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Approve boss notification error: ${error.message}`);
      }
    }

    // Reject boss notification
    async function rejectBossNotification(notificationId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const reason = prompt('Please provide a reason for rejecting this boss achievement:');
      if (!reason) {
        addLog('‚ÑπÔ∏è Boss notification rejection cancelled');
        return;
      }

      addLog(`üîÑ Rejecting boss notification ${notificationId}...`);

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            notification_id: notificationId,
            status: 'rejected',
            reward_note: reason,
            admin_id: currentAdmin.discord_id
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Boss notification rejected successfully`);
          // Refresh the notifications list and dashboard count
          loadBossNotifications();
          loadBossNotificationCount();
        } else {
          addLog(`‚ùå Failed to reject boss notification: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Reject boss notification error: ${error.message}`);
      }
    }
    
    // Filter boss notifications by status
    function filterBossNotifications() {
      loadBossNotifications();
    }
    
    // Get border color for boss notification status
    function getBossStatusBorderColor(status) {
      switch(status) {
        case 'approved': return 'border-green-500';
        case 'rejected': return 'border-red-500';
        case 'pending':
        default: return 'border-yellow-500';
      }
    }
    
    // Get badge color for boss notification status
    function getBossStatusBadgeColor(status) {
      switch(status) {
        case 'approved': return 'bg-green-600 text-white';
        case 'rejected': return 'bg-red-600 text-white';
        case 'pending':
        default: return 'bg-yellow-600 text-white';
      }
    }
    
    // Test boss notification table
    async function testBossNotificationTable() {
      addLog('üß™ Testing boss notification table...');
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php?test_table=1');
        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Boss notification table test passed`);
          addLog(`üìä Table structure: ${JSON.stringify(data.table_info, null, 2)}`);
          console.log('Boss notification table test results:', data);
        } else {
          addLog(`‚ùå Boss notification table test failed: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Error testing boss notification table: ${error.message}`);
        console.error('Boss notification table test error:', error);
      }
    }
    
    // Toggle boss user history view
    function toggleBossUserHistoryView() {
      addLog('üë§ Boss user history view toggle (feature placeholder)');
      // This could be implemented to show detailed user boss achievement history
    }

    // Game Management Functions
    async function loadGameStatistics() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading game statistics...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-game-statistics.php');
        const data = await response.json();
        
        if (data.success) {
          displayGameStatistics(data);
          addLog('‚úÖ Game statistics loaded successfully');
        } else {
          addLog(`‚ùå Failed to load game statistics: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Game statistics loading error: ${error.message}`);
      }
    }

    function displayGameStatistics(data) {
      try {
        // Update Tetris statistics
        const tetrisTotalScores = document.getElementById('tetrisTotalScores');
        const tetrisUniquePlayers = document.getElementById('tetrisUniquePlayers');
        const tetrisMaxScore = document.getElementById('tetrisMaxScore');
        const tetrisRecent24h = document.getElementById('tetrisRecent24h');
        
        if (tetrisTotalScores) tetrisTotalScores.textContent = data.tetris.total_scores.toLocaleString();
        if (tetrisUniquePlayers) tetrisUniquePlayers.textContent = data.tetris.unique_players.toLocaleString();
        if (tetrisMaxScore) tetrisMaxScore.textContent = data.tetris.max_score ? data.tetris.max_score.toLocaleString() : '0';
        if (tetrisRecent24h) tetrisRecent24h.textContent = data.tetris.recent_24h.toLocaleString();

        // Update Snake statistics
        const snakeTotalScores = document.getElementById('snakeTotalScores');
        const snakeUniquePlayers = document.getElementById('snakeUniquePlayers');
        const snakeMaxScore = document.getElementById('snakeMaxScore');
        const snakeRecent24h = document.getElementById('snakeRecent24h');
        
        if (snakeTotalScores) snakeTotalScores.textContent = data.snake.total_scores.toLocaleString();
        if (snakeUniquePlayers) snakeUniquePlayers.textContent = data.snake.unique_players.toLocaleString();
        if (snakeMaxScore) snakeMaxScore.textContent = data.snake.max_score ? data.snake.max_score.toLocaleString() : '0';
        if (snakeRecent24h) snakeRecent24h.textContent = data.snake.recent_24h.toLocaleString();

        // Update Space Invaders statistics
        const spaceInvadersTotalScores = document.getElementById('spaceInvadersTotalScores');
        const spaceInvadersUniquePlayers = document.getElementById('spaceInvadersUniquePlayers');
        const spaceInvadersMaxScore = document.getElementById('spaceInvadersMaxScore');
        const spaceInvadersRecent24h = document.getElementById('spaceInvadersRecent24h');
        
        if (spaceInvadersTotalScores) spaceInvadersTotalScores.textContent = data.space_invaders.total_scores.toLocaleString();
        if (spaceInvadersUniquePlayers) spaceInvadersUniquePlayers.textContent = data.space_invaders.unique_players.toLocaleString();
        if (spaceInvadersMaxScore) spaceInvadersMaxScore.textContent = data.space_invaders.max_score ? data.space_invaders.max_score.toLocaleString() : '0';
        if (spaceInvadersRecent24h) spaceInvadersRecent24h.textContent = data.space_invaders.recent_24h.toLocaleString();

        // Update combined statistics
        const totalGameScores = document.getElementById('totalGameScores');
        const totalGamePlayers = document.getElementById('totalGamePlayers');
        const totalGameRecent24h = document.getElementById('totalGameRecent24h');
        const totalGameRecent7d = document.getElementById('totalGameRecent7d');
        
        if (totalGameScores) totalGameScores.textContent = data.total.total_scores.toLocaleString();
        if (totalGamePlayers) totalGamePlayers.textContent = data.total.total_players.toLocaleString();
        if (totalGameRecent24h) totalGameRecent24h.textContent = data.total.recent_24h.toLocaleString();
        if (totalGameRecent7d) totalGameRecent7d.textContent = data.total.recent_7d.toLocaleString();

        // Display top players
        displayTopPlayers('tetris', data.tetris_top_players);
        displayTopPlayers('snake', data.snake_top_players);
        displayTopPlayers('space_invaders', data.space_invaders_top_players);

        // Display recent activity
        displayRecentActivity(data.recent_activity);
      } catch (error) {
        console.error('Error displaying game statistics:', error);
        addLog(`‚ùå Error displaying game statistics: ${error.message}`);
      }
    }

    // ===== NEW GAME MANAGEMENT FUNCTIONS =====
    
    // Main function to load all game management data
    function loadGameManagementData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }
      
      addLog('üîÑ Loading game management data...');
      
      // Load overview dashboard by default
      loadGameOverview();
      
      // Load other game data as needed
      loadSeasonStats();
      loadGameSettings();
      loadCurrentSeasonSettings();
      
      addLog('‚úÖ Game management data loaded successfully');
    }
    
    // Tab switching functionality
    function switchGameTab(tabName) {
      console.log('üîÑ switchGameTab called with:', tabName);
      
      // Stop notification checking for Space Invaders if switching away
      if (tabName !== 'space-invaders') {
        stopBossNotificationChecking();
      }
      
      // Store the current tab content before hiding
      const currentTab = document.querySelector('.game-tab-content:not([style*="display: none"])');
      let currentTabContent = '';
      if (currentTab) {
        currentTabContent = currentTab.innerHTML;
        console.log('üíæ Preserving content from current tab:', currentTab.id);
      }
      
      // Hide all game tab contents by adding a hidden class and setting display
      const allTabs = document.querySelectorAll('.game-tab-content');
      allTabs.forEach(tab => {
        tab.classList.add('hidden');
        tab.style.display = 'none';
        console.log('Hidden tab:', tab.id);
      });
      
      // Remove active class from all tab buttons
      const allButtons = document.querySelectorAll('.tab-btn');
      allButtons.forEach(btn => btn.classList.remove('active'));
      
      // Map button names to actual tab IDs
      const tabMapping = {
        'overview': 'overviewTab',
        'tetris': 'tetrisTab',
        'snake': 'snakeTab',
        'space-invaders': 'spaceInvadersTab',
        'cheese-invaders': 'cheeseInvadersTab',
        'cheese-hunt': 'cheeseHuntTab',
        'discord-race': 'discordRaceTab'
      };
      
      // Show selected tab and activate button
      const selectedTabId = tabMapping[tabName];
      const selectedTab = document.getElementById(selectedTabId);
      const selectedButton = document.querySelector(`[data-game-tab="${tabName}"]`);
      
      console.log('Selected tab ID:', selectedTabId);
      console.log('Selected tab element:', selectedTab);
      
      if (selectedTab) {
        selectedTab.classList.remove('hidden');
        selectedTab.classList.add('show-tab');
        selectedTab.style.display = 'block';
        console.log('‚úÖ Showing tab:', selectedTabId);
        console.log('üîç Tab display style after setting:', selectedTab.style.display);
        console.log('üîç Tab computed style:', window.getComputedStyle(selectedTab).display);
        
        // Force a reflow to ensure the tab is properly displayed
        selectedTab.offsetHeight;
      } else {
        console.error('‚ùå Tab not found:', selectedTabId);
      }
      
      if (selectedButton) {
        selectedButton.classList.add('active');
        console.log('‚úÖ Activated button for:', tabName);
      } else {
        console.error('‚ùå Button not found for:', tabName);
      }
      
      // Load data for the selected tab with enhanced error handling and display refresh
      console.log('üîÑ Loading data for tab:', tabName);
      
      // Use setTimeout to ensure DOM is fully updated before loading data
      setTimeout(async () => {
        try {
          switch(tabName) {
            case 'overview':
              console.log('Loading overview data...');
              await loadGameOverview();
              break;
            case 'tetris':
              console.log('Loading Tetris data...');
              await loadTetrisData();
              break;
            case 'snake':
              console.log('Loading Snake data...');
              await loadSnakeData();
              break;
            case 'space-invaders':
              console.log('üëæ Loading Space Invaders data...');
              addLog('üëæ Loading Space Invaders data...');
              await loadSpaceInvadersData();
              await loadBossNotifications(); // Load boss notifications when tab is opened
              startBossNotificationChecking(); // Start real-time notification checking
              break;
            case 'cheese-hunt':
              console.log('üßÄ Loading Cheese Hunt data...');
              addLog('üßÄ Loading Cheese Hunt data...');
              // Don't call refreshCheeseHuntDisplay here - it clears content
              await loadCheeseHuntData();
              break;
            case 'discord-race':
              console.log('üèÅ Loading Discord Race data...');
              addLog('üèÅ Loading Discord Race data...');
              // Don't call refreshDiscordRaceDisplay here - it clears content
              await loadDiscordRaceData();
              break;
          }
          
          // Additional verification that tab is visible after data loading
          if (selectedTab) {
            const computedStyle = window.getComputedStyle(selectedTab);
            const isVisible = computedStyle.display !== 'none' && 
                            computedStyle.visibility !== 'hidden' && 
                            selectedTab.offsetHeight > 0;
            
            console.log('üîç Tab visibility check after data loading:', {
              display: computedStyle.display,
              visibility: computedStyle.visibility,
              height: selectedTab.offsetHeight,
              isVisible: isVisible
            });
            
            if (!isVisible) {
              console.warn('‚ö†Ô∏è Tab not visible after data loading, forcing display...');
              selectedTab.style.display = 'block';
              selectedTab.style.visibility = 'visible';
              selectedTab.classList.remove('hidden');
              
              // If the tab still has no content, restore the preserved content
              if (selectedTab.innerHTML.trim() === '' && currentTabContent) {
                console.log('üîÑ Restoring preserved content to tab:', selectedTabId);
                selectedTab.innerHTML = currentTabContent;
              }
            }
          }
        } catch (error) {
          console.error('‚ùå Error loading data for tab:', tabName, error);
          addLog(`‚ùå Error loading data for tab ${tabName}: ${error.message}`);
        }
      }, 100); // Small delay to ensure DOM updates
    }

    // Overview Dashboard Functions
    async function loadGameOverview() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading game overview...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success) {
          displayGameOverview(data);
          addLog('‚úÖ Game overview loaded successfully');
        } else {
          addLog(`‚ùå Failed to load game overview: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Game overview loading error: ${error.message}`);
      }
    }

    function displayGameOverview(data) {
      try {
        console.log('üìä Dashboard data received:', data);
        console.log('üìä Dashboard data structure:', JSON.stringify(data, null, 2));
        
        // Update system overview cards - Fix data path to use data.data.overview
        if (data.data && data.data.overview) {
          const overview = data.data.overview;
          console.log('üìä Overview data:', overview);
          
          if (document.getElementById('totalActivePlayers')) {
            document.getElementById('totalActivePlayers').textContent = overview.total_active_players || '-';
            console.log('üìä Updated totalActivePlayers:', overview.total_active_players || '-');
          }
          if (document.getElementById('totalWeeklyPlayers')) {
            document.getElementById('totalWeeklyPlayers').textContent = overview.total_weekly_players || '-';
            console.log('üìä Updated totalWeeklyPlayers:', overview.total_weekly_players || '-');
          }
          if (document.getElementById('totalGamesPlayed')) {
            document.getElementById('totalGamesPlayed').textContent = overview.total_games_played || '-';
            console.log('üìä Updated totalGamesPlayed:', overview.total_games_played || '-');
          }
          if (document.getElementById('totalGamesToday')) {
            document.getElementById('totalGamesToday').textContent = overview.total_games_today || '-';
            console.log('üìä Updated totalGamesToday:', overview.total_games_today || '-');
          }
          if (document.getElementById('topPerformersWeek')) {
            document.getElementById('topPerformersWeek').textContent = overview.top_performers_week || '-';
            console.log('üìä Updated topPerformersWeek:', overview.top_performers_week || '-');
          }
          if (document.getElementById('topPerformersAllTime')) {
            document.getElementById('topPerformersAllTime').textContent = overview.top_performers_all_time || '-';
            console.log('üìä Updated topPerformersAllTime:', overview.top_performers_all_time || '-');
          }
        } else {
          console.log('‚ùå No overview data found in response - checking data.data.overview');
          // Try alternative data structure
          if (data.data && data.data.games) {
            console.log('üìä Found games data, updating overview with game summaries');
            updateOverviewWithGameSummaries(data.data.games);
          }
        }

        // Update daily activity chart (placeholder for now)
        const dailyChart = document.getElementById('dailyActivityChart');
        if (dailyChart) {
          dailyChart.innerHTML = '<div class="text-green-400 text-center">üìä Daily activity data loaded</div>';
        }

        // Update weekly performance
        const weeklyPerf = document.getElementById('weeklyPerformance');
        if (weeklyPerf && data.data && data.data.overview) {
          const overview = data.data.overview;
          weeklyPerf.innerHTML = `
            <div class="bg-gray-600 p-2 rounded mb-2">
              <div class="flex justify-between text-sm">
                <span>üéÆ Total Games This Week</span>
                <span class="font-semibold">${overview.total_games_week || 0}</span>
              </div>
            </div>
            <div class="bg-gray-600 p-2 rounded mb-2">
              <div class="flex justify-between text-sm">
                <span>üë• New Players This Week</span>
                <span class="font-semibold">${overview.new_players_week || 0}</span>
              </div>
            </div>
            <div class="bg-gray-600 p-2 rounded mb-2">
              <span>üìà Growth Rate</span>
              <span class="font-semibold text-green-400">+${overview.growth_rate || 0}%</span>
            </div>
          `;
        } else if (weeklyPerf && data.data && data.data.games) {
          // Fallback to game summaries if no overview data
          const games = data.data.games;
          const totalGames = Object.values(games).reduce((sum, game) => {
            if (game.season_data && game.season_data.total_scores) {
              return sum + game.season_data.total_scores;
            }
            if (game.current_data && game.current_data.total_clicks) {
              return sum + game.current_data.total_clicks;
            }
            return sum;
          }, 0);
          
          weeklyPerf.innerHTML = `
            <div class="bg-gray-600 p-2 rounded mb-2">
              <div class="flex justify-between text-sm">
                <span>üéÆ Total Games This Week</span>
                <span class="font-semibold">${totalGames}</span>
              </div>
            </div>
            <div class="bg-gray-600 p-2 rounded mb-2">
              <div class="flex justify-between text-sm">
                <span>üë• Active Games</span>
                <span class="font-semibold">${Object.keys(games).length}</span>
              </div>
            </div>
            <div class="bg-gray-600 p-2 rounded mb-2">
              <div class="flex justify-between text-sm">
                <span>üìä Data Source</span>
                <span class="font-semibold text-blue-400">Game Stats</span>
              </div>
            </div>
          `;
        }
              } catch (error) {
          console.error('Error displaying game overview:', error);
          addLog(`‚ùå Error displaying game overview: ${error.message}`);
        }
      }

      // Function to update overview with game summaries when overview data is not available
      function updateOverviewWithGameSummaries(games) {
        try {
          console.log('üìä Updating overview with game summaries:', games);
          
          // Calculate totals from game data
          let totalScores = 0;
          let totalPlayers = 0;
          let maxScore = 0;
          
          Object.values(games).forEach(game => {
            if (game.season_data) {
              totalScores += game.season_data.total_scores || 0;
              totalPlayers += game.season_data.unique_players || 0;
              maxScore = Math.max(maxScore, game.season_data.max_score || 0);
            }
            if (game.current_data) {
              totalScores += game.current_data.total_clicks || 0;
              totalPlayers += game.current_data.unique_players || 0;
              maxScore = Math.max(maxScore, game.current_data.max_clicks || 0);
            }
            if (game.race_data) {
              totalScores += game.race_data.total_races || 0;
              totalPlayers += game.race_data.total_participants || 0;
            }
          });
          
          // Update overview cards with calculated data
          if (document.getElementById('totalGamesPlayed')) {
            document.getElementById('totalGamesPlayed').textContent = totalScores;
          }
          if (document.getElementById('totalActivePlayers')) {
            document.getElementById('totalActivePlayers').textContent = totalPlayers;
          }
          if (document.getElementById('topPerformersAllTime')) {
            document.getElementById('topPerformersAllTime').textContent = maxScore;
          }
          
          console.log('‚úÖ Overview updated with game summaries');
        } catch (error) {
          console.error('Error updating overview with game summaries:', error);
        }
      }

    // Tetris Tab Functions
    async function loadTetrisData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading Tetris data...');
      
      // Show loading state
      const tetrisTab = document.getElementById('tetrisTab');
      if (tetrisTab) {
        tetrisTab.classList.add('loading');
        const loadingIndicator = document.createElement('div');
        loadingIndicator.id = 'tetrisLoading';
        loadingIndicator.className = 'fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50';
        loadingIndicator.innerHTML = 'üîÑ Loading Tetris Data...';
        document.body.appendChild(loadingIndicator);
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games && data.data.games.tetris) {
          displayTetrisData(data.data.games.tetris);
          addLog('‚úÖ Tetris data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load Tetris data: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Tetris data loading error: ${error.message}`);
      } finally {
        // Remove loading state
        const tetrisTab = document.getElementById('tetrisTab');
        if (tetrisTab) {
          tetrisTab.classList.remove('loading');
        }
        const loadingIndicator = document.getElementById('tetrisLoading');
        if (loadingIndicator) {
          loadingIndicator.remove();
        }
      }
    }

    function displayTetrisData(tetrisData) {
      try {
        console.log('Tetris data received:', tetrisData);
        
        // Helper function to format numbers nicely
        const formatNumber = (num) => {
          if (num === null || num === undefined || num === '-') return '-';
          if (typeof num === 'string') num = parseFloat(num);
          if (isNaN(num)) return '-';
          return num.toLocaleString();
        };

        // Helper function to format scores with DSPOINC conversion
        const formatScore = (score) => {
          if (score === null || score === undefined || score === '-') return '-';
          if (typeof score === 'string') score = parseFloat(score);
          if (isNaN(score)) return '-';
          const dspoinc = score * 10;
          return `${score.toLocaleString()} (${dspoinc.toLocaleString()} DSPOINC)`;
        };

        // Update Tetris statistics from season_data with better formatting
        if (document.getElementById('tetrisTotalScores')) {
          const totalScores = tetrisData.season_data?.total_scores || 0;
          document.getElementById('tetrisTotalScores').textContent = formatNumber(totalScores);
          document.getElementById('tetrisTotalScores').className = totalScores > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisUniquePlayers')) {
          const uniquePlayers = tetrisData.season_data?.unique_players || 0;
          document.getElementById('tetrisUniquePlayers').textContent = formatNumber(uniquePlayers);
          document.getElementById('tetrisUniquePlayers').className = uniquePlayers > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisMaxScore')) {
          const maxScore = tetrisData.season_data?.max_score || 0;
          document.getElementById('tetrisMaxScore').textContent = formatScore(maxScore);
          document.getElementById('tetrisMaxScore').className = maxScore > 0 ? 'text-green-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisAvgScore')) {
          const avgScore = tetrisData.season_data?.avg_score || 0;
          document.getElementById('tetrisAvgScore').textContent = formatScore(avgScore);
          document.getElementById('tetrisAvgScore').className = avgScore > 0 ? 'text-blue-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisRecent24h')) {
          const recent24h = tetrisData.season_data?.recent_24h || 0;
          document.getElementById('tetrisRecent24h').textContent = formatNumber(recent24h);
          document.getElementById('tetrisRecent24h').className = recent24h > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisRecent7d')) {
          const recent7d = tetrisData.season_data?.recent_7d || 0;
          document.getElementById('tetrisRecent7d').textContent = formatNumber(recent7d);
          document.getElementById('tetrisRecent7d').className = recent7d > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisRecent30d')) {
          const recent30d = tetrisData.season_data?.recent_30d || 0;
          document.getElementById('tetrisRecent30d').textContent = formatNumber(recent30d);
          document.getElementById('tetrisRecent30d').className = recent30d > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }

        // Update season data with better formatting
        if (document.getElementById('tetrisCurrentSeason')) {
          const currentSeason = tetrisData.season_data?.current_season || 'Season 1';
          document.getElementById('tetrisCurrentSeason').textContent = currentSeason;
          document.getElementById('tetrisCurrentSeason').className = 'text-white font-semibold';
        }
        
        if (document.getElementById('tetrisSeasonScores')) {
          const seasonScores = tetrisData.season_data?.total_scores || 0;
          document.getElementById('tetrisSeasonScores').textContent = formatNumber(seasonScores);
          document.getElementById('tetrisSeasonScores').className = seasonScores > 0 ? 'text-green-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('tetrisSeasonPlayers')) {
          const seasonPlayers = tetrisData.season_data?.unique_players || 0;
          document.getElementById('tetrisSeasonPlayers').textContent = formatNumber(seasonPlayers);
          document.getElementById('tetrisSeasonPlayers').className = seasonPlayers > 0 ? 'text-blue-400 font-semibold' : 'text-gray-400';
        }

        // Update leaderboard with enhanced styling and animations
        const leaderboard = document.getElementById('tetrisLeaderboard');
        if (leaderboard) {
          if (tetrisData.top_players && tetrisData.top_players.length > 0) {
            leaderboard.innerHTML = tetrisData.top_players.map((player, index) => {
              const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
              const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
              const scoreValue = player.score || 0;
              const dspoincValue = scoreValue * 10;
              
              return `
                <div class="leaderboard-item" style="animation-delay: ${index * 0.1}s;">
                  <div class="leaderboard-rank ${rankClass}">
                    ${rankEmoji} #${index + 1}
                  </div>
                  <div class="leaderboard-info">
                    <div class="leaderboard-name">
                      ${player.username || 'Unknown Player'}
                      ${index < 3 ? `<span class="text-xs ml-2 px-2 py-1 bg-yellow-900 bg-opacity-50 rounded-full text-yellow-200">Top Player</span>` : ''}
                    </div>
                    <div class="leaderboard-score">
                      <span class="font-bold text-blue-300">${scoreValue.toLocaleString()}</span>
                      <span class="text-xs text-gray-400 ml-2">(${dspoincValue.toLocaleString()} DSPOINC)</span>
                    </div>
                  </div>
                  <div class="leaderboard-date">
                    <div class="text-center">
                      <div class="text-xs text-gray-400 mb-1">Discord ID</div>
                      <div class="font-mono text-sm">${player.discord_id || 'N/A'}</div>
                    </div>
                  </div>
                </div>
              `;
            }).join('');
            
            // Add leaderboard summary
            const summary = document.createElement('div');
            summary.className = 'mt-4 p-4 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-700 border-opacity-50';
            summary.innerHTML = `
              <div class="flex items-center justify-between text-sm">
                <div class="text-blue-200">
                  <span class="font-semibold">üèÜ Leaderboard Summary:</span>
                  ${tetrisData.top_players.length} players ranked
                </div>
                <div class="text-blue-300">
                  <span class="font-semibold">Total DSPOINC:</span>
                  ${tetrisData.top_players.reduce((sum, p) => sum + (p.score || 0) * 10, 0).toLocaleString()}
                </div>
              </div>
            `;
            leaderboard.appendChild(summary);
          } else {
            leaderboard.innerHTML = `
              <div class="text-center p-8 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 border-opacity-50">
                <div class="text-gray-300 text-2xl mb-3">üìä</div>
                <div class="text-gray-400 text-lg mb-2 font-semibold">No Leaderboard Data</div>
                <div class="text-gray-500 text-sm mb-4">No players have completed Tetris games yet</div>
                <div class="text-blue-400 text-sm bg-blue-900 bg-opacity-30 px-4 py-2 rounded-full border border-blue-700 border-opacity-50">
                  Start playing to see rankings! üéÆ
                </div>
              </div>
            `;
          }
        }

        // Add data summary at the top
        const dataSummary = document.createElement('div');
        dataSummary.className = 'mb-4 p-3 bg-blue-900 bg-opacity-50 rounded-lg';
        dataSummary.innerHTML = `
          <div class="text-blue-200 text-sm">
            <strong>üìä Data Summary:</strong> 
            ${tetrisData.season_data?.total_scores || 0} scores from ${tetrisData.season_data?.unique_players || 0} players in ${tetrisData.season_data?.current_season || 'Season 1'}
            ${tetrisData.season_data?.total_scores > 0 ? '‚úÖ' : '‚ùå No data yet'}
          </div>
          <div class="text-blue-300 text-xs mt-2">
            <strong>üïí Last Updated:</strong> ${new Date().toLocaleString()}
          </div>
        `;
        
        // Insert summary at the top of the Tetris tab
        const tetrisTab = document.getElementById('tetrisTab');
        if (tetrisTab && !tetrisTab.querySelector('.data-summary')) {
          dataSummary.className += ' data-summary';
          tetrisTab.insertBefore(dataSummary, tetrisTab.firstChild);
        }

      } catch (error) {
        console.error('Error displaying Tetris data:', error);
        addLog(`‚ùå Error displaying Tetris data: ${error.message}`);
        
        // Show error state in the display
        const leaderboard = document.getElementById('tetrisLeaderboard');
        if (leaderboard) {
          leaderboard.innerHTML = `
            <div class="text-center p-6">
              <div class="text-red-400 text-lg mb-2">‚ùå Error Loading Data</div>
              <div class="text-gray-500 text-sm">Failed to display Tetris data</div>
              <div class="text-blue-400 text-sm mt-2">Check console for details</div>
            </div>
          `;
        }
      }
    }

    // Snake Tab Functions
    async function loadSnakeData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading Snake data...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games && data.data.games.snake) {
          displaySnakeData(data.data.games.snake);
          addLog('‚úÖ Snake data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load Snake data: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Snake data loading error: ${error.message}`);
      }
    }

    function displaySnakeData(snakeData) {
      try {
        console.log('Snake data received:', snakeData);
        
        // Helper function to format numbers nicely
        const formatNumber = (num) => {
          if (num === null || num === undefined || num === '-') return '-';
          if (typeof num === 'string') num = parseFloat(num);
          if (isNaN(num)) return '-';
          return num.toLocaleString();
        };

        // Helper function to format scores with DSPOINC conversion
        const formatScore = (score) => {
          if (score === null || score === undefined || score === '-') return '-';
          if (typeof score === 'string') score = parseFloat(score);
          if (isNaN(score)) return '-';
          const dspoinc = score * 10;
          return `${score.toLocaleString()} (${dspoinc.toLocaleString()} DSPOINC)`;
        };

        // Update Snake statistics from season_data with better formatting
        if (document.getElementById('snakeTotalScores')) {
          const totalScores = snakeData.season_data?.total_scores || 0;
          document.getElementById('snakeTotalScores').textContent = formatNumber(totalScores);
          document.getElementById('snakeTotalScores').className = totalScores > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('snakeUniquePlayers')) {
          const uniquePlayers = snakeData.season_data?.unique_players || 0;
          document.getElementById('snakeUniquePlayers').textContent = formatNumber(uniquePlayers);
          document.getElementById('snakeUniquePlayers').className = uniquePlayers > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('snakeMaxScore')) {
          const maxScore = snakeData.season_data?.max_score || 0;
          document.getElementById('snakeMaxScore').textContent = formatScore(maxScore);
          document.getElementById('snakeMaxScore').className = maxScore > 0 ? 'text-green-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('snakeAvgScore')) {
          const avgScore = snakeData.season_data?.avg_score || 0;
          document.getElementById('snakeAvgScore').textContent = formatScore(avgScore);
          document.getElementById('snakeAvgScore').className = avgScore > 0 ? 'text-blue-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('snakeRecent24h')) {
          const recent24h = snakeData.season_data?.recent_24h || 0;
          document.getElementById('snakeRecent24h').textContent = formatNumber(recent24h);
          document.getElementById('snakeRecent24h').className = recent24h > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('snakeRecent7d')) {
          const recent7d = snakeData.season_data?.recent_7d || 0;
          document.getElementById('snakeRecent7d').textContent = formatNumber(recent7d);
          document.getElementById('snakeRecent7d').className = recent7d > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }

        // Update player statistics with better formatting
        if (document.getElementById('snakeActivePlayers')) {
          const activePlayers = snakeData.season_data?.unique_players || 0;
          document.getElementById('snakeActivePlayers').textContent = formatNumber(activePlayers);
          document.getElementById('snakeActivePlayers').className = activePlayers > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('snakeNewPlayers')) {
          document.getElementById('snakeNewPlayers').textContent = 'üìä Coming Soon';
          document.getElementById('snakeNewPlayers').className = 'text-blue-400 text-sm';
        }
        
        if (document.getElementById('snakeReturningPlayers')) {
          document.getElementById('snakeReturningPlayers').textContent = 'üìä Coming Soon';
          document.getElementById('snakeReturningPlayers').className = 'text-blue-400 text-sm';
        }
        
        if (document.getElementById('snakeGrowthRate')) {
          document.getElementById('snakeGrowthRate').textContent = 'üìä Coming Soon';
          document.getElementById('snakeGrowthRate').className = 'text-blue-400 text-sm';
        }

        // Update leaderboard with enhanced styling and animations
        const leaderboard = document.getElementById('snakeLeaderboard');
        if (leaderboard) {
          if (snakeData.top_players && snakeData.top_players.length > 0) {
            leaderboard.innerHTML = snakeData.top_players.map((player, index) => {
              const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
              const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
              const scoreValue = player.score || 0;
              const dspoincValue = scoreValue * 10;
              
              return `
                <div class="leaderboard-item" style="animation-delay: ${index * 0.1}s;">
                  <div class="leaderboard-rank ${rankClass}">
                    ${rankEmoji} #${index + 1}
                  </div>
                  <div class="leaderboard-info">
                    <div class="leaderboard-name">
                      ${player.username || 'Unknown Player'}
                      ${index < 3 ? `<span class="text-xs ml-2 px-2 py-1 bg-green-900 bg-opacity-50 rounded-full text-green-200">Top Player</span>` : ''}
                    </div>
                    <div class="leaderboard-score">
                      <span class="font-bold text-green-300">${scoreValue.toLocaleString()}</span>
                      <span class="text-xs text-gray-400 ml-2">(${dspoincValue.toLocaleString()} DSPOINC)</span>
                    </div>
                  </div>
                  <div class="leaderboard-date">
                    <div class="text-center">
                      <div class="text-xs text-gray-400 mb-1">Discord ID</div>
                      <div class="font-mono text-sm">${player.discord_id || 'N/A'}</div>
                    </div>
                  </div>
                </div>
              `;
            }).join('');
            
            // Add leaderboard summary
            const summary = document.createElement('div');
            summary.className = 'mt-4 p-4 bg-green-900 bg-opacity-30 rounded-lg border border-green-700 border-opacity-50';
            summary.innerHTML = `
              <div class="flex items-center justify-between text-sm">
                <div class="text-green-200">
                  <span class="font-semibold">üèÜ Leaderboard Summary:</span>
                  ${snakeData.top_players.length} players ranked
                </div>
                <div class="text-green-300">
                  <span class="font-semibold">Total DSPOINC:</span>
                  ${snakeData.top_players.reduce((sum, p) => sum + (p.score || 0) * 10, 0).toLocaleString()}
                </div>
              </div>
            `;
            leaderboard.appendChild(summary);
          } else {
            leaderboard.innerHTML = `
              <div class="text-center p-8 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 border-opacity-50">
                <div class="text-gray-300 text-2xl mb-3">üêç</div>
                <div class="text-gray-400 text-lg mb-2 font-semibold">No Leaderboard Data</div>
                <div class="text-gray-500 text-sm mb-4">No players have completed Snake games yet</div>
                <div class="text-green-400 text-sm bg-green-900 bg-opacity-30 px-4 py-2 rounded-full border border-green-700 border-opacity-50">
                  Start playing to see rankings! üéÆ
                </div>
              </div>
            `;
          }
        }

        // Add data summary at the top
        const dataSummary = document.createElement('div');
        dataSummary.className = 'mb-4 p-3 bg-green-900 bg-opacity-50 rounded-lg';
        dataSummary.innerHTML = `
          <div class="text-green-200 text-sm">
            <strong>üìä Data Summary:</strong> 
            ${snakeData.season_data?.total_scores || 0} scores from ${snakeData.season_data?.unique_players || 0} players in ${snakeData.season_data?.current_season || 'Season 1'}
            ${snakeData.season_data?.total_scores > 0 ? '‚úÖ' : '‚ùå No data yet'}
          </div>
          <div class="text-green-300 text-xs mt-2">
            <strong>üïí Last Updated:</strong> ${new Date().toLocaleString()}
          </div>
        `;
        
        // Insert summary at the top of the Snake tab
        const snakeTab = document.getElementById('snakeTab');
        if (snakeTab && !snakeTab.querySelector('.data-summary')) {
          dataSummary.className += ' data-summary';
          snakeTab.insertBefore(dataSummary, snakeTab.firstChild);
        }

      } catch (error) {
        console.error('Error displaying Snake data:', error);
        addLog(`‚ùå Error displaying Snake data: ${error.message}`);
        
        // Show error state in the display
        const leaderboard = document.getElementById('snakeLeaderboard');
        if (leaderboard) {
          leaderboard.innerHTML = `
            <div class="text-center p-6">
              <div class="text-red-400 text-lg mb-2">‚ùå Error Loading Data</div>
              <div class="text-gray-500 text-sm">Failed to display Snake data</div>
              <div class="text-blue-400 text-sm mt-2">Check console for details</div>
            </div>
          `;
        }
      }
    }

    // Space Invaders Tab Functions (Combined with Cheese Invaders)
    async function loadSpaceInvadersData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üëæ Loading Space Invaders & Cheese Invaders data...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games) {
          // Combine both Space Invaders and Cheese Invaders data
          const spaceInvadersData = data.data.games.space_invaders || {};
          const cheeseInvadersData = data.data.games.cheese_invaders || {};
          
          // Merge the data for combined display
          const combinedData = {
            space_invaders: spaceInvadersData,
            cheese_invaders: cheeseInvadersData,
            combined_stats: {
              total_scores: (spaceInvadersData.season_data?.total_scores || 0) + (cheeseInvadersData.season_data?.total_scores || 0),
              unique_players: Math.max(spaceInvadersData.season_data?.unique_players || 0, cheeseInvadersData.season_data?.unique_players || 0),
              max_score: Math.max(spaceInvadersData.season_data?.max_score || 0, cheeseInvadersData.season_data?.max_score || 0),
              avg_score: ((spaceInvadersData.season_data?.avg_score || 0) + (cheeseInvadersData.season_data?.avg_score || 0)) / 2,
              recent_24h: (spaceInvadersData.season_data?.recent_24h || 0) + (cheeseInvadersData.season_data?.recent_24h || 0),
              recent_7d: (spaceInvadersData.season_data?.recent_7d || 0) + (cheeseInvadersData.season_data?.recent_7d || 0)
            },
            combined_top_players: []
          };
          
          // Combine top players from both games
          const allPlayers = new Map();
          
          // Add Space Invaders players
          if (spaceInvadersData.top_players) {
            spaceInvadersData.top_players.forEach(player => {
              allPlayers.set(player.discord_id, {
                ...player,
                game: 'Space Invaders',
                game_emoji: 'üëæ'
              });
            });
          }
          
          // Add Cheese Invaders players (merge if same player)
          if (cheeseInvadersData.top_players) {
            cheeseInvadersData.top_players.forEach(player => {
              if (allPlayers.has(player.discord_id)) {
                // Player exists in both games, keep the higher score
                const existing = allPlayers.get(player.discord_id);
                if (player.score > existing.score) {
                  allPlayers.set(player.discord_id, {
                    ...player,
                    game: 'Cheese Invaders',
                    game_emoji: 'üßÄ'
                  });
                }
              } else {
                allPlayers.set(player.discord_id, {
                  ...player,
                  game: 'Cheese Invaders',
                  game_emoji: 'üßÄ'
                });
              }
            });
          }
          
          // Sort combined players by score
          combinedData.combined_top_players = Array.from(allPlayers.values())
            .sort((a, b) => (b.score || 0) - (a.score || 0))
            .slice(0, 10); // Top 10
          
          displaySpaceInvadersData(combinedData);
          addLog('‚úÖ Space Invaders & Cheese Invaders data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load game data: ${data.error || 'No data available'}`);
        }
      } catch (error) {
        addLog(`‚ùå Game data loading error: ${error.message}`);
      }
    }

    function displaySpaceInvadersData(invadersData) {
      try {
        console.log('üëæ Space Invaders data received:', invadersData);
        
        // Helper function to format numbers nicely
        const formatNumber = (num) => {
          if (num === null || num === undefined || num === '-') return '-';
          if (typeof num === 'string') num = parseFloat(num);
          if (isNaN(num)) return '-';
          return num.toLocaleString();
        };

        // Helper function to format scores with DSPOINC conversion
        const formatScore = (score) => {
          if (score === null || score === undefined || score === '-') return '-';
          if (typeof score === 'string') score = parseFloat(score);
          if (isNaN(score)) return '-';
          const dspoinc = score * 10; // Space Invaders uses 10x multiplier like other games
          return `${score.toLocaleString()} (${dspoinc.toLocaleString()} DSPOINC)`;
        };

        // Update combined statistics from both games
        if (document.getElementById('spaceInvadersTotalScores')) {
          const totalScores = invadersData.combined_stats?.total_scores || 0;
          document.getElementById('spaceInvadersTotalScores').textContent = formatNumber(totalScores);
          document.getElementById('spaceInvadersTotalScores').className = totalScores > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('spaceInvadersUniquePlayers')) {
          const uniquePlayers = invadersData.combined_stats?.unique_players || 0;
          document.getElementById('spaceInvadersUniquePlayers').textContent = formatNumber(uniquePlayers);
          document.getElementById('spaceInvadersUniquePlayers').className = uniquePlayers > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('spaceInvadersMaxScore')) {
          const maxScore = invadersData.combined_stats?.max_score || 0;
          document.getElementById('spaceInvadersMaxScore').textContent = formatScore(maxScore);
          document.getElementById('spaceInvadersMaxScore').className = maxScore > 0 ? 'text-green-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('spaceInvadersAvgScore')) {
          const avgScore = invadersData.combined_stats?.avg_score || 0;
          document.getElementById('spaceInvadersAvgScore').textContent = formatScore(avgScore);
          document.getElementById('spaceInvadersAvgScore').className = avgScore > 0 ? 'text-blue-400 font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('spaceInvadersRecent24h')) {
          const recent24h = invadersData.combined_stats?.recent_24h || 0;
          document.getElementById('spaceInvadersRecent24h').textContent = formatNumber(recent24h);
          document.getElementById('spaceInvadersRecent24h').className = recent24h > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('spaceInvadersRecent7d')) {
          const recent7d = invadersData.combined_stats?.recent_7d || 0;
          document.getElementById('spaceInvadersRecent7d').textContent = formatNumber(recent7d);
          document.getElementById('spaceInvadersRecent7d').className = recent7d > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }

        // Update player statistics with better formatting
        if (document.getElementById('spaceInvadersActivePlayers')) {
          const activePlayers = invadersData.combined_stats?.unique_players || 0;
          document.getElementById('spaceInvadersActivePlayers').textContent = formatNumber(activePlayers);
          document.getElementById('spaceInvadersActivePlayers').className = activePlayers > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('spaceInvadersNewPlayers')) {
          document.getElementById('spaceInvadersNewPlayers').textContent = 'üìä Coming Soon';
          document.getElementById('spaceInvadersNewPlayers').className = 'text-blue-400 text-sm';
        }
        
        if (document.getElementById('spaceInvadersReturningPlayers')) {
          document.getElementById('spaceInvadersReturningPlayers').textContent = 'üìä Coming Soon';
          document.getElementById('spaceInvadersReturningPlayers').className = 'text-blue-400 text-sm';
        }
        
        if (document.getElementById('spaceInvadersGrowthRate')) {
          document.getElementById('spaceInvadersGrowthRate').textContent = 'üìä Coming Soon';
          document.getElementById('spaceInvadersGrowthRate').className = 'text-blue-400 text-sm';
        }

        // Update leaderboard with combined data from both games
        const leaderboard = document.getElementById('spaceInvadersLeaderboard');
        if (leaderboard) {
          if (invadersData.combined_top_players && invadersData.combined_top_players.length > 0) {
            leaderboard.innerHTML = invadersData.combined_top_players.map((player, index) => {
              const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
              const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
              const scoreValue = player.score || 0;
              const dspoincValue = scoreValue * 10;
              const gameBadge = player.game_emoji || 'üéÆ';
              const gameName = player.game || 'Unknown Game';
              
              return `
                <div class="leaderboard-item" style="animation-delay: ${index * 0.1}s;">
                  <div class="leaderboard-rank ${rankClass}">
                    ${rankEmoji} #${index + 1}
                  </div>
                  <div class="leaderboard-info">
                    <div class="leaderboard-name">
                      ${player.username || 'Unknown Player'}
                      ${index < 3 ? `<span class="text-xs ml-2 px-2 py-1 bg-blue-900 bg-opacity-50 rounded-full text-blue-200">Top Player</span>` : ''}
                      <div class="text-xs text-gray-400 mt-1">
                        ${gameBadge} ${gameName}
                      </div>
                    </div>
                    <div class="leaderboard-score">
                      <span class="font-bold text-blue-300">${scoreValue.toLocaleString()}</span>
                      <span class="text-xs text-gray-400 ml-2">(${dspoincValue.toLocaleString()} DSPOINC)</span>
                    </div>
                  </div>
                  <div class="leaderboard-date">
                    <div class="text-center">
                      <div class="text-xs text-gray-400 mb-1">Discord ID</div>
                      <div class="font-mono text-sm">${player.discord_id || 'N/A'}</div>
                    </div>
                  </div>
                </div>
              `;
            }).join('');
            
            // Add leaderboard summary
            const summary = document.createElement('div');
            summary.className = 'mt-4 p-4 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-700 border-opacity-50';
            summary.innerHTML = `
              <div class="flex items-center justify-between text-sm">
                <div class="text-blue-200">
                  <span class="font-semibold">üèÜ Combined Leaderboard Summary:</span>
                  ${invadersData.combined_top_players.length} players ranked from both games
                </div>
                <div class="text-blue-300">
                  <span class="font-semibold">Total DSPOINC:</span>
                  ${invadersData.combined_top_players.reduce((sum, p) => sum + (p.score || 0) * 10, 0).toLocaleString()}
                </div>
              </div>
            `;
            leaderboard.appendChild(summary);
          } else {
            leaderboard.innerHTML = `
              <div class="text-center p-8 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 border-opacity-50">
                <div class="text-gray-300 text-2xl mb-3">üëæ</div>
                <div class="text-gray-400 text-lg mb-2 font-semibold">No Leaderboard Data</div>
                <div class="text-gray-500 text-sm mb-4">No players have completed Space Invaders or Cheese Invaders games yet</div>
                <div class="text-blue-400 text-sm bg-blue-900 bg-opacity-30 px-4 py-2 rounded-full border border-blue-700 border-opacity-50">
                  Start playing to see rankings! üéÆ
                </div>
              </div>
            `;
          }
        }

        // Add data summary at the top (combined data)
        const dataSummary = document.createElement('div');
        dataSummary.className = 'mb-4 p-3 bg-blue-900 bg-opacity-50 rounded-lg';
        dataSummary.innerHTML = `
          <div class="text-blue-200 text-sm">
            <strong>üìä Combined Data Summary:</strong> 
            ${invadersData.combined_stats?.total_scores || 0} total scores from ${invadersData.combined_stats?.unique_players || 0} unique players across both games
            ${invadersData.combined_stats?.total_scores > 0 ? '‚úÖ' : '‚ùå No data yet'}
          </div>
          <div class="text-blue-300 text-xs mt-2">
            <strong>üïí Last Updated:</strong> ${new Date().toLocaleString()}
          </div>
        `;
        
        // Insert summary at the top of the Space Invaders tab
        const spaceInvadersTab = document.getElementById('spaceInvadersTab');
        if (spaceInvadersTab && !spaceInvadersTab.querySelector('.data-summary')) {
          dataSummary.className += ' data-summary';
          spaceInvadersTab.insertBefore(dataSummary, spaceInvadersTab.firstChild);
        }

      } catch (error) {
        console.error('Error displaying Space Invaders data:', error);
        addLog(`‚ùå Error displaying Space Invaders data: ${error.message}`);
        
        // Show error state in the display
        const leaderboard = document.getElementById('spaceInvadersLeaderboard');
        if (leaderboard) {
          leaderboard.innerHTML = `
            <div class="text-center p-6">
              <div class="text-red-400 text-lg mb-2">‚ùå Error Loading Data</div>
              <div class="text-gray-500 text-sm">Failed to display Space Invaders data</div>
              <div class="text-blue-400 text-sm mt-2">Check console for details</div>
            </div>
          `;
        }
      }
    }

    // Boss Level Notification Functions
    async function loadBossNotifications() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üëë Loading boss level notifications...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php');
        const data = await response.json();
        
        if (data.success && data.notifications) {
          displayBossNotifications(data.notifications);
          addLog(`‚úÖ Loaded ${data.notifications.length} boss notifications`);
        } else {
          addLog(`‚ùå Failed to load boss notifications: ${data.error || 'No data available'}`);
          displayBossNotifications([]);
        }
      } catch (error) {
        addLog(`‚ùå Boss notifications loading error: ${error.message}`);
        displayBossNotifications([]);
      }
    }

    function displayBossNotifications(notifications) {
      const container = document.getElementById('bossNotificationsList');
      if (!container) return;

      // Calculate total DSPOINC rewards given
      const totalRewards = notifications
        .filter(n => n.special_reward_given && n.dspoinc_earned)
        .reduce((sum, n) => sum + (n.dspoinc_earned || 0), 0);
      
      // Calculate pending notifications
      const pendingCount = notifications.filter(n => n.status === 'pending').length;
      
      // Update the total rewards display
      const totalRewardsElement = document.getElementById('totalBossRewards');
      if (totalRewardsElement) {
        totalRewardsElement.textContent = totalRewards.toLocaleString();
      }
      
      // Update the pending count display
      const pendingElement = document.getElementById('pendingBossNotifications');
      if (pendingElement) {
        pendingElement.textContent = pendingCount;
        // Highlight if there are pending notifications
        pendingElement.parentElement.className = pendingCount > 0 
          ? 'text-sm text-orange-400 bg-orange-900 bg-opacity-30 px-3 py-1 rounded-full animate-pulse'
          : 'text-sm text-blue-400 bg-blue-900 bg-opacity-30 px-3 py-1 rounded-full';
      }

      if (!notifications || notifications.length === 0) {
        container.innerHTML = `
          <div class="text-center py-6 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 border-opacity-50">
            <div class="text-gray-300 text-2xl mb-3">üëë</div>
            <div class="text-gray-400 text-lg mb-2 font-semibold">No Boss Notifications</div>
            <div class="text-gray-500 text-sm">Players haven't reached boss levels yet</div>
            <div class="text-blue-400 text-sm bg-blue-900 bg-opacity-30 px-4 py-2 rounded-full border border-blue-700 border-opacity-50 mt-3">
              Start playing Space Invaders! üéÆ
            </div>
          </div>
        `;
        return;
      }

      container.innerHTML = notifications.map(notification => {
        const statusColor = notification.status === 'pending' ? 'text-yellow-400' : 
                           notification.status === 'reviewed' ? 'text-blue-400' : 
                           notification.status === 'rewarded' ? 'text-green-400' : 'text-gray-400';
        
        const statusIcon = notification.status === 'pending' ? '‚è≥' : 
                          notification.status === 'reviewed' ? 'üëÅÔ∏è' : 
                          notification.status === 'rewarded' ? '‚úÖ' : '‚ùì';
        
        const rewardBadge = notification.special_reward_given ? 
          '<span class="inline-block bg-green-600 text-white text-xs px-2 py-1 rounded-full ml-2">üéÅ Special Reward Given</span>' : '';
        
        const adminInfo = notification.admin_reviewed_by ? 
          `<div class="text-xs text-gray-400 mt-1">Reviewed by: ${notification.admin_reviewed_by} on ${new Date(notification.admin_reviewed_at).toLocaleDateString()}</div>` : '';
        
        const rewardInfo = notification.reward_description ? 
          `<div class="text-xs text-green-400 mt-1">üéÅ Reward: ${notification.reward_description}</div>` : '';
        
        // Add DSPOINC reward info if available
        const dspoincInfo = notification.dspoinc_earned ? 
          `<div class="text-xs text-yellow-400 mt-1">üí∞ DSPOINC Earned: ${notification.dspoinc_earned.toLocaleString()}</div>` : '';

        return `
          <div class="bg-gray-800 p-4 rounded-lg border border-gray-700 border-opacity-50 hover:border-orange-500 transition-all duration-300">
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-orange-400 font-bold">üëë ${notification.boss_name || 'Boss'}</span>
                  <span class="text-sm text-gray-400">Level ${notification.boss_level}</span>
                  <span class="text-sm text-blue-400">Wave ${notification.wave_number}</span>
                  ${rewardBadge}
                </div>
                <div class="text-white font-semibold">
                  ${notification.discord_name ? 
                    `üéÆ ${notification.discord_name}` : 
                    notification.player_username
                  }
                  ${notification.discord_id ? 
                    `<span class="text-xs text-blue-400 ml-2">ID: ${notification.discord_id}</span>` : 
                    ''
                  }
                </div>
                <div class="text-sm text-gray-300">
                  Score: ${notification.score ? notification.score.toLocaleString() : 'N/A'} 
                  (${notification.dspoinc_earned ? notification.dspoinc_earned.toLocaleString() : 'N/A'} DSPOINC)
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  ${new Date(notification.created_at).toLocaleString()}
                </div>
                ${adminInfo}
                ${rewardInfo}
                ${dspoincInfo}
              </div>
              <div class="flex flex-col gap-2 ml-4">
                <span class="text-sm ${statusColor} font-semibold">${statusIcon} ${notification.status}</span>
                ${notification.status === 'pending' ? `
                  <button onclick="reviewBossNotification(${notification.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">üëÅÔ∏è Review</button>
                  <button onclick="giveSpecialReward(${notification.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs">üéÅ Give Reward</button>
                ` : ''}
                ${notification.status === 'reviewed' ? `
                  <button onclick="giveSpecialReward(${notification.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs">üéÅ Give Reward</button>
                ` : ''}
                <button onclick="deleteBossNotification(${notification.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs">üóëÔ∏è Delete</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function reviewBossNotification(notificationId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            id: notificationId,
            status: 'reviewed',
            admin_reviewed_by: currentAdmin.username || 'Admin'
          })
        });

        const data = await response.json();
        if (data.success) {
          addLog('‚úÖ Boss notification marked as reviewed');
          showNotification('‚úÖ Boss notification marked as reviewed', 'success');
          loadBossNotifications(); // Refresh the list
        } else {
          addLog(`‚ùå Failed to review notification: ${data.error}`);
          showNotification(`‚ùå Failed to review notification: ${data.error}`, 'error');
        }
      } catch (error) {
        addLog(`‚ùå Error reviewing notification: ${error.message}`);
      }
    }

    async function giveSpecialReward(notificationId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      // Create a custom reward input modal
      const rewardModal = document.createElement('div');
      rewardModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      rewardModal.innerHTML = `
        <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4">
          <h3 class="text-xl font-bold text-white mb-4">üéÅ Give Special Boss Reward</h3>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">DSPOINC Amount</label>
              <input type="number" id="rewardDspoincAmount" placeholder="100" min="1" max="10000" 
                     class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:border-blue-500 focus:outline-none">
              <p class="text-xs text-gray-400 mt-1">Enter the DSPOINC amount to give to the player</p>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">Reward Description</label>
              <textarea id="rewardDescription" placeholder="Boss level achievement reward" rows="3"
                        class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:border-blue-500 focus:outline-none"></textarea>
              <p class="text-xs text-gray-400 mt-1">Describe what this reward is for</p>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">Message to Player</label>
              <textarea id="playerMessage" placeholder="Congratulations on reaching the boss level!" rows="2"
                        class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:border-blue-500 focus:outline-none"></textarea>
              <p class="text-xs text-gray-400 mt-1">Optional message to send with the reward</p>
            </div>
          </div>
          
          <div class="flex gap-3 mt-6">
            <button onclick="this.closest('.fixed').remove()" 
                    class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors">
              Cancel
            </button>
            <button onclick="submitBossReward(${notificationId})" 
                    class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors">
              üéÅ Give Reward
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(rewardModal);
    }

    async function submitBossReward(notificationId) {
      const dspoincAmount = document.getElementById('rewardDspoincAmount').value;
      const rewardDescription = document.getElementById('rewardDescription').value;
      const playerMessage = document.getElementById('playerMessage').value;
      
      if (!dspoincAmount || !rewardDescription) {
        showNotification('‚ùå Please fill in DSPOINC amount and reward description', 'error');
        return;
      }
      
      try {
        // First, update the notification status
        const notificationResponse = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            id: notificationId,
            status: 'rewarded',
            admin_reviewed_by: currentAdmin.username || 'Admin',
            special_reward_given: true,
            reward_description: rewardDescription
          })
        });

        const notificationData = await notificationResponse.json();
        if (!notificationData.success) {
          throw new Error(`Failed to update notification: ${notificationData.error}`);
        }

        // Get the notification details to find the player
        const getNotificationResponse = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php?id=' + notificationId);
        const notificationDetails = await getNotificationResponse.json();
        
        if (!notificationDetails.success || !notificationDetails.notifications || notificationDetails.notifications.length === 0) {
          throw new Error('Failed to get notification details');
        }
        
        const notification = notificationDetails.notifications[0];
        const playerUsername = notification.player_username;
        const playerId = notification.player_id;
        
        // Now give the DSPOINC reward using the existing points system
        const pointsResponse = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            action: 'adjust_points',
            user_identifier: playerUsername,
            points_change: parseInt(dspoincAmount),
            reason: `Boss Level Achievement Reward: ${rewardDescription}`,
            admin_username: currentAdmin.username || 'Admin',
            game_type: 'space_invaders',
            additional_notes: playerMessage || `Congratulations on reaching boss level ${notification.boss_level}!`
          })
        });

        const pointsData = await pointsResponse.json();
        if (!pointsData.success) {
          throw new Error(`Failed to give DSPOINC reward: ${pointsData.error}`);
        }

        // Close the modal
        document.querySelector('.fixed').remove();
        
        // Show success message
        const successMessage = `‚úÖ Gave ${dspoincAmount} DSPOINC to ${playerUsername} for boss level achievement!`;
        addLog(successMessage);
        showNotification(successMessage, 'success');
        
        // Refresh the notifications list
        loadBossNotifications();
        
      } catch (error) {
        addLog(`‚ùå Error giving boss reward: ${error.message}`);
        showNotification(`‚ùå Error giving boss reward: ${error.message}`, 'error');
      }
    }

    async function deleteBossNotification(notificationId) {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      if (!confirm('Are you sure you want to delete this boss notification?')) return;

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            id: notificationId
          })
        });

        const data = await response.json();
        if (data.success) {
          addLog('‚úÖ Boss notification deleted');
          showNotification('‚úÖ Boss notification deleted', 'success');
          loadBossNotifications(); // Refresh the list
        } else {
          addLog(`‚ùå Failed to delete notification: ${data.error}`);
          showNotification(`‚ùå Failed to delete notification: ${data.error}`, 'error');
        }
      } catch (error) {
        addLog(`‚ùå Error deleting notification: ${error.message}`);
      }
    }

    function filterBossNotifications() {
      const filter = document.getElementById('bossNotificationFilter').value;
      loadBossNotifications(filter);
    }

    async function clearOldNotifications() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      if (!confirm('Are you sure you want to clear old notifications? This will delete all reviewed and rewarded notifications older than 30 days.')) return;

      try {
        // This would need a separate API endpoint for bulk deletion
        addLog('üîÑ Clearing old notifications...');
        // For now, just reload the current notifications
        loadBossNotifications();
        addLog('‚úÖ Old notifications cleared (feature to be implemented)');
      } catch (error) {
        addLog(`‚ùå Error clearing notifications: ${error.message}`);
      }
    }

    // Start real-time notification checking when Space Invaders tab is opened
    let bossNotificationCheckInterval;
    let dashboardBossStatsInterval;
    
    function startBossNotificationChecking() {
      // Clear any existing interval
      if (bossNotificationCheckInterval) {
        clearInterval(bossNotificationCheckInterval);
      }
      
      // Check for new notifications every 30 seconds
      bossNotificationCheckInterval = setInterval(async () => {
        if (document.getElementById('spaceInvadersTab').style.display !== 'none') {
          await checkForNewBossNotifications();
        }
      }, 30000); // 30 seconds
    }
    
    function startDashboardBossStatsUpdating() {
      // Clear any existing interval
      if (dashboardBossStatsInterval) {
        clearInterval(dashboardBossStatsInterval);
      }
      
      // Update dashboard boss stats every 60 seconds
      dashboardBossStatsInterval = setInterval(async () => {
        if (currentAdmin && document.getElementById('dashboardTab').style.display !== 'none') {
          await updateDashboardBossStats();
        }
      }, 60000); // 60 seconds
    }
    
    function stopBossNotificationChecking() {
      if (bossNotificationCheckInterval) {
        clearInterval(bossNotificationCheckInterval);
        bossNotificationCheckInterval = null;
      }
    }
    
    function stopDashboardBossStatsUpdating() {
      if (dashboardBossStatsInterval) {
        clearInterval(dashboardBossStatsInterval);
        dashboardBossStatsInterval = null;
      }
    }
    
    async function updateDashboardBossStats() {
      try {
        const bossStatsResponse = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php');
        const bossStats = await bossStatsResponse.json();
        
        if (bossStats.success && bossStats.notifications) {
          const notifications = bossStats.notifications;
          
          // Calculate boss stats
          const pendingBossClaims = notifications.filter(n => n.status === 'pending').length;
          const totalBossRewards = notifications
            .filter(n => n.special_reward_given && n.dspoinc_earned)
            .reduce((sum, n) => sum + (n.dspoinc_earned || 0), 0);
          
          const today = new Date().toDateString();
          const bossClaimsToday = notifications
            .filter(n => new Date(n.created_at).toDateString() === today).length;
          
          const rewardedNotifications = notifications.filter(n => n.special_reward_given && n.dspoinc_earned);
          const avgBossReward = rewardedNotifications.length > 0 
            ? Math.round(totalBossRewards / rewardedNotifications.length) 
            : 0;
          
          // Update boss stats
          document.getElementById('pendingBossClaims').textContent = pendingBossClaims;
          document.getElementById('totalBossRewards').textContent = totalBossRewards.toLocaleString();
          document.getElementById('bossClaimsToday').textContent = bossClaimsToday;
          document.getElementById('avgBossReward').textContent = avgBossReward.toLocaleString();
          
          // Update detailed boss stats
          displayRecentBossClaims(notifications.slice(0, 5)); // Show last 5
          displayBossAchievementTypes(notifications);
          
          // Show notification if there are new pending claims
          if (pendingBossClaims > 0) {
            showNotification(`üëë ${pendingBossClaims} new boss level claim(s) pending review!`, 'info', 3000);
          }
        }
      } catch (error) {
        console.debug('Background dashboard boss stats update failed:', error);
      }
    }
    
    async function checkForNewBossNotifications() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/boss-level-notification.php?status=pending&limit=1');
        const data = await response.json();
        
        if (data.success && data.notifications && data.notifications.length > 0) {
          const latestNotification = data.notifications[0];
          const notificationTime = new Date(latestNotification.created_at).getTime();
          const currentTime = Date.now();
          
          // Show indicator if notification is less than 5 minutes old
          if (currentTime - notificationTime < 300000) { // 5 minutes
            showBossNotificationIndicator();
          }
        }
      } catch (error) {
        // Silently fail for background checks
        console.debug('Background boss notification check failed:', error);
      }
    }
    
    function showBossNotificationIndicator() {
      const indicator = document.getElementById('bossNotificationIndicator');
      if (indicator) {
        indicator.classList.remove('hidden');
        
        // Auto-hide after 10 seconds
        setTimeout(() => {
          indicator.classList.add('hidden');
        }, 10000);
      }
    }

    // Cheese Hunt Tab Functions
    async function loadCheeseHuntData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading Cheese Hunt data...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games && data.data.games.cheese_hunt) {
          displayCheeseData(data.data.games.cheese_hunt);
          addLog('‚úÖ Cheese Hunt data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load Cheese Hunt data: ${data.error || 'No data available'}`);
        }
      } catch (error) {
        addLog(`‚ùå Cheese Hunt data loading error: ${error.message}`);
      }
    }

    function displayCheeseData(cheeseData) {
      try {
        console.log('üßÄ Cheese Hunt data received:', cheeseData);
        console.log('üßÄ Cheese Hunt data structure:', JSON.stringify(cheeseData, null, 2));
        console.log('üßÄ Cheese Hunt current_data:', cheeseData.current_data);
        console.log('üßÄ Cheese Hunt top_players:', cheeseData.top_players);
        
        // Add log to admin interface
        addLog('üßÄ Displaying Cheese Hunt data...');
        addLog('üßÄ Data structure: ' + JSON.stringify(cheeseData, null, 2));
        // Update Cheese Hunt statistics from current_data
        console.log('Looking for cheeseTotalClicks element:', document.getElementById('cheeseTotalClicks'));
        if (document.getElementById('cheeseTotalClicks')) {
          console.log('Setting cheeseTotalClicks to:', cheeseData.current_data?.total_clicks || '-');
          document.getElementById('cheeseTotalClicks').textContent = cheeseData.current_data?.total_clicks || '-';
        } else {
          console.error('Element cheeseTotalClicks not found!');
        }
        
        if (document.getElementById('cheeseUniquePlayers')) {
          console.log('Setting cheeseUniquePlayers to:', cheeseData.current_data?.unique_players || '-');
          document.getElementById('cheeseUniquePlayers').textContent = cheeseData.current_data?.unique_players || '-';
        } else {
          console.error('Element cheeseUniquePlayers not found!');
        }
        
        if (document.getElementById('cheeseClicksToday')) {
          console.log('Setting cheeseClicksToday to:', cheeseData.current_data?.recent_24h || '-');
          document.getElementById('cheeseClicksToday').textContent = cheeseData.current_data?.recent_24h || '-';
        } else {
          console.error('Element cheeseClicksToday not found!');
        }
        if (document.getElementById('cheeseAvgClicks')) document.getElementById('cheeseAvgClicks').textContent = '-';
        if (document.getElementById('cheeseRegularEggs')) document.getElementById('cheeseRegularEggs').textContent = '-';
        if (document.getElementById('cheeseGoldenEggs')) document.getElementById('cheeseGoldenEggs').textContent = '-';
        if (document.getElementById('cheeseRareEggs')) document.getElementById('cheeseRareEggs').textContent = '-';
        if (document.getElementById('cheeseAchievements')) document.getElementById('cheeseAchievements').textContent = '-';
        if (document.getElementById('cheeseCompletionRate')) document.getElementById('cheeseCompletionRate').textContent = '-';
        if (document.getElementById('cheeseActiveHunters')) document.getElementById('cheeseActiveHunters').textContent = cheeseData.current_data?.unique_players || '-';

        // Update statistics cards with new structure
        console.log('üßÄ Updating Cheese Hunt statistics cards...');
        
        if (document.getElementById('cheeseTotalClicks')) {
          const totalClicks = cheeseData.current_data?.total_clicks || 0;
          document.getElementById('cheeseTotalClicks').textContent = formatNumber(totalClicks);
          console.log('üßÄ Updated cheeseTotalClicks:', totalClicks);
        } else {
          console.log('‚ùå cheeseTotalClicks element not found');
        }
        
        if (document.getElementById('cheeseUniquePlayers')) {
          const uniquePlayers = cheeseData.current_data?.unique_players || 0;
          document.getElementById('cheeseUniquePlayers').textContent = formatNumber(uniquePlayers);
        }
        
        if (document.getElementById('cheeseClicksToday')) {
          const clicksToday = cheeseData.current_data?.recent_24h || 0;
          document.getElementById('cheeseClicksToday').textContent = formatNumber(clicksToday);
        }
        
        if (document.getElementById('cheeseAvgClicks')) {
          const totalClicks = cheeseData.current_data?.total_clicks || 0;
          const uniquePlayers = cheeseData.current_data?.unique_players || 0;
          const avgClicks = uniquePlayers > 0 ? Math.round(totalClicks / uniquePlayers) : 0;
          document.getElementById('cheeseAvgClicks').textContent = formatNumber(avgClicks);
        }
        
        if (document.getElementById('cheeseRegularEggs')) {
          document.getElementById('cheeseRegularEggs').textContent = 'üìä Coming Soon';
        }
        
        if (document.getElementById('cheeseGoldenEggs')) {
          document.getElementById('cheeseGoldenEggs').textContent = 'üìä Coming Soon';
        }
        
        if (document.getElementById('cheeseRareEggs')) {
          document.getElementById('cheeseRareEggs').textContent = 'üìä Coming Soon';
        }
        
        if (document.getElementById('cheeseRecent24h')) {
          const recent24h = cheeseData.current_data?.recent_24h || 0;
          document.getElementById('cheeseRecent24h').textContent = formatNumber(recent24h);
        }
        
        if (document.getElementById('cheeseRecent7d')) {
          const recent7d = cheeseData.current_data?.recent_7d || 0;
          document.getElementById('cheeseRecent7d').textContent = formatNumber(recent7d);
        }
        
        if (document.getElementById('cheeseGrowthRate')) {
          document.getElementById('cheeseGrowthRate').textContent = 'üìä Coming Soon';
        }
        
        if (document.getElementById('cheeseDifficulty')) {
          document.getElementById('cheeseDifficulty').textContent = 'Normal';
        }

        // Update leaderboard with enhanced styling using new CSS classes
        const leaderboard = document.getElementById('cheeseLeaderboard');
        console.log('üßÄ Looking for cheeseLeaderboard element:', leaderboard);
        addLog('üßÄ Looking for cheeseLeaderboard element: ' + (leaderboard ? 'FOUND' : 'NOT FOUND'));
        
        if (leaderboard) {
          if (cheeseData.top_players && cheeseData.top_players.length > 0) {
            addLog('üßÄ Found ' + cheeseData.top_players.length + ' top hunters, showing data grid');
            // Show actual player data in a grid format like other tabs
            leaderboard.innerHTML = `
              <div class="space-y-2">
                ${cheeseData.top_players.map((player, index) => `
                  <div class="flex justify-between items-center p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition-all duration-200 border-l-4 border-l-${index === 0 ? 'yellow' : index === 1 ? 'gray' : index === 2 ? 'orange' : 'blue'}-500">
                    <div class="flex items-center space-x-3">
                      <span class="text-lg font-bold text-${index === 0 ? 'yellow' : index === 1 ? 'gray' : index === 2 ? 'orange' : 'blue'}-400">#${index + 1}</span>
                      <div>
                        <div class="font-semibold text-white">${player.username || 'Anonymous'}</div>
                        <div class="text-xs text-gray-400">ID: ${player.user_id || 'N/A'}</div>
                      </div>
                    </div>
                    <div class="text-right">
                      <div class="text-lg font-bold text-yellow-400">${player.clicks || 0} clicks</div>
                      <div class="text-sm text-blue-400">${player.games || 1} game${player.games !== 1 ? 's' : ''}</div>
                      <div class="text-xs text-gray-400">Avg: ${player.games > 0 ? Math.round((player.clicks || 0) / player.games) : 0}</div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `;
          } else {
            addLog('üßÄ No top hunters found, showing empty state grid');
            // Show a proper grid structure even when no data
            leaderboard.innerHTML = `
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-gray-700 p-4 rounded-lg text-center">
                  <div class="text-3xl mb-2">üßÄ</div>
                  <div class="text-lg font-semibold text-white mb-2">No Hunters Yet</div>
                  <div class="text-sm text-gray-400">Start hunting to appear here!</div>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg text-center">
                  <div class="text-3xl mb-2">üìä</div>
                  <div class="text-lg font-semibold text-white mb-2">Total Clicks: ${cheeseData.current_data?.total_clicks || 0}</div>
                  <div class="text-sm text-gray-400">Status: ${cheeseData.status || 'Active'}</div>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg text-center">
                  <div class="text-3xl mb-2">üéØ</div>
                  <div class="text-lg font-semibold text-white mb-2">Players: ${cheeseData.current_data?.unique_players || 0}</div>
                  <div class="text-sm text-gray-400">Today: ${cheeseData.current_data?.recent_24h || 0}</div>
                </div>
              </div>
            `;
          }
        } else {
          addLog('‚ùå ERROR: cheeseLeaderboard element not found!');
          console.error('‚ùå cheeseLeaderboard element not found!');
        }
      } catch (error) {
        console.error('Error displaying Cheese Hunt data:', error);
        addLog(`‚ùå Error displaying Cheese Hunt data: ${error.message}`);
      }
    }

    // Discord Config Tab Functions
    async function loadDiscordConfigData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading Discord configuration data...');

      try {
        // Load Discord bot configuration and status
        const response = await fetch(API_BASE_URL + '/api/admin/get-discord-activity.php');
        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Discord configuration data loaded successfully');
          
          // Update dynamic Discord data if available
          const currentCodeElement = document.getElementById('currentCode');
          const currentUrlElement = document.getElementById('currentUrl');
          const lastUpdatedElement = document.getElementById('lastUpdated');
          
          if (currentCodeElement && data.invite_code) {
            currentCodeElement.textContent = data.invite_code;
          }
          if (currentUrlElement && data.discord_url) {
            currentUrlElement.textContent = data.discord_url;
          }
          if (lastUpdatedElement) {
            lastUpdatedElement.textContent = new Date().toLocaleDateString();
          }
        } else {
          addLog(`‚ùå Failed to load Discord config data: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Discord config data loading error: ${error.message}`);
      }
    }

    // Cheese Guide Tab Functions
    async function loadCheeseGuideData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üßÄ Loading Cheese Guide data...');

      try {
        // The Cheese Guide tab content is static, so no additional data loading needed
        // Just ensure the tab is visible and content is displayed
        addLog('‚úÖ Cheese Guide data loaded successfully');
        
        // Update any dynamic content if available
        const currentDate = new Date().toLocaleDateString();
        const dateElements = document.querySelectorAll('#cheeseGuideTab .text-gray-400');
        if (dateElements.length > 0) {
          dateElements.forEach(element => {
            if (element.textContent.includes('Last Updated')) {
              element.textContent = `Last Updated: ${currentDate}`;
            }
          });
        }
      } catch (error) {
        addLog(`‚ùå Cheese Guide data loading error: ${error.message}`);
      }
    }

    // Discord Cheese Race Tab Functions
    async function loadDiscordRaceData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Loading Discord Cheese Race data...');

      try {
        // Load data from the consolidated games stats API
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games && data.data.games.discord_race) {
          console.log('Discord Race data found in response:', data.data.games.discord_race);
          // Add a small delay to ensure DOM is ready
          setTimeout(() => {
            displayDiscordRaceData(data.data.games.discord_race);
          }, 100);
          addLog('‚úÖ Discord Cheese Race data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load Discord Race data: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Discord Race data loading error: ${error.message}`);
      }
    }

    // Discord Race Sync Function - Syncs with Discord bot data
    async function syncDiscordRaceData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üîÑ Syncing Discord Race data with bot...');

      try {
        // Show loading state
        const syncButton = document.querySelector('button[onclick="syncDiscordRaceData()"]');
        if (syncButton) {
          syncButton.disabled = true;
          syncButton.innerHTML = 'üîÑ Syncing...';
        }

        // Call the Discord bot sync API
        const response = await fetch(API_BASE_URL + '/api/admin/sync-discord-race.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'sync_race_data',
            admin_username: currentAdmin
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Discord Race sync completed! ${data.message || ''}`);
          
          // Refresh the race data after sync
          setTimeout(() => {
            loadDiscordRaceData();
          }, 1000);
          
          // Show success notification
          showNotification('üîÑ Discord Race Sync Complete', 'Race data has been synchronized with the Discord bot!', 'success');
          } else {
          addLog(`‚ùå Discord Race sync failed: ${data.error || 'Unknown error'}`);
          showNotification('‚ùå Sync Failed', data.error || 'Failed to sync Discord race data', 'error');
        }
      } catch (error) {
        addLog(`‚ùå Discord Race sync error: ${error.message}`);
        showNotification('‚ùå Sync Error', `Error: ${error.message}`, 'error');
      } finally {
        // Restore button state
        if (syncButton) {
          syncButton.disabled = false;
          syncButton.innerHTML = 'üîÑ Sync Discord Bot';
        }
      }
    }

    // Display Discord Race data
    function displayDiscordRaceData(raceData) {
      try {
        console.log('üèÅ Discord Race data received:', raceData);
        console.log('üèÅ Discord Race data structure:', JSON.stringify(raceData, null, 2));
        console.log('üèÅ Discord Race race_data:', raceData.race_data);
        console.log('üèÅ Race overview available:', raceData.race_data?.race_overview);
        console.log('üèÅ Top racers available:', raceData.race_data?.top_racers);
        console.log('üèÅ Recent activity available:', raceData.race_data?.recent_activity);
        
        // Update Discord Race statistics from race_data API
        console.log('Looking for raceTotalRaces element:', document.getElementById('raceTotalRaces'));
        if (document.getElementById('raceTotalRaces')) {
          console.log('Setting raceTotalRaces to:', raceData.race_data?.total_races || 0);
          document.getElementById('raceTotalRaces').textContent = raceData.race_data?.total_races || 0;
        } else {
          console.error('Element raceTotalRaces not found!');
        }
        
        if (document.getElementById('raceActiveRaces')) {
          console.log('Setting raceActiveRaces to:', raceData.race_data?.recent_24h || 0);
          document.getElementById('raceActiveRaces').textContent = raceData.race_data?.recent_24h || 0;
        } else {
          console.error('Element raceActiveRaces not found!');
        }
        
        if (document.getElementById('raceTotalParticipants')) {
          console.log('Setting raceTotalParticipants to:', raceData.race_data?.total_participants || 0);
          document.getElementById('raceTotalParticipants').textContent = raceData.race_data?.total_participants || 0;
        } else {
          console.error('Element raceTotalParticipants not found!');
          console.error('Available elements with "race" in ID:', Array.from(document.querySelectorAll('[id*="race"]')).map(el => el.id));
        }
        
        if (document.getElementById('raceTotalWinners')) {
          document.getElementById('raceTotalWinners').textContent = raceData.race_data?.total_prizes_awarded || 0;
        }
        
        // Calculate additional stats
        const totalRaces = raceData.race_data?.total_races || 0;
        const recentRacesCount = raceData.race_data?.recent_24h || 0;
        const completedRaces = totalRaces - recentRacesCount;
        const successRate = totalRaces > 0 ? Math.round((completedRaces / totalRaces) * 100) : 0;
        
        if (document.getElementById('raceCompletedRaces')) document.getElementById('raceCompletedRaces').textContent = completedRaces;
        if (document.getElementById('raceSuccessRate')) document.getElementById('raceSuccessRate').textContent = successRate + '%';
        if (document.getElementById('raceAvgParticipants')) document.getElementById('raceAvgParticipants').textContent = totalRaces > 0 ? Math.round((raceData.race_data?.total_participants || 0) / totalRaces) : 0;
        
        // Handle other elements that might not have data yet
        if (document.getElementById('raceUniqueWinners')) document.getElementById('raceUniqueWinners').textContent = 'Coming Soon';
        if (document.getElementById('raceTopWinner')) document.getElementById('raceTopWinner').textContent = 'Coming Soon';
        if (document.getElementById('racePeakParticipation')) document.getElementById('racePeakParticipation').textContent = 'Coming Soon';
        
        // Update status and other elements
        if (document.getElementById('raceStatus')) {
          document.getElementById('raceStatus').textContent = 'üü¢ Active';
        }

        // Update race overview table
        const raceOverviewTable = document.getElementById('raceOverviewTable');
        if (raceOverviewTable && raceData.race_data?.race_overview) {
          console.log('Race overview data:', raceData.race_data.race_overview);
          if (raceData.race_data.race_overview.length > 0) {
            raceOverviewTable.innerHTML = raceData.race_data.race_overview.map((race, index) => {
              console.log('Processing race:', race);
              return `
                <tr class="border-b border-gray-600 hover:bg-gray-600 transition-colors duration-200" style="animation-delay: ${index * 0.1}s">
                  <td class="p-2 text-xs font-mono text-blue-400">${race.id ? race.id.substring(0, 12) + '...' : 'N/A'}</td>
                  <td class="p-2 text-white font-semibold">${race.creator_name || 'Unknown'}</td>
                  <td class="p-2">
                    <span class="px-2 py-1 text-xs rounded-full ${
                      race.status === 'finished' ? 'bg-green-600 text-green-100' : 
                      race.status === 'active' ? 'bg-blue-600 text-blue-100' : 
                      race.status === 'waiting' ? 'bg-yellow-600 text-yellow-100' : 
                      'bg-gray-600 text-gray-100'
                    }">
                      ${race.status_icon || '‚ùì'} ${race.status_display || race.status || 'Unknown'}
                    </span>
                  </td>
                  <td class="p-2 text-center">
                    <span class="text-blue-400 font-semibold">${race.participant_count || 0}</span>
                    <span class="text-gray-400 text-xs">/${race.max_players || '?'}</span>
                  </td>
                  <td class="p-2 text-xs text-gray-300">
                    ${race.created_at ? new Date(race.created_at).toLocaleDateString() + ' ' + new Date(race.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'N/A'}
                  </td>
                  <td class="p-2 text-xs text-gray-300">${race.duration || 'N/A'}</td>
                  <td class="p-2 text-yellow-400 font-semibold">${race.dspoinc_reward || 0}</td>
                  <td class="p-2 text-xs">
                    <div class="text-green-400">Max: ${race.max_cheese_collected || 0}</div>
                    <div class="text-blue-400">Avg: ${race.avg_cheese_collected || 0}</div>
                  </td>
                </tr>
              `;
            }).join('');
          } else {
            raceOverviewTable.innerHTML = `
              <tr>
                <td colspan="8" class="text-center p-4 text-gray-400">No races found</td>
              </tr>
            `;
          }
        } else {
          console.log('Race overview table or data not found:', {
            table: raceOverviewTable,
            raceData: raceData.race_data,
            raceOverview: raceData.race_data?.race_overview
          });
          if (raceOverviewTable) {
            raceOverviewTable.innerHTML = `
              <tr>
                <td colspan="8" class="text-center p-4 text-gray-400">Loading race overview...</td>
              </tr>
            `;
          }
        }

        // Update recent races list
        const recentRacesElement = document.getElementById('recentRaceActivity');
        if (recentRacesElement) {
          console.log('Recent activity data:', raceData.race_data?.recent_activity);
          if (raceData.race_data?.recent_activity && raceData.race_data.recent_activity.length > 0) {
            // Add summary at the top
            const totalRaces = raceData.race_data.recent_activity.length;
            const raceEvents = raceData.race_data.recent_activity.filter(activity => activity.event_type === 'race_started').length;
            const playerJoins = raceData.race_data.recent_activity.filter(activity => activity.event_type === 'player_joined').length;
            
            recentRacesElement.innerHTML = `
              <div class="data-summary bg-gray-600 bg-opacity-50 p-3 rounded-lg mb-4 border border-gray-500">
                <div class="grid grid-cols-3 gap-4 text-center">
                  <div>
                    <div class="text-2xl font-bold text-blue-400">${totalRaces}</div>
                    <div class="text-xs text-gray-300">Total Events</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-green-400">${raceEvents}</div>
                    <div class="text-xs text-gray-300">Races Started</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-yellow-400">${playerJoins}</div>
                    <div class="text-xs text-gray-300">Players Joined</div>
                  </div>
                </div>
              </div>
              ${raceData.race_data.recent_activity.map((activity, index) => {
                console.log('Processing activity:', activity);
                return `
                  <div class="history-item bg-gray-600 p-3 rounded-lg mb-3 border border-gray-500 hover:bg-gray-500 transition-colors duration-200" style="animation-delay: ${index * 0.1}s">
                    <div class="flex justify-between items-start mb-2">
                      <div class="flex items-center space-x-2">
                        <span class="text-lg">${activity.event_type === 'race_started' ? 'üèÅ' : 'üë§'}</span>
                        <span class="text-white font-semibold">${activity.username || 'Unknown'}</span>
                        <span class="px-2 py-1 text-xs rounded-full ${
                          activity.event_type === 'race_started' ? 'bg-blue-600 text-blue-100' : 
                          'bg-green-600 text-green-100'
                        }">${activity.event_type === 'race_started' ? 'Race Started' : 'Player Joined'}</span>
                      </div>
                      <div class="text-right">
                        <div class="text-sm text-gray-300">${activity.created_at ? new Date(activity.created_at).toLocaleString() : 'No date'}</div>
                        <div class="text-xs text-gray-400">Race: ${activity.race_id ? activity.race_id.substring(0, 8) + '...' : 'N/A'}</div>
                      </div>
                    </div>
                    <div class="text-sm text-gray-300">
                      <span class="text-blue-400">üìÖ</span> ${activity.description || 'No description'}
                    </div>
                  </div>
                `;
              }).join('')}
            `;
          } else {
            recentRacesElement.innerHTML = `
              <div class="text-gray-400 text-center py-8">
                <div class="text-4xl mb-2">üèÅ</div>
                <p class="text-lg font-semibold mb-2">No Recent Activity</p>
                <p class="text-sm">Start a new race to see activity here!</p>
                <div class="mt-4 p-3 bg-gray-600 bg-opacity-50 rounded-lg border border-gray-500">
                  <p class="text-sm text-gray-300">Total races: ${raceData.race_data?.total_races || 0}</p>
                  <div class="text-xs text-gray-400">Total participants: ${raceData.race_data?.total_participants || 0}</div>
                </div>
              </div>
            `;
          }
        } else {
          console.log('Recent activity element not found:', recentRacesElement);
        }

        // Update leaderboard with enhanced styling
        const leaderboard = document.getElementById('raceLeaderboard');
        if (leaderboard) {
          console.log('Leaderboard data:', raceData.race_data?.top_racers);
          if (!raceData.race_data || !raceData.race_data.top_racers || raceData.race_data.top_racers.length === 0) {
            leaderboard.innerHTML = `
              <div class="text-gray-400 text-center py-8">
                <div class="text-4xl mb-2">üèÜ</div>
                <p class="text-lg font-semibold mb-2">Leaderboard Coming Soon</p>
                <p class="text-sm">Race data will appear here as players compete</p>
                <div class="mt-4 p-3 bg-gray-600 bg-opacity-50 rounded-lg border border-gray-500">
                  <p class="text-sm text-gray-300">Recent races: ${raceData.race_data?.recent_activity?.length || 0}</p>
                  <div class="text-xs text-gray-400">Total participants: ${raceData.race_data?.total_participants || 0}</div>
                </div>
              </div>
            `;
          } else {
            // Enhanced leaderboard with the new CSS classes
            const topRacers = raceData.race_data.top_racers.slice(0, 10);
            console.log('Processing top racers:', topRacers);
            leaderboard.innerHTML = `
              <div class="data-summary bg-gray-600 bg-opacity-50 p-3 rounded-lg mb-4 border border-gray-500">
                <div class="grid grid-cols-3 gap-4 text-center">
                  <div>
                    <div class="text-2xl font-bold text-blue-400">${topRacers.length}</div>
                    <div class="text-xs text-gray-300">Top Racers</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-green-400">${raceData.race_data.total_races || 0}</div>
                    <div class="text-xs text-gray-300">Total Races</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-yellow-400">${raceData.race_data.total_participants || 0}</div>
                    <div class="text-xs text-gray-300">Participants</div>
                  </div>
                </div>
              </div>
              ${topRacers.map((racer, index) => {
                console.log('Processing racer:', racer);
                return `
                  <div class="leaderboard-item bg-gray-600 p-3 rounded-lg mb-2 border border-gray-500 hover:bg-gray-500 transition-all duration-200 transform hover:scale-105" style="animation-delay: ${index * 0.1}s">
                    <div class="flex justify-between items-center">
                      <div class="flex items-center space-x-3">
                        <div class="leaderboard-rank w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${
                          index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : 'bg-gray-500 text-gray-200'
                        }">
                          ${index + 1}
                        </div>
                        <div class="leaderboard-info">
                          <div class="leaderboard-name text-white font-semibold">${racer.username || 'Unknown Player'}</div>
                          <div class="text-xs text-gray-400">${racer.user_id || 'No User ID'}</div>
                        </div>
                      </div>
                      <div class="text-right">
                        <div class="leaderboard-score text-lg font-bold text-green-400">${racer.total_cheese || 0} cheese</div>
                        <div class="text-xs text-gray-400">${racer.total_races || 0} races</div>
                        <div class="text-xs text-yellow-400">üèÜ ${racer.first_place_finishes || 0} wins</div>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            `;
          }
        } else {
          console.log('Leaderboard element not found:', leaderboard);
        }
      } catch (error) {
        console.error('Error displaying Discord Race data:', error);
        addLog(`‚ùå Error displaying Discord Race data: ${error.message}`);
      }
    }

    // Enhanced Tab Display Refresh Functions
    // These functions ensure proper display refresh for the last 3 tabs
    
    // Refresh race activity
    async function refreshRaceActivity() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }
      
      addLog('üîÑ Refreshing race activity...');
      await loadDiscordRaceData();
      addLog('‚úÖ Race activity refreshed');
    }
    
    async function refreshCheeseHuntDisplay() {
      console.log('üßÄ Refreshing Cheese Hunt display...');
      try {
        // Force a reflow and ensure visibility
        const tab = document.getElementById('cheeseHuntTab');
        if (tab) {
          // Force DOM reflow
          tab.offsetHeight;
          
          // Ensure proper display
          tab.style.display = 'block';
          tab.style.visibility = 'visible';
          tab.classList.remove('hidden');
          
          // Verify visibility
          const computedStyle = window.getComputedStyle(tab);
          const isVisible = computedStyle.display !== 'none' && 
                          computedStyle.visibility !== 'hidden' && 
                          tab.offsetHeight > 0;
          
          console.log('üßÄ Cheese Hunt tab visibility check:', {
            display: computedStyle.display,
            visibility: computedStyle.visibility,
            height: tab.offsetHeight,
            isVisible: isVisible
          });
          
          if (!isVisible) {
            console.warn('‚ö†Ô∏è Cheese Hunt tab not visible, forcing display...');
            tab.style.display = 'block';
            tab.style.visibility = 'visible';
            tab.classList.remove('hidden');
            
            // Wait a bit for the DOM to update
            await new Promise(resolve => setTimeout(resolve, 100));
          }
        }
        
        // Refresh the data display
        await loadCheeseHuntData();
        
        // Wait for content to render, then verify visibility again
        await new Promise(resolve => setTimeout(resolve, 200));
        
        // Final visibility check after content loads
        if (tab) {
          const finalCheck = window.getComputedStyle(tab);
          const finalVisible = finalCheck.display !== 'none' && 
                              finalCheck.visibility !== 'hidden' && 
                              tab.offsetHeight > 0;
          
          console.log('üßÄ Final visibility check after content load:', {
            display: finalCheck.display,
            visibility: finalCheck.visibility,
            height: tab.offsetHeight,
            isVisible: finalVisible
          });
        }
        
        addLog('‚úÖ Cheese Hunt display refreshed successfully');
      } catch (error) {
        console.error('‚ùå Error refreshing Cheese Hunt display:', error);
        addLog(`‚ùå Error refreshing Cheese Hunt display: ${error.message}`);
      }
    }
    
    async function refreshDiscordRaceDisplay() {
      console.log('üèÅ Refreshing Discord Race display...');
      try {
        // Force a reflow and ensure visibility
        const tab = document.getElementById('discordRaceTab');
        if (tab) {
          // Force DOM reflow
          tab.offsetHeight;
          
          // Ensure proper display
          tab.style.display = 'block';
          tab.style.visibility = 'visible';
          tab.classList.remove('hidden');
          
          // Verify visibility
          const computedStyle = window.getComputedStyle(tab);
          const isVisible = computedStyle.display !== 'none' && 
                          computedStyle.visibility !== 'hidden' && 
                          tab.offsetHeight > 0;
          
          console.log('üèÅ Discord Race tab visibility check:', {
            display: computedStyle.display,
            visibility: computedStyle.visibility,
            height: tab.offsetHeight,
            isVisible: isVisible
          });
          
          if (!isVisible) {
            console.warn('‚ö†Ô∏è Discord Race tab not visible, forcing display...');
            tab.style.display = 'block';
            tab.style.visibility = 'visible';
            tab.classList.remove('hidden');
            
            // Wait a bit for the DOM to update
            await new Promise(resolve => setTimeout(resolve, 100));
          }
        }
        
        // Refresh the data display
        await loadDiscordRaceData();
        
        // Wait for content to render, then verify visibility again
        await new Promise(resolve => setTimeout(resolve, 200));
        
        // Final visibility check after content loads
        if (tab) {
          const finalCheck = window.getComputedStyle(tab);
          const finalVisible = finalCheck.display !== 'none' && 
                              finalCheck.visibility !== 'hidden' && 
                              tab.offsetHeight > 0;
          
          console.log('üèÅ Final visibility check after content load:', {
            display: finalCheck.display,
            visibility: finalCheck.visibility,
            height: tab.offsetHeight,
            isVisible: finalVisible
          });
        }
        
        addLog('‚úÖ Discord Race display refreshed successfully');
      } catch (error) {
        console.error('‚ùå Error refreshing Discord Race display:', error);
        addLog(`‚ùå Error refreshing Discord Race display: ${error.message}`);
      }
    }

    // Utility Functions
    function resetTetrisScores() {
      addLog('üîÑ Tetris score reset requested...');
      if (confirm('‚ö†Ô∏è This will reset ALL Tetris scores. This action cannot be undone. Are you sure?')) {
        fetch(API_BASE_URL + '/api/admin/reset-game-scores-v2.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            game_type: 'tetris',
            reason: 'Admin requested Tetris reset'
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            addLog('‚úÖ Tetris scores reset successfully');
            loadTetrisData(); // Refresh the data
        } else {
            addLog('‚ùå Failed to reset Tetris scores: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Reset error:', error);
          addLog('‚ùå Reset failed: ' + error.message);
        });
      }
    }

    function resetSnakeScores() {
      addLog('üîÑ Snake score reset requested...');
      if (confirm('‚ö†Ô∏è This will reset ALL Snake scores. This action cannot be undone. Are you sure?')) {
        fetch(API_BASE_URL + '/api/admin/reset-game-scores-v2.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            game_type: 'snake',
            reason: 'Admin requested Snake reset'
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            addLog('‚úÖ Snake scores reset successfully');
            loadSnakeData(); // Refresh the data
        } else {
            addLog('‚ùå Failed to reset Snake scores: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Reset error:', error);
          addLog('‚ùå Reset failed: ' + error.message);
        });
      }
    }



    function resetCheeseData() {
      addLog('üîÑ Cheese Hunt data reset requested...');
      if (confirm('‚ö†Ô∏è This will reset ALL Cheese Hunt data. This action cannot be undone. Are you sure?')) {
        fetch(API_BASE_URL + '/api/admin/reset-game-scores-v2.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            game_type: 'cheese_hunt',
            reason: 'Admin requested Cheese Hunt reset'
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            addLog('‚úÖ Cheese Hunt data reset successfully');
            loadCheeseHuntData(); // Refresh the data
          } else {
            addLog('‚ùå Failed to reset Cheese Hunt data: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Reset error:', error);
          addLog('‚ùå Reset failed: ' + error.message);
        });
      }
    }

    function exportTetrisData() {
      addLog('üìä Tetris data export requested...');
      fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const tetrisData = data.games.tetris || {};
            const csvContent = generateTetrisCSV(tetrisData);
            downloadCSV(csvContent, 'tetris_data_export.csv');
            addLog('‚úÖ Tetris data exported successfully');
          } else {
            addLog('‚ùå Failed to fetch Tetris data for export');
          }
        })
        .catch(error => {
          console.error('Export error:', error);
          addLog('‚ùå Export failed: ' + error.message);
        });
    }

    function exportSnakeData() {
      addLog('üìä Snake data export requested...');
      fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const snakeData = data.games.snake || {};
            const csvContent = generateSnakeCSV(snakeData);
            downloadCSV(csvContent, 'snake_data_export.csv');
            addLog('‚úÖ Snake data exported successfully');
          } else {
            addLog('‚ùå Failed to fetch Snake data for export');
          }
        })
        .catch(error => {
          console.error('Export error:', error);
          addLog('‚ùå Export failed: ' + error.message);
        });
    }



    function exportCheeseData() {
      addLog('üìä Cheese Hunt data export requested...');
              fetch(API_BASE_URL + '/api/admin/get-cheese-stats.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const csvContent = generateCheeseHuntCSV(data);
            downloadCSV(csvContent, 'cheese_hunt_data_export.csv');
            addLog('‚úÖ Cheese Hunt data exported successfully');
          } else {
            addLog('‚ùå Failed to fetch Cheese Hunt data for export');
          }
        })
        .catch(error => {
          console.error('Export error:', error);
          addLog('‚ùå Export failed: ' + error.message);
        });
    }

    function exportRaceData() {
      addLog('üìä Discord Cheese Race data export requested...');
              fetch(API_BASE_URL + '/api/admin/get-discord-activity.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const csvContent = generateDiscordRaceCSV(data.events);
            downloadCSV(csvContent, 'discord_race_data_export.csv');
            addLog('‚úÖ Discord Race data exported successfully');
          } else {
            addLog('‚ùå Failed to fetch Discord Race data for export');
          }
        })
        .catch(error => {
          console.error('Export error:', error);
          addLog('‚ùå Export failed: ' + error.message);
        });
    }

    // CSV Generation functions
    function generateTetrisCSV(data) {
      let csv = 'Player,Score,Season,Date\n';
      if (data.leaderboard) {
        data.leaderboard.forEach(player => {
          csv += `${player.username},${player.score},${player.season || 'Current'},${player.date || 'N/A'}\n`;
        });
      }
      return csv;
    }

    function generateSnakeCSV(data) {
      let csv = 'Player,Score,Season,Date\n';
      if (data.leaderboard) {
        data.leaderboard.forEach(player => {
          csv += `${player.username},${player.score},${player.season || 'Current'},${player.date || 'N/A'}\n`;
        });
      }
      return csv;
    }



    function generateCheeseHuntCSV(data) {
      let csv = 'Player,Clicks,Date\n';
      if (data.cheese_clicks) {
        data.cheese_clicks.forEach(click => {
          csv += `${click.discord_name},${click.clicks},${click.timestamp}\n`;
        });
      }
      return csv;
    }

    function generateDiscordRaceCSV(events) {
      let csv = 'Type,User,Channel,Description,Timestamp\n';
      events.forEach(event => {
        csv += `${event.type},${event.user_name},${event.channel_name},${event.description},${event.timestamp}\n`;
      });
      return csv;
    }

    // Utility function to download CSV
    function downloadCSV(content, filename) {
      const blob = new Blob([content], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }

    // Generate comprehensive CSV for all games
    function generateAllGamesCSV(games) {
      let csv = 'Game,Player,Score,Season,Date,Additional Info\n';
      
      // Tetris data
      if (games.tetris && games.tetris.leaderboard) {
        games.tetris.leaderboard.forEach(player => {
          csv += `Tetris,${player.username},${player.score},${player.season || 'Current'},${player.date || 'N/A'},Level: ${player.level || 'N/A'}\n`;
        });
      }
      
      // Snake data
      if (games.snake && games.snake.leaderboard) {
        games.snake.leaderboard.forEach(player => {
          csv += `Snake,${player.username},${player.score},${player.season || 'Current'},${player.date || 'N/A'},Length: ${player.length || 'N/A'}\n`;
        });
      }
      

      
      return csv;
    }

    function exportGameData() {
      addLog('üìä Game data export requested...');
      // Export all games data in one comprehensive CSV
      fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const csvContent = generateAllGamesCSV(data.games);
            downloadCSV(csvContent, 'all_games_data_export.csv');
            addLog('‚úÖ All games data exported successfully');
          } else {
            addLog('‚ùå Failed to fetch games data for export');
          }
        })
        .catch(error => {
          console.error('Export error:', error);
          addLog('‚ùå Export failed: ' + error.message);
        });
    }

    function backupGameData() {
      addLog('üíæ Game data backup requested...');
      // Create a comprehensive backup of all game data
      Promise.all([
        fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php'),
        fetch(API_BASE_URL + '/api/admin/get-cheese-stats.php'),
        fetch(API_BASE_URL + '/api/admin/get-discord-activity.php')
      ])
      .then(responses => Promise.all(responses.map(r => r.json())))
      .then(dataArray => {
        const backupData = {
          timestamp: new Date().toISOString(),
          games_stats: dataArray[0],
          cheese_stats: dataArray[1],
          discord_activity: dataArray[2]
        };
        
        const backupContent = JSON.stringify(backupData, null, 2);
        const blob = new Blob([backupContent], { type: 'application/json' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `game_data_backup_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        addLog('‚úÖ Game data backup created successfully');
      })
      .catch(error => {
        console.error('Backup error:', error);
        addLog('‚ùå Backup failed: ' + error.message);
      });
    }

    function resetAllGameScores() {
      addLog('üîÑ All game scores reset requested...');
      if (confirm('‚ö†Ô∏è This will reset ALL game scores for ALL players. This action cannot be undone. Are you sure?')) {
        fetch(API_BASE_URL + '/api/admin/reset-game-scores-v2.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            reset_all: true,
            reason: 'Admin requested full reset'
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            addLog('‚úÖ All game scores reset successfully');
            // Refresh the dashboard
            loadGameManagementData();
          } else {
            addLog('‚ùå Failed to reset game scores: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Reset error:', error);
          addLog('‚ùå Reset failed: ' + error.message);
        });
      }
    }

    function manageRaceBot() {
      addLog('ü§ñ Race bot settings requested...');
      // Open race bot configuration modal
      document.getElementById('raceBotModal').classList.remove('hidden');
    }

    // Season Statistics Functions
    async function loadSeasonStats() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const season = document.getElementById('seasonSelector').value;
      const gameType = document.getElementById('gameFilter').value;

      addLog(`üîÑ Loading season statistics for ${season}...`);

      try {
        const response = await fetch(API_BASE_URL + `/api/admin/get-season-stats.php?season=${season}&game_type=${gameType}`);
        const data = await response.json();
        
        if (data.success) {
          displaySeasonStats(data.data);
          updateSeasonSelector(data.data.available_seasons);
          addLog('‚úÖ Season statistics loaded successfully');
        } else {
          addLog(`‚ùå Failed to load season statistics: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Season statistics loading error: ${error.message}`);
      }
    }

    // Season Management Functions
    async function switchActiveSeason() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const newSeason = document.getElementById('seasonSwitchSelector').value;
      addLog(`üîÑ Switching active season to ${newSeason}...`);

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/switch-active-season.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            new_season: newSeason,
            admin_id: currentAdmin
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Successfully switched to ${newSeason}`);
          updateSeasonStatus(newSeason);
          loadSeasonData(); // Refresh the display
        } else {
          addLog(`‚ùå Failed to switch season: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Season switch error: ${error.message}`);
      }
    }

    async function loadSeasonData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const selectedSeason = document.getElementById('viewSeasonSelector').value;
      addLog(`üîÑ Loading data for ${selectedSeason}...`);

      try {
        const response = await fetch(API_BASE_URL + `/api/admin/get-season-data.php?season=${selectedSeason}`);
        const data = await response.json();
        
        if (data.success) {
          displaySeasonData(data.data, selectedSeason);
          addLog(`‚úÖ ${selectedSeason} data loaded successfully`);
        } else {
          addLog(`‚ùå Failed to load ${selectedSeason} data: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Season data loading error: ${error.message}`);
      }
    }

    function refreshSeasonData() {
      loadSeasonData();
    }

    function updateSeasonStatus(activeSeason) {
      // Update the current season status display
      const statusElement = document.querySelector('.bg-green-900 .text-green-400.font-bold');
      if (statusElement) {
        statusElement.textContent = activeSeason === 'season_2' ? 
          'Season 2 - The Great Reset (2025)' : 
          'Season 1 - Historical';
      }

      // Update the season switch selector
      const switchSelector = document.getElementById('seasonSwitchSelector');
      if (switchSelector) {
        switchSelector.value = activeSeason;
      }

      // Update the view season selector
      const viewSelector = document.getElementById('viewSeasonSelector');
      if (viewSelector) {
        viewSelector.value = activeSeason;
      }
    }

    function displaySeasonData(data, season) {
      const container = document.getElementById('seasonStats');
      
      let html = `
        <div class="bg-blue-900 bg-opacity-30 p-4 rounded-lg border border-blue-700 mb-4">
          <h5 class="font-semibold text-blue-400 mb-3">üìä ${season.toUpperCase()} Data Overview</h5>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-white">${data.total_scores || 0}</div>
              <div class="text-sm text-gray-300">Total Scores</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-white">${data.unique_players || 0}</div>
              <div class="text-sm text-gray-300">Unique Players</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-white">${data.max_score || 0}</div>
              <div class="text-sm text-gray-300">Max Score</div>
            </div>
          </div>
        </div>
      `;

      // Add game-specific data
      if (data.games) {
        html += `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${Object.entries(data.games).map(([game, stats]) => `
              <div class="bg-gray-700 p-3 rounded">
                <h6 class="font-semibold text-yellow-400 mb-2">üéÆ ${game.charAt(0).toUpperCase() + game.slice(1)}</h6>
                <div class="text-sm text-gray-300">
                  <p>Scores: ${stats.total_scores || 0}</p>
                  <p>Players: ${stats.unique_players || 0}</p>
                  <p>Max Score: ${stats.max_score || 0}</p>
                </div>
              </div>
            `).join('')}
          </div>
        `;
      }

      container.innerHTML = html;
    }

    function displaySeasonStats(data) {
      const container = document.getElementById('seasonStats');
      
      let html = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <div class="bg-gray-700 p-3 rounded">
            <h5 class="font-semibold text-blue-400 mb-2">üü¶ Tetris Statistics</h5>
            ${data.season_stats.tetris ? `
              <p class="text-sm text-gray-300">Total Scores: ${data.season_stats.tetris.total_scores.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Unique Players: ${data.season_stats.tetris.unique_players.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Max Score: ${data.season_stats.tetris.max_score ? data.season_stats.tetris.max_score.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Avg Score: ${Math.round(data.season_stats.tetris.avg_score || 0).toLocaleString()}</p>
              <p class="text-sm text-yellow-400">Top Performers: ${data.season_stats.tetris.top_performers}</p>
            ` : '<p class="text-sm text-gray-400">No data available</p>'}
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h5 class="font-semibold text-green-400 mb-2">üêç Snake Statistics</h5>
            ${data.season_stats.snake ? `
              <p class="text-sm text-gray-300">Total Scores: ${data.season_stats.snake.total_scores.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Unique Players: ${data.season_stats.snake.unique_players.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Max Score: ${data.season_stats.snake.max_score ? data.season_stats.snake.max_score.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Avg Score: ${Math.round(data.season_stats.snake.avg_score || 0).toLocaleString()}</p>
              <p class="text-sm text-yellow-400">Top Performers: ${data.season_stats.snake.top_performers}</p>
            ` : '<p class="text-sm text-gray-400">No data available</p>'}
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h5 class="font-semibold text-orange-400 mb-2">üëæ Space Invaders Statistics</h5>
            ${data.season_stats.space_invaders ? `
              <p class="text-sm text-gray-300">Total Scores: ${data.season_stats.space_invaders.total_scores.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Unique Players: ${data.season_stats.space_invaders.unique_players.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Max Score: ${data.season_stats.space_invaders.max_score ? data.season_stats.space_invaders.max_score.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Avg Score: ${Math.round(data.season_stats.space_invaders.avg_score || 0).toLocaleString()}</p>
              <p class="text-sm text-yellow-400">Top Performers: ${data.season_stats.space_invaders.top_performers}</p>
            ` : '<p class="text-sm text-gray-400">No data available</p>'}
          </div>
        </div>
        
        <!-- Second Row for Cheese Hunt and Discord Race -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div class="bg-gray-700 p-3 rounded">
            <h5 class="font-semibold text-yellow-400 mb-2">üßÄ Cheese Hunt Statistics</h5>
            ${data.season_stats.cheese_hunt ? `
              <p class="text-sm text-gray-300">Total Clicks: ${data.season_stats.cheese_hunt.total_clicks ? data.season_stats.cheese_hunt.total_clicks.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Unique Players: ${data.season_stats.cheese_hunt.unique_players.toLocaleString()}</p>
              <p class="text-sm text-gray-300">Max Clicks: ${data.season_stats.cheese_hunt.max_clicks ? data.season_stats.cheese_hunt.max_clicks.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Avg Clicks: ${Math.round(data.season_stats.cheese_hunt.avg_clicks || 0).toLocaleString()}</p>
              <p class="text-sm text-yellow-400">Active Hunters: ${data.season_stats.cheese_hunt.unique_players || '0'}</p>
            ` : '<p class="text-sm text-gray-400">No data available</p>'}
          </div>
          <div class="bg-gray-700 p-3 rounded">
            <h5 class="font-semibold text-purple-400 mb-2">üèÅ Discord Race Statistics</h5>
            ${data.season_stats.discord_race ? `
              <p class="text-sm text-gray-300">Total Races: ${data.season_stats.discord_race.total_races ? data.season_stats.discord_race.total_races.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Total Participants: ${data.season_stats.discord_race.total_participants ? data.season_stats.discord_race.total_participants.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Prizes Awarded: ${data.season_stats.discord_race.total_prizes_awarded ? data.season_stats.discord_race.total_prizes_awarded.toLocaleString() : '0'}</p>
              <p class="text-sm text-gray-300">Recent 24h: ${data.season_stats.discord_race.recent_24h ? data.season_stats.discord_race.recent_24h.toLocaleString() : '0'}</p>
              <p class="text-sm text-yellow-400">Active Racers: ${data.season_stats.discord_race.total_participants || '0'}</p>
            ` : '<p class="text-sm text-gray-400">No data available</p>'}
          </div>
        </div>
      `;

      // Add top performers section
      if (data.top_performers) {
        html += `
          <div class="bg-gray-700 p-3 rounded mb-4">
            <h5 class="font-semibold text-yellow-400 mb-2">üèÜ Current Season Top Performers</h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        `;

        if (data.top_performers.tetris && data.top_performers.tetris.length > 0) {
          html += `
            <div>
              <h6 class="text-blue-400 font-semibold mb-2">üü¶ Tetris</h6>
              ${data.top_performers.tetris.map((player, index) => `
                <div class="flex justify-between items-center mb-1 ${player.is_top_performer ? 'bg-yellow-600 bg-opacity-30 p-1 rounded' : ''}">
                  <span class="text-sm text-white">${index + 1}. ${player.discord_name || 'Unknown'}</span>
                  <span class="text-sm text-green-400">${player.score.toLocaleString()}</span>
                </div>
              `).join('')}
            </div>
          `;
        }

        if (data.top_performers.snake && data.top_performers.snake.length > 0) {
          html += `
            <div>
              <h6 class="text-green-400 font-semibold mb-2">üêç Snake</h6>
              ${data.top_performers.snake.map((player, index) => `
                <div class="flex justify-between items-center mb-1 ${player.is_top_performer ? 'bg-yellow-600 bg-opacity-30 p-1 rounded' : ''}">
                  <span class="text-sm text-white">${index + 1}. ${player.discord_name || 'Unknown'}</span>
                  <span class="text-sm text-green-400">${player.score.toLocaleString()}</span>
                </div>
              `).join('')}
            </div>
          `;
        }

        if (data.top_performers.space_invaders && data.top_performers.space_invaders.length > 0) {
          html += `
            <div>
              <h6 class="text-orange-400 font-semibold mb-2">üëæ Space Invaders</h6>
              ${data.top_performers.space_invaders.map((player, index) => `
                <div class="flex justify-between items-center mb-1 ${player.is_top_performer ? 'bg-yellow-600 bg-opacity-30 p-1 rounded' : ''}">
                  <span class="text-sm text-white">${index + 1}. ${player.discord_name || 'Unknown'}</span>
                  <span class="text-sm text-green-400">${player.score.toLocaleString()}</span>
                </div>
              `).join('')}
            </div>
          `;
        }

        html += `
            </div>
          </div>
        `;
      }

      // Add all-time legends section
      if (data.all_time_legends) {
        html += `
          <div class="bg-gray-700 p-3 rounded">
            <h5 class="font-semibold text-purple-400 mb-2">üëë All-Time Legends (Top Performers)</h5>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        `;

        if (data.all_time_legends.tetris && data.all_time_legends.tetris.length > 0) {
          html += `
            <div>
              <h6 class="text-blue-400 font-semibold mb-2">üü¶ Tetris Legends</h6>
              ${data.all_time_legends.tetris.map((legend, index) => `
                <div class="flex justify-between items-center mb-1 bg-purple-600 bg-opacity-30 p-1 rounded">
                  <div>
                    <span class="text-sm text-white">${index + 1}. ${legend.discord_name || 'Unknown'}</span>
                    <span class="text-xs text-gray-400 block">${legend.season}</span>
                  </div>
                  <span class="text-sm text-green-400">${legend.score.toLocaleString()}</span>
                </div>
              `).join('')}
            </div>
          `;
        }

        if (data.all_time_legends.snake && data.all_time_legends.snake.length > 0) {
          html += `
            <div>
              <h6 class="text-green-400 font-semibold mb-2">üêç Snake Legends</h6>
              ${data.all_time_legends.snake.map((legend, index) => `
                <div class="flex justify-between items-center mb-1 bg-purple-600 bg-opacity-30 p-1 rounded">
                  <div>
                    <span class="text-sm text-white">${index + 1}. ${legend.discord_name || 'Unknown'}</span>
                    <span class="text-xs text-gray-400 block">${legend.season}</span>
                  </div>
                  <span class="text-sm text-green-400">${legend.score.toLocaleString()}</span>
                </div>
              `).join('')}
            </div>
          `;
        }

        html += `
            </div>
          </div>
        `;
      }

      container.innerHTML = html;
    }

    function updateSeasonSelector(availableSeasons) {
      const selector = document.getElementById('seasonSelector');
      const currentOptions = selector.innerHTML;
      
      // Keep the "Current Season" option and add available seasons
      selector.innerHTML = '<option value="current">Current Season</option>';
      
      availableSeasons.forEach(season => {
        const option = document.createElement('option');
        option.value = season;
        option.textContent = season;
        selector.appendChild(option);
      });
    }

    function displayTopPlayers(gameType, players) {
      let containerId;
      
      // Map game types to their correct container IDs
      switch(gameType) {
        case 'tetris':
          containerId = 'tetrisTopPlayers';
          break;
        case 'snake':
          containerId = 'snakeTopPlayers';
          break;
        case 'space_invaders':
          containerId = 'spaceInvadersTopPlayers';
          break;
        default:
          console.warn(`Unknown game type: ${gameType}`);
          return;
      }
      
      const container = document.getElementById(containerId);
      
      if (!container) {
        console.warn(`Container ${containerId} not found`);
        return;
      }
      
      if (!players || players.length === 0) {
        container.innerHTML = '<div class="text-gray-400 text-sm">No players found</div>';
        return;
      }

      container.innerHTML = players.map((player, index) => `
        <div class="bg-gray-700 p-2 rounded flex justify-between items-center">
          <div class="flex items-center">
            <span class="text-sm font-semibold text-gray-300 mr-2">#${index + 1}</span>
            <div>
              <p class="text-sm font-semibold text-white">${player.discord_name || 'Unknown'}</p>
              <p class="text-xs text-gray-400">${player.discord_id}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="text-sm font-semibold text-green-400">${player.best_score.toLocaleString()}</p>
            <p class="text-xs text-gray-400">${player.total_games} games</p>
          </div>
        </div>
      `).join('');
    }

    function displayRecentActivity(activity) {
      const container = document.getElementById('recentGameActivity');
      
      if (!container) {
        console.warn('Container recentGameActivity not found');
        return;
      }
      
      if (!activity || activity.length === 0) {
        container.innerHTML = '<div class="text-gray-400 text-sm">No recent activity</div>';
        return;
      }

      container.innerHTML = activity.map(item => `
        <div class="bg-gray-700 p-2 rounded flex justify-between items-center">
          <div class="flex items-center">
            <span class="text-sm mr-2">${item.game === 'tetris' ? 'üü¶' : item.game === 'snake' ? 'üêç' : item.game === 'space_invaders' ? 'üöÄ' : 'üéÆ'}</span>
            <div>
              <p class="text-sm font-semibold text-white">${item.discord_name || 'Unknown'}</p>
              <p class="text-xs text-gray-400">${formatDate(item.timestamp)}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="text-sm font-semibold text-green-400">${item.score.toLocaleString()}</p>
          </div>
        </div>
      `).join('');
    }

    function toggleResetOptions() {
      const resetType = document.getElementById('resetType').value;
      const seasonOption = document.getElementById('seasonOption');
      const topScoresOption = document.getElementById('topScoresOption');
      const userOption = document.getElementById('userOption');

      // Hide all options first
      seasonOption.classList.add('hidden');
      topScoresOption.classList.add('hidden');
      userOption.classList.add('hidden');

      // Show relevant option
      if (resetType === 'season') {
        seasonOption.classList.remove('hidden');
      } else if (resetType === 'top_scores') {
        topScoresOption.classList.remove('hidden');
      } else if (resetType === 'user') {
        userOption.classList.remove('hidden');
      }
    }

    async function resetGameScores() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const gameType = document.getElementById('resetGameType').value;
      const resetType = document.getElementById('resetType').value;
      const topCount = document.getElementById('topCount').value;
      const userId = document.getElementById('resetUserId').value.trim();
      const seasonName = document.getElementById('seasonName').value.trim();

      // Validate inputs
      if (resetType === 'user' && !userId) {
        addLog('‚ùå Please enter a Discord User ID for user-specific reset');
        return;
      }

      if (resetType === 'top_scores' && (!topCount || topCount < 1 || topCount > 100)) {
        addLog('‚ùå Please enter a valid number of top scores (1-100)');
        return;
      }

      // Create confirmation message
      let confirmationMessage = `Are you sure you want to reset ${gameType === 'all' ? 'all games' : gameType} scores?\n\n`;
      confirmationMessage += `Reset Type: ${resetType}\n`;
      
      if (resetType === 'season') {
        confirmationMessage += `New Season: ${seasonName || 'auto-generated'}\n`;
        confirmationMessage += `üìä Current season data will be preserved as historical data\n`;
        confirmationMessage += `üèÜ Top 2 performers will be marked as legends\n`;
      } else if (resetType === 'top_scores') {
        confirmationMessage += `Top Scores: ${topCount}\n`;
      } else if (resetType === 'user') {
        confirmationMessage += `User ID: ${userId}\n`;
      }
      
      confirmationMessage += '\n‚ö†Ô∏è This action cannot be undone!';

      if (!confirm(confirmationMessage)) {
        return;
      }

      addLog(`üîÑ Resetting game scores...`);

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/reset-game-scores-v2.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            admin_username: currentAdmin.username,
            game_type: gameType,
            reset_type: resetType,
            top_count: parseInt(topCount),
            user_id: userId,
            season_name: seasonName || null
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Game scores reset successfully!`);
          addLog(`üìä Records affected: ${data.details.records_affected}`);
          addLog(`üéÆ Game type: ${data.details.game_type}`);
          addLog(`üîÑ Reset type: ${data.details.reset_type}`);
          addLog(`üìÖ Current season: ${data.details.current_season}`);
          addLog(`üÜï New season: ${data.details.new_season}`);
          
          // Show top performers if any
          if (data.details.top_performers) {
            addLog(`üèÜ Top performers marked as legends:`);
            Object.keys(data.details.top_performers).forEach(game => {
              data.details.top_performers[game].forEach(performer => {
                addLog(`  ${game}: ${performer.discord_name} (${performer.score})`);
              });
            });
          }
          
          // Refresh statistics
          loadGameStatistics();
          loadSeasonStats();
        } else {
          addLog(`‚ùå Failed to reset game scores: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Reset game scores error: ${error.message}`);
      }
    }

    // Game Settings Management
    async function loadGameSettings() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/game-settings.php?action=get_settings');
        const data = await response.json();
        
        if (data.success) {
          const settings = data.settings;
          
                       // Populate Tetris settings
             document.getElementById('tetrisWlEnabled').checked = settings.tetris_wl_enabled == 1;
             document.getElementById('tetrisWlThreshold').value = settings.tetris_wl_threshold || 4000;
             document.getElementById('tetrisWlRoleId').value = settings.tetris_wl_role_id || '';
             document.getElementById('tetrisWlBonus').value = settings.tetris_wl_bonus || 1000;
             
             // Populate Snake settings
             document.getElementById('snakeWlEnabled').checked = settings.snake_wl_enabled == 1;
             document.getElementById('snakeWlThreshold').value = settings.snake_wl_threshold || 4000;
             document.getElementById('snakeWlRoleId').value = settings.snake_wl_role_id || '';
             document.getElementById('snakeWlBonus').value = settings.snake_wl_bonus || 1000;
          
          addLog('‚úÖ Game settings loaded successfully');
        } else {
          addLog('‚ùå Failed to load game settings');
        }
      } catch (error) {
        addLog(`‚ùå Load game settings error: ${error.message}`);
      }
    }

    async function saveGameSettings() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
          return;
        }

               const tetrisWlEnabled = document.getElementById('tetrisWlEnabled').checked ? 1 : 0;
         const tetrisWlThreshold = parseInt(document.getElementById('tetrisWlThreshold').value);
         const tetrisWlRoleId = document.getElementById('tetrisWlRoleId').value;
         const tetrisWlBonus = parseInt(document.getElementById('tetrisWlBonus').value);
         const snakeWlEnabled = document.getElementById('snakeWlEnabled').checked ? 1 : 0;
         const snakeWlThreshold = parseInt(document.getElementById('snakeWlThreshold').value);
         const snakeWlRoleId = document.getElementById('snakeWlRoleId').value;
         const snakeWlBonus = parseInt(document.getElementById('snakeWlBonus').value);

      // Validate inputs
               if ((tetrisWlEnabled && !tetrisWlRoleId) || (snakeWlEnabled && !snakeWlRoleId)) {
           addLog('‚ùå Please select a WL role when enabling WL grants');
           return;
         }
       
         if (tetrisWlThreshold < 1000 || tetrisWlThreshold > 10000 || 
             snakeWlThreshold < 1000 || snakeWlThreshold > 10000) {
           addLog('‚ùå Score threshold must be between 1000 and 10000');
           return;
         }
       
         if (tetrisWlBonus < 100 || tetrisWlBonus > 10000 || 
             snakeWlBonus < 100 || snakeWlBonus > 10000) {
           addLog('‚ùå Bonus points must be between 100 and 10000');
           return;
         }

      addLog('üíæ Saving game settings...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/game-settings.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
                       body: JSON.stringify({
               action: 'update_settings',
               tetris_wl_enabled: tetrisWlEnabled,
               tetris_wl_threshold: tetrisWlThreshold,
               tetris_wl_role_id: tetrisWlRoleId,
               tetris_wl_bonus: tetrisWlBonus,
               snake_wl_enabled: snakeWlEnabled,
               snake_wl_threshold: snakeWlThreshold,
               snake_wl_role_id: snakeWlRoleId,
               snake_wl_bonus: snakeWlBonus
             })
        });

        const data = await response.json();
        
        if (data.success) {
                       addLog('‚úÖ Game settings saved successfully!');
             addLog(`üü¶ Tetris WL: ${tetrisWlEnabled ? 'Enabled' : 'Disabled'} (${tetrisWlThreshold} DSPOINC, +${tetrisWlBonus} bonus)`);
             addLog(`üêç Snake WL: ${snakeWlEnabled ? 'Enabled' : 'Disabled'} (${snakeWlThreshold} DSPOINC, +${snakeWlBonus} bonus)`);
        } else {
          addLog(`‚ùå Failed to save game settings: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Save game settings error: ${error.message}`);
      }
    }

    // Enhanced quest creation with role granting
    async function createQuest() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      const questType = document.getElementById('newQuestType').value;
      const questReward = parseInt(document.getElementById('newQuestReward').value);
      const questUrl = document.getElementById('newQuestUrl').value;
      const questDescription = document.getElementById('newQuestDescription').value;
      const grantRole = document.getElementById('grantRoleCheckbox').checked;
      const roleId = document.getElementById('questRoleId').value;

      if (!questType || !questDescription || questReward <= 0) {
        addLog('‚ùå Please fill in all required fields (type, description, reward)');
        return;
      }

      if (grantRole && !roleId) {
        addLog('‚ùå Please enter a Discord role ID when granting roles');
        return;
      }

      addLog('üîÑ Creating new quest...');

      try {
        const questData = {
          action: 'create',
          type: questType,
          description: questDescription,
          link: questUrl,
          reward: questReward,
          created_by: currentAdmin.discord_id,
          grant_role: grantRole,
          role_id: roleId
        };

        // Add cheese quest specific fields if it's a cheese hunt
        if (questType === 'cheese_hunt') {
          questData.movement_pattern = document.getElementById('cheeseMovementPattern').value;
          questData.movement_speed = document.getElementById('cheeseMovementSpeed').value;
          questData.hidden_areas = document.getElementById('cheeseHiddenAreas').value === 'true';
          questData.cheese_count = parseInt(document.getElementById('cheeseCount').value);
          questData.discord_ticket = document.getElementById('cheeseDiscordTicket').value === 'true';
          questData.screenshot_required = document.getElementById('cheeseScreenshotRequired').value === 'true';
          questData.winner_message = document.getElementById('cheeseWinnerMessage').value;
        }

        const response = await fetch(API_BASE_URL + '/api/admin/create-quest.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(questData)
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Quest created successfully! ID: ${data.quest_id}${grantRole ? `, Role ID: ${roleId}` : ''}`);
          
          // Clear form
          document.getElementById('newQuestType').value = '';
          document.getElementById('newQuestReward').value = '';
          document.getElementById('newQuestUrl').value = '';
          document.getElementById('newQuestDescription').value = '';
          document.getElementById('grantRoleCheckbox').checked = false;
          document.getElementById('questRoleId').value = '';
          
          // Refresh active quests
          loadActiveQuests();
          } else {
          addLog(`‚ùå Failed to create quest: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Create quest error: ${error.message}`);
      }
    }

    // Load active quests
    async function loadActiveQuests() {
      if (!currentAdmin) return;

      try {
        const response = await fetch(API_BASE_URL + '/api/user/quests.php?user_id=' + currentAdmin.discord_id);
        const data = await response.json();
        
        if (data.success) {
          displayActiveQuests(data.quests);
        }
      } catch (error) {
        console.error('Error loading active quests:', error);
      }
    }

    function displayActiveQuests(quests) {
      const container = document.getElementById('activeQuestsList');
      
      if (!quests || quests.length === 0) {
        container.innerHTML = `<div class="text-gray-300">No active quests found.</div>`;
        return;
      }

      container.innerHTML = quests.map(quest => `
        <div class="bg-gray-700 p-4 rounded-lg">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-semibold text-white">${quest.title || `Quest #${quest.quest_id}`}</h4>
            <span class="px-2 py-1 bg-green-600 text-white text-xs rounded">Active</span>
          </div>
          <p class="text-gray-300 text-sm mb-2">${quest.description}</p>
          <div class="flex justify-between items-center">
            <span class="text-yellow-400 font-semibold">${quest.reward} $DSPOINC</span>
            ${quest.role_id ? `<span class="text-blue-400 text-sm">üé≠ Role: ${quest.role_id}</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    // Display recent quest claims
    function displayRecentQuestClaims(claims) {
      const container = document.getElementById('recentQuestClaims');
      
      if (claims.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No quest claims found</div>';
        return;
      }

      container.innerHTML = claims.map(claim => {
        const username = claim.username || 'Anonymous Mouse';
        const displayName = username.length > 12 ? username.substring(0, 12) + '...' : username;
        const statusColor = claim.status === 'approved' ? 'text-green-400' : 
                           claim.status === 'rejected' ? 'text-red-400' : 'text-yellow-400';
        const statusText = claim.status === 'approved' ? '‚úÖ Approved' : 
                          claim.status === 'rejected' ? '‚ùå Rejected' : '‚è≥ Pending';
        const date = new Date(claim.claimed_at).toLocaleDateString();
        
        return `
          <div class="flex justify-between items-center py-1">
            <span class="text-green-300">
              <a href="/profile.html?user_id=${encodeURIComponent(claim.user_id)}" 
                 class="hover:text-green-200 underline cursor-pointer" 
                 title="View ${username}'s profile">
                ${displayName}
              </a>
            </span>
            <span class="${statusColor} text-xs">${statusText}</span>
            <span class="text-gray-400 text-xs">${date}</span>
          </div>
        `;
      }).join('');
    }

    // Display active quests by type
    function displayActiveQuestsByType(questsByType) {
      const container = document.getElementById('activeQuestsByType');
      
      if (questsByType.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No active quests found</div>';
        return;
      }

      container.innerHTML = questsByType.map(quest => {
        const questTypeEmoji = quest.type === 'cheese_hunt' ? 'üßÄ' : 
                              quest.type === 'tweet' ? 'üê¶' : 
                              quest.type === 'tetris' ? 'üü¶' : 
                              quest.type === 'snake' ? 'üêç' : 
                              quest.type === 'hytopia_game' ? 'üéÆ' : 
                              quest.type === 'invite' ? 'üë•' : 
                              quest.type === 'Custom' ? 'üìù' : 'üéØ';
        const questTypeName = quest.type === 'cheese_hunt' ? 'Cheese Hunt' : 
                             quest.type === 'tweet' ? 'Twitter' : 
                             quest.type === 'tetris' ? 'Tetris' : 
                             quest.type === 'snake' ? 'Snake' : 
                             quest.type === 'hytopia_game' ? 'Hytopia Game' : 
                             quest.type === 'invite' ? 'Invite' : 
                             quest.type === 'Custom' ? 'Custom' : quest.type;
        
        return `
          <div class="flex justify-between items-center py-1">
            <span class="text-purple-300">${questTypeEmoji} ${questTypeName}</span>
            <span class="text-white font-semibold">${quest.count}</span>
          </div>
        `;
      }).join('');
    }

    // Display recent boss claims
    function displayRecentBossClaims(claims) {
      const container = document.getElementById('recentBossClaims');
      
      if (claims.length === 0) {
        container.innerHTML = '<div class="text-gray-400">No boss claims found</div>';
        return;
      }

      container.innerHTML = claims.map(claim => {
        const username = claim.player_username || 'Anonymous Player';
        const displayName = username.length > 12 ? username.substring(0, 12) + '...' : username;
        const statusColor = claim.status === 'rewarded' ? 'text-green-400' : 
                           claim.status === 'reviewed' ? 'text-blue-400' : 'text-orange-400';
        const statusText = claim.status === 'rewarded' ? 'üéÅ Rewarded' : 
                          claim.status === 'reviewed' ? 'üëÅÔ∏è Reviewed' : '‚è≥ Pending';
        const date = new Date(claim.created_at).toLocaleDateString();
        const bossInfo = `${claim.boss_name || 'Boss'} Lv.${claim.boss_level}`;
        
        return `
          <div class="flex justify-between items-center py-1">
            <div class="flex flex-col">
              <span class="text-orange-300">
                <a href="/profile.html?user_id=${encodeURIComponent(claim.player_id || '')}" 
                   class="hover:text-orange-200 underline cursor-pointer" 
                   title="View ${username}'s profile">
                  ${displayName}
                </a>
              </span>
              <span class="text-xs text-gray-400">${bossInfo}</span>
            </div>
            <div class="text-right">
              <span class="${statusColor} text-xs">${statusText}</span>
              <div class="text-gray-400 text-xs">${date}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Display boss achievement types
    function displayBossAchievementTypes(notifications) {
      const container = document.getElementById('bossAchievementTypes');
      
      // Group by boss type and count
      const bossTypeCounts = {};
      notifications.forEach(notification => {
        const bossType = notification.boss_type || 'Unknown';
        bossTypeCounts[bossType] = (bossTypeCounts[bossType] || 0) + 1;
      });
      
      if (Object.keys(bossTypeCounts).length === 0) {
        container.innerHTML = '<div class="text-gray-400">No boss types found</div>';
        return;
      }

      container.innerHTML = Object.entries(bossTypeCounts)
        .sort(([,a], [,b]) => b - a) // Sort by count descending
        .map(([bossType, count]) => {
          const bossEmoji = bossType === 'cheeseKing' ? 'üëë' : 
                           bossType === 'cheeseEmperor' ? 'üëë' : 
                           bossType === 'cheeseGod' ? 'üåü' : 
                           bossType === 'cheeseDestroyer' ? 'üí•' : 'üëæ';
          const bossName = bossType === 'cheeseKing' ? 'Cheese King' : 
                          bossType === 'cheeseEmperor' ? 'Cheese Emperor' : 
                          bossType === 'cheeseGod' ? 'Cheese God' : 
                          bossType === 'cheeseDestroyer' ? 'Cheese Destroyer' : bossType;
          
          return `
            <div class="flex justify-between items-center py-1">
              <span class="text-green-300">${bossEmoji} ${bossName}</span>
              <span class="text-white font-semibold">${count}</span>
            </div>
          `;
        }).join('');
    }

    // Load and display user adjustments
    async function loadUserAdjustments(userId, username) {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-user-adjustments.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'get_user_adjustments',
            user_id: userId
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayUserAdjustments(data.adjustments, username);
        } else {
          addLog(`‚ùå Failed to load adjustments for ${username}: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Error loading adjustments for ${username}: ${error.message}`);
      }
    }

    // Display user adjustments in a modal
    function displayUserAdjustments(adjustments, username) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      modal.innerHTML = `
        <div class="bg-gray-800 p-6 rounded-lg max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">üìä Adjustments for ${username}</h3>
            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-xl">&times;</button>
          </div>
          <div class="space-y-2">
            ${adjustments.length === 0 ? 
              '<div class="text-gray-400">No adjustments found for this user.</div>' :
              adjustments.map(adj => {
                const amount = parseInt(adj.amount);
                const isPositive = amount > 0;
                const timestamp = new Date(adj.timestamp).toLocaleString();
                
                return `
                  <div class="bg-gray-700 p-3 rounded ${isPositive ? 'border-l-4 border-green-500' : 'border-l-4 border-red-500'}">
                    <div class="flex justify-between items-start">
                      <div>
                        <strong class="${isPositive ? 'text-green-400' : 'text-red-400'}">
                          ${isPositive ? '+' : ''}${amount.toLocaleString()} $DSPOINC
                        </strong>
                        <span class="text-sm text-gray-300 ml-2">(${adj.action})</span>
                      </div>
                      <div class="text-xs text-gray-400">${timestamp}</div>
                    </div>
                    <div class="text-sm text-gray-300 mt-1">Reason: ${adj.reason || 'No reason'}</div>
                    ${adj.admin_id ? `<div class="text-xs text-gray-400">Admin: ${adj.admin_id}</div>` : ''}
                  </div>
                `;
              }).join('')
            }
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
      });
    }

    // Display engagement statistics
    function displayEngagementStats(stats) {
      const container = document.getElementById('engagementStats');
      container.innerHTML = `
        <div class="space-y-1">
          <div class="flex justify-between">
            <span class="text-cyan-300">Power Users (>100 clicks):</span>
            <span class="text-white font-semibold">${stats.power_users}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-cyan-300">Active Users (7 days):</span>
            <span class="text-white font-semibold">${stats.active_users_7_days}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-cyan-300">Retention Rate:</span>
            <span class="text-white font-semibold">${stats.user_retention_rate}%</span>
          </div>
        </div>
      `;
    }

    // Display wealth distribution statistics
    function displayWealthStats(stats) {
      const container = document.getElementById('wealthStats');
      container.innerHTML = `
        <div class="space-y-1">
          <div class="flex justify-between">
            <span class="text-emerald-300">Highest Balance:</span>
            <span class="text-white font-semibold">${stats.max_balance.toLocaleString()}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-emerald-300">Lowest Balance:</span>
            <span class="text-white font-semibold">${stats.min_balance.toLocaleString()}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-emerald-300">Average Balance:</span>
            <span class="text-white font-semibold">${stats.avg_balance.toLocaleString()}</span>
          </div>
        </div>
      `;
    }

    // ========================================
    // HOLDER VERIFICATION FUNCTIONS
    // ========================================

    // Load holder verification statistics
    async function loadHolderVerificationStats() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-holder-verification-stats.php');
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('totalVerifications').textContent = data.stats.total_verifications || 0;
          document.getElementById('successfulVerifications').textContent = data.stats.successful_verifications || 0;
          document.getElementById('totalNFTs').textContent = data.stats.total_nfts || 0;
          document.getElementById('activeRoles').textContent = data.stats.active_roles || 0;
        } else {
          addVerificationLog(`‚ùå Failed to load verification stats: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Error loading verification stats: ${error.message}`);
      }
    }

    // Load verifications with filters
    async function loadVerifications() {
      try {
        const collectionFilter = document.getElementById('verificationCollectionFilter').value;
        const statusFilter = document.getElementById('verificationStatusFilter').value;
        
        const response = await fetch(API_BASE_URL + '/api/admin/get-holder-verifications.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            collection: collectionFilter,
            status: statusFilter
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayVerifications(data.verifications);
          addVerificationLog(`‚úÖ Loaded ${data.verifications.length} verifications`);
        } else {
          addVerificationLog(`‚ùå Failed to load verifications: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Error loading verifications: ${error.message}`);
      }
    }

    // Display verifications in the list
    function displayVerifications(verifications) {
      const container = document.getElementById('verificationsList');
      
      if (verifications.length === 0) {
        container.innerHTML = '<div class="text-gray-400 text-center py-4">No verifications found</div>';
        return;
      }

      container.innerHTML = verifications.map(verification => {
        const statusIcon = verification.role_granted ? '‚úÖ' : '‚ùå';
        const statusColor = verification.role_granted ? 'text-green-400' : 'text-red-400';
        const date = new Date(verification.verified_at).toLocaleString();
        
        return `
          <div class="bg-gray-700 p-3 rounded border-l-4 border-gray-600">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold text-white">${verification.username}</div>
                <div class="text-sm text-gray-300">${verification.wallet.substring(0, 8)}...${verification.wallet.substring(verification.wallet.length - 8)}</div>
                <div class="text-sm text-gray-400">Collection: ${verification.collection}</div>
              </div>
              <div class="text-right">
                <div class="${statusColor} font-semibold">${statusIcon} ${verification.role_granted ? 'Role Granted' : 'No Role'}</div>
                <div class="text-xs text-gray-400">${date}</div>
                <div class="text-xs text-gray-400">NFTs: ${verification.nft_count}</div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Search NFTs by wallet and collection
    async function searchNFTs() {
      try {
        const wallet = document.getElementById('nftWalletAddress').value.trim();
        const collection = document.getElementById('nftCollection').value;
        
        if (!wallet) {
          addVerificationLog('‚ùå Please enter a wallet address');
          return;
        }

        const response = await fetch(API_BASE_URL + '/api/admin/search-nft-ownership.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            wallet: wallet,
            collection: collection
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayNFTSearchResults(data.nfts, wallet);
          addVerificationLog(`‚úÖ Found ${data.nfts.length} NFTs for wallet ${wallet.substring(0, 8)}...`);
        } else {
          addVerificationLog(`‚ùå NFT search failed: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Error searching NFTs: ${error.message}`);
      }
    }

    // Display NFT search results
    function displayNFTSearchResults(nfts, wallet) {
      const container = document.getElementById('nftSearchResults');
      
      if (nfts.length === 0) {
        container.innerHTML = '<div class="text-gray-400 text-center py-4">No NFTs found for this wallet</div>';
        return;
      }

      container.innerHTML = nfts.map(nft => {
        const rarityColor = nft.rarity === 'Legendary' ? 'text-yellow-400' : 
                           nft.rarity === 'Epic' ? 'text-purple-400' : 
                           nft.rarity === 'Rare' ? 'text-blue-400' : 'text-gray-400';
        
        return `
          <div class="bg-gray-700 p-3 rounded border-l-4 border-gray-600">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold text-white">Token #${nft.token_id}</div>
                <div class="text-sm ${rarityColor}">${nft.rarity || 'Common'}</div>
                <div class="text-sm text-gray-400">Collection: ${nft.collection}</div>
              </div>
              <div class="text-right">
                <div class="text-xs text-gray-400">${new Date(nft.acquired_at).toLocaleDateString()}</div>
                ${nft.traits ? `<div class="text-xs text-gray-400">Has Traits</div>` : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Grant role to user
    async function grantRole() {
      try {
        const userId = document.getElementById('roleUserId').value.trim();
        const roleId = document.getElementById('roleToGrant').value;
        const reason = document.getElementById('roleGrantReason').value.trim();
        
        if (!userId) {
          addVerificationLog('‚ùå Please enter a Discord user ID');
          return;
        }

        const response = await fetch(API_BASE_URL + '/api/admin/grant-discord-role.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userId,
            role_id: roleId,
            reason: reason || 'Manual role grant via admin interface'
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addVerificationLog(`‚úÖ Role granted to user ${userId}`);
          document.getElementById('roleUserId').value = '';
          document.getElementById('roleGrantReason').value = '';
        } else {
          addVerificationLog(`‚ùå Failed to grant role: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Error granting role: ${error.message}`);
      }
    }

    // Revoke role from user
    async function revokeRole() {
      try {
        const userId = document.getElementById('revokeUserId').value.trim();
        const roleId = document.getElementById('roleToRevoke').value;
        const reason = document.getElementById('roleRevokeReason').value.trim();
        
        if (!userId) {
          addVerificationLog('‚ùå Please enter a Discord user ID');
          return;
        }

        const response = await fetch(API_BASE_URL + '/api/admin/revoke-discord-role.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userId,
            role_id: roleId,
            reason: reason || 'Manual role revocation via admin interface'
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addVerificationLog(`‚úÖ Role revoked from user ${userId}`);
          document.getElementById('revokeUserId').value = '';
          document.getElementById('roleRevokeReason').value = '';
        } else {
          addVerificationLog(`‚ùå Failed to revoke role: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Error revoking role: ${error.message}`);
      }
    }

    // Add log to verification log
    function addVerificationLog(message) {
      const log = document.getElementById('verificationLog');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = 'text-blue-400';
      logEntry.textContent = `[${timestamp}] ${message}`;
      log.appendChild(logEntry);
      log.scrollTop = log.scrollHeight;
    }

    // Load holder verification data when tab is opened
    function loadHolderVerificationData() {
      loadHolderVerificationStats();
      addVerificationLog('üîÑ Holder verification system initialized');
    }

    // Refresh verification statistics
    async function refreshVerificationStats() {
      addVerificationLog('üîÑ Refreshing verification statistics...');
      await loadHolderVerificationStats();
      addVerificationLog('‚úÖ Verification statistics refreshed');
    }

    // Export verification data
    async function exportVerificationData() {
      try {
        addVerificationLog('üì• Exporting verification data...');
        
        const response = await fetch(API_BASE_URL + '/api/admin/export-verification-data.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            format: 'json',
            include_history: true
          })
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `verification-data-${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
          addVerificationLog('‚úÖ Verification data exported successfully');
        } else {
          const data = await response.json();
          addVerificationLog(`‚ùå Export failed: ${data.error || 'Unknown error'}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Export error: ${error.message}`);
      }
    }

    // Search holder users with instant search
    function searchHolderUsersInstant(searchTerm) {
      if (searchTimeout) clearTimeout(searchTimeout);
      
      if (searchTerm.length < 2) {
        document.getElementById('holderUserSearchResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
        document.getElementById('holderUserSearchResults').classList.add('hidden');
        return;
      }

      searchTimeout = setTimeout(async () => {
        try {
          const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'searchuser',
              search: searchTerm
            })
          });

          const data = await response.json();
          
          if (data.success) {
            displayHolderUserSearchResults(data.users);
            document.getElementById('holderUserSearchResults').classList.remove('hidden');
          } else {
            addVerificationLog(`‚ùå Search failed: ${data.error}`);
          }
      } catch (error) {
          addVerificationLog(`‚ùå Search error: ${error.message}`);
        }
      }, 300);
    }

    // Display holder user search results
    function displayHolderUserSearchResults(users) {
      const container = document.getElementById('holderUserSearchResults');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="user-card mb-2 p-2 bg-gray-600 rounded">
          <div class="flex justify-between items-center">
            <div>
              <h4 class="font-semibold text-white">${user.username || 'Unknown User'}</h4>
              <p class="text-sm text-gray-300">ID: ${user.user_id}</p>
              <p class="text-sm text-yellow-400">Balance: ${user.score?.toLocaleString() || 0} $DSPOINC</p>
            </div>
            <button onclick="selectHolderUser('${user.user_id}', '${user.username || 'Unknown'}')" 
                    class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">
              Select
            </button>
          </div>
        </div>
      `).join('');
    }

    // Select user from holder search results
    function selectHolderUser(userId, username) {
      document.getElementById('roleUserId').value = userId;
      document.getElementById('holderUserSearchResults').classList.add('hidden');
      document.getElementById('holderUserSearch').value = username;
      addVerificationLog(`‚úÖ Selected user: ${username} (${userId})`);
    }

    // Search holder users (manual search)
    async function searchHolderUsers() {
      const searchTerm = document.getElementById('holderUserSearch').value.trim();
      if (!searchTerm) {
        addVerificationLog('‚ùå Please enter a search term');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'searchuser',
            search: searchTerm
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayHolderUserSearchResults(data.users);
          document.getElementById('holderUserSearchResults').classList.remove('hidden');
          addVerificationLog(`üîç Found ${data.users.length} users matching "${searchTerm}"`);
        } else {
          addVerificationLog(`‚ùå Search failed: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Search error: ${error.message}`);
      }
    }

    // Search revoke users with instant search
    function searchRevokeUsersInstant(searchTerm) {
      if (searchTimeout) clearTimeout(searchTimeout);
      
      if (searchTerm.length < 2) {
        document.getElementById('revokeUserSearchResults').innerHTML = '<div class="text-gray-300">Enter at least 2 characters to search...</div>';
        document.getElementById('revokeUserSearchResults').classList.add('hidden');
        return;
      }

      searchTimeout = setTimeout(async () => {
        try {
          const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'searchuser',
              search: searchTerm
            })
          });

          const data = await response.json();
          
          if (data.success) {
            displayRevokeUserSearchResults(data.users);
            document.getElementById('revokeUserSearchResults').classList.remove('hidden');
          } else {
            addVerificationLog(`‚ùå Search failed: ${data.error}`);
          }
        } catch (error) {
          addVerificationLog(`‚ùå Search error: ${error.message}`);
        }
      }, 300);
    }

    // Display revoke user search results
    function displayRevokeUserSearchResults(users) {
      const container = document.getElementById('revokeUserSearchResults');
      
      if (users.length === 0) {
        container.innerHTML = '<div class="text-gray-300">No users found</div>';
        return;
      }

      container.innerHTML = users.map(user => `
        <div class="user-card mb-2 p-2 bg-gray-600 rounded">
          <div class="flex justify-between items-center">
            <div>
              <h4 class="font-semibold text-white">${user.username || 'Unknown User'}</h4>
              <p class="text-sm text-gray-300">ID: ${user.user_id}</p>
              <p class="text-sm text-yellow-400">Balance: ${user.score?.toLocaleString() || 0} $DSPOINC</p>
            </div>
            <button onclick="selectRevokeUser('${user.user_id}', '${user.username || 'Unknown'}')" 
                    class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm">
              Select
            </button>
          </div>
        </div>
      `).join('');
    }

    // Select user from revoke search results
    function selectRevokeUser(userId, username) {
      document.getElementById('revokeUserId').value = userId;
      document.getElementById('revokeUserSearchResults').classList.add('hidden');
      document.getElementById('revokeUserSearch').value = username;
      addVerificationLog(`‚úÖ Selected user: ${username} (${userId})`);
    }

    // Search revoke users (manual search)
    async function searchRevokeUsers() {
      const searchTerm = document.getElementById('revokeUserSearch').value.trim();
      if (!searchTerm) {
        addVerificationLog('‚ùå Please enter a search term');
        return;
      }

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/point-management.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'searchuser',
            search: searchTerm
          })
        });

        const data = await response.json();
        
        if (data.success) {
          displayRevokeUserSearchResults(data.users);
          document.getElementById('revokeUserSearchResults').classList.remove('hidden');
          addVerificationLog(`üîç Found ${data.users.length} users matching "${searchTerm}"`);
        } else {
          addVerificationLog(`‚ùå Search failed: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Search error: ${error.message}`);
      }
    }

    // Load role history
    async function loadRoleHistory(action) {
      try {
        const response = await fetch(`/api/admin/get-role-grant-history.php?action=${action}&limit=50`);
        const data = await response.json();
        
        if (data.success) {
          displayRoleHistory(data.history);
          addVerificationLog(`‚úÖ Loaded ${data.history.length} role history entries`);
        } else {
          addVerificationLog(`‚ùå Failed to load role history: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Error loading role history: ${error.message}`);
      }
    }

    // Display role history
    function displayRoleHistory(history) {
      const container = document.getElementById('roleHistoryList');
      
      if (history.length === 0) {
        container.innerHTML = '<div class="text-gray-400 text-center py-4">No role history found.</div>';
        return;
      }

      container.innerHTML = history.map(entry => {
        const isRevoked = entry.revoked_at !== null;
        const statusColor = isRevoked ? 'border-red-500' : 'border-green-500';
        const statusIcon = isRevoked ? '‚ùå' : '‚úÖ';
        const statusText = isRevoked ? 'Revoked' : 'Granted';
        const date = new Date(entry.granted_at).toLocaleString();
        
        return `
          <div class="bg-gray-700 p-3 rounded border-l-4 ${statusColor}">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-semibold text-white">${statusIcon} ${statusText}</div>
                <div class="text-gray-300 text-sm">User: ${entry.username || 'Unknown'} (${entry.user_id})</div>
                <div class="text-gray-300 text-sm">Role: ${entry.role_name || entry.role_id}</div>
                <div class="text-gray-300 text-sm">Date: ${date}</div>
                <div class="text-gray-300 text-sm">Reason: ${entry.reason || 'No reason provided'}</div>
                ${isRevoked ? `<div class="text-gray-300 text-sm">Revoked: ${new Date(entry.revoked_at).toLocaleString()}</div>` : ''}
              </div>
              <div class="text-right">
                <span class="px-2 py-1 rounded text-xs font-semibold ${isRevoked ? 'bg-red-600 text-white' : 'bg-green-600 text-white'}">
                  ${statusText}
                </span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Search role history
    async function searchRoleHistory() {
      const searchTerm = document.getElementById('historyUserSearch').value.trim();
      if (!searchTerm) {
        addVerificationLog('‚ùå Please enter a search term');
        return;
      }

      try {
        const response = await fetch(`/api/admin/get-role-grant-history.php?user_id=${encodeURIComponent(searchTerm)}&limit=50`);
        const data = await response.json();
        
        if (data.success) {
          displayRoleHistory(data.history);
          addVerificationLog(`üîç Found ${data.history.length} matching role history entries`);
        } else {
          addVerificationLog(`‚ùå Search failed: ${data.error}`);
        }
      } catch (error) {
        addVerificationLog(`‚ùå Search error: ${error.message}`);
      }
    }

    // Load current season settings
    async function loadCurrentSeasonSettings() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-current-season-settings.php');
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('currentTetrisMax').textContent = data.tetris_max_score.toLocaleString();
          document.getElementById('currentSnakeMax').textContent = data.snake_max_score.toLocaleString();
          document.getElementById('currentSpaceInvadersMax').textContent = data.space_invaders_max_score ? data.space_invaders_max_score.toLocaleString() : '10000';
          document.getElementById('currentPointsPerLine').textContent = data.points_per_line;
          document.getElementById('currentPointsPerCheese').textContent = data.points_per_cheese;
          document.getElementById('currentPointsPerInvader').textContent = data.points_per_invader ? data.points_per_invader : '0.01';
          
          // Update ratio displays if they exist
          const tetrisRatioElement = document.getElementById('tetrisRatio');
          const snakeRatioElement = document.getElementById('snakeRatio');
          const spaceInvadersRatioElement = document.getElementById('spaceInvadersRatio');
          if (tetrisRatioElement) {
            tetrisRatioElement.textContent = `1:${data.points_per_line}`;
          }
          if (snakeRatioElement) {
            snakeRatioElement.textContent = `1:${data.points_per_cheese}`;
          }
          if (spaceInvadersRatioElement) {
            const invaderRatio = data.points_per_invader ? data.points_per_invader : 0.01;
            spaceInvadersRatioElement.textContent = `1:${invaderRatio}`;
          }
          
          addLog('‚úÖ Season settings loaded successfully');
        } else {
          addLog(`‚ùå Failed to load current season settings: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Error loading current season settings: ${error.message}`);
      }
    }

    // Set ratio preset
    function setRatioPreset(tetrisRatio, snakeRatio, spaceInvadersRatio = 0.1) {
      document.getElementById('newPointsPerLine').value = tetrisRatio;
      document.getElementById('newPointsPerCheese').value = snakeRatio;
      document.getElementById('newPointsPerInvader').value = spaceInvadersRatio;
      addLog(`‚ö° Applied ratio preset: Tetris 1:${tetrisRatio}, Snake 1:${snakeRatio}, Space Invaders 1:${spaceInvadersRatio}`);
    }

    // Update season settings
    async function updateSeasonSettings() {
      try {
        const tetrisMax = parseInt(document.getElementById('newTetrisMax').value);
        const snakeMax = parseInt(document.getElementById('newSnakeMax').value);
        const spaceInvadersMax = parseInt(document.getElementById('newSpaceInvadersMax').value);
        const pointsPerLine = parseInt(document.getElementById('newPointsPerLine').value);
        const pointsPerCheese = parseInt(document.getElementById('newPointsPerCheese').value);
        const pointsPerInvader = parseFloat(document.getElementById('newPointsPerInvader').value);

        if (isNaN(tetrisMax) || isNaN(snakeMax) || isNaN(spaceInvadersMax) || isNaN(pointsPerLine) || isNaN(pointsPerCheese) || isNaN(pointsPerInvader)) {
          addLog('‚ùå Please enter valid numbers for all fields');
          return;
        }

        const response = await fetch(API_BASE_URL + '/api/admin/update-season-settings.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            tetris_max_score: tetrisMax,
            snake_max_score: snakeMax,
            space_invaders_max_score: spaceInvadersMax,
            points_per_line: pointsPerLine,
            points_per_cheese: pointsPerCheese,
            points_per_invader: pointsPerInvader
          })
        });

        const data = await response.json();
        
        if (data.success) {
          addLog(`‚úÖ Season settings updated successfully`);
          loadCurrentSeasonSettings();
        } else {
          addLog(`‚ùå Failed to update season settings: ${data.error}`);
        }
      } catch (error) {
        addLog(`‚ùå Error updating season settings: ${error.message}`);
      }
    }

    // Discord Activity Feed Functions
    let discordFeedInterval = null;
    let discordFeedActive = false;
    let discordEventCount = 0;

    function toggleDiscordFeed() {
      const button = document.getElementById('toggleDiscordFeed');
      const status = document.getElementById('feedStatus');
      
      if (discordFeedActive) {
        // Stop the feed
        if (discordFeedInterval) {
          clearInterval(discordFeedInterval);
          discordFeedInterval = null;
        }
        discordFeedActive = false;
        status.textContent = '‚ñ∂Ô∏è Start';
        button.className = 'bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm';
        addLog('üõë Discord activity feed stopped');
      } else {
        // Start the feed
        discordFeedActive = true;
        status.textContent = '‚èπÔ∏è Stop';
        button.className = 'bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm';
        startDiscordFeed();
        addLog('‚ñ∂Ô∏è Discord activity feed started');
      }
    }

    function startDiscordFeed() {
      // Clear existing feed
      clearDiscordFeed();
      
      // Start polling for Discord events
      discordFeedInterval = setInterval(async () => {
        try {
          // First try to get real-time Discord events
          const response = await fetch(API_BASE_URL + '/api/admin/discord-events.php');
          const data = await response.json();
          
          if (data.success && data.events && data.events.length > 0) {
            data.events.forEach(event => {
              addDiscordEvent(event);
            });
          } else {
            // Fallback to the old activity endpoint
            const fallbackResponse = await fetch(API_BASE_URL + '/api/admin/get-discord-activity.php');
            const fallbackData = await fallbackResponse.json();
            
            if (fallbackData.success && fallbackData.events && fallbackData.events.length > 0) {
              fallbackData.events.forEach(event => {
                addDiscordEvent(event);
              });
            }
          }
      } catch (error) {
          console.error('Error fetching Discord activity:', error);
        }
      }, 2000); // Poll every 2 seconds
    }

    function addDiscordEvent(event) {
      const feed = document.getElementById('discordActivityFeed');
      const stats = document.getElementById('feedStats');
      
      // Create event element
      const eventElement = document.createElement('div');
      eventElement.className = 'flex items-center space-x-2 text-gray-300 hover:bg-gray-700 p-1 rounded transition-colors';
      
      const timestamp = new Date(event.timestamp).toLocaleTimeString();
      const eventType = getEventTypeIcon(event.type);
      const userName = event.user_name || 'Unknown';
      const channelName = event.channel_name || 'Unknown';
      
      // Determine color based on event type
      let userColor = 'text-green-400';
      let channelColor = 'text-yellow-400';
      
      if (event.type === 'admin_action') {
        userColor = 'text-red-400';
        channelColor = 'text-purple-400';
      } else if (event.type === 'command') {
        userColor = 'text-blue-400';
        channelColor = 'text-cyan-400';
      } else if (event.type === 'cheese_click') {
        userColor = 'text-orange-400';
        channelColor = 'text-yellow-400';
      } else if (event.type === 'game_score') {
        userColor = 'text-purple-400';
        channelColor = 'text-green-400';
      }
      
      eventElement.innerHTML = `
        <span class="text-gray-500 text-xs min-w-[60px]">${timestamp}</span>
        <span class="text-blue-400 text-lg">${eventType}</span>
        <span class="${userColor} font-semibold">${userName}</span>
        <span class="text-gray-400">in</span>
        <span class="${channelColor}">#${channelName}</span>
        <span class="text-gray-500 text-xs">(${event.user_id})</span>
        ${event.description ? `<span class="text-gray-400 text-xs ml-2">- ${event.description}</span>` : ''}
      `;
      
      // Add to feed
      feed.insertBefore(eventElement, feed.firstChild);
      
      // Limit feed to 50 events
      while (feed.children.length > 50) {
        feed.removeChild(feed.lastChild);
      }
      
      // Update stats
      discordEventCount++;
      stats.textContent = `Events: ${discordEventCount} | Last update: ${timestamp}`;
    }

    function getEventTypeIcon(eventType) {
      switch(eventType) {
        case 'messageCreate':
          return 'üí¨';
        case 'messageDelete':
          return 'üóëÔ∏è';
        case 'memberJoin':
          return 'üëã';
        case 'memberLeave':
          return 'üëã';
        case 'reactionAdd':
          return 'üëç';
        case 'reactionRemove':
          return 'üëé';
        case 'command':
          return '‚ö°';
        case 'game_score':
          return 'üéÆ';
        case 'admin_action':
          return 'üîß';
        case 'cheese_click':
          return 'üßÄ';
        default:
          return 'üìù';
      }
    }

    function clearDiscordFeed() {
      const feed = document.getElementById('discordActivityFeed');
      const stats = document.getElementById('feedStats');
      
      feed.innerHTML = `
        <div class="text-gray-400 text-center py-4">
          <div class="text-lg mb-2">ü§ñ Discord Bot Activity</div>
          <div class="text-sm">Click "Start" to begin monitoring Discord events</div>
        </div>
      `;
      
      discordEventCount = 0;
      stats.textContent = 'Events: 0 | Last update: Never';
    }

    // üîß REMOVED: Duplicate loadCommunityFundsData function (conflicting with main implementation)
    
    // Import wallet CSV data
    async function importWalletCSV() {
      addLog('üì• Importing wallet CSV data...');
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/import-wallet-csv.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (data.success) {
          if (data.status === 'already_imported') {
            addLog('‚úÖ Wallet data already imported!');
            addLog(`üí∞ Current Balance: ${data.current_balance} SOL`);
            addLog(`üìä Total Transactions: ${data.total_transactions}`);
            addLog(`üìÖ Last Import: ${data.timestamp}`);
            
            // Update import status
            document.getElementById('walletImportStatus').innerHTML = 
              `<span class="text-green-400">‚úÖ Already imported ${data.total_transactions} transactions</span>`;
          } else {
            addLog('‚úÖ Wallet CSV imported successfully!');
            addLog(`üí∞ Current Balance: ${data.balance.sol} SOL`);
            addLog(`üìä Total Transactions: ${data.transactions.total}`);
            
            // Update import status
            document.getElementById('walletImportStatus').innerHTML = 
              `<span class="text-green-400">‚úÖ Imported ${data.transactions.total} transactions</span>`;
          }
          
          // Refresh wallet data display
          loadRealWalletData();
        } else {
          addLog('‚ùå CSV import failed: ' + (data.message || 'Unknown error'));
          document.getElementById('walletImportStatus').innerHTML = 
            `<span class="text-red-400">‚ùå Import failed</span>`;
        }
      } catch (error) {
        addLog('‚ùå CSV import error: ' + error.message);
        document.getElementById('walletImportStatus').innerHTML = 
          `<span class="text-red-400">‚ùå Import error</span>`;
      }
    }
    
    // Force reimport wallet CSV data
    async function forceReimportCSV() {
      if (!confirm('‚ö†Ô∏è This will delete all existing wallet data and reimport from CSV. Continue?')) {
        return;
      }
      
      addLog('üîÑ Force reimporting wallet CSV data...');
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/import-wallet-csv.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            force_reimport: 'true'
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Wallet CSV reimported successfully!');
          
          // Handle both response formats (force reimport vs normal import)
          if (data.data && data.data.current_balance && data.data.transactions) {
            // Force reimport response format
            addLog(`üí∞ Current Balance: ${data.data.current_balance.sol} SOL`);
            addLog(`üìä Total Transactions: ${data.data.transactions.total}`);
            
            // Update import status
            document.getElementById('walletImportStatus').innerHTML = 
              `<span class="text-green-400">‚úÖ Reimported ${data.data.transactions.total} transactions</span>`;
          } else if (data.balance && data.transactions) {
            // Normal import response format
            addLog(`üí∞ Current Balance: ${data.balance.sol} SOL`);
            addLog(`üìä Total Transactions: ${data.transactions.total}`);
            
            // Update import status
            document.getElementById('walletImportStatus').innerHTML = 
              `<span class="text-green-400">‚úÖ Reimported ${data.transactions.total} transactions</span>`;
          } else {
            // Fallback for other response formats
            addLog(`üí∞ Reimport completed successfully`);
            document.getElementById('walletImportStatus').innerHTML = 
              `<span class="text-green-400">‚úÖ Reimport completed successfully</span>`;
          }
          
          // Refresh wallet data display
          loadRealWalletData();
        } else {
          addLog('‚ùå CSV reimport failed: ' + (data.message || 'Unknown error'));
          document.getElementById('walletImportStatus').innerHTML = 
            `<span class="text-red-400">‚ùå Reimport failed</span>`;
        }
      } catch (error) {
        addLog('‚ùå CSV reimport error: ' + error.message);
        document.getElementById('walletImportStatus').innerHTML = 
          `<span class="text-red-400">‚ùå Reimport error</span>`;
      }
    }
    
    // Load real wallet data from CSV import
    async function loadRealWalletData() {
      try {
        // Check if we're on the community funds tab before proceeding
        const communityFundsTab = document.getElementById('communityFundsTab');
        if (!communityFundsTab || communityFundsTab.style.display === 'none') {
          addLog('‚ö†Ô∏è Community Funds tab not visible, skipping wallet data load');
          return;
        }
        
        const response = await fetch(API_BASE_URL + '/api/admin/get-community-wallet-real-data.php');
        const data = await response.json();
        
        addLog(`üìä Real wallet API response: ${JSON.stringify(data).substring(0, 200)}...`);
        
        if (data.success) {
          // Update wallet balance display - handle both response formats
          const balanceElement = document.getElementById('walletBalance');
          const changeElement = document.getElementById('wallet24hChange');
          const transactionsElement = document.getElementById('walletTransactions');
          const statusElement = document.getElementById('walletImportStatus');
          
          // Safely update elements only if they exist
          if (balanceElement && data.balance && data.balance.sol !== undefined) {
            balanceElement.textContent = data.balance.sol.toFixed(9);
            addLog(`üí∞ Updated wallet balance display: ${data.balance.sol.toFixed(9)} SOL`);
          } else {
            addLog(`‚ö†Ô∏è Could not update wallet balance: element=${!!balanceElement}, data.balance=${!!data.balance}, sol=${data.balance?.sol}`);
          }
          
          if (changeElement && data.balance && data.balance['24h_change'] !== undefined) {
            changeElement.textContent = data.balance['24h_change'].toFixed(9);
          } else if (changeElement) {
            changeElement.textContent = '0.000000000';
          }
          
          if (transactionsElement && data.transactions && data.transactions.total !== undefined) {
            transactionsElement.textContent = data.transactions.total;
          }
          
          // Update import status safely
          if (statusElement) {
            if (data.transactions && data.transactions.total > 0) {
              statusElement.innerHTML = `<span class="text-green-400">‚úÖ ${data.transactions.total} transactions loaded</span>`;
              if (data.balance && data.balance.sol !== undefined) {
                addLog(`üí∞ Real wallet balance: ${data.balance.sol} SOL`);
              }
            } else {
              statusElement.innerHTML = `<span class="text-yellow-400">‚ö†Ô∏è No wallet data imported yet</span>`;
            }
          }
          
          // Display transaction history in the new table
          displayWalletTransactionHistory(data);
        } else {
          // Handle error case
          const balanceElement = document.getElementById('walletBalance');
          const changeElement = document.getElementById('wallet24hChange');
          const transactionsElement = document.getElementById('walletTransactions');
          const statusElement = document.getElementById('walletImportStatus');
          
          if (balanceElement) balanceElement.textContent = '-';
          if (changeElement) changeElement.textContent = '-';
          if (transactionsElement) transactionsElement.textContent = '-';
          
          if (statusElement) {
            statusElement.innerHTML = `<span class="text-red-400">‚ùå ${data.error || 'Unknown error'}</span>`;
          }
        }
      } catch (error) {
        addLog('‚ùå Error loading real wallet data: ' + error.message);
        const statusElement = document.getElementById('walletImportStatus');
        if (statusElement) {
          statusElement.innerHTML = `<span class="text-red-400">‚ùå Error loading data</span>`;
        }
      }
    }
    
    // Refresh wallet data
    async function refreshWalletData() {
      addLog('üîÑ Refreshing wallet data...');
      await loadRealWalletData();
    }
    
    // Display wallet transaction history
    function displayWalletTransactionHistory(data) {
      const tableBody = document.getElementById('walletTransactionsTableBody');
      if (!tableBody) return;
      
      if (data.transactions && data.transactions.recent && data.transactions.recent.length > 0) {
        let html = '';
        
        data.transactions.recent.forEach(tx => {
          const amountSol = tx.amount_sol || 0;
          const balanceSol = tx.post_balance_sol || 0;
          const feeSol = tx.fee_sol || 0;
          const time = tx.time || 'Unknown';
          const type = tx.type || 'Unknown';
          const txhash = tx.hash || 'Unknown';
          
          const amountClass = amountSol > 0 ? 'text-green-400' : 'text-red-400';
          const typeClass = type === 'inc' ? 'text-green-400' : 'text-red-400';
          
          html += `
            <tr class="border-b border-gray-600 hover:bg-gray-600 hover:bg-opacity-50">
              <td class="px-4 py-2 text-sm">${time}</td>
              <td class="px-4 py-2 text-sm ${typeClass}">${type === 'inc' ? 'üì• Incoming' : 'üì§ Outgoing'}</td>
              <td class="px-4 py-2 text-sm ${amountClass}">${amountSol.toFixed(9)}</td>
              <td class="px-4 py-2 text-sm text-blue-400">${balanceSol.toFixed(9)}</td>
              <td class="px-4 py-2 text-sm text-yellow-400">${feeSol.toFixed(6)}</td>
              <td class="px-4 py-2 text-sm text-center">
                <button onclick="editWalletTransaction('${txhash}', '${type}', ${amountSol}, ${balanceSol}, ${feeSol})" class="text-blue-600 hover:text-blue-800 px-2 py-1 mr-2">
                  ‚úèÔ∏è
                </button>
                <button onclick="viewTransactionDetails('${txhash}')" class="text-green-600 hover:text-green-800 px-2 py-1">
                  üëÅÔ∏è
                </button>
              </td>
            </tr>
          `;
        });
        
        tableBody.innerHTML = html;
        addLog(`üìä Displayed ${data.transactions.recent.length} wallet transactions`);
      } else {
        tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-gray-400">No transaction history available</td></tr>';
        addLog('‚ö†Ô∏è No transaction history to display');
      }
    }
    
    // Edit wallet transaction
    function editWalletTransaction(txhash, type, amount, balance, fee) {
      addLog(`‚úèÔ∏è Editing transaction: ${txhash}`);
      
      // Create modal HTML
      const modalHTML = `
        <div id="editWalletTransactionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4">
            <h3 class="text-xl font-semibold mb-4 text-white">‚úèÔ∏è Edit Wallet Transaction</h3>
            
            <input type="hidden" id="editTxHash" value="${txhash}">
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Transaction Hash</label>
                <input type="text" id="editTxHashDisplay" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       value="${txhash}" readonly>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Type</label>
                <select id="editTxType" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white">
                  <option value="inc" ${type === 'inc' ? 'selected' : ''}>üì• Incoming</option>
                  <option value="dec" ${type === 'dec' ? 'selected' : ''}>üì§ Outgoing</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Amount (SOL)</label>
                <input type="number" id="editTxAmount" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       step="0.000000001" min="0" value="${amount}" placeholder="0.000000000">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Balance (SOL)</label>
                <input type="number" id="editTxBalance" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       step="0.000000001" min="0" value="${balance}" placeholder="0.000000000">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Fee (SOL)</label>
                <input type="number" id="editTxFee" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       step="0.000000001" min="0" value="${fee}" placeholder="0.000000000">
              </div>
            </div>
            
            <div class="flex gap-3 mt-6">
              <button onclick="closeEditWalletTransactionModal()" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                Cancel
              </button>
              <button onclick="submitEditWalletTransaction()" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">
                Update Transaction
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to page load
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    function closeEditWalletTransactionModal() {
      const modal = document.getElementById('editWalletTransactionModal');
      if (modal) {
        modal.remove();
      }
    }
    
    async function submitEditWalletTransaction() {
      const txhash = document.getElementById('editTxHash').value;
      const type = document.getElementById('editTxType').value;
      const amount = parseFloat(document.getElementById('editTxAmount').value);
      const balance = parseFloat(document.getElementById('editTxBalance').value);
      const fee = parseFloat(document.getElementById('editTxFee').value);
      
      if (isNaN(amount) || amount < 0 || isNaN(balance) || balance < 0 || isNaN(fee) || fee < 0) {
        addLog('‚ùå Please fill in all values with valid numbers');
        return;
      }
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/update-wallet-transaction.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            txhash: txhash,
            type: type,
            amount: amount,
            balance: balance,
            fee: fee
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Wallet transaction updated successfully');
          closeEditWalletTransactionModal();
          loadRealWalletData(); // Refresh data
        } else {
          addLog('‚ùå Failed to update transaction: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Error updating transaction: ' + error.message);
        console.error('Edit wallet transaction error:', error);
      }
    }
    
    // View transaction details
    function viewTransactionDetails(txhash) {
      addLog(`üëÅÔ∏è Viewing transaction details: ${txhash}`);
      // For now, just show the hash in a simple alert
      alert(`Transaction Hash: ${txhash}\n\nThis feature can be expanded to show more details like:\n- Block information\n- Token transfers\n- Associated accounts\n- Raw transaction data`);
    }

    function showCommunityFundsLoadingStates() {
      // Show loading for metrics
      document.getElementById('solBalance').textContent = 'Loading...';
      document.getElementById('totalNfts').textContent = 'Loading...';
      document.getElementById('totalCollections').textContent = 'Loading...';
      document.getElementById('totalEntries').textContent = 'Loading...';
      
      // Show loading for statistics
      document.getElementById('monthlyTotal').textContent = 'Loading...';
      document.getElementById('lastMonthTotal').textContent = 'Loading...';
      document.getElementById('averageEntry').textContent = 'Loading...';
      
      // Show loading for collections and NFTs
      document.getElementById('collectionsSummary').innerHTML = '<div class="text-center text-gray-300">Loading collections...</div>';
      document.getElementById('nftGallery').innerHTML = '<div class="text-center text-gray-300">Loading NFTs...</div>';
      
      // Show loading for recent activity
      document.getElementById('recentActivity').innerHTML = '<div class="text-gray-400 text-sm">Loading recent activity...</div>';
    }

    async function loadCommunityWalletData() {
      try {
        addLog('üîÑ Loading community wallet data...');
        const response = await fetch(API_BASE_URL + '/api/admin/get-community-wallet-nfts.php');
        addLog(`üì° Wallet API response status: ${response.status}`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        addLog(`üìä Wallet API response: ${JSON.stringify(data).substring(0, 200)}...`);
        
        if (data.success) {
          // Update SOL balance
          document.getElementById('solBalance').textContent = data.balance.sol.toFixed(4);
          
          // Update NFT count
          document.getElementById('totalNfts').textContent = data.nfts.total;
          
          // Update collections count
          document.getElementById('totalCollections').textContent = data.nfts.collections.length;
          
          // Display collections summary
          displayCollectionsSummary(data.nfts.collections);
          
          // Display NFT gallery
          displayNFTGallery(data.nfts.list);
          
          // Populate collection filters
          populateCollectionFilters(data.nfts.collections);
          
          // Store NFT data for modal
          window.communityNFTs = data.nfts.list;
          window.communityCollections = data.nfts.collections;
          
          addLog('‚úÖ Community wallet data loaded successfully');
        } else {
          console.error('Error loading wallet data:', data.error);
          addLog(`‚ùå Wallet API error: ${data.error}`);
          document.getElementById('solBalance').textContent = 'Error';
          document.getElementById('totalNfts').textContent = 'Error';
          document.getElementById('totalCollections').textContent = 'Error';
          
          // Show error in collections and NFTs
          document.getElementById('collectionsSummary').innerHTML = '<div class="text-center text-red-400">Error loading collections</div>';
          document.getElementById('nftGallery').innerHTML = '<div class="text-center text-red-400">Error loading NFTs</div>';
        }
      } catch (error) {
        console.error('Error loading wallet data:', error);
        addLog(`‚ùå Wallet data loading error: ${error.message}`);
        document.getElementById('solBalance').textContent = 'Error';
        document.getElementById('totalNfts').textContent = 'Error';
        document.getElementById('totalCollections').textContent = 'Error';
        
        // Show error in collections and NFTs
        document.getElementById('collectionsSummary').innerHTML = '<div class="text-center text-red-400">Error loading collections</div>';
        document.getElementById('nftGallery').innerHTML = '<div class="text-center text-red-400">Error loading NFTs</div>';
      }
    }

    async function loadCommunityFundsEntries() {
      try {
        addLog('üîÑ Loading community funds entries...');
        const response = await fetch(API_BASE_URL + '/api/admin/get-community-funds.php');
        addLog(`üì° Funds API response status: ${response.status}`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        addLog(`üìä Funds API response: ${JSON.stringify(data).substring(0, 200)}...`);
        
        if (data.success) {
          // üîß CRITICAL FIX: Better data validation
          if (data.entries && Array.isArray(data.entries)) {
            displayCommunityFundsEntries(data.entries);
            calculateAndDisplayStatistics(data.entries);
            displayCommunityFundsRecentActivity(data.entries);
            
            // Update total entries count
            const totalElement = document.getElementById('totalEntries');
            if (totalElement) {
              totalElement.textContent = data.entries.length;
            }
            
            addLog(`‚úÖ Community funds entries loaded: ${data.entries.length} entries`);
          } else {
            console.error('‚ùå Invalid entries format:', data.entries);
            addLog(`‚ùå Funds API returned invalid entries format: ${typeof data.entries}`);
            displayCommunityFundsEntries([]); // Show empty state
          }
        } else {
          console.error('‚ùå Funds API error:', data.message);
          addLog(`‚ùå Funds API error: ${data.message}`);
          displayCommunityFundsEntries([]); // Show empty state
        }
      } catch (error) {
        console.error('Error loading community funds:', error);
        addLog(`‚ùå Funds entries loading error: ${error.message}`);
      }
    }

    function displayCommunityFundsEntries(entries) {
      console.log('üîç displayCommunityFundsEntries called with:', entries);
      
      const tbody = document.getElementById('communityFundsTableBody');
      console.log('üîç communityFundsTableBody element:', tbody);
      
      // üîß CRITICAL FIX: Check if element exists before accessing
      if (!tbody) {
        console.error('‚ùå communityFundsTableBody element not found');
        addLog('‚ùå Community funds table body element not found');
        
        // Try to find the element again after a short delay
        setTimeout(() => {
          const retryTbody = document.getElementById('communityFundsTableBody');
          if (retryTbody) {
            console.log('‚úÖ Found communityFundsTableBody on retry');
            displayCommunityFundsEntries(entries);
          } else {
            console.error('‚ùå Still cannot find communityFundsTableBody after retry');
            addLog('‚ùå Community funds table body element still not found after retry');
          }
        }, 500);
        return;
      }
      
      console.log('‚úÖ Found communityFundsTableBody, updating display');
      tbody.innerHTML = '';
      
      if (!entries || entries.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="px-4 py-4 text-center text-gray-500">No community funds entries found</td>
          </tr>
        `;
        addLog('‚ÑπÔ∏è No community funds entries to display');
        return;
      }
      
      console.log(`üìä Displaying ${entries.length} community funds entries`);
      addLog(`üìä Displaying ${entries.length} community funds entries`);
      
      entries.forEach((entry, index) => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50';
        
        row.innerHTML = `
          <td class="px-4 py-2 border-b">${entry.type}</td>
          <td class="px-4 py-2 border-b">${entry.description}</td>
          <td class="px-4 py-2 border-b text-right">${entry.amount} SOL</td>
          <td class="px-4 py-2 border-b">${entry.date}</td>
          <td class="px-4 py-2 border-b text-center">
            <button onclick="editCommunityFundsEntry(${entry.id}, '${entry.type}', '${entry.description.replace(/'/g, "\\'")}', ${entry.amount})" class="text-blue-600 hover:text-blue-800 px-2 py-1 mr-2">
              ‚úèÔ∏è
            </button>
            <button onclick="deleteCommunityFundsEntry(${entry.id})" class="text-red-600 hover:text-red-800 px-2 py-1">
              üóëÔ∏è
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
      
      console.log('‚úÖ Community funds display updated successfully');
      addLog('‚úÖ Community funds display updated successfully');
    }

    async function addCommunityFundsEntry() {
      const type = document.getElementById('entryType').value;
      const description = document.getElementById('entryDescription').value;
      const amount = parseFloat(document.getElementById('entryAmount').value);
      
      if (!type || !description || isNaN(amount)) {
        alert('Please fill in all fields with valid values');
        return;
      }
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/add-community-funds.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            type: type,
            description: description,
            amount: amount
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Clear form
          document.getElementById('entryType').value = 'expense';
          document.getElementById('entryDescription').value = '';
          document.getElementById('entryAmount').value = '';
          
          // Reload data
          loadCommunityFundsData();
          
          alert('Community funds entry added successfully!');
        } else {
          alert('Error: ' + data.message);
        }
      } catch (error) {
        console.error('Error adding community funds entry:', error);
        alert('Error adding entry. Please try again.');
      }
    }

    async function deleteCommunityFundsEntry(id) {
      if (!confirm('Are you sure you want to delete this entry?')) {
        return;
      }
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/delete-community-funds.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ id: id })
        });
        
        const data = await response.json();
        
        if (data.success) {
          loadCommunityFundsData();
          alert('Entry deleted successfully!');
        } else {
          alert('Error: ' + data.message);
        }
      } catch (error) {
        console.error('Error deleting entry:', error);
        alert('Error deleting entry. Please try again.');
      }
    }
    
    // üîß NEW: CSV Import/Export Functions for Community Funds
    async function importCommunityFundsCSV() {
      const fileInput = document.getElementById('communityFundsCsvInput');
      const statusDiv = document.getElementById('communityFundsCsvStatus');
      
      if (!fileInput.files[0]) {
        statusDiv.innerHTML = '<span class="text-red-400">‚ùå Please select a CSV file first</span>';
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = async function(e) {
        try {
          const csvText = e.target.result;
          const lines = csvText.split('\n');
          const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
          
          // Validate CSV structure
          const requiredHeaders = ['type', 'description', 'amount', 'date'];
          const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
          
          if (missingHeaders.length > 0) {
            statusDiv.innerHTML = `<span class="text-red-400">‚ùå Missing required headers: ${missingHeaders.join(', ')}</span>`;
            return;
          }
          
          statusDiv.innerHTML = '<span class="text-blue-400">‚è≥ Processing CSV file...</span>';
          
          let successCount = 0;
          let errorCount = 0;
          
          // Process each line (skip header)
          for (let i = 1; i < lines.length; i++) {
            if (lines[i].trim() === '') continue;
            
            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
            if (values.length < 4) continue;
            
            const entry = {
              type: values[0],
              description: values[1],
              amount: parseFloat(values[2]),
              date: values[3]
            };
            
            try {
              const response = await fetch(API_BASE_URL + '/api/admin/add-community-funds.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(entry)
              });
              
              const result = await response.json();
              if (result.success) {
                successCount++;
              } else {
                errorCount++;
                console.error(`Error importing line ${i + 1}:`, result.message);
              }
            } catch (error) {
              errorCount++;
              console.error(`Error importing line ${i + 1}:`, error);
            }
          }
          
          statusDiv.innerHTML = `<span class="text-green-400">‚úÖ Import completed: ${successCount} successful, ${errorCount} errors</span>`;
          
          // Refresh the display
          setTimeout(() => {
            loadCommunityFundsData();
          }, 1000);
          
        } catch (error) {
          statusDiv.innerHTML = `<span class="text-red-400">‚ùå Error processing CSV: ${error.message}</span>`;
          console.error('CSV processing error:', error);
        }
      };
      
      reader.readAsText(file);
    }
    
    async function downloadCommunityFundsCSV() {
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-community-funds.php');
        const data = await response.json();
        
        if (!data.success || !data.entries) {
          alert('Error loading community funds data for export');
          return;
        }
        
        // Create CSV content
        const headers = ['Type', 'Description', 'Amount', 'Date', 'Created At'];
        const csvContent = [
          headers.join(','),
          ...data.entries.map(entry => [
            entry.type,
            `"${entry.description}"`,
            entry.amount,
            entry.date,
            entry.created_at
          ].join(','))
        ].join('\n');
        
        // Create and download file
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `community-funds-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        addLog('‚úÖ Community funds CSV exported successfully');
        
      } catch (error) {
        console.error('Error exporting CSV:', error);
        alert('Error exporting CSV. Please try again.');
      }
    }
    
    // üîß NEW: Wallet Transactions CSV Import/Export Functions
    async function importWalletTransactionsCSV() {
      const fileInput = document.getElementById('walletTransactionsCsvInput');
      const statusDiv = document.getElementById('walletTransactionsCsvStatus');
      
      if (!fileInput.files[0]) {
        statusDiv.innerHTML = '<span class="text-red-400">‚ùå Please select a CSV file first</span>';
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = async function(e) {
        try {
          const csvText = e.target.result;
          const lines = csvText.split('\n');
          const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
          
          // Validate CSV structure for wallet transactions
          const requiredHeaders = ['txhash', 'type', 'amount', 'balance', 'fee'];
          const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
          
          if (missingHeaders.length > 0) {
            statusDiv.innerHTML = `<span class="text-red-400">‚ùå Missing required headers: ${missingHeaders.join(', ')}</span>`;
            return;
          }
          
          statusDiv.innerHTML = '<span class="text-blue-400">‚è≥ Processing wallet transactions CSV...</span>';
          
          let successCount = 0;
          let errorCount = 0;
          
          // Process each line (skip header)
          for (let i = 1; i < lines.length; i++) {
            if (lines[i].trim() === '') continue;
            
            const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
            if (values.length < 5) continue;
            
            const transaction = {
              txhash: values[0],
              type: values[1], // 'inc' or 'dec'
              amount: parseFloat(values[2]),
              balance: parseFloat(values[3]),
              fee: parseFloat(values[4])
            };
            
            try {
              // Use the update-wallet-transaction.php API
              const response = await fetch(API_BASE_URL + '/api/admin/update-wallet-transaction.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(transaction)
              });
              
              const result = await response.json();
              if (result.success) {
                successCount++;
              } else {
                errorCount++;
                console.error(`Error importing line ${i + 1}:`, result.message);
              }
            } catch (error) {
              errorCount++;
              console.error(`Error importing line ${i + 1}:`, error);
            }
          }
          
          statusDiv.innerHTML = `<span class="text-green-400">‚úÖ Wallet transactions import completed: ${successCount} successful, ${errorCount} errors</span>`;
          
          // Refresh the wallet data display
          setTimeout(() => {
            loadCommunityWalletData();
          }, 1000);
          
        } catch (error) {
          statusDiv.innerHTML = `<span class="text-red-400">‚ùå Error processing CSV: ${error.message}</span>`;
          console.error('CSV processing error:', error);
        }
      };
      
      reader.readAsText(file);
    }
    
    async function downloadWalletTransactionsCSV() {
      try {
        // Get wallet transactions data from the correct API
        const response = await fetch(API_BASE_URL + '/api/admin/get-wallet-transactions.php?limit=10000');
        const data = await response.json();
        
        if (!data.success || !data.transactions) {
          alert('Error loading wallet transactions data for export');
          return;
        }
        
        // Create CSV content for wallet transactions
        const headers = ['Transaction Hash', 'Block Time', 'Change Type', 'Amount (SOL)', 'Pre Balance (SOL)', 'Post Balance (SOL)', 'Fee (SOL)', 'Token Account', 'Token Address', 'Created At'];
        const csvContent = [
          headers.join(','),
          ...data.transactions.map(tx => [
            tx.txhash || 'N/A',
            tx.block_time || 'N/A',
            tx.change_type || 'N/A',
            tx.amount_sol || 0,
            tx.pre_balance_sol || 0,
            tx.post_balance_sol || 0,
            tx.fee_sol || 0,
            tx.token_account || 'N/A',
            tx.token_address || 'N/A',
            tx.created_at || 'N/A'
          ].join(','))
        ].join('\n');
        
        // Create and download file
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `wallet-transactions-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        addLog(`‚úÖ Wallet transactions CSV exported successfully: ${data.transactions.length} transactions`);
        
      } catch (error) {
        console.error('Error exporting CSV:', error);
        alert('Error exporting CSV. Please try again.');
      }
    }
    
    async function loadWalletTransactionsData() {
      try {
        addLog('üí∞ Loading wallet transactions data...');
        await loadCommunityWalletData();
        addLog('‚úÖ Wallet transactions data refreshed');
      } catch (error) {
        addLog(`‚ùå Error loading wallet transactions: ${error.message}`);
      }
    }

    function refreshCommunityFundsData() {
      loadCommunityFundsData();
    }

    function refreshWalletData() {
      loadCommunityWalletData();
    }

    function calculateAndDisplayStatistics(entries) {
      if (!entries || entries.length === 0) {
        document.getElementById('monthlyTotal').textContent = '0.0000';
        document.getElementById('lastMonthTotal').textContent = '0.0000';
        document.getElementById('averageEntry').textContent = '0.0000';
        return;
      }

      const now = new Date();
      const currentMonth = now.getMonth();
      const currentYear = now.getFullYear();
      
      let monthlyTotal = 0;
      let lastMonthTotal = 0;
      let totalAmount = 0;
      let totalEntries = entries.length;

      entries.forEach(entry => {
        const entryDate = new Date(entry.created_at || entry.date);
        const entryMonth = entryDate.getMonth();
        const entryYear = entryDate.getFullYear();
        
        // Parse amount (remove 'SOL' suffix if present)
        const amountStr = entry.amount.toString().replace(' SOL', '');
        const amount = parseFloat(amountStr) || 0;
        
        if (entry.type === 'income') {
          totalAmount += amount;
          
          if (entryMonth === currentMonth && entryYear === currentYear) {
            monthlyTotal += amount;
          } else if ((entryMonth === currentMonth - 1 && entryYear === currentYear) || 
                     (currentMonth === 0 && entryMonth === 11 && entryYear === currentYear - 1)) {
            lastMonthTotal += amount;
          }
        } else if (entry.type === 'expense') {
          totalAmount -= amount;
          
          if (entryMonth === currentMonth && entryYear === currentYear) {
            monthlyTotal -= amount;
          } else if ((entryMonth === currentMonth - 1 && entryYear === currentYear) || 
                     (currentMonth === 0 && entryMonth === 11 && entryYear === currentYear - 1)) {
            lastMonthTotal -= amount;
          }
        }
      });

      const averageEntry = totalEntries > 0 ? totalAmount / totalEntries : 0;

      document.getElementById('monthlyTotal').textContent = monthlyTotal.toFixed(4);
      document.getElementById('lastMonthTotal').textContent = lastMonthTotal.toFixed(4);
      document.getElementById('averageEntry').textContent = averageEntry.toFixed(4);
    }

    function displayCommunityFundsRecentActivity(entries) {
      const container = document.getElementById('recentActivity');
      container.innerHTML = '';
      
      if (!entries || entries.length === 0) {
        container.innerHTML = '<div class="text-gray-400 text-sm">No recent activity</div>';
        return;
      }

      // Show last 5 entries
      const recentEntries = entries.slice(0, 5);
      
      recentEntries.forEach(entry => {
        const activityDiv = document.createElement('div');
        activityDiv.className = 'text-sm p-2 bg-gray-700 rounded';
        
        const typeIcon = entry.type === 'income' ? 'üí∏' : 'üí∞';
        const typeColor = entry.type === 'income' ? 'text-green-400' : 'text-red-400';
        
        activityDiv.innerHTML = `
          <div class="flex justify-between items-center">
            <span class="text-gray-300">${typeIcon} ${entry.description}</span>
            <span class="${typeColor} font-semibold">${entry.amount} SOL</span>
          </div>
          <div class="text-xs text-gray-400 mt-1">${entry.date}</div>
        `;
        
        container.appendChild(activityDiv);
      });
    }

    // NFT Portfolio Functions
    function displayCollectionsSummary(collections) {
      const container = document.getElementById('collectionsSummary');
      container.innerHTML = '';
      
      if (!collections || collections.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-400">No collections found</div>';
        return;
      }
      
      // Show top 4 collections
      const topCollections = collections.slice(0, 4);
      
      topCollections.forEach(collection => {
        const div = document.createElement('div');
        div.className = 'text-center bg-purple-800 bg-opacity-50 p-3 rounded-lg border border-purple-400';
        div.innerHTML = `
          <div class="text-lg font-bold text-purple-300">${collection.count}</div>
          <div class="text-xs text-purple-200 truncate" title="${collection.name}">${collection.name}</div>
        `;
        container.appendChild(div);
      });
      
      // Add "more" indicator if there are more collections
      if (collections.length > 4) {
        const moreDiv = document.createElement('div');
        moreDiv.className = 'text-center bg-gray-700 bg-opacity-50 p-3 rounded-lg border border-gray-500';
        moreDiv.innerHTML = `
          <div class="text-lg font-bold text-gray-300">+${collections.length - 4}</div>
          <div class="text-xs text-gray-200">More</div>
        `;
        container.appendChild(moreDiv);
      }
    }

    function displayNFTGallery(nfts) {
      const container = document.getElementById('nftGallery');
      container.innerHTML = '';
      
      if (!nfts || nfts.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-400">No NFTs found</div>';
        return;
      }
      
      // Show first 12 NFTs
      const displayNFTs = nfts.slice(0, 12);
      
      displayNFTs.forEach(nft => {
        const div = document.createElement('div');
        div.className = 'bg-gray-800 bg-opacity-50 p-3 rounded-lg border border-gray-600 text-center';
        div.innerHTML = `
          <div class="w-full h-24 bg-gray-700 rounded mb-2 flex items-center justify-center">
            ${nft.image ? `<img src="${nft.image}" alt="${nft.name}" class="w-full h-full object-cover rounded">` : 'üñºÔ∏è'}
          </div>
          <div class="text-xs text-gray-300 font-semibold truncate" title="${nft.name}">${nft.name}</div>
          <div class="text-xs text-gray-400 truncate" title="${nft.collection}">${nft.collection}</div>
        `;
        container.appendChild(div);
      });
      
      // Add "view all" indicator if there are more NFTs
      if (nfts.length > 12) {
        const viewAllDiv = document.createElement('div');
        viewAllDiv.className = 'bg-purple-700 bg-opacity-50 p-3 rounded-lg border border-purple-400 text-center cursor-pointer hover:bg-purple-600';
        viewAllDiv.onclick = () => showAllNFTsModal();
        viewAllDiv.innerHTML = `
          <div class="text-lg font-bold text-purple-300">+${nfts.length - 12}</div>
          <div class="text-xs text-purple-200">View All</div>
        `;
        container.appendChild(viewAllDiv);
      }
    }

    function populateCollectionFilters(collections) {
      const filter = document.getElementById('nftCollectionFilter');
      const modalFilter = document.getElementById('modalCollectionFilter');
      
      // Clear existing options
      filter.innerHTML = '<option value="">All Collections</option>';
      modalFilter.innerHTML = '<option value="">All Collections</option>';
      
      // Add collection options
      collections.forEach(collection => {
        const option = document.createElement('option');
        option.value = collection.name;
        option.textContent = `${collection.name} (${collection.count})`;
        
        filter.appendChild(option.cloneNode(true));
        modalFilter.appendChild(option);
      });
    }

    // Notification System
    function showNotification(message, type = 'info', duration = 5000) {
      // Remove existing notifications
      const existingNotifications = document.querySelectorAll('.notification-toast');
      existingNotifications.forEach(notification => notification.remove());
      
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification-toast fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
      
      // Set notification content based on type
      const typeConfig = {
        success: { bg: 'bg-green-600', icon: '‚úÖ', text: 'text-white' },
        error: { bg: 'bg-red-600', icon: '‚ùå', text: 'text-white' },
        warning: { bg: 'bg-yellow-600', icon: '‚ö†Ô∏è', text: 'text-white' },
        info: { bg: 'bg-blue-600', icon: '‚ÑπÔ∏è', text: 'text-white' }
      };
      
      const config = typeConfig[type] || typeConfig.info;
      
      notification.innerHTML = `
        <div class="flex items-center gap-3 ${config.bg} ${config.text} p-3 rounded-lg">
          <span class="text-xl">${config.icon}</span>
          <span class="font-semibold">${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-white hover:text-gray-200 text-xl">√ó</button>
        </div>
      `;
      
      // Add to page
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      // Auto remove after duration
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 300);
      }, duration);
    }

    // Add Funds Modal Functions
    function showAddFundsModal() {
      // Create modal HTML
      const modalHTML = `
        <div id="addFundsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4">
            <h3 class="text-xl font-semibold mb-4 text-white">‚ûï Add Community Funds Entry</h3>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Type</label>
                <select id="fundType" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white">
                  <option value="income">üí∞ Income</option>
                  <option value="expense">üí∏ Expense</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                <input type="text" id="fundDescription" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       placeholder="e.g., NFT Purchase, Community Donation">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Amount (SOL)</label>
                <input type="number" id="fundAmount" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       step="0.0001" min="0" placeholder="0.0000">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Date</label>
                <input type="date" id="fundDate" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white">
              </div>
            </div>
            
            <div class="flex gap-3 mt-6">
              <button onclick="closeAddFundsModal()" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                Cancel
              </button>
              <button onclick="submitAddFunds()" class="flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded">
                Add Entry
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to page
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Set default date to today
      document.getElementById('fundDate').value = new Date().toISOString().split('T')[0];
    }

    function closeAddFundsModal() {
      const modal = document.getElementById('addFundsModal');
      if (modal) {
        modal.remove();
      }
    }

    async function submitAddFunds() {
      const type = document.getElementById('fundType').value;
      const description = document.getElementById('fundDescription').value;
      const amount = parseFloat(document.getElementById('fundAmount').value);
      const date = document.getElementById('fundDate').value;
      
      if (!description || isNaN(amount) || amount <= 0 || !date) {
        addLog('‚ùå Please fill in all fields with valid values');
        return;
      }
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/add-community-funds.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            type: type,
            description: description,
            amount: amount,
            date: date
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Community funds entry added successfully');
          closeAddFundsModal();
          loadCommunityFundsData(); // Refresh data
        } else {
          addLog('‚ùå Failed to add entry: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Error adding entry: ' + error.message);
        console.error('Add funds error:', error);
      }
    }

    // Edit Funds Modal Functions
    function showEditFundsModal(id, type, description, amount) {
      // Create modal HTML
      const modalHTML = `
        <div id="editFundsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4">
            <h3 class="text-xl font-semibold mb-4 text-white">‚úèÔ∏è Edit Community Funds Entry</h3>
            
            <input type="hidden" id="editFundId" value="${id}">
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Type</label>
                <select id="editFundType" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white">
                  <option value="income" ${type === 'income' ? 'selected' : ''}>üí∞ Income</option>
                  <option value="expense" ${type === 'expense' ? 'selected' : ''}>üí∏ Expense</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                <input type="text" id="editFundDescription" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       value="${description}" placeholder="e.g., NFT Purchase, Community Donation">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">Amount (SOL)</label>
                <input type="number" id="editFundAmount" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white" 
                       step="0.0001" min="0" value="${amount}" placeholder="0.0000">
              </div>
            </div>
            
            <div class="flex gap-3 mt-6">
              <button onclick="closeEditFundsModal()" class="flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                Cancel
              </button>
              <button onclick="submitEditFunds()" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">
                Update Entry
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Add modal to page
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function closeEditFundsModal() {
      const modal = document.getElementById('editFundsModal');
      if (modal) {
        modal.remove();
      }
    }

    async function submitEditFunds() {
      const id = document.getElementById('editFundId').value;
      const type = document.getElementById('editFundType').value;
      const description = document.getElementById('editFundDescription').value;
      const amount = parseFloat(document.getElementById('editFundAmount').value);
      
      if (!description || isNaN(amount) || amount <= 0) {
        addLog('‚ùå Please fill in all fields with valid values');
        return;
      }
      
      try {
        const response = await fetch(API_BASE_URL + '/api/admin/update-community-funds.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: id,
            type: type,
            description: description,
            amount: amount
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Community funds entry updated successfully');
          closeEditFundsModal();
          loadCommunityFundsData(); // Refresh data
        } else {
          addLog('‚ùå Failed to update entry: ' + (data.message || 'Unknown error'));
        }
      } catch (error) {
        addLog('‚ùå Error updating entry: ' + error.message);
        console.error('Edit funds error:', error);
      }
    }

    // NFT Modal Functions
    function showAllNFTsModal() {
      document.getElementById('nftPortfolioModal').classList.remove('hidden');
      displayModalNFTs();
    }

    function closeNFTModal() {
      document.getElementById('nftPortfolioModal').classList.add('hidden');
    }

    function displayModalNFTs() {
      const container = document.getElementById('modalNftGrid');
      const searchTerm = document.getElementById('modalNftSearch').value.toLowerCase();
      const collectionFilter = document.getElementById('modalCollectionFilter').value;
      
      let filteredNFTs = window.communityNFTs || [];
      
      // Apply filters
      if (searchTerm) {
        filteredNFTs = filteredNFTs.filter(nft => 
          nft.name.toLowerCase().includes(searchTerm) || 
          nft.collection.toLowerCase().includes(searchTerm)
        );
      }
      
      if (collectionFilter) {
        filteredNFTs = filteredNFTs.filter(nft => nft.collection === collectionFilter);
      }
      
      // Reset to first page when filtering
      currentNFTPage = 1;
      
      // Calculate pagination
      const startIndex = (currentNFTPage - 1) * nftsPerPage;
      const endIndex = startIndex + nftsPerPage;
      const pageNFTs = filteredNFTs.slice(startIndex, endIndex);
      
      // Display NFTs for current page
      container.innerHTML = '';
      pageNFTs.forEach(nft => {
        const div = document.createElement('div');
        div.className = 'bg-gray-800 bg-opacity-50 p-3 rounded-lg border border-gray-600 text-center';
        div.innerHTML = `
          <div class="w-full h-32 bg-gray-700 rounded mb-2 flex items-center justify-center">
            ${nft.image ? `<img src="${nft.image}" alt="${nft.name}" class="w-full h-full object-cover rounded">` : 'üñºÔ∏è'}
          </div>
          <div class="text-sm text-gray-300 font-semibold truncate" title="${nft.name}">${nft.name}</div>
          <div class="text-xs text-gray-400 truncate" title="${nft.collection}">${nft.collection}</div>
          <div class="text-xs text-gray-500 mt-1">${nft.mint.substring(0, 8)}...</div>
        `;
        container.appendChild(div);
      });
      
      // Update page info
      updateNFTPageInfo();
    }

    function exportNFTData() {
      const nfts = window.communityNFTs || [];
      const collections = window.communityCollections || [];
      
      const data = {
        wallet: '62DpHkt3h7r6CJECjtRQUoMnm3SJxUTzF5kNUGjs2325',
        export_date: new Date().toISOString(),
        total_nfts: nfts.length,
        collections: collections,
        nfts: nfts
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `community-wallet-nfts-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Search and filter event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // NFT search functionality
      const nftSearch = document.getElementById('nftSearch');
      if (nftSearch) {
        nftSearch.addEventListener('input', () => {
          const searchTerm = nftSearch.value.toLowerCase();
          const collectionFilter = document.getElementById('nftCollectionFilter').value;
          filterNFTGallery(searchTerm, collectionFilter);
        });
      }
      
      // NFT collection filter
      const nftCollectionFilter = document.getElementById('nftCollectionFilter');
      if (nftCollectionFilter) {
        nftCollectionFilter.addEventListener('change', () => {
          const searchTerm = document.getElementById('nftSearch').value.toLowerCase();
          const collectionFilter = nftCollectionFilter.value;
          filterNFTGallery(searchTerm, collectionFilter);
        });
      }
      
      // Modal search functionality
      const modalNftSearch = document.getElementById('modalNftSearch');
      if (modalNftSearch) {
        modalNftSearch.addEventListener('input', displayModalNFTs);
      }
      
      // Modal collection filter
      const modalCollectionFilter = document.getElementById('modalCollectionFilter');
      if (modalCollectionFilter) {
        modalCollectionFilter.addEventListener('change', displayModalNFTs);
      }
    });

    // Pagination variables
    let currentNFTPage = 1;
    const nftsPerPage = 48; // 6x8 grid

    function previousNFTPage() {
      if (currentNFTPage > 1) {
        currentNFTPage--;
        displayModalNFTs();
        updateNFTPageInfo();
      }
    }

    function nextNFTPage() {
      const totalPages = Math.ceil((window.communityNFTs || []).length / nftsPerPage);
      if (currentNFTPage < totalPages) {
        currentNFTPage++;
        displayModalNFTs();
        updateNFTPageInfo();
      }
    }

    function updateNFTPageInfo() {
      const totalNFTs = window.communityNFTs || [];
      const totalPages = Math.ceil(totalNFTs.length / nftsPerPage);
      document.getElementById('nftPageInfo').textContent = `Page ${currentNFTPage} of ${totalPages}`;
    }

    function filterNFTGallery(searchTerm, collectionFilter) {
      const container = document.getElementById('nftGallery');
      const nfts = window.communityNFTs || [];
      
      let filteredNFTs = nfts;
      
      if (searchTerm) {
        filteredNFTs = filteredNFTs.filter(nft => 
          nft.name.toLowerCase().includes(searchTerm) || 
          nft.collection.toLowerCase().includes(searchTerm)
        );
      }
      
      if (collectionFilter) {
        filteredNFTs = filteredNFTs.filter(nft => nft.collection === collectionFilter);
      }
      
      // Display filtered NFTs (max 12)
      const displayNFTs = filteredNFTs.slice(0, 12);
      container.innerHTML = '';
      
      displayNFTs.forEach(nft => {
        const div = document.createElement('div');
        div.className = 'bg-gray-800 bg-opacity-50 p-3 rounded-lg border border-gray-600 text-center';
        div.innerHTML = `
          <div class="w-full h-24 bg-gray-700 rounded mb-2 flex items-center justify-center">
            ${nft.image ? `<img src="${nft.image}" alt="${nft.name}" class="w-full h-full object-cover rounded">` : 'üñºÔ∏è'}
          </div>
          <div class="text-xs text-gray-300 font-semibold truncate" title="${nft.name}">${nft.name}</div>
          <div class="text-xs text-gray-400 truncate" title="${nft.collection}">${nft.collection}</div>
        `;
        container.appendChild(div);
      });
      
      // Add "view all" indicator if there are more filtered results
      if (filteredNFTs.length > 12) {
        const viewAllDiv = document.createElement('div');
        viewAllDiv.className = 'bg-purple-700 bg-opacity-50 p-3 rounded-lg border border-purple-400 text-center cursor-pointer hover:bg-purple-600';
        viewAllDiv.onclick = () => showAllNFTsModal();
        viewAllDiv.innerHTML = `
          <div class="text-lg font-bold text-purple-300">+${filteredNFTs.length - 12}</div>
          <div class="text-xs text-purple-200">View All</div>
        `;
        container.appendChild(viewAllDiv);
      }
    }

    // Race Bot Modal Functions
    function hideRaceBotModal() {
      document.getElementById('raceBotModal').classList.add('hidden');
    }

    async function saveRaceBotConfig() {
      addLog('üíæ Saving race bot configuration...');
      
      const config = {
        maxPlayers: document.getElementById('defaultMaxPlayers').value,
        duration: document.getElementById('defaultDuration').value,
        dspoincReward: document.getElementById('defaultDspoincReward').value,
        roleReward: document.getElementById('defaultRoleReward').value
      };

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/save-race-bot-config.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(config)
        });

        const data = await response.json();
        
        if (data.success) {
          addLog('‚úÖ Race bot configuration saved successfully');
        } else {
          addLog('‚ùå Failed to save configuration: ' + data.error);
        }
      } catch (error) {
        addLog('‚ùå Configuration save error: ' + error.message);
      }
    }

    async function refreshRaceBotData() {
      addLog('üîÑ Refreshing race bot data...');
      
      try {
        // Load race statistics
        const statsResponse = await fetch(API_BASE_URL + '/api/admin/get-race-stats.php');
        const statsData = await statsResponse.json();
        
        if (statsData.success) {
          updateRaceBotStats(statsData.data);
          addLog('‚úÖ Race bot data refreshed successfully');
        } else {
          addLog('‚ùå Failed to load race statistics: ' + statsData.error);
        }

        // Load recent races
        const racesResponse = await fetch(API_BASE_URL + '/api/admin/get-recent-races.php');
        const racesData = await racesResponse.json();
        
        if (racesData.success) {
          updateRecentRacesList(racesData.data);
        } else {
          addLog('‚ùå Failed to load recent races: ' + racesData.error);
        }
      } catch (error) {
        addLog('‚ùå Data refresh error: ' + error.message);
      }
    }

    function updateRaceBotStats(stats) {
      document.getElementById('activeRacesCount').textContent = stats.activeRaces || 0;
      document.getElementById('totalRacesToday').textContent = stats.totalRacesToday || 0;
      document.getElementById('participantsToday').textContent = stats.participantsToday || 0;
      document.getElementById('dspoincDistributed').textContent = stats.dspoincDistributed || 0;
    }

    function updateRecentRacesList(races) {
      const container = document.getElementById('recentRacesList');
      
      if (!races || races.length === 0) {
        container.innerHTML = '<p class="text-sm text-gray-500">No recent races found</p>';
        return;
      }

      let html = '';
      races.forEach(race => {
        const statusColor = race.status === 'active' ? 'text-green-600' : 
                           race.status === 'completed' ? 'text-blue-600' : 'text-gray-600';
        
        html += `
          <div class="border-b border-gray-200 pb-2 mb-2">
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium">${race.creator_name}</span>
              <span class="${statusColor}">${race.status}</span>
            </div>
            <div class="text-xs text-gray-500">
              ${race.max_players} players ‚Ä¢ ${race.duration}min ‚Ä¢ ${race.dspoinc_reward} DSPOINC
            </div>
            <div class="text-xs text-gray-400">
              Created: ${new Date(race.created_at).toLocaleString()}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

  </script>

  <!-- Database Upload Modal -->
  <div id="uploadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">üì§ Upload Database</h3>
        <button onclick="hideUploadModal()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <form id="uploadForm" onsubmit="event.preventDefault(); uploadDatabase();">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Select SQLite Database File:</label>
          <input type="file" id="dbFile" accept=".sqlite,.db" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div id="uploadStatus" class="mb-4"></div>
        
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="hideUploadModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
            Upload Database
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Database Viewer Modal -->
  <div id="viewerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">üëÅÔ∏è Database Viewer</h3>
        <button onclick="hideDatabaseViewer()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div id="viewerContent" class="overflow-y-auto max-h-[calc(90vh-120px)]">
        <!-- Database viewer content will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Database Unlock Modal -->
  <div id="unlockModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">üîì Unlock Database Access</h3>
        <button onclick="hideDatabaseUnlock()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="mb-4">
        <p class="text-sm text-gray-600 mb-3">Enter the internal password to access database operations:</p>
        <input type="password" id="databasePassword" placeholder="Enter database password..." 
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      
      <div id="unlockStatus" class="mb-4"></div>
      
      <div class="flex justify-end space-x-3">
        <button type="button" onclick="hideDatabaseUnlock()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300">
          Cancel
        </button>
        <button onclick="unlockDatabase()" class="px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700">
          üîì Unlock Access
        </button>
      </div>
    </div>
  </div>

  <!-- Race Bot Configuration Modal -->
  <div id="raceBotModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">ü§ñ Discord Cheese Race Bot Configuration</h3>
        <button onclick="hideRaceBotModal()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
        <!-- Bot Status Section -->
        <div class="mb-6">
          <h4 class="text-md font-semibold text-gray-700 mb-3">üìä Bot Status</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-100 p-3 rounded">
              <p class="text-sm text-gray-600">Active Races:</p>
              <p class="text-lg font-bold text-blue-600" id="activeRacesCount">0</p>
            </div>
            <div class="bg-gray-100 p-3 rounded">
              <p class="text-sm text-gray-600">Total Races Today:</p>
              <p class="text-lg font-bold text-green-600" id="totalRacesToday">0</p>
            </div>
            <div class="bg-gray-100 p-3 rounded">
              <p class="text-sm text-gray-600">Participants Today:</p>
              <p class="text-lg font-bold text-purple-600" id="participantsToday">0</p>
            </div>
            <div class="bg-gray-100 p-3 rounded">
              <p class="text-sm text-gray-600">DSPOINC Distributed:</p>
              <p class="text-lg font-bold text-yellow-600" id="dspoincDistributed">0</p>
            </div>
          </div>
        </div>

        <!-- Race Configuration Section -->
        <div class="mb-6">
          <h4 class="text-md font-semibold text-gray-700 mb-3">‚öôÔ∏è Race Configuration</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Default Max Players:</label>
              <input type="number" id="defaultMaxPlayers" value="10" min="2" max="50" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Default Duration (minutes):</label>
              <input type="number" id="defaultDuration" value="5" min="1" max="60" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Default DSPOINC Reward:</label>
              <input type="number" id="defaultDspoincReward" value="100" min="10" max="1000" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Role Reward:</label>
              <input type="text" id="defaultRoleReward" placeholder="Optional role name" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
          </div>
        </div>

        <!-- Recent Races Section -->
        <div class="mb-6">
          <h4 class="text-md font-semibold text-gray-700 mb-3">üèÅ Recent Races</h4>
          <div id="recentRacesList" class="bg-gray-100 p-3 rounded max-h-40 overflow-y-auto">
            <p class="text-sm text-gray-500">Loading recent races...</p>
          </div>
        </div>

        <!-- Actions Section -->
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="hideRaceBotModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300">
            Close
          </button>
          <button onclick="saveRaceBotConfig()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
            üíæ Save Configuration
          </button>
          <button onclick="refreshRaceBotData()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
            üîÑ Refresh Data
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Utility Functions -->
  <script>
    // Utility function for escaping HTML
    function escapeHtml(text) {
      if (text === null || text === undefined) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Cheese Hunt Tab Functions
    async function loadCheeseHuntData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üßÄ Loading Cheese Hunt data...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games && data.data.games.cheese_hunt) {
          displayCheeseData(data.data.games.cheese_hunt);
          addLog('‚úÖ Cheese Hunt data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load Cheese Hunt data: ${data.error || 'No data available'}`);
        }
      } catch (error) {
        addLog(`‚ùå Cheese Hunt data loading error: ${error.message}`);
      }
    }

    function displayCheeseData(cheeseData) {
      try {
        console.log('üßÄ Cheese Hunt data received:', cheeseData);
        addLog('üßÄ Displaying Cheese Hunt data...');
        
        // Helper function to format numbers nicely
        const formatNumber = (num) => {
          if (num === null || num === undefined || num === '-') return '-';
          if (typeof num === 'string') num = parseFloat(num);
          if (isNaN(num)) return '-';
          return num.toLocaleString();
        };

        // Update Cheese Hunt statistics
        if (document.getElementById('cheeseTotalClicks')) {
          const totalClicks = cheeseData.current_data?.total_clicks || 0;
          document.getElementById('cheeseTotalClicks').textContent = formatNumber(totalClicks);
          document.getElementById('cheeseTotalClicks').className = totalClicks > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('cheeseUniquePlayers')) {
          const uniquePlayers = cheeseData.current_data?.unique_players || 0;
          document.getElementById('cheeseUniquePlayers').textContent = formatNumber(uniquePlayers);
          document.getElementById('cheeseUniquePlayers').className = uniquePlayers > 0 ? 'text-white font-semibold' : 'text-gray-400';
        }
        
        if (document.getElementById('cheeseAvgClicks')) {
          const avgClicks = cheeseData.current_data?.avg_clicks || 0;
          document.getElementById('cheeseAvgClicks').textContent = formatNumber(avgClicks);
          document.getElementById('cheeseAvgClicks').className = avgClicks > 0 ? 'text-blue-400 font-semibold' : 'text-gray-400';
        }

        // Update leaderboard with grid system
        const leaderboard = document.getElementById('cheeseLeaderboard');
        if (leaderboard) {
          if (cheeseData.top_hunters && cheeseData.top_hunters.length > 0) {
            leaderboard.innerHTML = `
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                ${cheeseData.top_hunters.map((hunter, index) => `
                  <div class="bg-gray-700 p-4 rounded-lg border border-gray-600">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-lg font-bold text-yellow-400">#${index + 1}</span>
                      <span class="text-sm text-gray-400">${hunter.username || 'Unknown'}</span>
                    </div>
                    <div class="text-2xl font-bold text-green-400">${formatNumber(hunter.clicks || 0)} clicks</div>
                    <div class="text-sm text-gray-300">${hunter.date || 'No date'}</div>
                  </div>
                `).join('')}
              </div>
            `;
          } else {
            leaderboard.innerHTML = `
              <div class="text-center p-8 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 border-opacity-50">
                <div class="text-gray-300 text-2xl mb-3">üßÄüéØ</div>
                <div class="text-gray-400 text-lg mb-2 font-semibold">No Leaderboard Data</div>
                <div class="text-gray-500 text-sm mb-4">No players have completed Cheese Hunt games yet</div>
                <div class="text-green-400 text-sm bg-green-900 bg-opacity-30 px-4 py-2 rounded-full border border-green-700 border-opacity-50">
                  Start playing to see rankings! üéÆ
                </div>
              </div>
            `;
          }
        }

        // Add data summary
        const dataSummary = document.createElement('div');
        dataSummary.className = 'mb-4 p-3 bg-orange-900 bg-opacity-50 rounded-lg';
        dataSummary.innerHTML = `
          <div class="text-orange-200 text-sm">
            <strong>üìä Data Summary:</strong> 
            ${cheeseData.current_data?.total_clicks || 0} total clicks from ${cheeseData.current_data?.unique_players || 0} players
            ${cheeseData.current_data?.total_clicks > 0 ? '‚úÖ' : '‚ùå No data yet'}
          </div>
          <div class="text-orange-300 text-xs mt-2">
            <strong>üïí Last Updated:</strong> ${new Date().toLocaleString()}
          </div>
        `;
        
        const cheeseHuntTab = document.getElementById('cheeseHuntTab');
        if (cheeseHuntTab && !cheeseHuntTab.querySelector('.data-summary')) {
          dataSummary.className += ' data-summary';
          cheeseHuntTab.insertBefore(dataSummary, cheeseHuntTab.firstChild);
        }

      } catch (error) {
        console.error('Error displaying Cheese Hunt data:', error);
        addLog(`‚ùå Error displaying Cheese Hunt data: ${error.message}`);
      }
    }
    
    // Discord Race Tab Functions
    async function loadDiscordRaceData() {
      if (!currentAdmin) {
        addLog('‚ùå Please authenticate first');
        return;
      }

      addLog('üèÅ Loading Discord Race data...');

      try {
        const response = await fetch(API_BASE_URL + '/api/admin/get-all-games-stats.php');
        const data = await response.json();
        
        if (data.success && data.data && data.data.games && data.data.games.discord_race) {
          displayDiscordRaceData(data.data.games.discord_race);
          addLog('‚úÖ Discord Race data loaded successfully');
        } else {
          addLog(`‚ùå Failed to load Discord Race data: ${data.error || 'No data available'}`);
        }
      } catch (error) {
        addLog(`‚ùå Discord Race data loading error: ${error.message}`);
      }
    }

    // Discord Race data loading function - uses the enhanced displayDiscordRaceData function above

    // Add CSS for data-loaded indicators
    const style = document.createElement('style');
    style.textContent = `
      .tab-btn.data-loaded {
        border-color: #10b981;
        position: relative;
      }

      .tab-btn.data-loaded::after {
        content: '';
        position: absolute;
        top: 8px;
        right: 8px;
        width: 8px;
        height: 8px;
        background: #10b981;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
      
      /* Ensure tabs are visible when explicitly shown */
      .game-tab-content.show-tab {
        display: block !important;
      }
      
      /* Override any conflicting display rules */
      .game-tab-content[style*="display: block"] {
        display: block !important;
      }
    `;
    document.head.appendChild(style);

    // ========================================
    // ‚úÖ CRISIS RESPONSE COMPLETED - DUPLICATE STUBS REMOVED
    // ========================================
    // All functions are now properly implemented above in the main function section
    // No more duplicate or stub functions



    // üí∞ POINT MANAGEMENT TAB FUNCTIONS - REMOVED OLD STUBS
    // Functions are now implemented above in the main function section

    // Store item creation function removed - implemented above

    // Store management functions removed - implemented above

    // üöÄ GAME MANAGEMENT 2.0 FUNCTIONS - Advanced Season Management
async function loadGameManagement2Data() {
  console.log('üöÄ Loading Game Management 2.0 data...');
  try {
    // Load current season status
    const seasonResponse = await fetch(API_BASE_URL + '/api/admin/get-current-season-settings.php');
    const seasonData = await seasonResponse.json();
    
    if (seasonData.success) {
      updateSeasonDisplay2(seasonData.data);
    }
    
    // Load game statistics
    await loadGameStatsBySeason2();
    
    console.log('‚úÖ Game Management 2.0 data loaded successfully');
  } catch (error) {
    console.error('‚ùå Error loading Game Management 2.0 data:', error);
  }
}

async function loadSeasonOverview2() {
  try {
    const response = await fetch(API_BASE_URL + '/api/admin/get-season-data.php?season=season_2');
    const data = await response.json();
    
    if (data.success) {
      updateSeasonOverview2(data);
    }
  } catch (error) {
    console.error('‚ùå Error loading season overview:', error);
  }
}

async function loadGameStatsBySeason2() {
  try {
    const season = document.getElementById('viewSeasonSelector2')?.value || 'season_2';
    const response = await fetch(API_BASE_URL + '/api/admin/get-season-data.php?season=' + season);
    const data = await response.json();
    
    if (data.success) {
      displayGameStats2(data.data, season);
    }
  } catch (error) {
    console.error('‚ùå Error loading game stats by season:', error);
  }
}

async function loadTopPerformers2() {
  try {
    const response = await fetch(API_BASE_URL + '/api/admin/get-top-users.php');
    const data = await response.json();
    
    if (data.success) {
      displayTopPerformers2(data.data);
    }
  } catch (error) {
    console.error('‚ùå Error loading top performers:', error);
  }
}

async function loadSeasonComparison2() {
  try {
    const [season1Response, season2Response] = await Promise.all([
      fetch(API_BASE_URL + '/api/admin/get-season-data.php?season=season_1'),
      fetch(API_BASE_URL + '/api/admin/get-season-data.php?season=season_2')
    ]);
    
    const season1Data = await season1Response.json();
    const season2Data = await season2Response.json();
    
    if (season1Data.success && season2Data.success) {
      displaySeasonComparison2(season1Data.data, season2Data.data);
    }
  } catch (error) {
    console.error('‚ùå Error loading season comparison:', error);
  }
}

async function switchActiveSeason2() {
  const newSeason = document.getElementById('seasonSwitchSelector2').value;
  const adminId = 'admin'; // You can enhance this with actual admin ID
  
  try {
    const response = await fetch(API_BASE_URL + '/api/admin/switch-active-season.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ new_season: newSeason, admin_id: adminId })
    });
    
    const data = await response.json();
    
    if (data.success) {
      addLog(`‚úÖ Successfully switched to ${newSeason}`);
      loadGameManagement2Data(); // Refresh data
    } else {
      addLog(`‚ùå Failed to switch season: ${data.error}`);
    }
  } catch (error) {
    console.error('‚ùå Error switching season:', error);
    addLog(`‚ùå Error switching season: ${error.message}`);
  }
}

async function loadSeasonData2() {
  const season = document.getElementById('viewSeasonSelector2').value;
  try {
    const response = await fetch(API_BASE_URL + '/api/admin/get-season-data.php?season=' + season);
    const data = await response.json();
    
    if (data.success) {
      displaySeasonData2(data.data, season);
    }
  } catch (error) {
    console.error('‚ùå Error loading season data:', error);
  }
}

function refreshSeasonData2() {
  loadSeasonData2();
  loadGameStatsBySeason2();
  loadTopPerformers2();
  loadSeasonComparison2();
}

function updateSeasonDisplay2(data) {
  console.log('üìä updateSeasonDisplay2 called with data:', data);
  
  // Enhanced null-safe checks with fallback values
  if (!data) {
    console.warn('‚ùå updateSeasonDisplay2: No data provided');
    data = {};
  }
  
  // Handle different data structures safely with enhanced fallbacks
  const currentSeason = data?.current_season || data?.season || data?.currentSeason || 'Unknown';
  const totalGames = data?.total_games || data?.total_scores || data?.totalGames || data?.totalScores || 0;
  const activePlayers = data?.active_players || data?.unique_players || data?.activePlayers || data?.uniquePlayers || 0;
  
  console.log('üìä Parsed values:', { currentSeason, totalGames, activePlayers });
  
  // Update current season display
  const currentSeasonElement = document.getElementById('currentSeasonDisplay2');
  if (currentSeasonElement) {
    currentSeasonElement.textContent = currentSeason;
    console.log('‚úÖ Updated currentSeasonDisplay2:', currentSeason);
  } else {
    console.warn('‚ö†Ô∏è currentSeasonDisplay2 element not found');
  }
  
  // Update total games display
  const totalGamesElement = document.getElementById('totalGamesDisplay2');
  if (totalGamesElement) {
    totalGamesElement.textContent = totalGames;
    console.log('‚úÖ Updated totalGamesDisplay2:', totalGames);
  } else {
    console.warn('‚ö†Ô∏è totalGamesDisplay2 element not found');
  }
  
  // Update active players display
  const activePlayersElement = document.getElementById('activePlayersDisplay2');
  if (activePlayersElement) {
    activePlayersElement.textContent = activePlayers;
    console.log('‚úÖ Updated activePlayersDisplay2:', activePlayers);
  } else {
    console.warn('‚ö†Ô∏è activePlayersDisplay2 element not found');
  }
}

function updateSeasonOverview2(data) {
  // Update season overview display
  if (data.season) {
    const seasonDisplay = document.getElementById('currentSeasonDisplay2');
    if (seasonDisplay) {
      seasonDisplay.textContent = data.season.replace('_', ' ').toUpperCase();
    }
  }
  
  // Update total games count
  let totalGames = 0;
  if (data.data) {
    Object.values(data.data).forEach(gameData => {
      if (gameData && gameData.total_scores) {
        totalGames += gameData.total_scores;
      }
    });
  }
  
  const totalGamesDisplay = document.getElementById('totalGamesDisplay2');
  if (totalGamesDisplay) {
    totalGamesDisplay.textContent = totalGames;
  }
  
  // Update active players count
  let activePlayers = 0;
  if (data.data) {
    Object.values(data.data).forEach(gameData => {
      if (gameData && gameData.unique_players) {
        activePlayers = Math.max(activePlayers, gameData.unique_players);
      }
    });
  }
  
  const activePlayersDisplay = document.getElementById('activePlayersDisplay2');
  if (activePlayersDisplay) {
    activePlayersDisplay.textContent = activePlayers;
  }
}

function displaySeasonData2(data, season) {
  // Display detailed season data
  console.log(`üìä Displaying season data for ${season}:`, data);
  
  // Update game statistics grid
  displayGameStats2(data, season);
  
  // Update top performers
  if (data.top_performers) {
    displayTopPerformers2({ top_players: data.top_performers });
  }
  
  // Update season comparison if viewing all seasons
  if (season === 'all') {
    // This will be handled by loadSeasonComparison2
  }
}

function displayGameStats2(data, season) {
  const grid = document.getElementById('gameStatsGrid2');
  if (!grid) return;
  
  const games = ['tetris', 'snake', 'space_invaders', 'cheese_hunt', 'discord_race'];
  const gameNames = {
    tetris: 'üß© Tetris',
    snake: 'üêç Snake', 
    space_invaders: 'üëæ Space Invaders',
    cheese_hunt: 'üßÄ Cheese Hunt',
    discord_race: 'üèÅ Discord Race'
  };
  
  grid.innerHTML = '';
  
  games.forEach(game => {
    const gameData = data[game] || { total_scores: 0, unique_players: 0, max_score: 0 };
    
    const card = document.createElement('div');
    card.className = 'bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-600';
    card.innerHTML = `
      <div class="text-center">
        <div class="text-lg font-semibold text-yellow-400 mb-2">${gameNames[game]}</div>
        <div class="text-2xl font-bold text-white mb-1">${gameData.total_scores}</div>
        <div class="text-sm text-gray-300 mb-2">Total Scores</div>
        <div class="text-sm text-blue-400">${gameData.unique_players} Players</div>
        <div class="text-sm text-green-400">Max: ${gameData.max_score} DSPOINC</div>
      </div>
    `;
    
    grid.appendChild(card);
  });
}

function displayTopPerformers2(data) {
  const container = document.getElementById('topPerformersDisplay2');
  if (!container) return;
  
  container.innerHTML = '';
  
  if (data.top_players && data.top_players.length > 0) {
    data.top_players.slice(0, 5).forEach((player, index) => {
      const playerDiv = document.createElement('div');
      playerDiv.className = 'bg-gray-700 p-3 rounded border-l-4 border-yellow-500';
      playerDiv.innerHTML = `
        <div class="flex justify-between items-center">
          <span class="text-yellow-400 font-semibold">#${index + 1}</span>
          <span class="text-white">${player.username || player.discord_name || 'Unknown'}</span>
          <span class="text-green-400">${player.total_score || 0} DSPOINC</span>
        </div>
      `;
      container.appendChild(playerDiv);
    });
  } else {
    container.innerHTML = '<div class="text-gray-400 text-center">No top performers data available</div>';
  }
}

function displaySeasonComparison2(season1Data, season2Data) {
  const container = document.getElementById('seasonComparisonDisplay2');
  if (!container) return;
  
  container.innerHTML = '';
  
  const games = ['tetris', 'snake', 'space_invaders', 'cheese_hunt', 'discord_race'];
  
  games.forEach(game => {
    const s1 = season1Data[game] || { total_scores: 0, unique_players: 0 };
    const s2 = season2Data[game] || { total_scores: 0, unique_players: 0 };
    
    const comparisonDiv = document.createElement('div');
    comparisonDiv.className = 'bg-gray-700 p-3 rounded border-l-4 border-blue-500 mb-2';
    comparisonDiv.innerHTML = `
      <div class="flex justify-between items-center">
        <span class="text-blue-400 font-semibold">${game.replace('_', ' ').toUpperCase()}</span>
        <div class="text-sm">
          <span class="text-gray-400">S1: ${s1.total_scores}</span>
          <span class="text-white mx-2">vs</span>
          <span class="text-green-400">S2: ${s2.total_scores}</span>
        </div>
      </div>
    `;
    container.appendChild(comparisonDiv);
  });
}

function startLiveActivityFeed2() {
  const feed = document.getElementById('liveActivityFeed2');
  if (!feed) return;
  
  // Simulate live activity updates
  const activities = [
    'üéÆ New Tetris game started',
    'üêç Snake game completed - 45 DSPOINC earned',
    'üëæ Space Invaders wave 5 reached',
    'üßÄ Cheese Hunt: 3 eggs found',
    'üèÅ Discord Race: New participant joined'
  ];
  
  let currentIndex = 0;
  setInterval(() => {
    if (feed.children.length > 10) {
      feed.removeChild(feed.firstChild);
    }
    
    const activityDiv = document.createElement('div');
    activityDiv.className = 'text-sm text-green-400 border-b border-gray-600 pb-1';
    activityDiv.textContent = `${new Date().toLocaleTimeString()} - ${activities[currentIndex]}`;
    feed.appendChild(activityDiv);
    
    currentIndex = (currentIndex + 1) % activities.length;
  }, 5000);
}

async function refreshAllGameData2() {
  addLog('üîÑ Refreshing all Game Management 2.0 data...');
  await loadGameManagement2Data();
  await loadSeasonOverview2();
  await loadGameStatsBySeason2();
  await loadTopPerformers2();
  await loadSeasonComparison2();
  addLog('‚úÖ All Game Management 2.0 data refreshed');
}

async function resetSeasonStats2() {
  if (confirm('‚ö†Ô∏è Are you sure you want to reset season statistics? This will clear all current season data.')) {
    addLog('üîÑ Resetting season statistics...');
    // Add reset logic here
    addLog('‚úÖ Season statistics reset completed');
  }
}

async function backupSeasonData2() {
  addLog('üíæ Creating season data backup...');
  try {
    const response = await fetch(API_BASE_URL + '/api/admin/sync-database.php');
    const data = await response.json();
    
    if (data.success) {
      addLog('‚úÖ Season data backup created successfully');
    } else {
      addLog('‚ùå Failed to create backup: ' + data.error);
    }
  } catch (error) {
    addLog('‚ùå Error creating backup: ' + error.message);
  }
}

async function createNewSeason2() {
  const seasonName = document.getElementById('newSeasonName2').value;
  if (!seasonName) {
    alert('Please enter a season name');
    return;
  }
  
  try {
    addLog(`üÜï Creating new season: ${seasonName}`);
    // Add season creation logic here
    addLog(`‚úÖ New season "${seasonName}" created successfully`);
    document.getElementById('newSeasonName2').value = '';
  } catch (error) {
    addLog(`‚ùå Error creating season: ${error.message}`);
  }
}

async function exportSeasonData2() {
  const season = document.getElementById('exportSeasonSelector2').value;
  addLog(`üì• Exporting ${season} data...`);
  
  try {
    // Add export logic here
    addLog(`‚úÖ ${season} data exported successfully`);
  } catch (error) {
    addLog(`‚ùå Error exporting data: ${error.message}`);
  }
}

// Test function for Game Management 2.0 tab
function testGames2Tab() {
  addLog('üß™ Testing Game Management 2.0 tab functions...');
  
  // Test if tab element exists
  const games2Tab = document.getElementById('games2Tab');
  if (games2Tab) {
    addLog('‚úÖ games2Tab element found');
    games2Tab.style.display = 'block';
  } else {
    addLog('‚ùå games2Tab element not found');
  }
  
  // Test if functions exist
  const functions = [
    'loadGameManagement2Data',
    'loadSeasonOverview2', 
    'loadGameStatsBySeason2',
    'loadTopPerformers2',
    'loadSeasonComparison2',
    'startLiveActivityFeed2'
  ];
  
  functions.forEach(funcName => {
    if (typeof window[funcName] === 'function') {
      addLog(`‚úÖ ${funcName} function exists`);
    } else {
      addLog(`‚ùå ${funcName} function NOT found`);
    }
  });
  
  addLog('üß™ Game Management 2.0 tab test completed');
}

// üéÆ GAME MANAGEMENT TAB FUNCTIONS - REMOVED OLD STUBS
    // Functions are now implemented above in the main function section

    // ========================================
    // ‚úÖ CRISIS RESPONSE COMPLETED
    // ========================================
    // All missing functions have been implemented as stubs
    // Admin interface should now be navigable without JavaScript errors
    // Next step: Test each tab and implement actual functionality
    
    // ========================================
    // üëë BOSS MANAGEMENT FUNCTIONS
    // ========================================
    
    // Boss management variables
    let currentBossConfigs = {};
    
    // Switch between boss tabs
    function switchBossTab(bossType) {
      console.log('üëë switchBossTab called with:', bossType);
      
      // Remove active class from all boss tab buttons
      const allButtons = document.querySelectorAll('.boss-tab-btn');
      allButtons.forEach(btn => btn.classList.remove('active'));
      
      // Add active class to selected button
      const selectedButton = document.querySelector(`[data-boss-tab="${bossType}"]`);
      if (selectedButton) {
        selectedButton.classList.add('active');
      }
      
      // Load and display boss configuration
      loadBossConfiguration(bossType);
    }
    
    // Load boss configuration from API
    async function loadBossConfiguration(bossType) {
      try {
        addLog(`üëë Loading boss configuration for ${bossType}...`);
        
        const response = await fetch(`${API_BASE_URL}/api/admin/boss-management.php?action=get_all`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('üîç Boss API response:', data); // Debug logging
        
        // üîß CRITICAL FIX: Handle different API response structures
        if (data.success) {
          if (data.bosses && data.bosses[bossType]) {
            // Standard response format
            const bossConfig = data.bosses[bossType];
            const mappedConfig = mapDatabaseFieldsToExpected(bossConfig);
            currentBossConfigs[bossType] = mappedConfig;
            displayBossConfiguration(bossType, mappedConfig);
            addLog(`‚úÖ Boss configuration loaded for ${bossType}`);
          } else if (data.bosses && Array.isArray(data.bosses)) {
            // Array format - find boss by type
            const bossConfig = data.bosses.find(boss => boss.boss_type === bossType);
            if (bossConfig) {
              const mappedConfig = mapDatabaseFieldsToExpected(bossConfig);
              currentBossConfigs[bossType] = mappedConfig;
              displayBossConfiguration(bossType, mappedConfig);
              addLog(`‚úÖ Boss configuration loaded for ${bossType} (array format)`);
            } else {
              // üîß NEW: Create default configuration if none exists
              addLog(`‚ö†Ô∏è No boss configuration found for ${bossType}, creating default...`);
              const defaultConfig = createDefaultBossConfig(bossType);
              currentBossConfigs[bossType] = defaultConfig;
              displayBossConfiguration(bossType, defaultConfig);
              addLog(`‚úÖ Default boss configuration created for ${bossType}`);
            }
          } else if (data.bosses && typeof data.bosses === 'object') {
            // Direct object format
            const bossConfig = data.bosses[bossType] || data.bosses;
            if (bossConfig) {
              const mappedConfig = mapDatabaseFieldsToExpected(bossConfig);
              currentBossConfigs[bossType] = mappedConfig;
              displayBossConfiguration(bossType, mappedConfig);
              addLog(`‚úÖ Boss configuration loaded for ${bossType} (direct format)`);
            } else {
              // üîß NEW: Create default configuration if none exists
              addLog(`‚ö†Ô∏è No boss configuration found for ${bossType}, creating default...`);
              const defaultConfig = createDefaultBossConfig(bossType);
              currentBossConfigs[bossType] = defaultConfig;
              displayBossConfiguration(bossType, defaultConfig);
              addLog(`‚úÖ Default boss configuration created for ${bossType}`);
            }
          } else {
            // üîß NEW: Handle empty response by creating default configuration
            addLog(`‚ö†Ô∏è Empty boss response, creating default configuration for ${bossType}...`);
            const defaultConfig = createDefaultBossConfig(bossType);
            currentBossConfigs[bossType] = defaultConfig;
            displayBossConfiguration(bossType, defaultConfig);
            addLog(`‚úÖ Default boss configuration created for ${bossType}`);
          }
        } else {
          // üîß NEW: Handle API failure by creating default configuration
          addLog(`‚ö†Ô∏è API request failed, creating default configuration for ${bossType}...`);
          const defaultConfig = createDefaultBossConfig(bossType);
          currentBossConfigs[bossType] = defaultConfig;
          displayBossConfiguration(bossType, defaultConfig);
          addLog(`‚úÖ Default boss configuration created for ${bossType}`);
        }
      } catch (error) {
        console.error('‚ùå Error loading boss configuration:', error);
        addLog(`‚ùå Error loading boss configuration: ${error.message}`);
      }
    }
    
    // Display boss configuration form
    function displayBossConfiguration(bossType, config) {
      const contentDiv = document.getElementById('bossConfigContent');
      
      contentDiv.innerHTML = `
        <div class="bg-gray-800 bg-opacity-50 p-6 rounded-lg">
          <h3 class="text-xl font-semibold mb-4 text-yellow-400">${config.name}</h3>
          <p class="text-gray-300 mb-6">${config.description}</p>
          
          <form id="bossConfigForm_${bossType}" class="space-y-6">
            <!-- Basic Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h4 class="text-lg font-semibold text-blue-400">üìä Basic Stats</h4>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Base Health</label>
                  <input type="number" name="baseHealth" value="${config.baseHealth}" 
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Health Multiplier</label>
                  <input type="number" name="healthMultiplier" value="${config.healthMultiplier}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Base Speed</label>
                  <input type="number" name="baseSpeed" value="${config.baseSpeed}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Speed Multiplier</label>
                  <input type="number" name="speedMultiplier" value="${config.speedMultiplier}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
              </div>
              
              <div class="space-y-4">
                <h4 class="text-lg font-semibold text-green-400">‚öîÔ∏è Combat Stats</h4>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Base Attack Cooldown</label>
                  <input type="number" name="baseAttackCooldown" value="${config.baseAttackCooldown}"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Attack Cooldown Multiplier</label>
                  <input type="number" name="attackCooldownMultiplier" value="${config.attackCooldownMultiplier}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Base Bullet Speed</label>
                  <input type="number" name="baseBulletSpeed" value="${config.baseBulletSpeed}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Bullet Speed Multiplier</label>
                  <input type="number" name="bulletSpeedMultiplier" value="${config.bulletSpeedMultiplier}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Base Bullet Damage</label>
                  <input type="number" name="baseBulletDamage" value="${config.baseBulletDamage}"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Bullet Damage Multiplier</label>
                  <input type="number" name="bulletDamageMultiplier" value="${config.bulletDamageMultiplier}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
              </div>
            </div>
            
            <!-- Abilities and Behavior -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h4 class="text-lg font-semibold text-purple-400">üé≠ Abilities</h4>
                
                <div class="space-y-3">
                  <label class="flex items-center">
                    <input type="checkbox" name="canTeleport" ${config.abilities.canTeleport ? 'checked' : ''}
                           class="mr-2 rounded border-gray-600 bg-gray-700 text-blue-500">
                    <span class="text-gray-300">Can Teleport</span>
                  </label>
                  
                  <label class="flex items-center">
                    <input type="checkbox" name="canShield" ${config.abilities.canShield ? 'checked' : ''}
                           class="mr-2 rounded border-gray-600 bg-gray-700 text-blue-500">
                    <span class="text-gray-300">Can Use Shield</span>
                  </label>
                  
                  <label class="flex items-center">
                    <input type="checkbox" name="canSummonMinions" ${config.abilities.canSummonMinions ? 'checked' : ''}
                           class="mr-2 rounded border-gray-600 bg-gray-700 text-blue-500">
                    <span class="text-gray-300">Can Summon Minions</span>
                  </label>
                  
                  <label class="flex items-center">
                    <input type="checkbox" name="canUseLaser" ${config.abilities.canUseLaser ? 'checked' : ''}
                           class="mr-2 rounded border-gray-600 bg-gray-700 text-blue-500">
                    <span class="text-gray-300">Can Use Laser</span>
                  </label>
                  
                  <label class="flex items-center">
                    <span class="text-gray-300">Can Create Explosions</span>
                    <input type="checkbox" name="canCreateExplosions" ${config.abilities.canCreateExplosions ? 'checked' : ''}
                           class="ml-2 rounded border-gray-600 bg-gray-700 text-blue-500">
                  </label>
                </div>
              </div>
              
              <div class="space-y-4">
                <h4 class="text-lg font-semibold text-orange-400">‚ö° Behavior</h4>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Size</label>
                  <input type="number" name="size" value="${config.size}" step="0.1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Special Attack Chance</label>
                  <input type="number" name="specialAttackChance" value="${config.specialAttackChance}" step="0.1" min="0" max="1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Rage Mode Threshold</label>
                  <input type="number" name="rageModeThreshold" value="${config.rageModeThreshold}" step="0.05" min="0" max="1"
                         class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                </div>
              </div>
            </div>
            
            <!-- Colors -->
            <div class="space-y-4">
              <h4 class="text-lg font-semibold text-pink-400">üé® Colors</h4>
              
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Primary Color</label>
                  <input type="color" name="primaryColor" value="${config.colors.primary}"
                         class="w-full h-12 bg-gray-700 border border-gray-600 rounded">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">Secondary Color</label>
                  <input type="color" name="secondaryColor" value="${config.colors.secondary}"
                         class="w-full h-12 bg-gray-700 border border-gray-600 rounded">
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-300 mb-2">Particle Color</label>
                  <input type="color" name="particleColor" value="${config.colors.particles}"
                         class="w-full h-12 bg-gray-700 border border-gray-600 rounded">
                </div>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4 pt-4 border-t border-gray-600">
              <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-semibold">
                üíæ Save Configuration
              </button>
              <button type="button" onclick="resetBossConfiguration('${bossType}')" 
                      class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded font-semibold">
                üîÑ Reset to Defaults
              </button>
              <button type="button" onclick="testBossConfiguration('${bossType}')" 
                      class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-semibold">
                üß™ Test Configuration
              </button>
            </div>
          </form>
        </div>
      `;
      
      // Add form submit handler
      const form = document.getElementById(`bossConfigForm_${bossType}`);
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        saveBossConfiguration(bossType);
      });
    }
    
    // Save boss configuration
    async function saveBossConfiguration(bossType) {
      try {
        const form = document.getElementById(`bossConfigForm_${bossType}`);
        const formData = new FormData(form);
        
        // Build configuration object
        const config = {
          baseHealth: parseInt(formData.get('baseHealth')),
          healthMultiplier: parseFloat(formData.get('healthMultiplier')),
          baseSpeed: parseFloat(formData.get('baseSpeed')),
          speedMultiplier: parseFloat(formData.get('speedMultiplier')),
          baseAttackCooldown: parseInt(formData.get('baseAttackCooldown')),
          attackCooldownMultiplier: parseFloat(formData.get('attackCooldownMultiplier')),
          baseBulletSpeed: parseFloat(formData.get('baseBulletSpeed')),
          bulletSpeedMultiplier: parseFloat(formData.get('bulletSpeedMultiplier')),
          baseBulletDamage: parseInt(formData.get('baseBulletDamage')),
          bulletDamageMultiplier: parseFloat(formData.get('bulletDamageMultiplier')),
          size: parseFloat(formData.get('size')),
          specialAttackChance: parseFloat(formData.get('specialAttackChance')),
          rageModeThreshold: parseFloat(formData.get('rageModeThreshold')),
          abilities: {
            canTeleport: formData.get('canTeleport') === 'on',
            canShield: formData.get('canShield') === 'on',
            canSummonMinions: formData.get('canSummonMinions') === 'on',
            canUseLaser: formData.get('canUseLaser') === 'on',
            canCreateExplosions: formData.get('canCreateExplosions') === 'on'
          },
          colors: {
            primary: formData.get('primaryColor'),
            secondary: formData.get('secondaryColor'),
            particles: formData.get('particleColor')
          }
        };
        
        addLog(`üíæ Saving boss configuration for ${bossType}...`);
        
        const response = await fetch(`${API_BASE_URL}/api/admin/boss-management.php`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            bossType: bossType,
            config: config
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        if (data.success) {
          addLog(`‚úÖ Boss configuration saved for ${bossType}`);
          
          // Update local config
          currentBossConfigs[bossType] = config;
          
          // Show success message
          showNotification(`Boss configuration saved successfully!`, 'success');
        } else {
          throw new Error(data.error || 'Unknown error');
        }
      } catch (error) {
        console.error('‚ùå Error saving boss configuration:', error);
        addLog(`‚ùå Error saving boss configuration: ${error.message}`);
        showNotification(`Error saving configuration: ${error.message}`, 'error');
      }
    }
    
    // Reset boss configuration to defaults
    async function resetBossConfiguration(bossType) {
      try {
        addLog(`üîÑ Resetting boss configuration for ${bossType}...`);
        
        const response = await fetch(`${API_BASE_URL}/api/admin/boss-management.php?bossType=${bossType}`, {
          method: 'DELETE'
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        if (data.success) {
          addLog(`‚úÖ Boss configuration reset for ${bossType}`);
          
          // Reload configuration
          await loadBossConfiguration(bossType);
          
          showNotification(`Boss configuration reset to defaults!`, 'success');
        } else {
          throw new Error(data.error || 'Unknown error');
        }
      } catch (error) {
        console.error('‚ùå Error resetting boss configuration:', error);
        addLog(`‚ùå Error resetting boss configuration: ${error.message}`);
        showNotification(`Error resetting configuration: ${error.message}`, 'error');
      }
    }
    
    
    
    // Refresh all boss configurations
    async function refreshBossConfigurations() {
      try {
        addLog('üîÑ Refreshing all boss configurations...');
        
        // Load the currently selected boss
        const activeBossTab = document.querySelector('.boss-tab-btn.active');
        if (activeBossTab) {
          const bossType = activeBossTab.getAttribute('data-boss-tab');
          await loadBossConfiguration(bossType);
        }
        
        addLog('‚úÖ All boss configurations refreshed');
      } catch (error) {
        console.error('‚ùå Error refreshing boss configurations:', error);
        addLog(`‚ùå Error refreshing boss configurations: ${error.message}`);
      }
    }
    
    // Reset all boss configurations to defaults
    async function resetAllBossConfigurations() {
      try {
        addLog('üîÑ Resetting all boss configurations to defaults...');
        
        const bossTypes = ['cheeseKing', 'cheeseEmperor', 'cheeseGod', 'cheeseDestroyer'];
        
        for (const bossType of bossTypes) {
          await resetBossConfiguration(bossType);
        }
        
        addLog('‚úÖ All boss configurations reset to defaults');
        showNotification('All boss configurations reset to defaults!', 'success');
      } catch (error) {
        console.error('‚ùå Error resetting all boss configurations:', error);
        addLog(`‚ùå Error resetting all boss configurations: ${error.message}`);
        showNotification(`Error resetting configurations: ${error.message}`, 'error');
      }
    }
    
    // Test boss configuration
    function testBossConfiguration(bossType) {
      addLog(`üß™ Testing boss configuration for ${bossType}...`);
      
      // This would integrate with the game to test the boss
      // For now, just show a message
      showNotification(`Boss configuration test initiated for ${bossType}! Check the game to see changes.`, 'info');
      
      addLog(`‚úÖ Boss configuration test completed for ${bossType}`);
    }
    
    // üîß NEW: Map database field names to expected field names
    function mapDatabaseFieldsToExpected(dbConfig) {
      if (!dbConfig) return null;
      
      return {
        name: dbConfig.name || `Unknown Boss: ${dbConfig.boss_type || 'Unknown'}`,
        description: dbConfig.description || 'No description available',
        baseHealth: dbConfig.base_health || dbConfig.baseHealth || 100,
        healthMultiplier: dbConfig.health_multiplier || dbConfig.healthMultiplier || 1.0,
        baseSpeed: dbConfig.base_speed || dbConfig.baseSpeed || 1.0,
        speedMultiplier: dbConfig.speed_multiplier || dbConfig.speedMultiplier || 1.0,
        baseAttackCooldown: dbConfig.base_attack_cooldown || dbConfig.baseAttackCooldown || 2000,
        attackCooldownMultiplier: dbConfig.attack_cooldown_multiplier || dbConfig.attackCooldownMultiplier || 1.0,
        baseBulletSpeed: dbConfig.base_bullet_speed || dbConfig.baseBulletSpeed || 2.0,
        bulletSpeedMultiplier: dbConfig.bullet_speed_multiplier || dbConfig.bulletSpeedMultiplier || 1.0,
        baseBulletDamage: dbConfig.base_bullet_damage || dbConfig.baseBulletDamage || 15,
        bulletDamageMultiplier: dbConfig.bullet_damage_multiplier || dbConfig.bulletDamageMultiplier || 1.0,
        size: dbConfig.size || 1.0,
        movementPatterns: dbConfig.movement_patterns ? JSON.parse(dbConfig.movement_patterns) : ['sideways'],
        attackPatterns: dbConfig.attack_patterns ? JSON.parse(dbConfig.attack_patterns) : [0],
        abilities: dbConfig.abilities ? JSON.parse(dbConfig.abilities) : {
          canTeleport: false,
          canShield: false,
          canSummonMinions: false,
          canUseLaser: false,
          canCreateExplosions: false
        },
        specialAttackChance: dbConfig.special_attack_chance || dbConfig.specialAttackChance || 0.2,
        rageModeThreshold: dbConfig.rage_mode_threshold || dbConfig.rageModeThreshold || 0.5,
        rageModeMultipliers: dbConfig.rage_mode_multipliers ? JSON.parse(dbConfig.rage_mode_multipliers) : {
          speed: 1.2,
          attackCooldown: 0.9,
          bulletSpeed: 1.1,
          bulletDamage: 1.1
        },
        colors: dbConfig.colors ? JSON.parse(dbConfig.colors) : {
          primary: '#808080',
          secondary: '#a0a0a0',
          particles: '#c0c0c0'
        }
      };
    }
    
    // üîß NEW: Create default boss configuration when none exists
    function createDefaultBossConfig(bossType) {
      const defaults = {
        cheeseKing: {
          name: 'üßÄ Cheese King',
          description: 'The mighty ruler of the cheese realm, with enhanced health and devastating attacks.',
          baseHealth: 200,
          healthMultiplier: 1.5,
          baseSpeed: 2.0,
          speedMultiplier: 1.2,
          baseAttackCooldown: 1500,
          attackCooldownMultiplier: 0.8,
          baseBulletSpeed: 3.0,
          bulletSpeedMultiplier: 1.1,
          baseBulletDamage: 25,
          bulletDamageMultiplier: 1.3,
          size: 1.2,
          movementPatterns: ['sideways', 'diagonal'],
          attackPatterns: [0, 1, 2],
          abilities: {
            canTeleport: true,
            canShield: false,
            canSummonMinions: true,
            canUseLaser: true,
            canCreateExplosions: false
          },
          specialAttackChance: 0.4,
          rageModeThreshold: 0.3,
          rageModeMultipliers: {
            speed: 1.4,
            attackCooldown: 0.7,
            bulletSpeed: 1.3,
            bulletDamage: 1.2
          },
          colors: {
            primary: '#ffd700',
            secondary: '#ff8c00',
            particles: '#ffff00'
          }
        },
        cheeseEmperor: {
          name: 'üëë Cheese Emperor',
          description: 'The supreme leader with ultimate power, capable of devastating the battlefield.',
          baseHealth: 300,
          healthMultiplier: 2.0,
          baseSpeed: 2.5,
          speedMultiplier: 1.4,
          baseAttackCooldown: 1200,
          attackCooldownMultiplier: 0.6,
          baseBulletSpeed: 3.5,
          bulletSpeedMultiplier: 1.3,
          baseBulletDamage: 35,
          bulletDamageMultiplier: 1.5,
          size: 1.4,
          movementPatterns: ['sideways', 'diagonal', 'zigzag'],
          attackPatterns: [0, 1, 2, 3],
          abilities: {
            canTeleport: true,
            canShield: true,
            canSummonMinions: true,
            canUseLaser: true,
            canCreateExplosions: true
          },
          specialAttackChance: 0.5,
          rageModeThreshold: 0.25,
          rageModeMultipliers: {
            speed: 1.6,
            attackCooldown: 0.5,
            bulletSpeed: 1.5,
            bulletDamage: 1.4
          },
          colors: {
            primary: '#ff4500',
            secondary: '#ff6347',
            particles: '#ff1493'
          }
        },
        cheeseGod: {
          name: '‚ö° Cheese God',
          description: 'The divine entity of cheese, with godlike powers and unstoppable force.',
          baseHealth: 500,
          healthMultiplier: 3.0,
          baseSpeed: 3.0,
          speedMultiplier: 1.8,
          baseAttackCooldown: 1000,
          attackCooldownMultiplier: 0.4,
          baseBulletSpeed: 4.0,
          bulletSpeedMultiplier: 1.6,
          baseBulletDamage: 50,
          bulletDamageMultiplier: 2.0,
          size: 1.6,
          movementPatterns: ['sideways', 'diagonal', 'zigzag', 'spiral'],
          attackPatterns: [0, 1, 2, 3, 4],
          abilities: {
            canTeleport: true,
            canShield: true,
            canSummonMinions: true,
            canUseLaser: true,
            canCreateExplosions: true
          },
          specialAttackChance: 0.6,
          rageModeThreshold: 0.2,
          rageModeMultipliers: {
            speed: 2.0,
            attackCooldown: 0.3,
            bulletSpeed: 2.0,
            bulletDamage: 1.8
          },
          colors: {
            primary: '#9400d3',
            secondary: '#8a2be2',
            particles: '#ff00ff'
          }
        },
        cheeseDestroyer: {
          name: 'üí• Cheese Destroyer',
          description: 'The ultimate destroyer, designed to annihilate everything in its path.',
          baseHealth: 800,
          healthMultiplier: 4.0,
          baseSpeed: 3.5,
          speedMultiplier: 2.0,
          baseAttackCooldown: 800,
          attackCooldownMultiplier: 0.3,
          baseBulletSpeed: 5.0,
          bulletSpeedMultiplier: 2.0,
          baseBulletDamage: 75,
          bulletDamageMultiplier: 2.5,
          size: 1.8,
          movementPatterns: ['sideways', 'diagonal', 'zigzag', 'spiral', 'chaos'],
          attackPatterns: [0, 1, 2, 3, 4, 5],
          abilities: {
            canTeleport: true,
            canShield: true,
            canSummonMinions: true,
            canUseLaser: true,
            canCreateExplosions: true
          },
          specialAttackChance: 0.7,
          rageModeThreshold: 0.15,
          rageModeMultipliers: {
            speed: 2.5,
            attackCooldown: 0.2,
            bulletSpeed: 2.5,
            bulletDamage: 2.2
          },
          colors: {
            primary: '#ff0000',
            secondary: '#dc143c',
            particles: '#ff4500'
          }
        }
      };
      
      return defaults[bossType] || {
        name: `Unknown Boss: ${bossType}`,
        description: 'Default configuration for unknown boss type.',
        baseHealth: 100,
        healthMultiplier: 1.0,
        baseSpeed: 1.0,
        speedMultiplier: 1.0,
        baseAttackCooldown: 2000,
        attackCooldownMultiplier: 1.0,
        baseBulletSpeed: 2.0,
        bulletSpeedMultiplier: 1.0,
        baseBulletDamage: 15,
        bulletDamageMultiplier: 1.0,
        size: 1.0,
        movementPatterns: ['sideways'],
        attackPatterns: [0],
        abilities: {
          canTeleport: false,
          canShield: false,
          canSummonMinions: false,
          canUseLaser: false,
          canCreateExplosions: false
        },
        specialAttackChance: 0.2,
        rageModeThreshold: 0.5,
        rageModeMultipliers: {
          speed: 1.2,
          attackCooldown: 0.9,
          bulletSpeed: 1.1,
          bulletDamage: 1.1
        },
        colors: {
          primary: '#808080',
          secondary: '#a0a0a0',
          particles: '#c0c0c0'
        }
      };
    }

    // ========================================
    // AUTO-LOADING SYSTEM HELPER FUNCTIONS
    // ========================================

    // Mark tab as recently loaded with timestamp
    function markTabAsLoaded(tabName) {
      const timestamp = Date.now();
      if (!window.tabLoadHistory) {
        window.tabLoadHistory = {};
      }
      window.tabLoadHistory[tabName] = timestamp;
      console.log(`üìÖ Tab ${tabName} marked as loaded at ${new Date(timestamp).toLocaleTimeString()}`);
    }

    // Check if tab needs refresh (older than 5 minutes)
    function shouldRefreshTab(tabName) {
      if (!window.tabLoadHistory || !window.tabLoadHistory[tabName]) {
        return true; // Never loaded, needs refresh
      }
      const fiveMinutes = 5 * 60 * 1000; // 5 minutes in milliseconds
      const timeSinceLastLoad = Date.now() - window.tabLoadHistory[tabName];
      return timeSinceLastLoad > fiveMinutes;
    }

    // Auto-load recent user activity for users tab
    async function loadRecentUserActivity() {
      try {
        addLog('üë• Loading recent user activity...');
        
        // Load recent user registrations and activity
        const response = await fetch(`${API_BASE_URL}/api/admin/get-stats.php`);
        const data = await response.json();
        
        if (data.success) {
          // Update user count display
          const userResults = document.getElementById('userResults');
          if (userResults) {
            userResults.innerHTML = `
              <div class="text-center p-4">
                <div class="text-2xl font-bold text-blue-400 mb-2">${data.totalUsers || 0}</div>
                <div class="text-sm text-gray-400">Total Users</div>
                <div class="text-xs text-gray-500 mt-1">Last updated: ${new Date().toLocaleTimeString()}</div>
              </div>
              <div class="text-center p-2">
                <div class="text-sm text-gray-400">Search for users to see detailed results...</div>
              </div>
            `;
          }
          addLog('‚úÖ Recent user activity loaded');
        }
      } catch (error) {
        console.error('‚ùå Error loading recent user activity:', error);
        addLog(`‚ùå Error loading user activity: ${error.message}`);
      }
    }

    // Auto-load point statistics for points tab
    async function loadPointStatistics() {
      try {
        addLog('üí∞ Loading point statistics...');
        
        // Load point system overview
        const response = await fetch(`${API_BASE_URL}/api/admin/get-stats.php`);
        const data = await response.json();
        
        if (data.success) {
          // Update point statistics display
          const pointResults = document.getElementById('pointResults');
          if (pointResults) {
            pointResults.innerHTML = `
              <div class="text-center p-4">
                <div class="text-2xl font-bold text-green-400 mb-2">${data.totalScores || 0}</div>
                <div class="text-sm text-gray-400">Total Points Awarded</div>
                <div class="text-xs text-gray-500 mt-1">Last updated: ${new Date().toLocaleTimeString()}</div>
              </div>
              <div class="text-center p-2">
                <div class="text-sm text-gray-400">Search for users to manage points...</div>
              </div>
            `;
          }
          addLog('‚úÖ Point statistics loaded');
        }
      } catch (error) {
        console.error('‚ùå Error loading point statistics:', error);
        addLog(`‚ùå Error loading point statistics: ${error.message}`);
      }
    }

    // Auto-load all boss configurations for bosses tab
    async function loadAllBossConfigurations() {
      try {
        addLog('üëë Loading all boss configurations...');
        
        const bossTypes = ['cheeseKing', 'cheeseEmperor', 'cheeseGod', 'cheeseDestroyer'];
        
        // Load configurations for all bosses
        for (const bossType of bossTypes) {
          await loadBossConfiguration(bossType);
        }
        
        addLog('‚úÖ All boss configurations loaded');
      } catch (error) {
        console.error('‚ùå Error loading boss configurations:', error);
        addLog(`‚ùå Error loading boss configurations: ${error.message}`);
      }
    }

    // Enhanced tab switching with auto-refresh
    function switchTabWithAutoRefresh(tabName) {
      console.log(`üîÑ Switching to tab with auto-refresh: ${tabName}`);
      
      // Check if tab needs refresh
      if (shouldRefreshTab(tabName)) {
        console.log(`üîÑ Tab ${tabName} needs refresh, auto-loading data...`);
        showTab(tabName); // This will auto-load the data
      } else {
        console.log(`‚úÖ Tab ${tabName} recently loaded, switching without refresh`);
        // Just switch the tab without reloading data
        showTab(tabName);
      }
    }

    // Auto-refresh all tabs periodically (every 10 minutes)
    function startAutoRefreshSystem() {
      console.log('üîÑ Starting auto-refresh system...');
      
      setInterval(() => {
        const currentTab = window.currentTab;
        if (currentTab && shouldRefreshTab(currentTab)) {
          console.log(`üîÑ Auto-refreshing current tab: ${currentTab}`);
          showTab(currentTab);
        }
      }, 10 * 60 * 1000); // 10 minutes
      
      addLog('‚úÖ Auto-refresh system started (10-minute intervals)');
    }

    // Initialize auto-refresh system when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Start auto-refresh system after a short delay
      setTimeout(() => {
        startAutoRefreshSystem();
      }, 5000); // 5 seconds after page load
    });
        // Load enhanced dashboard statistics
        async function loadEnhancedDashboardStats() {
      console.log('üöÄ Loading enhanced dashboard statistics...');
      addLog('üöÄ Loading enhanced dashboard statistics...');
      
      try {
        // Load enhanced statistics from available APIs
        await loadEnhancedStatsFromAvailableAPIs();
        
        // Load user engagement data
        await loadUserEngagementData();
        
        // Load wealth distribution data
        await loadWealthDistributionData();
        
        addLog('‚úÖ Enhanced dashboard statistics loaded successfully');
      } catch (error) {
        console.error('‚ùå Error loading enhanced dashboard stats:', error);
        addLog(`‚ùå Error loading enhanced dashboard stats: ${error.message}`);
        // Set default values on error
        setDefaultEnhancedStats();
      }
    }

    // Load enhanced stats from available APIs
    async function loadEnhancedStatsFromAvailableAPIs() {
      try {
        console.log('üìä Loading enhanced stats from available APIs...');
        
        // Try to get enhanced stats from quest claims API
        const questClaimsResponse = await fetch(API_BASE_URL + '/api/admin/get-enhanced-quest-claims.php?status=all');
        const questClaimsData = await questClaimsResponse.json();
        
        if (questClaimsData.success && questClaimsData.claims) {
          const claims = questClaimsData.claims;
          const completedClaims = claims.filter(c => c.status === 'approved');
          const pendingClaims = claims.filter(c => c.status === 'pending');
          
          console.log('üìä Quest claims data:', { total: claims.length, completed: completedClaims.length, pending: pendingClaims.length });
          
          // Update enhanced stats elements
          updateEnhancedStatsElement('questCompletionRate', 
            claims.length > 0 ? Math.round((completedClaims.length / claims.length) * 100) : 0, '%');
          updateEnhancedStatsElement('questsClaimedToday', 
            claims.filter(c => {
              const today = new Date().toDateString();
              const claimDate = new Date(c.claimed_at).toDateString();
              return today === claimDate;
            }).length);
          updateEnhancedStatsElement('rolesGrantedToday', completedClaims.length);
        }
        
        // Try to get cheese stats for clicks data
        const cheeseStatsResponse = await fetch(API_BASE_URL + '/api/admin/get-cheese-stats.php');
        const cheeseStatsData = await cheeseStatsResponse.json();
        
        if (cheeseStatsData.success && cheeseStatsData.stats) {
          const stats = cheeseStatsData.stats;
          console.log('üìä Cheese stats data:', stats);
          
          updateEnhancedStatsElement('clicksLast24h', stats.recent_24h || 0);
          updateEnhancedStatsElement('avgClicksPerUser', 
            stats.total_users > 0 ? Math.round(stats.total_clicks / stats.total_users) : 0);
        }
        
        // Calculate total DSPOINC from quest claims
        if (questClaimsData.success && questClaimsData.claims) {
          const totalDspoinc = questClaimsData.claims
            .filter(c => c.status === 'approved')
            .reduce((sum, c) => sum + (parseInt(c.reward) || 0), 0);
          updateEnhancedStatsElement('totalDSPOINC', totalDspoinc.toLocaleString());
        }
        
        // Calculate average quest reward
        if (questClaimsData.success && questClaimsData.claims) {
          const approvedClaims = questClaimsData.claims.filter(c => c.status === 'approved');
          const avgReward = approvedClaims.length > 0 ? 
            Math.round(approvedClaims.reduce((sum, c) => sum + (parseInt(c.reward) || 0), 0) / approvedClaims.length) : 0;
          updateEnhancedStatsElement('avgQuestReward', avgReward.toLocaleString());
        }
        
        // Try to get new users today from stats API
        try {
          const statsResponse = await fetch(API_BASE_URL + '/api/admin/get-stats.php');
          const statsData = await statsResponse.json();
          
          if (statsData.success) {
            updateEnhancedStatsElement('newUsersToday', statsData.newUsers24h || statsData.newUsersToday || 0);
          }
        } catch (error) {
          console.warn('‚ö†Ô∏è Could not load new users data:', error);
          updateEnhancedStatsElement('newUsersToday', 0);
        }
        
      } catch (error) {
        console.error('‚ùå Error loading enhanced stats from APIs:', error);
        addLog(`‚ùå Error loading enhanced stats from APIs: ${error.message}`);
      }
    }

    // Load user engagement data
    async function loadUserEngagementData() {
      try {
        console.log('üë• Loading user engagement data...');
        const container = document.getElementById('engagementStats');
        if (!container) {
          console.warn('‚ö†Ô∏è engagementStats element not found');
          return;
        }
        
        // Try to get recent user activity from multiple sources
        let engagementData = {
          newUsers24h: 0,
          activeUsers24h: 0,
          totalSessions: 0
        };
        
        try {
          const statsResponse = await fetch(API_BASE_URL + '/api/admin/get-stats.php');
          const statsData = await statsResponse.json();
          
          if (statsData.success) {
            engagementData = {
              newUsers24h: statsData.newUsers24h || statsData.newUsersToday || 0,
              activeUsers24h: statsData.activeUsers24h || statsData.activeUsers || 0,
              totalSessions: statsData.totalSessions || statsData.totalScores || 0
            };
          }
        } catch (error) {
          console.warn('‚ö†Ô∏è Could not load engagement data from stats API:', error);
        }
        
        // Try to get additional engagement data from quest claims
        try {
          const questClaimsResponse = await fetch(API_BASE_URL + '/api/admin/get-enhanced-quest-claims.php?status=all');
          const questClaimsData = await questClaimsResponse.json();
          
          if (questClaimsData.success && questClaimsData.claims) {
            const claims = questClaimsData.claims;
            const today = new Date().toDateString();
            
            const claimsToday = claims.filter(c => {
              const claimDate = new Date(c.claimed_at).toDateString();
              return today === claimDate;
            }).length;
            
            engagementData.questsToday = claimsToday;
          }
        } catch (error) {
          console.warn('‚ö†Ô∏è Could not load quest engagement data:', error);
        }
        
        const engagementHTML = `
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-gray-300">New Users (24h):</span>
              <span class="text-green-400 font-semibold">${engagementData.newUsers24h}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-300">Active Users (24h):</span>
              <span class="text-blue-400 font-semibold">${engagementData.activeUsers24h}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-300">Total Sessions:</span>
              <span class="text-purple-400 font-semibold">${engagementData.totalSessions}</span>
            </div>
            ${engagementData.questsToday !== undefined ? `
            <div class="flex justify-between">
              <span class="text-gray-300">Quests Today:</span>
              <span class="text-yellow-400 font-semibold">${engagementData.questsToday}</span>
            </div>
            ` : ''}
          </div>
        `;
        container.innerHTML = engagementHTML;
        console.log('‚úÖ User engagement data loaded:', engagementData);
        
      } catch (error) {
        console.error('‚ùå Error loading user engagement data:', error);
        const container = document.getElementById('engagementStats');
        if (container) {
          container.innerHTML = '<div class="text-red-400">Error loading engagement data</div>';
        }
      }
    }

    // Load wealth distribution data
    async function loadWealthDistributionData() {
      try {
        console.log('üí∞ Loading wealth distribution data...');
        const container = document.getElementById('wealthStats');
        if (!container) {
          console.warn('‚ö†Ô∏è wealthStats element not found');
          return;
        }
        
        // Try to get wealth distribution from quest claims
        const questClaimsResponse = await fetch(API_BASE_URL + '/api/admin/get-enhanced-quest-claims.php?status=approved');
        const questClaimsData = await questClaimsResponse.json();
        
        if (questClaimsData.success && questClaimsData.claims) {
          const claims = questClaimsData.claims;
          const totalDspoinc = claims.reduce((sum, c) => sum + (parseInt(c.reward) || 0), 0);
          const avgReward = claims.length > 0 ? Math.round(totalDspoinc / claims.length) : 0;
          const topReward = Math.max(...claims.map(c => parseInt(c.reward) || 0), 0);
          
          // Calculate wealth distribution tiers
          const wealthTiers = {
            low: claims.filter(c => (parseInt(c.reward) || 0) < 100).length,
            medium: claims.filter(c => (parseInt(c.reward) || 0) >= 100 && (parseInt(c.reward) || 0) < 500).length,
            high: claims.filter(c => (parseInt(c.reward) || 0) >= 500).length
          };
          
          const wealthHTML = `
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-gray-300">Total DSPOINC:</span>
                <span class="text-green-400 font-semibold">${totalDspoinc.toLocaleString()}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-300">Average Reward:</span>
                <span class="text-blue-400 font-semibold">${avgReward.toLocaleString()}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-300">Top Reward:</span>
                <span class="text-purple-400 font-semibold">${topReward.toLocaleString()}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-300">Low Tier (<100):</span>
                <span class="text-gray-400">${wealthTiers.low}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-300">High Tier (500+):</span>
                <span class="text-yellow-400">${wealthTiers.high}</span>
              </div>
            </div>
          `;
          container.innerHTML = wealthHTML;
          console.log('‚úÖ Wealth distribution data loaded:', { totalDspoinc, avgReward, topReward, wealthTiers });
        } else {
          container.innerHTML = '<div class="text-gray-400">No wealth data available</div>';
        }
      } catch (error) {
        console.error('‚ùå Error loading wealth distribution data:', error);
        const container = document.getElementById('wealthStats');
        if (container) {
          container.innerHTML = '<div class="text-red-400">Error loading wealth data</div>';
        }
      }
    }

    // Update enhanced stats element with fallback and styling
    function updateEnhancedStatsElement(elementId, value, suffix = '') {
      const element = document.getElementById(elementId);
      if (element) {
        const displayValue = value + suffix;
        element.textContent = displayValue;
        
        // Add visual styling based on value
        if (value > 0) {
          element.className = 'text-white font-semibold';
          element.style.textShadow = '0 0 10px rgba(255, 255, 255, 0.3)';
        } else if (value === 0) {
          element.className = 'text-gray-400';
          element.style.textShadow = 'none';
        } else {
          element.className = 'text-red-400';
          element.style.textShadow = '0 0 10px rgba(239, 68, 68, 0.3)';
        }
        
        console.log(`‚úÖ Updated ${elementId}: ${displayValue}`);
      } else {
        console.warn(`‚ö†Ô∏è Element not found: ${elementId}`);
      }
    }

    // Set default enhanced stats values with better formatting
    function setDefaultEnhancedStats() {
      console.log('üîÑ Setting default enhanced stats values...');
      
      const defaultStats = {
        'avgClicksPerUser': '0',
        'totalDSPOINC': '0',
        'questCompletionRate': '0%',
        'avgQuestReward': '0',
        'clicksLast24h': '0',
        'newUsersToday': '0',
        'questsClaimedToday': '0',
        'rolesGrantedToday': '0'
      };
      
      Object.entries(defaultStats).forEach(([elementId, value]) => {
        updateEnhancedStatsElement(elementId, value, elementId === 'questCompletionRate' ? '' : '');
      });
      
      // Set default engagement and wealth displays
      const engagementContainer = document.getElementById('engagementStats');
      if (engagementContainer) {
        engagementContainer.innerHTML = '<div class="text-gray-400">No engagement data available</div>';
      }
      
      const wealthContainer = document.getElementById('wealthStats');
      if (wealthContainer) {
        wealthContainer.innerHTML = '<div class="text-gray-400">No wealth data available</div>';
      }
      
      console.log('‚úÖ Default enhanced stats values set');
    }
  </script>

</body>
</html>