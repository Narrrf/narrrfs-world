<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🧠 Your Narrrf Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#fcd34d">
  <link rel="icon" href="img/cheese-egg.png" type="image/png">

  <style>
    /* 🎨 Style Card Elements */
    .card {
      background: #36393f;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    /* 🖼️ Avatar */
    .avatar {
      border-radius: 50%;
      width: 100px;
      height: 100px;
      margin-bottom: 15px;
    }

    /* 🧠 Username */
    .username {
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    /* 🧬 Tagline + Guild Info */
    .tagline {
      font-size: 0.95em;
      color: #b9bbbe;
      margin-bottom: 20px;
    }
    .guilds {
      margin-top: 15px;
      font-size: 0.9em;
    }

    /* 🧀 Highlight Text */
    .cheese {
      margin-top: 25px;
      font-style: italic;
      color: #fcd34d;
    }
  </style>
</head>

<!-- ✅ Profile Scroll DOM Zone -->
<body class="bg-[#2f3136] text-white font-sans flex flex-col items-center py-10 px-4">

<!-- 🔰 Header with App Context -->
<header class="w-full bg-black py-4 px-6 text-yellow-400 text-center shadow-md">
  <h1 class="text-xl font-bold tracking-wide">🧠 Narrrf's Lab – Phase 2 Portal</h1>
  <p class="text-xs text-gray-400 mt-1">Profile Synced via Discord OAuth · Powered by Cheese Architect 4.0</p>
</header>

<!-- 💎 Conditional VIP Notification -->
<div id="goldenCheeseGate" class="hidden mt-4 p-4 bg-yellow-100 text-yellow-800 font-bold rounded-xl shadow-lg animate-pulse">
  <img src="img/big-cheese.svg" class="w-8 h-8 inline mr-2" alt="Big Cheese" />
  Welcome, VIP! You found the Golden Cheese 🧀
</div>

<!-- 🧂 VIP Absence Fallback -->
<div id="noCheeseJoke" class="hidden mt-4 text-sm italic text-gray-500">
  😅 You’re logged in, but... no VIP pass? That’s nacho cheese!
</div>

<!-- 👤 User Profile Card -->
<main class="flex-grow flex items-center justify-center px-4 py-12">
  <div class="bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center border-4 border-yellow-400">

    <!-- 👋 Welcome Message -->
    <p id="welcome-msg" class="text-yellow-300 text-sm italic mb-2">
      Welcome back, <span id="welcome-name">loading...</span>
    </p>

    <!-- 🖼️ User Avatar -->
    <img id="avatar" class="w-24 h-24 mx-auto rounded-full border-4 border-yellow-500 shadow mb-4 animate-bounce" src="" alt="User Avatar" />

    <!-- 📛 Username Display -->
    <h1 id="username" class="text-2xl font-bold text-yellow-300">Loading...</h1>
    <p id="email" class="text-sm text-gray-400">...</p>
    <p id="guilds" class="mt-2 text-sm text-yellow-100 italic">Guilds loading...</p>

    <!-- 🧪 Traits + Wallet View -->
    <div class="mt-6 bg-yellow-100 text-gray-900 rounded-lg p-4 shadow-inner">
      <h2 class="font-semibold text-lg mb-2">🎒 Wallet & Traits</h2>
      <p id="wallet-address">🔗 Linked wallet: <em class="text-sm">coming soon</em></p>
      <p>🧬 Traits: <span id="traits">pending sync</span></p>
      <p id="user-roles" class="mt-3 text-sm text-yellow-900 italic">Roles: loading...</p>
    </div>

    <!-- ✅ Session Note -->
    <div class="mt-4 text-xs text-gray-300 italic">
      OAuth session live · Verified via Discord
    </div>

    <!-- 👣 Footer Note -->
    <div class="mt-6 text-yellow-400 text-sm">
      🧠 Profile powered by Cheese Architect 5.0 · Phase 2 Bridge Online
    </div>
  </div>
</main>
<!-- 🧠 Profile Game Guide Dashboard -->
<section class="bg-gradient-to-br from-yellow-50 via-white to-purple-100 py-16 px-6">
  <div class="max-w-5xl mx-auto space-y-12">

    <!-- 👤 Profile Summary -->
    <div class="bg-yellow-50 rounded-3xl shadow-xl p-6 border-l-4 border-yellow-300">
      <h2 class="text-2xl font-extrabold text-yellow-700 mb-2">🧬 Synced Profile: <span id="username">loading...</span></h2>
      <p class="text-sm text-gray-700">Discord: <span id="discord-tag">...loading</span></p>
      <p class="text-sm text-gray-700">Wallet: <span id="wallet">...loading</span></p>
      <p class="text-sm text-purple-700 italic mt-1">Roles: VIP | Cartographer | Puzzle Adept</p>
    </div>

    <!-- 🗺️ Access Map -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-400">
      <h3 class="text-xl font-bold text-blue-700 mb-4">🗺️ Game Access Tracker</h3>
      <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
        <li>🌉 <strong>Hytopia Portal:</strong> <span class="text-green-600">🟢 Synced</span></li>
        <li>🎭 <strong>Puzzle Gate 3:</strong> <span class="text-yellow-600">🟡 Unlocked</span></li>
        <li>🧠 <strong>Brain Riddle 5.0:</strong> <span class="text-red-600">🔴 Pending Trait</span></li>
        <li>💼 <strong>Inventory Access:</strong> <span class="text-green-500">🟢 Open</span></li>
      </ul>
    </div>

    <!-- 🧠 Why Onion Bridge -->
    <div class="bg-indigo-100 border-l-4 border-indigo-300 p-6 rounded-xl shadow">
      <h3 class="text-2xl font-bold text-indigo-800 mb-3">🧠 Why Onion Bridge?</h3>
      <p class="text-sm text-gray-700">“We are building the future of Web3 integrated gaming: combining HYTOPIA’s dynamic voxel environments with our unique Onion-layered roles, NFTs, and Discord-driven logic. It’s not just gaming—it’s a fully immersive community experience.” — Masterchiefe</p>
      <ul class="list-disc list-inside mt-4 text-sm text-gray-700 space-y-1">
        <li>Full dimensional synchronization (game, Discord, blockchain)</li>
        <li>Trait-based gameplay puzzles & unlockable areas</li>
        <li>Interactive role & NFT-based UI elements in-game</li>
        <li>AI-supported coding & development tools</li>
      </ul>
    </div>

    <!-- 🔗 Navigation Tiles -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <a href="mint.html" class="bg-pink-200 p-4 rounded-xl shadow text-center hover:bg-pink-300">
        🧬 Mint Traits
      </a>
      <a href="get-roles.html" class="bg-yellow-200 p-4 rounded-xl shadow text-center hover:bg-yellow-300">
        🧠 Get Roles
      </a>
      <a href="hytopia-preview.html" class="bg-blue-200 p-4 rounded-xl shadow text-center hover:bg-blue-300">
        🗺️ Hytopia Portal
      </a>
      <a href="whitepaper.html" class="bg-purple-200 p-4 rounded-xl shadow text-center hover:bg-purple-300">
        📜 Lorebook
      </a>
    </div>

    <!-- 🌀 Glowing Rune Badge + Call to Portal -->
    <div class="text-center space-y-6 pt-8">
      <div class="text-lg text-gray-700 italic animate-pulse">
        🧬 Sync your traits. Unlock your destiny.
      </div>

      <div class="flex justify-center">
        <div class="w-20 h-20 rounded-full border-4 border-yellow-400 animate-spin-slow shadow-lg bg-yellow-200 flex items-center justify-center">
          <img src="img/cheese-egg1.png" alt="Rune Seal" class="w-10 h-10 animate-pulse" />
        </div>
      </div>

      <a href="/profile.html" class="inline-block bg-purple-600 text-white py-3 px-8 rounded-full shadow-xl border-4 border-yellow-300 hover:bg-purple-700 transition transform hover:scale-105 text-lg font-semibold">
        🚪 Enter the Portal: Sync Profile
      </a>
    </div>

    <!-- 📜 Entry Guide -->
    <div class="mt-10 max-w-md mx-auto text-sm text-gray-600 bg-white bg-opacity-80 p-4 rounded-xl shadow-inner border-l-4 border-purple-300">
      <p class="mb-2 font-bold text-purple-800">How to Enter Hytopia via Narrrf's Lab:</p>
      <ol class="list-decimal list-inside space-y-1 text-left">
        <li>Login with Discord on your <strong>Profile Page</strong></li>
        <li>Sync your wallet & view your traits</li>
        <li>Gain roles based on ownership & lore completions</li>
        <li>Access portals and exclusive trait-based puzzles</li>
      </ol>
    </div>

  </div>
</section>

<!-- 🧀 Footer Scroll Seal -->
<footer class="text-center text-xs text-yellow-600 py-6 mt-16">
  🧠 Powered by Cheese Architect 4.0 — HTML Brain of Narrrf’s World<br>
  🧀 Brain Sync 4.0 Confirmed · Profile UX Last Update: 2025 · Guided by Coreforge + Corebrain 📊
</footer>
  
  <!-- 🌀 Cheese Portal to Hytopia -->
<div class="mt-10 text-center">
  <a href="/hytopia.html" class="group inline-block relative" title="🧀 Hytopia portal is closed... for now.">
    <div class="relative p-4 rounded-full bg-yellow-300/90 hover:bg-yellow-400 transition-all duration-300 shadow-2xl animate-pulse">
      <img src="img/cheese-portal.png" alt="Enter Hytopia" class="w-24 h-24 sm:w-32 sm:h-32 mx-auto group-hover:scale-105 transition-transform duration-300 drop-shadow-lg" />
      <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
        <div class="text-xs bg-black/80 text-yellow-300 px-3 py-1 rounded-full shadow-md animate-pulse">
          🧀 Portal Closed · Opening Soon!
        </div>
      </div>
      
<!-- 🔐 Dynamic Fetch Script -->
<script>
  async function loadProfile() {
    try {
      const res = await fetch('/api/user.php', { credentials: 'include' });
      if (!res.ok) {
        document.getElementById('username').innerText = 'Not Logged In';
        return;
      }

      const user = await res.json();
      const fullUsername = `${user.username}#${user.discriminator}`;
      document.getElementById('avatar').src = user.avatarUrl || '';
      document.getElementById('username').innerText = fullUsername;
      document.getElementById('welcome-name').innerText = fullUsername;
      document.getElementById('email').innerText = user.email || 'No email provided';
      document.getElementById('guilds').innerText = `🎯 Guilds Connected: ${user.guilds?.length || 0}`;
      document.getElementById('wallet-address').innerText = `🔗 Linked wallet: ${localStorage.getItem('walletAddress') || 'not connected'}`;
    } catch (e) {
      console.error('Profile fetch failed', e);
      document.getElementById('username').innerText = 'Login Required';
    }
  }

  document.addEventListener("DOMContentLoaded", async () => {
    loadProfile();
    try {
      const res = await fetch('/api/user/roles.php');
      const data = await res.json();
      const roles = data.roles || [];

      if (roles.includes("VIP Holder") || roles.includes("VIP_pass")) {
        document.getElementById('goldenCheeseGate').classList.remove('hidden');
        console.log("%c🧀 VIP Access: Golden Cheese Unlocked!", "color: gold; font-weight: bold;");
      } else {
        document.getElementById('noCheeseJoke').classList.remove('hidden');
        console.log("😅 Logged in, but VIP role not found.");
      }
    } catch (err) {
      console.error("Role check failed:", err);
    }
  });
</script>

</body>
</html>
