<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ§  Your Narrrf Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#fcd34d">
  <link rel="icon" href="img/cheese-egg.png" type="image/png">

  <style>
    .card {
      background: #36393f;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }
    .avatar {
      border-radius: 50%;
      width: 100px;
      height: 100px;
      margin-bottom: 15px;
    }
    .username {
      font-size: 1.5em;
      margin-bottom: 5px;
    }
    .tagline {
      font-size: 0.95em;
      color: #b9bbbe;
      margin-bottom: 20px;
    }
    .guilds {
      margin-top: 15px;
      font-size: 0.9em;
    }
    .cheese {
      margin-top: 25px;
      font-style: italic;
      color: #fcd34d;
    }
  </style>
</head>

<!-- âœ… Move this outside the <head> tag -->
<body class="bg-[#2f3136] text-white font-sans flex flex-col items-center py-10 px-4">

<!-- ðŸ”° Header with App Context -->
<header class="w-full bg-black py-4 px-6 text-yellow-400 text-center shadow-md">
  <h1 class="text-xl font-bold tracking-wide">ðŸ§  Narrrf's Lab â€“ Phase 2 Portal</h1>
  <p class="text-xs text-gray-400 mt-1">Profile Synced via Discord OAuth Â· Powered by Cheese Architect 4.0</p>
</header>

<!-- ðŸ’Ž Conditional VIP Notification -->
<div id="goldenCheeseGate" class="hidden mt-4 p-4 bg-yellow-100 text-yellow-800 font-bold rounded-xl shadow-lg animate-pulse">
  <img src="img/big-cheese.svg" class="w-8 h-8 inline mr-2" alt="Big Cheese" />
  Welcome, VIP! You found the Golden Cheese ðŸ§€
</div>

<!-- ðŸ§‚ VIP Absence Fallback -->
<div id="noCheeseJoke" class="hidden mt-4 text-sm italic text-gray-500">
  ðŸ˜… Youâ€™re logged in, but... no VIP pass? Thatâ€™s nacho cheese!
</div>

<!-- ðŸ‘¤ User Profile Card -->
<main class="flex-grow flex items-center justify-center px-4 py-12">
  <div class="bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center border-4 border-yellow-400">

    <!-- ðŸ‘‹ Welcome Message -->
    <p id="welcome-msg" class="text-yellow-300 text-sm italic mb-2">Welcome back, <span id="welcome-name">...</span></p>

    <!-- ðŸ–¼ï¸ User Avatar -->
    <img id="avatar" class="w-24 h-24 mx-auto rounded-full border-4 border-yellow-500 shadow mb-4 animate-bounce" src="" alt="User Avatar" />

    <!-- ðŸ“› Username Display -->
    <h1 id="username" class="text-2xl font-bold text-yellow-300">Loading...</h1>
    <p id="email" class="text-sm text-gray-400">...</p>
    <p id="guilds" class="mt-2 text-sm text-yellow-100 italic">Guilds loading...</p>

    <!-- ðŸ§ª Traits + Wallet View -->
    <div class="mt-6 bg-yellow-100 text-gray-900 rounded-lg p-4 shadow-inner">
      <h2 class="font-semibold text-lg mb-2">ðŸŽ’ Wallet & Traits</h2>
      <p id="wallet-address">ðŸ”— Linked wallet: <em class="text-sm">coming soon</em></p>
      <p>ðŸ§¬ Traits: <span id="traits">pending sync</span></p>
      <p id="user-roles" class="mt-3 text-sm text-yellow-900 italic">Roles: loading...</p>
    </div>

    <!-- âœ… Session Note -->
    <div class="mt-4 text-xs text-gray-300 italic">
      OAuth session live Â· Verified via Discord
    </div>

    <!-- ðŸ‘£ Footer Note -->
    <div class="mt-6 text-yellow-400 text-sm">
      ðŸ§  Profile powered by Cheese Architect 4.0 Â· Phase 2 Bridge Online
    </div>
  </div>
</main>

<!-- ðŸ§€ Footer Scroll Seal -->
<footer class="text-center text-xs text-yellow-600 py-6 mt-16">
  ðŸ§  Powered by Cheese Architect 4.0 â€” HTML Brain of Narrrfâ€™s World<br>
  ðŸ§€ Brain Sync 4.0 Confirmed Â· Profile UX Last Update: 2025 Â· Guided by Coreforge + Corebrain ðŸ“Š
</footer>

  <!-- ðŸ” Dynamic Fetch Script -->
<script>
  async function loadProfile() {
    try {
      const res = await fetch('/api/user.php', {
        credentials: 'include'
      });

      if (!res.ok) {
        document.getElementById('username').innerText = 'Not Logged In';
        return;
      }

      const user = await res.json();
      document.getElementById('avatar').src = user.avatarUrl || '';
      document.getElementById('username').innerText = `${user.username}#${user.discriminator}`;
      document.getElementById('welcome-name').innerText = user.username || 'Unknown';
      document.getElementById('email').innerText = user.email || 'No email provided';
      document.getElementById('guilds').innerText = `ðŸŽ¯ Guilds Connected: ${user.guilds?.length || 0}`;
      document.getElementById('wallet-address').innerText = `ðŸ”— Linked wallet: ${localStorage.getItem('walletAddress') || 'not connected'}`;
    } catch (e) {
      console.error('Profile fetch failed', e);
      document.getElementById('username').innerText = 'Login Required';
    }
  }
</script>
  <script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    // Fetch user roles from /api/user/roles.php
    const res = await fetch('/api/user/roles.php');
    const data = await res.json();
    
    // Check if roles are returned successfully
    const roles = data.roles || [];
    
    // If the user has the VIP role, show the Golden Cheese gate
    if (roles.includes("VIP Holder") || roles.includes("VIP_pass")) {
      document.getElementById('goldenCheeseGate').classList.remove('hidden');
      console.log("%cðŸ§€ VIP Access: Golden Cheese Unlocked!", "color: gold; font-weight: bold;");
    } else {
      // If not, show the No VIP Joke
      document.getElementById('noCheeseJoke').classList.remove('hidden');
      console.log("ðŸ˜… Logged in, but VIP role not found.");
    }
  } catch (err) {
    console.error("Role check failed:", err);
  }
});

</script>

</body>
</html>