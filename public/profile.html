<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ§  Your Narrrf Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#fcd34d">
  <link rel="icon" href="img/cheese-egg.png" type="image/png">

  <style>
    /* ğŸ¨ Style Card Elements */
    .card {
      background: #36393f;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    /* ğŸ–¼ï¸ Avatar */
    .avatar {
      border-radius: 50%;
      width: 100px;
      height: 100px;
      margin-bottom: 15px;
    }

    /* ğŸ§  Username */
    .username {
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    /* ğŸ§¬ Tagline + Guild Info */
    .tagline {
      font-size: 0.95em;
      color: #b9bbbe;
      margin-bottom: 20px;
    }
    .guilds {
      margin-top: 15px;
      font-size: 0.9em;
    }

    /* ğŸ§€ Highlight Text */
    .cheese {
      margin-top: 25px;
      font-style: italic;
      color: #fcd34d;
    }
    @keyframes pop {
  0% { transform: scale(0.9); opacity: 0.3; }
  100% { transform: scale(1); opacity: 1; }
}
.animate-pop {
  animation: pop 0.4s ease-out;
}
  </style>
</head>

<!-- âœ… Profile Scroll DOM Zone -->
<body class="bg-[#2f3136] text-white font-sans flex flex-col items-center py-10 px-4">

<!-- ğŸ”° Header with App Context -->
<header class="w-full bg-black py-4 px-6 text-yellow-400 text-center shadow-md">
  <h1 class="text-xl font-bold tracking-wide">ğŸ§  Narrrf's Lab â€“ Phase 2 Portal</h1>
  <p class="text-xs text-gray-400 mt-1">Profile Synced via Discord OAuth Â· Powered by Cheese Architect 4.0</p>
</header>

<!-- ğŸ’ Conditional VIP Notification -->
<div id="goldenCheeseGate" class="hidden mt-4 p-4 bg-yellow-100 text-yellow-800 font-bold rounded-xl shadow-lg animate-pulse">
  <img src="img/big-cheese.svg" class="w-8 h-8 inline mr-2" alt="Big Cheese" />
  Welcome, VIP! You found the Golden Cheese ğŸ§€
</div>

<!-- ğŸ§‚ VIP Absence Fallback -->
<div id="noCheeseJoke" class="hidden mt-4 text-sm italic text-gray-500">
  ğŸ˜… Youâ€™re logged in, but... no VIP pass? Thatâ€™s nacho cheese!
</div>

<!-- ğŸ‘¤ User Profile Card -->
<main class="flex-grow flex items-center justify-center px-4 py-12">
  <div class="bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center border-4 border-yellow-400">

    <!-- ğŸ‘‹ Welcome Message -->
    <p id="welcome-msg" class="text-yellow-300 text-sm italic mb-2">
      Welcome back, <span id="welcome-name">loading...</span>
    </p>

<!-- ğŸ–¼ï¸ User Avatar or Discord Login -->
<div class="w-24 h-24 mx-auto mb-4">
  <a id="login-link" href="https://discord.com/oauth2/authorize?client_id=1357927342265204858&response_type=code&redirect_uri=https%3A%2F%2Fnarrrfs.world%2Fapi%2Fauth%2Fcallback.php&scope=identify+guilds+guilds.members.read">
    <img id="avatar"
         class="rounded-full border-4 border-yellow-500 shadow animate-bounce cursor-pointer transition hover:scale-105"
         src="img/grumpy-cheese.png"
         alt="Grumpy Guest Avatar"
         title="Click to login via Discord"
         width="96"
         height="96" />
  </a>
</div>

    <!-- ğŸ“› Username Display -->
    <h1 id="username" class="text-2xl font-bold text-yellow-300">Loading...</h1>
    <p id="email" class="text-sm text-gray-400">...</p>
    <p id="guilds" class="mt-2 text-sm text-yellow-100 italic">Guilds loading...</p>

    <!-- ğŸ§ª Traits + Wallet View -->
    <div class="mt-6 bg-yellow-100 text-gray-900 rounded-lg p-4 shadow-inner">
      <h2 class="font-semibold text-lg mb-2">ğŸ’ Wallet & Traits</h2>
      <p id="wallet-address">ğŸ”— Linked wallet: <em class="text-sm">coming soon</em></p>
      <p>ğŸ§¬ Traits: <span id="traits">pending sync</span></p>
      <p id="user-roles" class="mt-3 text-sm text-yellow-900 italic">Roles: loading...</p>
    </div>

    <!-- âœ… Session Note -->
    <div class="mt-4 text-xs text-gray-300 italic">
      OAuth session live Â· Verified via Discord
    </div>

    <!-- ğŸ‘£ Footer Note -->
    <div class="mt-6 text-yellow-400 text-sm">
      ğŸ§  Profile powered by Cheese Architect 5.0 Â· Phase 2 Bridge Online
    </div>
<!-- ğŸ§€ Trophy Shelf Zone -->
<section id="trophy-shelf" class="my-16 px-4">
  <h2 class="text-center text-2xl sm:text-3xl font-extrabold text-yellow-400 mb-6 drop-shadow">
    ğŸ† Role Trophy Shelf
  </h2>

  <div id="cheeseShelf" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6 justify-items-center">
    <!-- Dynamic trophies will appear here -->
  </div>

  <p class="text-center mt-6 text-xs italic text-yellow-200">Collect all the cheese pokals... or be forgotten.</p>
</section>
  </div>
</main>
<!-- ğŸ§€ Wanted Profile Card -->
<section class="my-16 flex justify-center items-center">
  <div class="bg-yellow-100 border-8 border-yellow-500 shadow-2xl rounded-lg p-8 relative max-w-lg mx-auto transform transition duration-500 hover:scale-105">

    <!-- ğŸ“œ Top Wanted Header -->
    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-yellow-500 text-white py-2 px-4 rounded-full shadow-md text-xl font-extrabold tracking-wide border-4 border-white">
      ğŸ§  WANTED CHEESE PROFILE ğŸ§€
    </div>

    <!-- ğŸ‘¤ Profile Info -->
    <div class="mt-4 space-y-3 text-left">
      <p class="text-lg font-bold text-yellow-900">
        ğŸ§€ Name: <span class="font-normal text-gray-800">MasterCheese#002</span>
      </p>
      <p class="text-lg font-bold text-yellow-900">
        ğŸ§  Roles:
        <span class="font-normal text-gray-800">Puzzle Adept, Lore Mage</span>
      </p>
      
      <!-- ğŸ“Š Stats Block -->
      <div class="bg-white bg-opacity-70 border-l-4 border-yellow-400 rounded p-4 mt-4 shadow-inner">
        <h4 class="font-bold text-yellow-800 mb-2">ğŸ“Š Stats</h4>
        <ul class="list-disc list-inside text-sm text-gray-800">
          <li>ğŸ§¬ Traits Unlocked: <strong>7 / 10</strong></li>
          <li>ğŸšª Portals Accessed: <strong>3</strong></li>
          <li>ğŸ“œ Lore Solved: <strong>2 riddles</strong></li>
          <li>ğŸ§€ Cheese Clicks: <strong>41</strong></li>
          <li>ğŸŒ Discord Role Sync: <strong>Complete âœ…</strong></li>
        </ul>
      </div>

      <!-- ğŸ§ª Skills Block -->
      <div class="bg-yellow-200 bg-opacity-60 rounded p-3 shadow-md">
        <h4 class="font-bold text-yellow-800">ğŸ§ª Skills</h4>
        <ul class="list-disc list-inside text-sm text-gray-700">
          <li>ğŸ¥š Egg Whisperer</li>
          <li>ğŸ—ºï¸ Chaos Cartographer</li>
          <li>ğŸ” Riddle Solver</li>
        </ul>
      </div>

      <!-- ğŸ” Access Levels -->
      <div class="bg-white bg-opacity-70 border-l-4 border-indigo-400 rounded p-4 shadow-inner">
        <h4 class="font-bold text-indigo-800 mb-2">ğŸ” Access Levels</h4>
        <ul class="flex gap-2 flex-wrap text-sm">
          <li class="bg-green-400 text-white px-3 py-1 rounded-full">ğŸŸ¢ Lore Portal</li>
          <li class="bg-yellow-400 text-white px-3 py-1 rounded-full">ğŸŸ¡ Hytopia Portal</li>
          <li class="bg-red-400 text-white px-3 py-1 rounded-full">ğŸ”´ Lab 3 (Locked)</li>
        </ul>
      </div>

      <!-- ğŸ’° Currency & NFTs -->
      <div class="bg-purple-100 border-l-4 border-purple-400 rounded p-4 shadow-inner">
        <h4 class="font-bold text-purple-800 mb-2">ğŸ’° Wallet & NFTs</h4>
        <ul class="list-disc list-inside text-sm text-gray-700">
          <li>ğŸ’ $SPOINC Balance: <strong>1,234</strong></li>
          <li>ğŸª™ $DSPOINC Balance: <strong>12,340</strong> (swap rate: 1 SPOINC â†”ï¸ 10,000 DSPOINC)</li>
          <li>ğŸ´ NFTs: 2x VIP Cheese, 1x LoreKey</li>
        </ul>
      </div>

      <!-- ğŸª§ Wanted Status -->
      <div class="text-center text-red-700 font-bold mt-4 animate-pulse">
        ğŸª§ STATUS: ğŸ”¥ WANTED FOR TRAIT THEFT
      </div>
    </div>

    <!-- ğŸ§€ Bottom Cheese Stamp -->
    <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 bg-yellow-500 text-white p-2 rounded-full border-4 border-white shadow-md">
      ğŸ§€ Official Cheese Stamp ğŸ§€
    </div>
  </div>
</section>

  <!-- ğŸ© Footer -->
  <footer class="text-center mt-16 text-xs text-gray-400">
    Powered by ğŸ§€ Cheese Architect 5.0 Â· Discord + Game + Wallet Sync Engine ğŸŒ
  </footer>
</body>

<!-- ğŸŸï¸ Quick Action Buttons -->
<div class="flex justify-center gap-4 my-12">
  
  <!-- ğŸ”‘ Conditional Login Button -->
  <a href="/profile.html" class="bg-indigo-500 text-white px-4 py-2 rounded-full shadow hover:bg-indigo-600">
    ğŸ”‘ Login / Sync Profile
  </a>

  <!-- ğŸ§ª Back to Lab Button -->
  <a href="/index.html" class="bg-yellow-500 text-white px-4 py-2 rounded-full shadow hover:bg-yellow-600">
    ğŸ§ª Back to the Lab
  </a>

  <!-- ğŸ§¬ Traits Button -->
  <a href="#traits" class="bg-pink-500 text-white px-4 py-2 rounded-full shadow hover:bg-pink-600">
    ğŸ§¬ View Traits
  </a>

  <!-- ğŸšª Portals Button -->
  <a href="#portals" class="bg-blue-500 text-white px-4 py-2 rounded-full shadow hover:bg-blue-600">
    ğŸšª Open Portals
  </a>

  <!-- ğŸ’° Wallet Button -->
  <a href="#wallet" class="bg-purple-500 text-white px-4 py-2 rounded-full shadow hover:bg-purple-600">
    ğŸ’° Manage Wallet
  </a>
</div>
  
  <!-- ğŸŒ€ Cheese Portal to Hytopia -->
<div class="mt-10 text-center">
  <a href="/hytopia.html" class="group inline-block relative" title="ğŸ§€ Hytopia portal is closed... for now.">
    <div class="relative p-4 rounded-full bg-yellow-300/90 hover:bg-yellow-400 transition-all duration-300 shadow-2xl animate-pulse">
      <img src="img/cheese-portal.png" alt="Enter Hytopia" class="w-24 h-24 sm:w-32 sm:h-32 mx-auto group-hover:scale-105 transition-transform duration-300 drop-shadow-lg" />
      <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
        <div class="text-xs bg-black/80 text-yellow-300 px-3 py-1 rounded-full shadow-md animate-pulse">
          ğŸ§€ Portal Closed Â· Opening Soon!
        </div>
      </div>
      
<!-- ğŸ” Dynamic Fetch Script logged in or not -->
<script>
const trophies = {
  "VIP Holder":             { img: "img/trophy_VIP.png", label: "VIP Cheese Lord" },
  "PokerOG":                { img: "img/trophy_PokerOG.png", label: "Poker OG" },
  "Champion":               { img: "img/trophy_champion.png", label: "Champion" },
  "Rumble":                 { img: "img/trophy_rumble.png", label: "Rumble Champ" },
  "Engage":                 { img: "img/trophy_engage.png", label: "Engager" },
  "Moderator":              { img: "img/trophy_moderator.png", label: "Moderator" },
  "Server Booster":         { img: "img/trophy_serverbooster.png", label: "Server Booster" },
  "Alpha Caller":           { img: "img/trophy_alphacaller.png", label: "Alpha Caller" },
  "Crypto Corn Friends":    { img: "img/trophy_cryptocornfriends.png", label: "Corny Companion" },
  "Rabbit Friends":         { img: "img/trophy_rabbitfriends.png", label: "Bunny Buddy" },
  "Kaleido Friends":        { img: "img/trophy_kaleidofriends.png", label: "Kaleido Supporter" },
  "Weedery Friends":        { img: "img/trophy_weederyfriends.png", label: "Weedery ğŸŒ¿" },
  "Community Member":       { img: "img/trophy_community.png", label: "Community Member" },
  "Verifiziert":            { img: "img/trophy_verified.png", label: "Verified" },
};

function renderTrophyShelf(userRoles = []) {
  const shelf = document.getElementById("cheeseShelf");
  if (!shelf) return;

  shelf.innerHTML = ""; // Clear shelf

  const uniqueRoles = [...new Set(userRoles)];

  uniqueRoles.forEach(role => {
    const trophy = trophies[role];
    if (trophy) {
      const trophyEl = document.createElement("div");
      trophyEl.className = "flex flex-col items-center animate-pop transition-transform hover:scale-105";

      trophyEl.innerHTML = `
        <img src="${trophy.img}" alt="${trophy.label}" class="w-16 h-16 sm:w-20 sm:h-20 drop-shadow mb-2" />
        <span class="text-sm text-yellow-100 font-semibold text-center">${trophy.label}</span>
      `;
      shelf.appendChild(trophyEl);
    }
  });
}

document.addEventListener("DOMContentLoaded", async function () {
  const avatar = document.getElementById('avatar');
  const loginLink = document.getElementById('login-link');

  try {
    const res = await fetch('/api/user.php', { credentials: 'include' });

    if (!res.ok) {
      // ğŸ§€ Not logged in
      document.getElementById('username').innerText = 'Not Logged In';
      document.getElementById('welcome-name').innerText = 'Guest#';
      document.getElementById('email').innerText = 'Please log in';
      document.getElementById('guilds').innerText = 'No guild data';
      document.getElementById('traits').innerText = 'Please log in';
      document.getElementById('user-roles').innerText = 'No roles synced';
      document.getElementById('wallet-address').innerText = 'Not connected';
      return;
    }

    // âœ… Logged in
    const user = await res.json();
    const fullUsername = `${user.username}#${user.discriminator}`;

    avatar.src = user.avatarUrl || 'img/default-avatar.png';
    avatar.alt = fullUsername;
    avatar.title = fullUsername;
    avatar.classList.remove('cursor-pointer');
    loginLink.removeAttribute('href');

    document.getElementById('username').innerText = fullUsername;
    document.getElementById('welcome-name').innerText = fullUsername;
    document.getElementById('email').innerText = user.email || 'No email provided';
    document.getElementById('guilds').innerText = `ğŸ¯ Guilds Connected: ${user.guilds?.length || 0}`;
    document.getElementById('traits').innerText = user.traits?.join(', ') || 'Traits sync soon';
    document.getElementById('user-roles').innerText = user.roles?.join(', ') || 'roles synched';
    document.getElementById('wallet-address').innerText = localStorage.getItem('walletAddress') || 'coming soon';

    // ğŸ‘‘ VIP Status + Trophy Shelf
    const vipRes = await fetch('/api/user/roles.php');
    const vipData = await vipRes.json();
    const roles = vipData.roles || [];

    renderTrophyShelf(roles);

    if (roles.includes("VIP Holder") || roles.includes("VIP_pass")) {
      document.getElementById('goldenCheeseGate').classList.remove('hidden');
    } else {
      document.getElementById('noCheeseJoke').classList.remove('hidden');
    }

  } catch (err) {
    console.error('Profile fetch failed:', err);
  }
});
</script>

</body>
</html>
